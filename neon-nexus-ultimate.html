<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0a0a0f">
    <title>Neon Nexus - The Ultimate Idle Experience</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    
    <style>
/* ===== NEON NEXUS - DARK/NEON THEME ===== */

/* Reset & Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    /* Neon Colors */
    --neon-cyan: #00ffff;
    --neon-magenta: #ff00ff;
    --neon-blue: #0080ff;
    --neon-green: #00ff00;
    --neon-pink: #ff1493;
    --neon-yellow: #ffff00;
    --neon-purple: #9d00ff;
    --neon-orange: #ff6600;
    
    /* Dark Theme */
    --bg-dark: #0a0a0f;
    --bg-panel: #12121a;
    --bg-card: #1a1a28;
    --bg-hover: #22223a;
    --text-primary: #ffffff;
    --text-secondary: #a0a0c0;
    --border-color: #2a2a40;
    
    /* Gradients */
    --gradient-main: linear-gradient(135deg, #00ffff 0%, #ff00ff 100%);
    --gradient-alt: linear-gradient(135deg, #0080ff 0%, #9d00ff 100%);
    --gradient-success: linear-gradient(135deg, #00ff00 0%, #00ffff 100%);
    --gradient-warning: linear-gradient(135deg, #ffff00 0%, #ff6600 100%);
    --gradient-danger: linear-gradient(135deg, #ff00ff 0%, #ff0000 100%);
}

body {
    font-family: 'Rajdhani', sans-serif;
    background: var(--bg-dark);
    color: var(--text-primary);
    overflow-x: hidden;
    min-height: 100vh;
}

/* Animated Star Background */
.stars {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0;
    background: 
        radial-gradient(2px 2px at 20% 30%, white, transparent),
        radial-gradient(2px 2px at 60% 70%, white, transparent),
        radial-gradient(1px 1px at 50% 50%, white, transparent),
        radial-gradient(1px 1px at 80% 10%, white, transparent),
        radial-gradient(2px 2px at 90% 60%, white, transparent),
        radial-gradient(1px 1px at 33% 80%, white, transparent),
        radial-gradient(2px 2px at 70% 40%, white, transparent);
    background-size: 200% 200%;
    animation: starMove 200s linear infinite;
    opacity: 0.3;
}

@keyframes starMove {
    from { background-position: 0 0; }
    to { background-position: 200% 200%; }
}

/* Main Container */
.game-container {
    position: relative;
    z-index: 1;
    max-width: 1920px;
    margin: 0 auto;
    padding: 20px;
}

/* Header */
.game-header {
    background: var(--bg-panel);
    border: 2px solid var(--border-color);
    border-radius: 15px;
    padding: 20px 30px;
    margin-bottom: 20px;
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.2);
    position: relative;
    overflow: hidden;
}

.game-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);
    animation: shimmer 3s infinite;
}

@keyframes shimmer {
    to { left: 100%; }
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.game-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 3em;
    font-weight: 900;
    letter-spacing: 0.1em;
    margin: 0;
}

.neon-text {
    color: var(--neon-cyan);
    text-shadow: 
        0 0 10px var(--neon-cyan),
        0 0 20px var(--neon-cyan),
        0 0 30px var(--neon-cyan),
        0 0 40px var(--neon-cyan);
    animation: neonPulse 2s ease-in-out infinite;
}

.nexus-text {
    color: var(--neon-magenta);
    text-shadow: 
        0 0 10px var(--neon-magenta),
        0 0 20px var(--neon-magenta),
        0 0 30px var(--neon-magenta),
        0 0 40px var(--neon-magenta);
    animation: neonPulse 2s ease-in-out infinite 0.5s;
}

@keyframes neonPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; }
}

.header-stats {
    display: flex;
    gap: 30px;
}

.stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px 20px;
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    min-width: 100px;
}

.stat-label {
    font-size: 0.9em;
    color: var(--text-secondary);
    margin-bottom: 5px;
}

.stat-value {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.8em;
    font-weight: 700;
    color: var(--neon-cyan);
    text-shadow: 0 0 10px var(--neon-cyan);
}

.prestige-value {
    color: var(--neon-magenta);
    text-shadow: 0 0 10px var(--neon-magenta);
}

/* Game Content Layout */
.game-content {
    display: grid;
    grid-template-columns: 1fr 2fr 1fr;
    gap: 20px;
    min-height: 70vh;
}

/* Panel Styling */
.left-panel, .center-panel, .right-panel {
    background: var(--bg-panel);
    border: 2px solid var(--border-color);
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.1);
}

/* Energy Display */
.energy-display {
    text-align: center;
    padding: 30px 20px;
    background: var(--bg-card);
    border: 2px solid var(--neon-cyan);
    border-radius: 15px;
    margin-bottom: 30px;
    box-shadow: 
        0 0 20px rgba(0, 255, 255, 0.3),
        inset 0 0 20px rgba(0, 255, 255, 0.1);
}

.energy-label {
    font-size: 1.2em;
    color: var(--text-secondary);
    margin-bottom: 10px;
    letter-spacing: 0.1em;
}

.energy-amount {
    font-family: 'Orbitron', sans-serif;
    font-size: 3em;
    font-weight: 900;
    color: var(--neon-cyan);
    text-shadow: 
        0 0 10px var(--neon-cyan),
        0 0 20px var(--neon-cyan),
        0 0 30px var(--neon-cyan);
    margin: 10px 0;
    animation: energyGlow 2s ease-in-out infinite;
}

@keyframes energyGlow {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.energy-per-sec {
    font-size: 1.3em;
    color: var(--neon-green);
    text-shadow: 0 0 10px var(--neon-green);
}

/* Main Click Button */
.click-area {
    text-align: center;
    margin: 30px 0;
    position: relative;
}

.main-click-btn {
    width: 250px;
    height: 250px;
    border: none;
    border-radius: 50%;
    background: var(--gradient-main);
    cursor: pointer;
    position: relative;
    transition: all 0.2s ease;
    box-shadow: 
        0 0 40px rgba(0, 255, 255, 0.5),
        0 0 60px rgba(255, 0, 255, 0.3),
        inset 0 0 30px rgba(255, 255, 255, 0.2);
}

.main-click-btn:hover {
    transform: scale(1.05);
    box-shadow: 
        0 0 60px rgba(0, 255, 255, 0.8),
        0 0 80px rgba(255, 0, 255, 0.5),
        inset 0 0 40px rgba(255, 255, 255, 0.3);
}

.main-click-btn:active {
    transform: scale(0.95);
}

.click-btn-inner {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
}

.click-icon {
    font-size: 5em;
    margin-bottom: 10px;
    animation: iconFloat 2s ease-in-out infinite;
}

@keyframes iconFloat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.click-text {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.5em;
    font-weight: 700;
    color: white;
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
}

/* Combo Counter */
.combo-counter {
    margin-top: 20px;
    padding: 10px 20px;
    background: var(--bg-card);
    border: 2px solid var(--neon-orange);
    border-radius: 10px;
    display: inline-block;
    box-shadow: 0 0 20px rgba(255, 102, 0, 0.5);
    animation: comboPulse 0.5s ease-in-out infinite;
}

@keyframes comboPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.combo-text {
    color: var(--text-secondary);
    margin-right: 10px;
}

.combo-value {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.5em;
    font-weight: 700;
    color: var(--neon-orange);
    text-shadow: 0 0 10px var(--neon-orange);
}

/* Multipliers Display */
.multipliers-display {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    margin: 20px 0;
}

.multiplier-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid var(--border-color);
}

.multiplier-item:last-child {
    border-bottom: none;
}

.mult-label {
    color: var(--text-secondary);
}

.mult-value {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    color: var(--neon-cyan);
    text-shadow: 0 0 10px var(--neon-cyan);
}

.prestige-mult .mult-value {
    color: var(--neon-magenta);
    text-shadow: 0 0 10px var(--neon-magenta);
}

/* Active Power-ups */
.active-powerups {
    margin: 20px 0;
}

.powerup-active-item {
    background: var(--bg-card);
    border: 2px solid var(--neon-yellow);
    border-radius: 10px;
    padding: 10px;
    margin-bottom: 10px;
    box-shadow: 0 0 15px rgba(255, 255, 0, 0.3);
    animation: powerupGlow 1s ease-in-out infinite;
}

@keyframes powerupGlow {
    0%, 100% { box-shadow: 0 0 15px rgba(255, 255, 0, 0.3); }
    50% { box-shadow: 0 0 25px rgba(255, 255, 0, 0.6); }
}

.powerup-active-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.powerup-active-name {
    font-weight: 700;
    color: var(--neon-yellow);
}

.powerup-active-timer {
    color: var(--text-secondary);
    font-size: 0.9em;
}

.powerup-progress {
    width: 100%;
    height: 4px;
    background: var(--bg-dark);
    border-radius: 2px;
    margin-top: 5px;
    overflow: hidden;
}

.powerup-progress-fill {
    height: 100%;
    background: var(--neon-yellow);
    transition: width 0.1s linear;
    box-shadow: 0 0 10px var(--neon-yellow);
}

/* Section Title */
.section-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.3em;
    font-weight: 700;
    color: var(--neon-cyan);
    text-shadow: 0 0 10px var(--neon-cyan);
    margin-bottom: 15px;
    text-align: center;
    letter-spacing: 0.1em;
}

/* Milestones */
.milestones-section {
    margin-top: 30px;
}

.milestones-list {
    max-height: 300px;
    overflow-y: auto;
}

.milestone-item {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 10px;
    transition: all 0.3s ease;
}

.milestone-item.unlocked {
    border-color: var(--neon-green);
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
}

.milestone-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.milestone-name {
    font-weight: 700;
    color: var(--neon-cyan);
}

.milestone-reward {
    color: var(--neon-green);
    font-size: 0.9em;
}

.milestone-progress-bar {
    width: 100%;
    height: 8px;
    background: var(--bg-dark);
    border-radius: 4px;
    overflow: hidden;
    position: relative;
}

.milestone-progress-fill {
    height: 100%;
    background: var(--gradient-success);
    transition: width 0.3s ease;
    box-shadow: 0 0 10px var(--neon-green);
}

.milestone-progress-text {
    text-align: center;
    font-size: 0.85em;
    color: var(--text-secondary);
    margin-top: 5px;
}

/* Tab Navigation */
.tab-navigation {
    display: flex;
    gap: 5px;
    margin-bottom: 20px;
    border-bottom: 2px solid var(--border-color);
}

.tab-btn {
    flex: 1;
    padding: 15px 10px;
    background: var(--bg-card);
    border: none;
    border-bottom: 3px solid transparent;
    color: var(--text-secondary);
    font-family: 'Rajdhani', sans-serif;
    font-size: 1.1em;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.tab-btn:hover {
    background: var(--bg-hover);
    color: var(--neon-cyan);
}

.tab-btn.active {
    color: var(--neon-cyan);
    border-bottom-color: var(--neon-cyan);
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
}

/* Tab Content */
.tab-content {
    min-height: 600px;
}

.tab-pane {
    display: none;
    animation: fadeIn 0.3s ease;
}

.tab-pane.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Upgrades Grid */
.upgrades-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 15px;
    max-height: 650px;
    overflow-y: auto;
    padding-right: 10px;
}

.upgrade-card {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.upgrade-card:hover {
    border-color: var(--neon-cyan);
    transform: translateY(-5px);
    box-shadow: 0 5px 30px rgba(0, 255, 255, 0.4);
}

.upgrade-card.maxed {
    opacity: 0.6;
    cursor: not-allowed;
    border-color: var(--neon-green);
}

.upgrade-card.maxed::after {
    content: 'MAX';
    position: absolute;
    top: 10px;
    right: 10px;
    background: var(--neon-green);
    color: var(--bg-dark);
    padding: 3px 8px;
    border-radius: 5px;
    font-weight: 700;
    font-size: 0.8em;
}

.upgrade-card.locked {
    opacity: 0.4;
    cursor: not-allowed;
    filter: grayscale(1);
}

.upgrade-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.upgrade-icon {
    font-size: 2em;
}

.upgrade-level {
    background: var(--bg-dark);
    padding: 3px 10px;
    border-radius: 5px;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.9em;
    color: var(--neon-cyan);
}

.upgrade-name {
    font-weight: 700;
    font-size: 1.1em;
    color: var(--neon-cyan);
    margin-bottom: 5px;
}

.upgrade-description {
    color: var(--text-secondary);
    font-size: 0.9em;
    margin-bottom: 10px;
    line-height: 1.4;
}

.upgrade-effect {
    color: var(--neon-green);
    font-size: 0.9em;
    margin-bottom: 10px;
}

.upgrade-cost {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 10px;
    border-top: 1px solid var(--border-color);
}

.cost-label {
    color: var(--text-secondary);
    font-size: 0.9em;
}

.cost-value {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    color: var(--neon-cyan);
}

.cost-value.affordable {
    color: var(--neon-green);
}

.cost-value.expensive {
    color: var(--neon-magenta);
}

/* Generators List */
.generators-list {
    max-height: 650px;
    overflow-y: auto;
    padding-right: 10px;
}

.generator-card {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.generator-card:hover {
    border-color: var(--neon-blue);
    box-shadow: 0 0 30px rgba(0, 128, 255, 0.4);
    transform: translateX(5px);
}

.generator-card.locked {
    opacity: 0.4;
    cursor: not-allowed;
    filter: grayscale(1);
}

.generator-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.generator-info {
    flex: 1;
}

.generator-icon {
    font-size: 2.5em;
    margin-right: 15px;
}

.generator-name {
    font-weight: 700;
    font-size: 1.3em;
    color: var(--neon-blue);
    margin-bottom: 5px;
}

.generator-count {
    font-family: 'Orbitron', sans-serif;
    color: var(--text-secondary);
}

.generator-count-value {
    color: var(--neon-cyan);
    font-weight: 700;
}

.generator-production {
    color: var(--neon-green);
    font-size: 0.95em;
    margin-bottom: 10px;
}

.generator-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.generator-cost {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    font-size: 1.1em;
}

.generator-multiplier {
    background: var(--bg-dark);
    padding: 5px 10px;
    border-radius: 5px;
    color: var(--neon-yellow);
    font-size: 0.9em;
}

/* Power-ups Grid */
.powerups-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    max-height: 650px;
    overflow-y: auto;
}

.powerup-card {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.powerup-card:hover {
    border-color: var(--neon-yellow);
    transform: translateY(-5px);
    box-shadow: 0 5px 30px rgba(255, 255, 0, 0.4);
}

.powerup-card.active {
    border-color: var(--neon-green);
    background: rgba(0, 255, 0, 0.1);
    animation: powerupActive 2s ease-in-out infinite;
}

@keyframes powerupActive {
    0%, 100% { box-shadow: 0 0 20px rgba(0, 255, 0, 0.5); }
    50% { box-shadow: 0 0 40px rgba(0, 255, 0, 0.8); }
}

.powerup-card.cooldown {
    opacity: 0.5;
    cursor: not-allowed;
}

.powerup-icon {
    font-size: 3em;
    margin-bottom: 10px;
}

.powerup-name {
    font-weight: 700;
    font-size: 1.1em;
    color: var(--neon-yellow);
    margin-bottom: 10px;
}

.powerup-description {
    color: var(--text-secondary);
    font-size: 0.9em;
    margin-bottom: 10px;
    line-height: 1.4;
}

.powerup-duration {
    color: var(--neon-cyan);
    font-size: 0.85em;
    margin-bottom: 10px;
}

.powerup-cost {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    color: var(--neon-green);
}

.powerup-cooldown {
    position: absolute;
    top: 10px;
    right: 10px;
    background: var(--bg-dark);
    padding: 3px 8px;
    border-radius: 5px;
    font-size: 0.8em;
    color: var(--neon-magenta);
}

/* Achievements */
.achievements-filter {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    justify-content: center;
}

.filter-btn {
    padding: 10px 20px;
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 8px;
    color: var(--text-secondary);
    font-family: 'Rajdhani', sans-serif;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
}

.filter-btn:hover {
    border-color: var(--neon-cyan);
    color: var(--neon-cyan);
}

.filter-btn.active {
    background: var(--neon-cyan);
    color: var(--bg-dark);
    border-color: var(--neon-cyan);
}

.achievements-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 15px;
    max-height: 600px;
    overflow-y: auto;
}

.achievement-card {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    transition: all 0.3s ease;
    position: relative;
}

.achievement-card.unlocked {
    border-color: var(--neon-green);
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
}

.achievement-card.locked {
    opacity: 0.5;
    filter: grayscale(1);
}

.achievement-tier {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 3px 8px;
    border-radius: 5px;
    font-size: 0.8em;
    font-weight: 700;
}

.achievement-tier.bronze {
    background: #cd7f32;
    color: white;
}

.achievement-tier.silver {
    background: #c0c0c0;
    color: var(--bg-dark);
}

.achievement-tier.gold {
    background: #ffd700;
    color: var(--bg-dark);
}

.achievement-tier.platinum {
    background: linear-gradient(135deg, #e5e4e2, #ffffff);
    color: var(--bg-dark);
}

.achievement-tier.diamond {
    background: linear-gradient(135deg, #b9f2ff, #00ffff);
    color: var(--bg-dark);
}

.achievement-icon {
    font-size: 3em;
    margin-bottom: 10px;
}

.achievement-name {
    font-weight: 700;
    font-size: 1.1em;
    color: var(--neon-cyan);
    margin-bottom: 5px;
}

.achievement-description {
    color: var(--text-secondary);
    font-size: 0.9em;
    margin-bottom: 10px;
}

.achievement-reward {
    color: var(--neon-green);
    font-size: 0.9em;
    font-weight: 700;
}

.achievement-progress {
    margin-top: 10px;
}

.achievement-progress-bar {
    width: 100%;
    height: 6px;
    background: var(--bg-dark);
    border-radius: 3px;
    overflow: hidden;
    margin-top: 5px;
}

.achievement-progress-fill {
    height: 100%;
    background: var(--gradient-success);
    transition: width 0.3s ease;
}

.achievement-progress-text {
    font-size: 0.85em;
    color: var(--text-secondary);
    margin-top: 3px;
}

/* Prestige */
.prestige-info {
    text-align: center;
}

.prestige-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 2.5em;
    color: var(--neon-magenta);
    text-shadow: 
        0 0 10px var(--neon-magenta),
        0 0 20px var(--neon-magenta),
        0 0 30px var(--neon-magenta);
    margin-bottom: 20px;
    animation: neonPulse 2s ease-in-out infinite;
}

.prestige-description {
    color: var(--text-secondary);
    font-size: 1.2em;
    margin-bottom: 30px;
    line-height: 1.6;
}

.prestige-stats {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 30px;
}

.prestige-stat {
    display: flex;
    justify-content: space-between;
    padding: 15px;
    border-bottom: 1px solid var(--border-color);
}

.prestige-stat:last-child {
    border-bottom: none;
}

.pstat-label {
    color: var(--text-secondary);
    font-size: 1.1em;
}

.pstat-value {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    font-size: 1.2em;
    color: var(--neon-cyan);
}

.prestige-points {
    color: var(--neon-magenta) !important;
    text-shadow: 0 0 10px var(--neon-magenta);
}

.prestige-btn {
    padding: 20px 60px;
    font-family: 'Orbitron', sans-serif;
    font-size: 1.5em;
    font-weight: 700;
    background: var(--gradient-danger);
    border: none;
    border-radius: 15px;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.prestige-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 50px rgba(255, 0, 255, 0.8);
}

.prestige-btn:active {
    transform: scale(0.95);
}

.prestige-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.prestige-upgrades {
    margin-top: 40px;
    text-align: left;
}

.prestige-upgrades-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.prestige-upgrade-card {
    background: var(--bg-card);
    border: 2px solid var(--neon-magenta);
    border-radius: 10px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.prestige-upgrade-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 30px rgba(255, 0, 255, 0.4);
}

.prestige-upgrade-card.maxed {
    opacity: 0.6;
    cursor: not-allowed;
    border-color: var(--neon-green);
}

.prestige-upgrade-card.locked {
    opacity: 0.4;
    cursor: not-allowed;
    filter: grayscale(1);
}

/* Special Event */
.special-event {
    background: var(--bg-card);
    border: 3px solid var(--neon-yellow);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 0 30px rgba(255, 255, 0, 0.5);
    animation: eventPulse 1.5s ease-in-out infinite;
}

@keyframes eventPulse {
    0%, 100% { transform: scale(1); box-shadow: 0 0 30px rgba(255, 255, 0, 0.5); }
    50% { transform: scale(1.02); box-shadow: 0 0 50px rgba(255, 255, 0, 0.8); }
}

.event-header {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 10px;
}

.event-icon {
    font-size: 2em;
    margin-right: 10px;
}

.event-title {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    font-size: 1.2em;
    color: var(--neon-yellow);
    text-shadow: 0 0 10px var(--neon-yellow);
}

.event-description {
    color: var(--text-secondary);
    margin-bottom: 10px;
    text-align: center;
    line-height: 1.4;
}

.event-timer {
    text-align: center;
    font-family: 'Orbitron', sans-serif;
    font-size: 1.3em;
    color: var(--neon-orange);
    margin-bottom: 15px;
}

.event-claim-btn {
    width: 100%;
    padding: 12px;
    background: var(--gradient-warning);
    border: none;
    border-radius: 10px;
    font-family: 'Rajdhani', sans-serif;
    font-weight: 700;
    font-size: 1.1em;
    color: var(--bg-dark);
    cursor: pointer;
    transition: all 0.3s ease;
}

.event-claim-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 20px rgba(255, 255, 0, 0.6);
}

/* Statistics */
.statistics-section {
    margin-bottom: 30px;
}

.stats-list {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
}

.stat-row {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid var(--border-color);
}

.stat-row:last-child {
    border-bottom: none;
}

.stat-name {
    color: var(--text-secondary);
}

.stat-number {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    color: var(--neon-cyan);
}

/* Progress Section */
.progress-section {
    margin-bottom: 30px;
}

.progress-bar {
    width: 100%;
    height: 30px;
    background: var(--bg-dark);
    border: 2px solid var(--border-color);
    border-radius: 15px;
    overflow: hidden;
    position: relative;
    margin-top: 15px;
}

.progress-fill {
    height: 100%;
    background: var(--gradient-main);
    transition: width 0.3s ease;
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
}

.progress-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    color: white;
    text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
}

/* Settings */
.settings-section {
}

.settings-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.setting-btn {
    padding: 12px;
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    color: var(--text-primary);
    font-family: 'Rajdhani', sans-serif;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
}

.setting-btn:hover {
    border-color: var(--neon-cyan);
    background: var(--bg-hover);
    transform: translateX(5px);
}

.setting-btn.danger {
    border-color: var(--neon-magenta);
    color: var(--neon-magenta);
}

.setting-btn.danger:hover {
    background: rgba(255, 0, 255, 0.1);
}

/* Notifications */
.notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.notification {
    background: var(--bg-panel);
    border: 2px solid var(--neon-cyan);
    border-radius: 10px;
    padding: 15px 20px;
    min-width: 300px;
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
    animation: notificationSlide 0.3s ease;
}

@keyframes notificationSlide {
    from {
        transform: translateX(400px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.notification.success {
    border-color: var(--neon-green);
    box-shadow: 0 0 30px rgba(0, 255, 0, 0.5);
}

.notification.warning {
    border-color: var(--neon-yellow);
    box-shadow: 0 0 30px rgba(255, 255, 0, 0.5);
}

.notification.error {
    border-color: var(--neon-magenta);
    box-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
}

.notification-title {
    font-weight: 700;
    font-size: 1.1em;
    margin-bottom: 5px;
    color: var(--neon-cyan);
}

.notification.success .notification-title {
    color: var(--neon-green);
}

.notification.warning .notification-title {
    color: var(--neon-yellow);
}

.notification.error .notification-title {
    color: var(--neon-magenta);
}

.notification-message {
    color: var(--text-secondary);
    font-size: 0.95em;
}

/* Particles */
.particle-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 999;
}

.particle {
    position: absolute;
    font-size: 1.5em;
    font-weight: 700;
    font-family: 'Orbitron', sans-serif;
    color: var(--neon-cyan);
    text-shadow: 0 0 10px var(--neon-cyan);
    animation: particleFloat 1.5s ease-out forwards;
    pointer-events: none;
}

@keyframes particleFloat {
    0% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
    100% {
        opacity: 0;
        transform: translateY(-100px) scale(1.5);
    }
}

.particle-effect {
    position: absolute;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--neon-cyan);
    box-shadow: 0 0 10px var(--neon-cyan);
    animation: particleBurst 0.8s ease-out forwards;
}

@keyframes particleBurst {
    0% {
        opacity: 1;
        transform: translate(0, 0) scale(1);
    }
    100% {
        opacity: 0;
        transform: translate(var(--tx), var(--ty)) scale(0);
    }
}

/* Modal */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}

.modal-content {
    background: var(--bg-panel);
    border: 3px solid var(--neon-cyan);
    border-radius: 15px;
    padding: 30px;
    max-width: 500px;
    width: 90%;
    box-shadow: 0 0 50px rgba(0, 255, 255, 0.5);
}

.modal-content h2 {
    font-family: 'Orbitron', sans-serif;
    color: var(--neon-cyan);
    margin-bottom: 20px;
    text-align: center;
}

#import-textarea {
    width: 100%;
    height: 200px;
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    color: var(--text-primary);
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
    resize: vertical;
}

.modal-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.modal-btn {
    flex: 1;
    padding: 12px;
    background: var(--neon-cyan);
    border: none;
    border-radius: 10px;
    color: var(--bg-dark);
    font-family: 'Rajdhani', sans-serif;
    font-weight: 700;
    font-size: 1.1em;
    cursor: pointer;
    transition: all 0.3s ease;
}

.modal-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 20px var(--neon-cyan);
}

.modal-btn.cancel {
    background: var(--bg-card);
    color: var(--text-primary);
    border: 2px solid var(--border-color);
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

::-webkit-scrollbar-track {
    background: var(--bg-dark);
    border-radius: 5px;
}

::-webkit-scrollbar-thumb {
    background: var(--neon-cyan);
    border-radius: 5px;
    box-shadow: 0 0 10px var(--neon-cyan);
}

::-webkit-scrollbar-thumb:hover {
    background: var(--neon-magenta);
    box-shadow: 0 0 15px var(--neon-magenta);
}

/* ===== MOBILE OPTIMIZATION ===== */

/* Prevent zoom and text selection on mobile */
* {
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    touch-action: manipulation;
}

/* Prevent text selection on game elements */
.main-click-btn, .tab-btn, .upgrade-card, .generator-card, 
.powerup-card, .achievement-card, .setting-btn, .prestige-btn,
.event-claim-btn, .filter-btn {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

/* Touch feedback for all buttons */
.main-click-btn:active,
.tab-btn:active,
.upgrade-card:active,
.generator-card:active,
.powerup-card:active,
.setting-btn:active,
.prestige-btn:active,
.event-claim-btn:active,
.filter-btn:active,
.modal-btn:active {
    opacity: 0.8;
}

/* Responsive Design */
@media (max-width: 1400px) {
    .game-content {
        grid-template-columns: 1fr 2fr;
    }
    
    .right-panel {
        grid-column: 1 / -1;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
    }
}

@media (max-width: 900px) {
    .game-content {
        grid-template-columns: 1fr;
    }
    
    .game-title {
        font-size: 2em;
    }
    
    .header-stats {
        gap: 15px;
    }
    
    .tab-btn {
        font-size: 0.9em;
        padding: 12px 5px;
    }
}

/* ===== IPHONE OPTIMIZATION ===== */

/* iPhone Pro Max (430px), 14/13/12 (390px), SE (375px) */
@media (max-width: 768px) {
    /* Reduce container padding */
    .game-container {
        padding: 10px;
    }
    
    /* Header optimizations */
    .game-header {
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .header-content {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
    
    .game-title {
        font-size: 2em;
    }
    
    .header-stats {
        width: 100%;
        justify-content: center;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .stat-item {
        min-width: 80px;
        padding: 8px 15px;
    }
    
    .stat-value {
        font-size: 1.4em;
    }
    
    /* Stack all panels vertically */
    .game-content {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    /* Panel padding */
    .left-panel, .center-panel, .right-panel {
        padding: 15px;
    }
    
    /* Energy display */
    .energy-display {
        padding: 20px 15px;
        margin-bottom: 20px;
    }
    
    .energy-label {
        font-size: 1em;
    }
    
    .energy-amount {
        font-size: 2.2em;
    }
    
    .energy-per-sec {
        font-size: 1.1em;
    }
    
    /* Main click button - larger for mobile */
    .main-click-btn {
        width: 200px;
        height: 200px;
        min-width: 200px;
        min-height: 200px;
    }
    
    .click-icon {
        font-size: 4em;
    }
    
    .click-text {
        font-size: 1.2em;
    }
    
    /* Combo counter */
    .combo-counter {
        margin-top: 15px;
        padding: 8px 15px;
    }
    
    .combo-value {
        font-size: 1.3em;
    }
    
    /* Multipliers display */
    .multipliers-display {
        padding: 12px;
        margin: 15px 0;
    }
    
    .multiplier-item {
        padding: 10px 0;
        font-size: 1em;
    }
    
    /* Milestones */
    .milestones-section {
        margin-top: 20px;
    }
    
    .section-title {
        font-size: 1.1em;
        margin-bottom: 12px;
    }
    
    .milestones-list {
        max-height: 250px;
    }
    
    .milestone-item {
        padding: 12px;
    }
    
    /* Tab navigation - minimum 44px height for touch */
    .tab-navigation {
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 15px;
    }
    
    .tab-btn {
        flex: 1 1 calc(50% - 4px);
        min-width: 140px;
        padding: 14px 8px;
        font-size: 0.95em;
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    /* Tab content */
    .tab-content {
        min-height: 400px;
    }
    
    /* Upgrades grid - single column on mobile */
    .upgrades-grid {
        grid-template-columns: 1fr;
        gap: 12px;
        max-height: 500px;
        padding-right: 5px;
    }
    
    .upgrade-card {
        padding: 12px;
        min-height: 44px;
    }
    
    .upgrade-header {
        margin-bottom: 8px;
    }
    
    .upgrade-icon {
        font-size: 1.8em;
    }
    
    .upgrade-name {
        font-size: 1em;
    }
    
    .upgrade-description {
        font-size: 0.85em;
        margin-bottom: 8px;
    }
    
    /* Generators list */
    .generators-list {
        max-height: 500px;
        padding-right: 5px;
    }
    
    .generator-card {
        padding: 15px;
        margin-bottom: 12px;
        min-height: 44px;
    }
    
    .generator-header {
        margin-bottom: 12px;
        flex-wrap: wrap;
    }
    
    .generator-icon {
        font-size: 2em;
        margin-right: 12px;
    }
    
    .generator-name {
        font-size: 1.1em;
    }
    
    /* Power-ups grid - single column */
    .powerups-grid {
        grid-template-columns: 1fr;
        gap: 12px;
        max-height: 500px;
    }
    
    .powerup-card {
        padding: 12px;
        min-height: 44px;
    }
    
    .powerup-icon {
        font-size: 2.5em;
    }
    
    .powerup-name {
        font-size: 1em;
    }
    
    /* Achievements - 2 columns on mobile */
    .achievements-filter {
        gap: 8px;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }
    
    .filter-btn {
        padding: 10px 15px;
        min-height: 44px;
        font-size: 0.9em;
    }
    
    .achievements-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        max-height: 500px;
    }
    
    .achievement-card {
        padding: 10px;
    }
    
    .achievement-icon {
        font-size: 2.5em;
    }
    
    .achievement-name {
        font-size: 0.95em;
    }
    
    .achievement-description {
        font-size: 0.8em;
    }
    
    /* Prestige section */
    .prestige-title {
        font-size: 2em;
        margin-bottom: 15px;
    }
    
    .prestige-description {
        font-size: 1em;
        margin-bottom: 20px;
    }
    
    .prestige-stats {
        padding: 15px;
        margin-bottom: 20px;
    }
    
    .prestige-stat {
        padding: 12px;
        flex-direction: column;
        gap: 5px;
        text-align: center;
    }
    
    .pstat-label {
        font-size: 0.95em;
    }
    
    .pstat-value {
        font-size: 1.1em;
    }
    
    .prestige-btn {
        padding: 16px 40px;
        font-size: 1.2em;
        min-height: 54px;
    }
    
    .prestige-upgrades-grid {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    /* Right panel stacked */
    .right-panel {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    /* Special event */
    .special-event {
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .event-claim-btn {
        min-height: 44px;
        padding: 12px;
        font-size: 1em;
    }
    
    /* Statistics */
    .statistics-section {
        margin-bottom: 20px;
    }
    
    .stats-list {
        padding: 12px;
    }
    
    .stat-row {
        padding: 8px 0;
        font-size: 0.95em;
    }
    
    /* Settings */
    .settings-list {
        gap: 8px;
    }
    
    .setting-btn {
        padding: 14px;
        min-height: 44px;
        font-size: 0.95em;
    }
    
    /* Notifications - adjust position for mobile */
    .notification-container {
        top: 10px;
        right: 10px;
        left: 10px;
        max-width: calc(100% - 20px);
    }
    
    .notification {
        min-width: auto;
        width: 100%;
        padding: 12px 15px;
    }
    
    .notification-title {
        font-size: 1em;
    }
    
    .notification-message {
        font-size: 0.9em;
    }
    
    /* Modal */
    .modal-content {
        width: 95%;
        padding: 20px;
        max-width: none;
    }
    
    .modal-content h2 {
        font-size: 1.3em;
    }
    
    #import-textarea {
        height: 150px;
        font-size: 0.85em;
    }
    
    .modal-buttons {
        flex-direction: column;
        gap: 8px;
    }
    
    .modal-btn {
        width: 100%;
        min-height: 44px;
    }
    
    /* Active power-ups */
    .powerup-active-item {
        padding: 8px;
        margin-bottom: 8px;
    }
    
    /* Progress bar */
    .progress-bar {
        height: 25px;
    }
    
    /* Reduce particle size on mobile */
    .particle {
        font-size: 1.2em;
    }
    
    .particle-effect {
        width: 8px;
        height: 8px;
    }
}

/* iPhone SE (375px) and smaller */
@media (max-width: 375px) {
    .game-title {
        font-size: 1.6em;
    }
    
    .main-click-btn {
        width: 180px;
        height: 180px;
        min-width: 180px;
        min-height: 180px;
    }
    
    .click-icon {
        font-size: 3.5em;
    }
    
    .click-text {
        font-size: 1em;
    }
    
    .energy-amount {
        font-size: 2em;
    }
    
    .tab-btn {
        font-size: 0.85em;
        padding: 12px 5px;
        min-width: 120px;
    }
    
    .achievements-grid {
        grid-template-columns: 1fr;
    }
    
    .section-title {
        font-size: 1em;
    }
    
    .prestige-title {
        font-size: 1.6em;
    }
}

/* Portrait orientation optimizations */
@media (orientation: portrait) and (max-width: 768px) {
    /* Optimize spacing for portrait mode */
    .game-container {
        padding: 8px;
    }
    
    .game-header {
        padding: 12px;
    }
    
    /* Taller click button area for easier thumb reach */
    .click-area {
        margin: 20px 0;
    }
    
    /* Reduce animation intensity on mobile */
    .main-click-btn {
        animation: none;
    }
    
    .main-click-btn:hover {
        transform: none;
    }
    
    .main-click-btn:active {
        transform: scale(0.95);
    }
    
    /* Disable hover effects on touch devices */
    .upgrade-card:hover,
    .generator-card:hover,
    .powerup-card:hover {
        transform: none;
    }
    
    .upgrade-card:active,
    .generator-card:active,
    .powerup-card:active {
        transform: scale(0.98);
    }
}

/* Landscape orientation on mobile */
@media (orientation: landscape) and (max-height: 500px) {
    .game-header {
        padding: 10px 15px;
        margin-bottom: 10px;
    }
    
    .game-title {
        font-size: 1.5em;
    }
    
    .header-stats {
        gap: 10px;
    }
    
    .stat-item {
        padding: 5px 10px;
        min-width: 70px;
    }
    
    .stat-value {
        font-size: 1.2em;
    }
    
    .game-content {
        grid-template-columns: 1fr 2fr;
        gap: 10px;
    }
    
    .left-panel {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    
    .main-click-btn {
        width: 150px;
        height: 150px;
    }
    
    .click-icon {
        font-size: 3em;
    }
    
    .energy-display {
        padding: 15px 10px;
        margin-bottom: 15px;
    }
    
    .energy-amount {
        font-size: 2em;
    }
    
    .milestones-section {
        display: none;
    }
    
    .tab-content {
        min-height: 300px;
    }
}

/* Celebration Effects */
@keyframes celebration {
    0%, 100% {
        transform: scale(1) rotate(0deg);
    }
    25% {
        transform: scale(1.2) rotate(-5deg);
    }
    50% {
        transform: scale(1.3) rotate(5deg);
    }
    75% {
        transform: scale(1.2) rotate(-5deg);
    }
}

.celebrate {
    animation: celebration 0.6s ease-in-out;
}

/* Loading Animation */
@keyframes loading {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid var(--border-color);
    border-top-color: var(--neon-cyan);
    border-radius: 50%;
    animation: loading 1s linear infinite;
}
    
/* ===== NEW FEATURES CSS ===== */

/* Bulk Buy Options */
.bulk-buy-controls {
    display: flex;
    gap: 8px;
    justify-content: center;
    margin: 15px 0;
    flex-wrap: wrap;
}

.bulk-buy-btn {
    padding: 8px 16px;
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 8px;
    color: var(--text-primary);
    font-family: 'Orbitron', sans-serif;
    font-size: 0.9em;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 60px;
}

.bulk-buy-btn:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
    transform: translateY(-2px);
}

.bulk-buy-btn.active {
    background: var(--gradient-main);
    border-color: var(--neon-cyan);
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
}

/* Daily Rewards */
.daily-rewards-panel {
    background: var(--bg-card);
    border: 2px solid var(--neon-magenta);
    border-radius: 15px;
    padding: 20px;
    margin: 20px 0;
    text-align: center;
    box-shadow: 0 0 30px rgba(255, 0, 255, 0.3);
}

.daily-reward-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.8em;
    color: var(--neon-magenta);
    text-shadow: 0 0 10px var(--neon-magenta);
    margin-bottom: 15px;
}

.daily-streak {
    font-size: 1.3em;
    color: var(--neon-cyan);
    margin: 10px 0;
}

.daily-reward-btn {
    padding: 15px 40px;
    font-family: 'Orbitron', sans-serif;
    font-size: 1.2em;
    background: var(--gradient-main);
    border: none;
    border-radius: 10px;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
    margin-top: 15px;
}

.daily-reward-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 30px rgba(255, 0, 255, 0.8);
}

.daily-reward-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.daily-timer {
    color: var(--text-secondary);
    font-size: 1em;
    margin-top: 10px;
}

/* Challenges/Quests */
.challenges-panel {
    background: var(--bg-card);
    border: 2px solid var(--neon-blue);
    border-radius: 15px;
    padding: 20px;
    margin: 20px 0;
}

.challenge-card {
    background: var(--bg-panel);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
    transition: all 0.3s ease;
}

.challenge-card:hover {
    border-color: var(--neon-blue);
    box-shadow: 0 0 15px rgba(0, 128, 255, 0.3);
}

.challenge-card.completed {
    border-color: var(--neon-green);
    opacity: 0.7;
}

.challenge-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.challenge-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.1em;
    color: var(--neon-blue);
}

.challenge-reward {
    color: var(--neon-yellow);
    font-weight: bold;
}

.challenge-progress {
    margin: 10px 0;
}

.progress-bar-container {
    background: var(--bg-dark);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    height: 20px;
    overflow: hidden;
    position: relative;
}

.progress-bar {
    background: var(--gradient-main);
    height: 100%;
    transition: width 0.3s ease;
    border-radius: 10px;
}

.progress-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 0.85em;
    font-weight: bold;
    color: white;
    text-shadow: 0 0 5px black;
}

.challenge-claim-btn {
    padding: 8px 20px;
    background: var(--gradient-success);
    border: none;
    border-radius: 8px;
    color: white;
    font-family: 'Orbitron', sans-serif;
    cursor: pointer;
    transition: all 0.3s ease;
}

.challenge-claim-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
}

.challenge-claim-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

/* Skill Tree */
.skill-tree-container {
    padding: 20px;
}

.skill-branches {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
}

.skill-branch {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 15px;
    padding: 20px;
}

.branch-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.5em;
    text-align: center;
    margin-bottom: 20px;
    text-shadow: 0 0 10px currentColor;
}

.branch-title.production { color: var(--neon-green); }
.branch-title.clicking { color: var(--neon-cyan); }
.branch-title.automation { color: var(--neon-magenta); }
.branch-title.special { color: var(--neon-yellow); }

.skill-node {
    background: var(--bg-panel);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 12px;
    margin: 10px 0;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.skill-node:hover:not(.locked) {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
    transform: translateX(5px);
}

.skill-node.unlocked {
    border-color: var(--neon-green);
    background: linear-gradient(135deg, var(--bg-panel) 0%, rgba(0, 255, 0, 0.1) 100%);
}

.skill-node.locked {
    opacity: 0.5;
    cursor: not-allowed;
}

.skill-name {
    font-family: 'Orbitron', sans-serif;
    font-size: 1em;
    color: var(--neon-cyan);
    margin-bottom: 5px;
}

.skill-description {
    font-size: 0.9em;
    color: var(--text-secondary);
    margin: 5px 0;
}

.skill-cost {
    color: var(--neon-yellow);
    font-weight: bold;
    margin-top: 5px;
}

.skill-points-display {
    text-align: center;
    font-size: 1.3em;
    color: var(--neon-magenta);
    margin-bottom: 20px;
    padding: 15px;
    background: var(--bg-card);
    border: 2px solid var(--neon-magenta);
    border-radius: 10px;
}

/* Collection System */
.collection-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    padding: 20px;
}

.artifact-card {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
}

.artifact-card.common { border-color: #808080; }
.artifact-card.rare { border-color: var(--neon-blue); }
.artifact-card.epic { border-color: var(--neon-magenta); }
.artifact-card.legendary { border-color: var(--neon-yellow); }

.artifact-card.unlocked {
    box-shadow: 0 0 20px currentColor;
}

.artifact-card.locked {
    opacity: 0.4;
    filter: grayscale(1);
}

.artifact-icon {
    font-size: 3em;
    margin: 10px 0;
}

.artifact-name {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.1em;
    margin: 10px 0;
}

.artifact-rarity {
    font-size: 0.9em;
    font-weight: bold;
    text-transform: uppercase;
    margin: 5px 0;
}

.artifact-bonus {
    color: var(--neon-green);
    font-size: 0.95em;
    margin-top: 10px;
}

.collection-stats {
    text-align: center;
    padding: 20px;
    background: var(--bg-card);
    border: 2px solid var(--neon-cyan);
    border-radius: 10px;
    margin: 20px 0;
}

/* Settings Panel */
.settings-grid {
    display: grid;
    gap: 15px;
    padding: 20px;
}

.setting-row {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.setting-label {
    font-size: 1.1em;
    color: var(--text-primary);
}

.setting-description {
    font-size: 0.9em;
    color: var(--text-secondary);
    margin-top: 5px;
}

.toggle-switch {
    position: relative;
    width: 60px;
    height: 30px;
    background: var(--bg-dark);
    border: 2px solid var(--border-color);
    border-radius: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.toggle-switch.active {
    background: var(--gradient-main);
    border-color: var(--neon-cyan);
}

.toggle-slider {
    position: absolute;
    top: 2px;
    left: 2px;
    width: 22px;
    height: 22px;
    background: white;
    border-radius: 50%;
    transition: all 0.3s ease;
}

.toggle-switch.active .toggle-slider {
    left: 32px;
}

/* Enhanced Stats */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    padding: 20px;
}

.stat-card {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 20px;
    text-align: center;
}

.stat-card-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.95em;
    color: var(--text-secondary);
    margin-bottom: 10px;
}

.stat-card-value {
    font-size: 2em;
    font-weight: bold;
    color: var(--neon-cyan);
    text-shadow: 0 0 10px var(--neon-cyan);
}

/* Tooltip System */
.tooltip {
    position: fixed;
    background: rgba(10, 10, 15, 0.95);
    border: 2px solid var(--neon-cyan);
    border-radius: 10px;
    padding: 15px;
    max-width: 300px;
    z-index: 10000;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease;
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
}

.tooltip.show {
    opacity: 1;
}

.tooltip-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.2em;
    color: var(--neon-cyan);
    margin-bottom: 10px;
}

.tooltip-content {
    color: var(--text-primary);
    font-size: 0.95em;
    line-height: 1.4;
}

.tooltip-stat {
    margin: 5px 0;
    display: flex;
    justify-content: space-between;
}

.tooltip-label {
    color: var(--text-secondary);
}

.tooltip-value {
    color: var(--neon-green);
    font-weight: bold;
}

/* Floating Damage Numbers */
.damage-number {
    position: fixed;
    font-family: 'Orbitron', sans-serif;
    font-weight: bold;
    font-size: 1.5em;
    pointer-events: none;
    z-index: 9999;
    animation: floatUp 1.5s ease-out forwards;
    text-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
}

@keyframes floatUp {
    0% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
    100% {
        opacity: 0;
        transform: translateY(-100px) scale(1.5);
    }
}

.damage-number.crit {
    color: var(--neon-magenta);
    font-size: 2em;
}

.damage-number.golden {
    color: #ffd700;
    font-size: 2.2em;
}

/* Automation Panel */
.automation-panel {
    background: var(--bg-card);
    border: 2px solid var(--neon-purple);
    border-radius: 15px;
    padding: 20px;
    margin: 20px 0;
}

.automation-option {
    background: var(--bg-panel);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.automation-info h4 {
    color: var(--neon-purple);
    font-family: 'Orbitron', sans-serif;
    margin-bottom: 5px;
}

.automation-info p {
    color: var(--text-secondary);
    font-size: 0.9em;
}

/* Progression Tracker */
.progression-panel {
    background: var(--bg-card);
    border: 2px solid var(--neon-green);
    border-radius: 15px;
    padding: 20px;
    margin: 20px 0;
}

.next-milestone {
    background: var(--bg-panel);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    margin: 15px 0;
}

.milestone-icon {
    font-size: 2em;
    text-align: center;
    margin-bottom: 10px;
}

.milestone-name {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.2em;
    color: var(--neon-green);
    text-align: center;
    margin-bottom: 10px;
}

.recommendations-list {
    list-style: none;
    padding: 0;
}

.recommendation-item {
    background: var(--bg-panel);
    border-left: 4px solid var(--neon-cyan);
    padding: 12px;
    margin: 10px 0;
    border-radius: 5px;
}

.recommendation-item.priority {
    border-left-color: var(--neon-yellow);
}

/* Save Slot Management */
.save-slots {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    padding: 20px;
}

.save-slot {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.save-slot:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
}

.save-slot.active {
    border-color: var(--neon-green);
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
}

.save-slot.empty {
    opacity: 0.5;
    font-style: italic;
}

.save-slot-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.save-slot-name {
    font-family: 'Orbitron', sans-serif;
    color: var(--neon-cyan);
}

.save-slot-info {
    font-size: 0.9em;
    color: var(--text-secondary);
    margin: 5px 0;
}

/* Collapsible Sections */
.collapsible-header {
    background: var(--bg-panel);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
    margin: 10px 0;
}

.collapsible-header:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
}

.collapsible-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.2em;
    color: var(--neon-cyan);
}

.collapsible-arrow {
    font-size: 1.5em;
    transition: transform 0.3s ease;
}

.collapsible-header.collapsed .collapsible-arrow {
    transform: rotate(-90deg);
}

.collapsible-content {
    max-height: 1000px;
    overflow: hidden;
    transition: max-height 0.3s ease, opacity 0.3s ease;
    opacity: 1;
}

.collapsible-content.collapsed {
    max-height: 0;
    opacity: 0;
}

/* Streak Indicators */
.streak-indicator {
    display: inline-block;
    padding: 5px 15px;
    background: var(--gradient-warning);
    border-radius: 20px;
    font-family: 'Orbitron', sans-serif;
    font-weight: bold;
    box-shadow: 0 0 15px rgba(255, 165, 0, 0.5);
    animation: streakPulse 1.5s ease-in-out infinite;
}

@keyframes streakPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

/* Level Up Animation */
@keyframes levelUp {
    0% {
        transform: scale(1) rotate(0deg);
        opacity: 1;
    }
    50% {
        transform: scale(1.5) rotate(180deg);
        opacity: 0.8;
    }
    100% {
        transform: scale(2) rotate(360deg);
        opacity: 0;
    }
}

.level-up-effect {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 5em;
    pointer-events: none;
    z-index: 10000;
    animation: levelUp 2s ease-out forwards;
}

/* Achievement Popup Enhanced */
.achievement-popup {
    position: fixed;
    top: 20px;
    right: -400px;
    width: 350px;
    background: linear-gradient(135deg, var(--bg-card) 0%, rgba(255, 0, 255, 0.2) 100%);
    border: 3px solid var(--neon-magenta);
    border-radius: 15px;
    padding: 20px;
    z-index: 10000;
    transition: right 0.5s ease;
    box-shadow: 0 0 40px rgba(255, 0, 255, 0.6);
}

.achievement-popup.show {
    right: 20px;
}

.achievement-popup-icon {
    font-size: 3em;
    text-align: center;
    margin-bottom: 10px;
    animation: bounceIn 0.5s ease;
}

@keyframes bounceIn {
    0% { transform: scale(0); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

/* Time to Afford Display */
.time-to-afford {
    font-size: 0.85em;
    color: var(--neon-yellow);
    margin-top: 5px;
    font-style: italic;
}

/* DPS Display */
.dps-display {
    text-align: center;
    padding: 15px;
    background: var(--bg-card);
    border: 2px solid var(--neon-green);
    border-radius: 10px;
    margin: 15px 0;
}

.dps-value {
    font-size: 2em;
    color: var(--neon-green);
    font-family: 'Orbitron', sans-serif;
    text-shadow: 0 0 10px var(--neon-green);
}

.dps-label {
    color: var(--text-secondary);
    font-size: 1em;
    margin-top: 5px;
}

/* Mobile Optimizations */
@media (max-width: 768px) {
    .bulk-buy-controls {
        gap: 5px;
    }
    
    .bulk-buy-btn {
        padding: 6px 12px;
        font-size: 0.8em;
        min-width: 50px;
    }
    
    .skill-branches {
        grid-template-columns: 1fr;
    }
    
    .collection-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .save-slots {
        grid-template-columns: 1fr;
    }
    
    .tooltip {
        max-width: 250px;
        font-size: 0.9em;
    }
    
    .damage-number {
        font-size: 1.2em;
    }
}

/* Touch Feedback for New Elements */
@media (hover: none) {
    .bulk-buy-btn:active,
    .skill-node:active,
    .artifact-card:active,
    .save-slot:active,
    .challenge-claim-btn:active {
        opacity: 0.8;
        transform: scale(0.98);
    }
}

</style>
</head>

<body>
    <div class="stars"></div>
    <div class="game-container">
        <!-- Header -->
        <header class="game-header">
            <div class="header-content">
                <h1 class="game-title">
                    <span class="neon-text">NEON</span> <span class="nexus-text">NEXUS</span>
                </h1>
                <div class="header-stats">
                    <div class="stat-item">
                        <span class="stat-label">LEVEL</span>
                        <span class="stat-value" id="player-level">1</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">PRESTIGE</span>
                        <span class="stat-value prestige-value" id="prestige-count">0</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Game Area -->
        <div class="game-content">
            <!-- Left Panel: Main Clicker -->
            <div class="left-panel">
                <!-- Energy Display -->
                <div class="energy-display">
                    <div class="energy-label">ENERGY CORES</div>
                    <div class="energy-amount" id="energy-amount">0</div>
                    <div class="energy-per-sec">
                        <span id="energy-per-sec">0</span> /sec
                    </div>
                </div>

                <!-- Main Click Button -->
                <div class="click-area">
                    <button class="main-click-btn" id="main-click-btn">
                        <div class="click-btn-inner">
                            <div class="click-icon"></div>
                            <div class="click-text">GENERATE</div>
                        </div>
                    </button>
                    <div class="combo-counter" id="combo-counter" style="display: none;">
                        <span class="combo-text">COMBO</span>
                        <span class="combo-value" id="combo-value">0</span>x
                    </div>
                </div>

                <!-- Multipliers Display -->
                <div class="multipliers-display">
                    <div class="multiplier-item">
                        <span class="mult-label">Click Power:</span>
                        <span class="mult-value" id="click-power">1</span>
                    </div>
                    
                    <!-- Active Mutations -->
                    <div class="active-mutations" style="margin: 20px 0;">
                        <h4 class="section-title" style="font-size: 1.1em;"> Active Mutations</h4>
                        <div id="mutations-list" style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="color: var(--text-secondary); text-align: center; padding: 10px; font-size: 0.9em;">
                                No mutations active
                            </div>
                        </div>
                    </div>


                <!-- DPS Display -->
                <div class="dps-display">
                    <div class="dps-value" id="dps-value">0</div>
                    <div class="dps-label">Total DPS</div>
                </div>

                <!-- Progression Tracker -->
                <div class="progression-panel" style="margin-top: 20px;">
                    <h3 class="section-title"> NEXT GOALS</h3>
                    <div id="next-goals"></div>
                    <h4 style="margin-top: 15px; color: var(--neon-cyan);"> Recommendations</h4>
                    <ul class="recommendations-list" id="recommendations"></ul>
                </div>
                    <div class="multiplier-item">
                        <span class="mult-label">Global Mult:</span>
                        <span class="mult-value" id="global-mult">1</span>x
                    </div>
                    <div class="multiplier-item prestige-mult" id="prestige-mult-display" style="display: none;">
                        <span class="mult-label">Prestige Bonus:</span>
                        <span class="mult-value" id="prestige-mult">1</span>x
                    </div>
                </div>

                <!-- Active Power-ups -->
                <div class="active-powerups" id="active-powerups"></div>

                <!-- Milestones -->
                <div class="milestones-section">
                    <h3 class="section-title"> MILESTONES</h3>
                    <div class="milestones-list" id="milestones-list"></div>
                </div>
            </div>

            <!-- Center Panel: Tabs -->
            <div class="center-panel">
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button class="tab-btn active" data-tab="upgrades"> UPGRADES</button>
                    <button class="tab-btn" data-tab="generators"> GENERATORS</button>
                    <button class="tab-btn" data-tab="powerups"> POWER-UPS</button>
                    <button class="tab-btn" data-tab="achievements"> ACHIEVEMENTS</button>
                    <button class="tab-btn" data-tab="prestige"> PRESTIGE</button>
                
                    <button class="tab-btn" data-tab="rewards"> REWARDS</button>
                    <button class="tab-btn" data-tab="challenges"> CHALLENGES</button>
                    <button class="tab-btn" data-tab="skills"> SKILLS</button>
                    <button class="tab-btn" data-tab="collection"> COLLECTION</button>
                    <button class="tab-btn" data-tab="automation"> AUTO</button>
                    <button class="tab-btn" data-tab="synergies"> Synergies</button>
                            <button class="tab-btn" data-tab="settings"> SETTINGS</button></div>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Upgrades Tab -->
                    <div class="tab-pane active" id="upgrades-tab">
                        <div class="bulk-buy-controls">
                            <button class="bulk-buy-btn active" data-amount="1">x1</button>
                            <button class="bulk-buy-btn" data-amount="10">x10</button>
                            <button class="bulk-buy-btn" data-amount="25">x25</button>
                            <button class="bulk-buy-btn" data-amount="100">x100</button>
                            <button class="bulk-buy-btn" data-amount="max">MAX</button>
                        </div>
                        <div class="upgrades-grid" id="upgrades-grid"></div>
                    </div>

                    <!-- Generators Tab -->
                    <div class="tab-pane" id="generators-tab">
                        <div class="bulk-buy-controls" id="bulk-buy-generators">
                            <button class="bulk-buy-btn active" data-amount="1">x1</button>
                            <button class="bulk-buy-btn" data-amount="10">x10</button>
                            <button class="bulk-buy-btn" data-amount="25">x25</button>
                            <button class="bulk-buy-btn" data-amount="100">x100</button>
                            <button class="bulk-buy-btn" data-amount="max">MAX</button>
                        </div>
                        <div class="generators-list" id="generators-list"></div>
                    </div>

                    <!-- Power-ups Tab -->
                    <div class="tab-pane" id="powerups-tab">
                        <div class="powerups-grid" id="powerups-grid"></div>
                    </div>

                    <!-- Achievements Tab -->
                    <div class="tab-pane" id="achievements-tab">
                        <div class="achievements-filter">
                            <button class="filter-btn active" data-filter="all">All</button>
                            <button class="filter-btn" data-filter="unlocked">Unlocked</button>
                            <button class="filter-btn" data-filter="locked">Locked</button>
                        </div>
                        <div class="achievements-grid" id="achievements-grid"></div>
                    </div>

                    <!-- Prestige Tab -->
                    <div class="tab-pane" id="prestige-tab">
                        <div class="prestige-info">
                            <h2 class="prestige-title"> ASCENSION PROTOCOL</h2>
                            <p class="prestige-description">
                                Reset your progress to gain permanent bonuses and unlock new features!
                            </p>
                            <div class="prestige-stats">
                                <div class="prestige-stat">
                                    <span class="pstat-label">Current Run Energy:</span>
                                    <span class="pstat-value" id="prestige-current-energy">0</span>
                                </div>
                        
                        <!-- Prestige Paths Selection -->
                        <div class="prestige-paths-section" style="margin-top: 30px;">
                            <h3 class="section-title"> Choose Your Path</h3>
                            <p style="text-align: center; color: var(--text-secondary); margin-bottom: 20px;">
                                Select a prestige path to define your playstyle
                            </p>
                            <div class="prestige-paths-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
                                <!-- Paths will be dynamically inserted here by JS -->
                            </div>
                            <div id="current-path-display" style="margin-top: 20px; padding: 15px; background: var(--bg-card); border-radius: 10px; border: 2px solid var(--neon-cyan);">
                                <!-- Current path info will be shown here -->
                            </div>
                        </div>


                    <!-- Daily Rewards Tab -->
                    <div class="tab-pane" id="rewards-tab">
                        <div class="daily-rewards-panel">
                            <h2 class="daily-reward-title"> DAILY REWARDS</h2>
                            <div class="daily-streak" id="daily-streak">Current Streak: 0 days</div>
                            <div class="daily-timer" id="daily-timer"></div>
                            <button class="daily-reward-btn" id="claim-daily-btn">Claim Reward</button>
                            <div class="streak-milestones" id="streak-milestones" style="margin-top: 20px;"></div>
                        </div>
                    </div>

                    <!-- Challenges Tab -->
                    <div class="tab-pane" id="synergies-tab">
                        <h3 class="section-title"> Synergies</h3>
                        <p style="text-align: center; color: var(--text-secondary); margin-bottom: 20px;">
                            Unlock powerful bonuses by combining upgrades and generators
                        </p>
                        
                        <div class="synergies-filter" style="display: flex; gap: 10px; justify-content: center; margin-bottom: 20px;">
                            <button class="filter-btn active" data-filter="all">All</button>
                            <button class="filter-btn" data-filter="unlocked">Unlocked</button>
                            <button class="filter-btn" data-filter="locked">Locked</button>
                        </div>
                        
                        <div id="synergies-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; max-height: 600px; overflow-y: auto;">
                            <!-- Synergies will be dynamically inserted here -->
                        </div>
                    </div>
                            <div id="challenges-list"></div>
                        </div>
                    </div>

                    <!-- Skills Tab -->
                    <div class="tab-pane" id="skills-tab">
                        <div class="skill-tree-container">
                            <div class="skill-points-display" id="skill-points">
                                Available Skill Points: <span id="skill-points-value">0</span>
                            </div>
                            <div class="skill-branches" id="skill-branches"></div>
                        </div>
                    </div>

                    <!-- Collection Tab -->
                    <div class="tab-pane" id="collection-tab">
                        <div class="collection-stats" id="collection-stats">
                            <h2 class="section-title"> ARTIFACT COLLECTION</h2>
                            <div>Collected: <span id="artifacts-collected">0</span> / <span id="artifacts-total">0</span></div>
                            
                        
                        <!-- Equipped Artifacts -->
                        <div class="equipped-artifacts" style="margin-bottom: 30px;">
                            <h4 class="section-title" style="font-size: 1.1em;"> Equipped Artifacts (Max 3)</h4>
                            <div id="equipped-artifacts-display" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; min-height: 120px; padding: 15px; background: var(--bg-card); border-radius: 10px; border: 2px solid var(--neon-magenta);">
                                <div style="grid-column: 1 / -1; text-align: center; color: var(--text-secondary); padding: 20px;">
                                    No artifacts equipped
                                </div>
                            </div>
                        </div>
<div style="margin-top: 10px;">Drop Chance: <span id="drop-chance">1%</span></div>
                        </div>
                        <div class="collection-grid" id="artifacts-grid"></div>
                    </div>

                    <!-- Automation Tab -->
                    <div class="tab-pane" id="automation-tab">
                        <div class="automation-panel">
                            <h2 class="section-title"> AUTOMATION SETTINGS</h2>
                            <div id="automation-options"></div>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div class="tab-pane" id="settings-tab">
                        <div class="settings-panel">
                            <h2 class="section-title"> GAME SETTINGS</h2>
                            <div class="settings-grid" id="settings-grid"></div>
                            
                            <h3 class="section-title" style="margin-top: 30px;"> SAVE MANAGEMENT</h3>
                            <div class="save-slots" id="save-slots"></div>
                        </div>
                    </div>
                                <div class="prestige-stat">
                                    <span class="pstat-label">Prestige Points Earned:</span>
                                    <span class="pstat-value prestige-points" id="prestige-points-gain">0</span>
                                </div>
                                <div class="prestige-stat">
                                    <span class="pstat-label">Total Prestige Points:</span>
                                    <span class="pstat-value prestige-points" id="prestige-points-total">0</span>
                                </div>
                                <div class="prestige-stat">
                                    <span class="pstat-label">Prestige Bonus:</span>
                                    <span class="pstat-value" id="prestige-bonus-display">+0%</span>
                                </div>
                            </div>
                            <button class="prestige-btn" id="prestige-btn"> ASCEND</button>
                            <div class="prestige-upgrades">
                                <h3 class="section-title">Prestige Upgrades</h3>
                                <div class="prestige-upgrades-grid" id="prestige-upgrades-grid"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Stats & Events -->
            <div class="right-panel">
                <!-- Special Event -->
                <div class="special-event" id="special-event" style="display: none;">
                    <div class="event-header">
                        <span class="event-icon"></span>
                        <span class="event-title" id="event-title">SPECIAL EVENT</span>
                    </div>
                    <div class="event-description" id="event-description"></div>
                    <div class="event-timer" id="event-timer"></div>
                    <button class="event-claim-btn" id="event-claim-btn">CLAIM</button>
                </div>

                <!-- Statistics -->
                <div class="statistics-section">
                    <h3 class="section-title"> STATISTICS</h3>
                    <div class="stats-list">
                        <div class="stat-row">
                            <span class="stat-name">Total Clicks:</span>
                            <span class="stat-number" id="total-clicks">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-name">Total Energy:</span>
                            <span class="stat-number" id="total-energy">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-name">Play Time:</span>
                            <span class="stat-number" id="play-time">0s</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-name">Highest Combo:</span>
                            <span class="stat-number" id="highest-combo">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-name">Achievements:</span>
                            <span class="stat-number"><span id="unlocked-achievements">0</span>/<span id="total-achievements">0</span></span>
                        </div>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="progress-section">
                    <h3 class="section-title"> NEXT LEVEL</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="level-progress"></div>
                        <span class="progress-text" id="level-progress-text">0%</span>
                    </div>
                </div>

                <!-- Settings -->
                <div class="settings-section">
                    <h3 class="section-title"> SETTINGS</h3>
                    <div class="settings-list">
                        <button class="setting-btn" id="save-btn"> Save Game</button>
                        <button class="setting-btn" id="load-btn"> Load Game</button>
                        <button class="setting-btn" id="export-btn"> Export</button>
                        <button class="setting-btn" id="import-btn"> Import</button>
                        <button class="setting-btn danger" id="reset-btn"> Hard Reset</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notification-container"></div>

    <!-- Particle Container -->
    <div class="particle-container" id="particle-container"></div>

    <!-- Modal for Import -->
    <div class="modal" id="import-modal" style="display: none;">
        <div class="modal-content">
            <h2>Import Save Data</h2>
            <textarea id="import-textarea" placeholder="Paste your save data here..."></textarea>
            <div class="modal-buttons">
                <button class="modal-btn" id="import-confirm-btn">Import</button>
                <button class="modal-btn cancel" id="import-cancel-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- All JavaScript embedded below -->
    
    <!-- ===== JAVASCRIPT CODE ===== -->
    
    <!-- Ripple animation style -->
    
<script>
// ===== NEON NEXUS: ULTIMATE EXPANSION =====
// Includes: Mutations, Synergies, Prestige Paths, Artifacts
// 50+ Upgrades, 25 Generators, Rebalanced Economy

// ===== NOTIFICATIONS =====
// Notification System

class NotificationSystem {
    constructor() {
        this.container = document.getElementById('notification-container');
        this.queue = [];
        this.isShowing = false;
    }

    show(title, message, type = 'info', duration = 3000) {
        this.queue.push({ title, message, type, duration });
        if (!this.isShowing) {
            this.processQueue();
        }
    }

    processQueue() {
        if (this.queue.length === 0) {
            this.isShowing = false;
            return;
        }

        this.isShowing = true;
        const { title, message, type, duration } = this.queue.shift();

        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <div class="notification-title">${title}</div>
            <div class="notification-message">${message}</div>
        `;

        this.container.appendChild(notification);

        setTimeout(() => {
            notification.style.animation = 'notificationSlide 0.3s ease reverse';
            setTimeout(() => {
                notification.remove();
                this.processQueue();
            }, 300);
        }, duration);
    }

    success(title, message, duration) {
        this.show(title, message, 'success', duration);
    }

    warning(title, message, duration) {
        this.show(title, message, 'warning', duration);
    }

    error(title, message, duration) {
        this.show(title, message, 'error', duration);
    }

    info(title, message, duration) {
        this.show(title, message, 'info', duration);
    }
}

const notifications = new NotificationSystem();


// ===== PARTICLES =====
// Particle Effects System

// Detect mobile device for performance optimization
const isMobileDevice = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent) || 
                       (navigator.maxTouchPoints && navigator.maxTouchPoints > 1);

class ParticleSystem {
    constructor() {
        this.container = document.getElementById('particle-container');
        // Reduce particle count on mobile for better performance
        this.isMobile = isMobileDevice;
        this.particleMultiplier = this.isMobile ? 0.4 : 1; // 40% particles on mobile
        
        if (this.isMobile) {
            console.log(' Particle system optimized for mobile');
        }
    }

    // Create floating text particle (for click rewards)
    createTextParticle(x, y, text, color = '#00ffff') {
        // Throttle text particles on mobile
        if (this.isMobile && Math.random() > 0.5) {
            return; // Skip 50% of text particles on mobile
        }
        
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.textContent = text;
        particle.style.left = x + 'px';
        particle.style.top = y + 'px';
        particle.style.color = color;
        particle.style.textShadow = `0 0 10px ${color}`;
        
        this.container.appendChild(particle);
        
        setTimeout(() => {
            particle.remove();
        }, 1500);
    }

    // Create burst effect (for achievements, upgrades)
    createBurst(x, y, count = 20, color = '#00ffff') {
        // Reduce burst particles on mobile
        const adjustedCount = Math.floor(count * this.particleMultiplier);
        
        for (let i = 0; i < adjustedCount; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle-effect';
            
            const angle = (Math.PI * 2 * i) / adjustedCount;
            const distance = 50 + Math.random() * 50;
            const tx = Math.cos(angle) * distance;
            const ty = Math.sin(angle) * distance;
            
            particle.style.left = x + 'px';
            particle.style.top = y + 'px';
            particle.style.background = color;
            particle.style.boxShadow = `0 0 10px ${color}`;
            particle.style.setProperty('--tx', tx + 'px');
            particle.style.setProperty('--ty', ty + 'px');
            
            this.container.appendChild(particle);
            
            setTimeout(() => {
                particle.remove();
            }, 800);
        }
    }

    // Create celebration effect (for milestones, prestige)
    createCelebration(element) {
        element.classList.add('celebrate');
        
        const rect = element.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        
        // Create multiple bursts with different colors
        const colors = ['#00ffff', '#ff00ff', '#00ff00', '#ffff00', '#0080ff'];
        // Reduce number of color bursts on mobile
        const colorsToUse = this.isMobile ? colors.slice(0, 3) : colors;
        
        colorsToUse.forEach((color, index) => {
            setTimeout(() => {
                this.createBurst(centerX, centerY, this.isMobile ? 15 : 30, color);
            }, index * 100);
        });
        
        setTimeout(() => {
            element.classList.remove('celebrate');
        }, 600);
    }

    // Create click ripple effect
    createRipple(x, y) {
        // Simplified ripple effect on mobile
        if (this.isMobile && Math.random() > 0.6) {
            return; // Skip 40% of ripples on mobile
        }
        
        const ripple = document.createElement('div');
        ripple.style.position = 'absolute';
        ripple.style.left = x + 'px';
        ripple.style.top = y + 'px';
        ripple.style.width = '10px';
        ripple.style.height = '10px';
        ripple.style.borderRadius = '50%';
        ripple.style.border = '2px solid #00ffff';
        ripple.style.pointerEvents = 'none';
        ripple.style.animation = 'rippleExpand 0.6s ease-out';
        
        this.container.appendChild(ripple);
        
        setTimeout(() => {
            ripple.remove();
        }, 600);
    }
    
    // Clean up old particles for mobile performance
    cleanup() {
        if (this.isMobile && this.container.children.length > 20) {
            // Remove oldest particles if too many exist
            while (this.container.children.length > 20) {
                this.container.firstChild.remove();
            }
        }
    }
}

// Add ripple animation to CSS dynamically
if (!document.getElementById('ripple-style')) {
    const style = document.createElement('style');
    style.id = 'ripple-style';
    style.textContent = `
        @keyframes rippleExpand {
            from {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            to {
                transform: translate(-50%, -50%) scale(10);
                opacity: 0;
            }
        }
    `;
    document.head.appendChild(style);
}

const particleSystem = new ParticleSystem();


// ===== MUTATIONS =====
// Mutation System - Random modifiers that change each prestige/run

class MutationsManager {
    constructor() {
        this.allMutations = [
            // Positive Mutations
            {
                id: 'mega_clicks',
                name: 'Mega Clicks',
                icon: '',
                description: 'Click power x5',
                type: 'positive',
                weight: 100,
                apply: (game) => {
                    game.mutationClickPowerMult = (game.mutationClickPowerMult || 1) * 5;
                }
            },
            {
                id: 'hyper_production',
                name: 'Hyper Production',
                icon: '',
                description: 'Generator production x3',
                type: 'positive',
                weight: 100,
                apply: (game) => {
                    game.mutationProductionMult = (game.mutationProductionMult || 1) * 3;
                }
            },
            {
                id: 'fortune_favors',
                name: 'Fortune Favors',
                icon: '',
                description: 'Crit chance +50%, Crit damage x2',
                type: 'positive',
                weight: 80,
                apply: (game) => {
                    game.critChance += 0.5;
                    game.critMultiplier *= 2;
                }
            },
            {
                id: 'combo_master',
                name: 'Combo Master',
                icon: '',
                description: 'Combo window x2, Combo bonus x3',
                type: 'positive',
                weight: 80,
                apply: (game) => {
                    game.comboWindow *= 2;
                    game.comboBonus = (game.comboBonus || 0) + 0.05;
                }
            },
            {
                id: 'discount_spree',
                name: 'Discount Spree',
                icon: '',
                description: 'All costs reduced by 30%',
                type: 'positive',
                weight: 90,
                apply: (game) => {
                    game.mutationCostReduction = (game.mutationCostReduction || 0) + 0.3;
                }
            },
            {
                id: 'energy_overflow',
                name: 'Energy Overflow',
                icon: '',
                description: 'All energy gains x4',
                type: 'positive',
                weight: 70,
                apply: (game) => {
                    game.energyGainMultiplier *= 4;
                }
            },
            {
                id: 'automation_surge',
                name: 'Automation Surge',
                icon: '',
                description: 'Auto-clicker efficiency x10',
                type: 'positive',
                weight: 60,
                apply: (game) => {
                    game.autoClickerMultiplier *= 10;
                }
            },
            {
                id: 'prestige_boost',
                name: 'Prestige Boost',
                icon: '',
                description: 'Prestige multiplier effectiveness x2',
                type: 'positive',
                weight: 50,
                apply: (game) => {
                    game.prestigeMultiplier = 1 + ((game.prestigeMultiplier - 1) * 2);
                }
            },
            
            // Negative Mutations (Higher rewards at prestige)
            {
                id: 'weak_clicks',
                name: 'Weak Clicks',
                icon: '',
                description: 'Click power 70% weaker, but +100% prestige points',
                type: 'challenge',
                weight: 80,
                apply: (game) => {
                    game.mutationClickPowerMult = (game.mutationClickPowerMult || 1) * 0.3;
                    game.prestigePointsBonus += 1.0;
                }
            },
            {
                id: 'slow_production',
                name: 'Slow Production',
                icon: '',
                description: 'Generators 60% slower, but +75% prestige points',
                type: 'challenge',
                weight: 80,
                apply: (game) => {
                    game.mutationProductionMult = (game.mutationProductionMult || 1) * 0.4;
                    game.prestigePointsBonus += 0.75;
                }
            },
            {
                id: 'expensive_world',
                name: 'Expensive World',
                icon: '',
                description: 'All costs x5, but +150% prestige points',
                type: 'challenge',
                weight: 70,
                apply: (game) => {
                    game.mutationCostIncrease = (game.mutationCostIncrease || 1) * 5;
                    game.prestigePointsBonus += 1.5;
                }
            },
            {
                id: 'fragile_combo',
                name: 'Fragile Combos',
                icon: '',
                description: 'Combo window halved, but combo bonus x5',
                type: 'challenge',
                weight: 70,
                apply: (game) => {
                    game.comboWindow *= 0.5;
                    game.comboBonus = (game.comboBonus || 0) + 0.10;
                    game.prestigePointsBonus += 0.5;
                }
            },
            {
                id: 'unlucky_streak',
                name: 'Unlucky Streak',
                icon: '',
                description: 'Crit chance reduced by 50%, but crits deal x5 damage',
                type: 'challenge',
                weight: 60,
                apply: (game) => {
                    game.critChance = Math.max(0, game.critChance - 0.5);
                    game.critMultiplier *= 5;
                    game.prestigePointsBonus += 0.5;
                }
            },
            
            // Wild/Random Mutations
            {
                id: 'chaos_mode',
                name: 'Chaos Mode',
                icon: '',
                description: 'All modifiers are randomized every 60 seconds',
                type: 'wild',
                weight: 30,
                apply: (game) => {
                    game.mutationChaosMode = true;
                    game.prestigePointsBonus += 1.0;
                }
            },
            {
                id: 'reverse_world',
                name: 'Reverse World',
                icon: '',
                description: 'Clicks generate less but generators are x10 stronger',
                type: 'wild',
                weight: 40,
                apply: (game) => {
                    game.mutationClickPowerMult = (game.mutationClickPowerMult || 1) * 0.1;
                    game.mutationProductionMult = (game.mutationProductionMult || 1) * 10;
                    game.prestigePointsBonus += 0.75;
                }
            },
            {
                id: 'click_or_die',
                name: 'Click or Die',
                icon: '',
                description: 'No generators work, but clicks are x20 stronger',
                type: 'wild',
                weight: 30,
                apply: (game) => {
                    game.mutationClickPowerMult = (game.mutationClickPowerMult || 1) * 20;
                    game.mutationProductionMult = (game.mutationProductionMult || 1) * 0;
                    game.prestigePointsBonus += 1.5;
                }
            },
            {
                id: 'golden_age',
                name: 'Golden Age',
                icon: '',
                description: 'Everything x2, costs x3',
                type: 'wild',
                weight: 50,
                apply: (game) => {
                    game.mutationClickPowerMult = (game.mutationClickPowerMult || 1) * 2;
                    game.mutationProductionMult = (game.mutationProductionMult || 1) * 2;
                    game.mutationCostIncrease = (game.mutationCostIncrease || 1) * 3;
                    game.prestigePointsBonus += 0.5;
                }
            }
        ];
        
        this.activeMutations = [];
        this.mutationsPerRun = 2; // Number of random mutations per prestige
    }
    
    rollNewMutations(game) {
        // Clear old mutations
        this.activeMutations = [];
        
        // Reset mutation modifiers
        game.mutationClickPowerMult = 1;
        game.mutationProductionMult = 1;
        game.mutationCostReduction = 0;
        game.mutationCostIncrease = 1;
        game.mutationChaosMode = false;
        
        // Randomly select mutations based on weight
        const availableMutations = [...this.allMutations];
        
        for (let i = 0; i < this.mutationsPerRun && availableMutations.length > 0; i++) {
            const totalWeight = availableMutations.reduce((sum, m) => sum + m.weight, 0);
            let random = Math.random() * totalWeight;
            
            let selectedIndex = 0;
            for (let j = 0; j < availableMutations.length; j++) {
                random -= availableMutations[j].weight;
                if (random <= 0) {
                    selectedIndex = j;
                    break;
                }
            }
            
            const selected = availableMutations.splice(selectedIndex, 1)[0];
            this.activeMutations.push(selected);
            selected.apply(game);
        }
        
        // Show notification
        if (this.activeMutations.length > 0) {
            const mutationNames = this.activeMutations.map(m => m.icon + ' ' + m.name).join(', ');
            notifications.info(
                ' Mutations Active!',
                mutationNames,
                7000
            );
        }
    }
    
    getActiveMutations() {
        return this.activeMutations;
    }
    
    getSaveData() {
        return {
            activeMutations: this.activeMutations.map(m => m.id)
        };
    }
    
    loadSaveData(data, game) {
        if (!data || !data.activeMutations) return;
        
        this.activeMutations = [];
        data.activeMutations.forEach(id => {
            const mutation = this.allMutations.find(m => m.id === id);
            if (mutation) {
                this.activeMutations.push(mutation);
                mutation.apply(game);
            }
        });
    }
}

const mutationsManager = new MutationsManager();

// ===== SYNERGIES =====
// Synergy System - Upgrade/Generator combos with bonus effects

class SynergiesManager {
    constructor() {
        this.synergies = [
            // Click Synergies
            {
                id: 'neural_quantum_sync',
                name: 'Neural-Quantum Sync',
                icon: '',
                description: 'Neural Amplifier + Quantum Processor = Click power x2',
                requirements: [
                    { type: 'upgrade', id: 'click_power_1', level: 10 },
                    { type: 'upgrade', id: 'click_power_2', level: 5 }
                ],
                bonus: 'Click power x2',
                unlocked: false,
                apply: (game) => {
                    game.synergyClickPowerMult = (game.synergyClickPowerMult || 1) * 2;
                }
            },
            {
                id: 'perfect_automation',
                name: 'Perfect Automation',
                icon: '',
                description: 'Auto-Clicker + Nano Bots = Auto-clickers work 5x faster',
                requirements: [
                    { type: 'upgrade', id: 'auto_click', level: 5 },
                    { type: 'generator', id: 'gen_1', count: 50 }
                ],
                bonus: 'Auto-clicker x5',
                unlocked: false,
                apply: (game) => {
                    game.autoClickerMultiplier *= 5;
                }
            },
            
            // Production Synergies
            {
                id: 'solar_quantum_fusion',
                name: 'Solar Quantum Fusion',
                icon: '',
                description: 'Solar Panels + Quantum Cores = Both produce 3x more',
                requirements: [
                    { type: 'generator', id: 'gen_2', count: 25 },
                    { type: 'generator', id: 'gen_3', count: 20 }
                ],
                bonus: 'Solar + Quantum x3',
                unlocked: false,
                apply: (game) => {
                    // Applied in generator production calculation
                    game.synergySolarQuantum = 3;
                }
            },
            {
                id: 'fusion_antimatter_core',
                name: 'Fusion Antimatter Core',
                icon: '',
                description: 'Fusion Plant + Antimatter Reactor = Both produce 4x more',
                requirements: [
                    { type: 'generator', id: 'gen_4', count: 30 },
                    { type: 'generator', id: 'gen_5', count: 25 }
                ],
                bonus: 'Fusion + Antimatter x4',
                unlocked: false,
                apply: (game) => {
                    game.synergyFusionAntimatter = 4;
                }
            },
            {
                id: 'dark_time_continuum',
                name: 'Dark Time Continuum',
                icon: '',
                description: 'Dark Energy + Time Singularity = Both produce 5x more',
                requirements: [
                    { type: 'generator', id: 'gen_6', count: 20 },
                    { type: 'generator', id: 'gen_7', count: 15 }
                ],
                bonus: 'Dark Energy + Time x5',
                unlocked: false,
                apply: (game) => {
                    game.synergyDarkTime = 5;
                }
            },
            
            // Multiplier Synergies
            {
                id: 'catalyst_reactor_overload',
                name: 'Catalyst Reactor Overload',
                icon: '',
                description: 'Energy Catalyst + Fusion Reactor upgrades = Global mult +100%',
                requirements: [
                    { type: 'upgrade', id: 'global_mult_1', level: 10 },
                    { type: 'upgrade', id: 'global_mult_2', level: 5 }
                ],
                bonus: 'Global mult +100%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 1.0;
                }
            },
            {
                id: 'reality_dimension_matrix',
                name: 'Reality Dimension Matrix',
                icon: '',
                description: 'Reality Engine + Dimension Gateway = All production x6',
                requirements: [
                    { type: 'generator', id: 'gen_8', count: 10 },
                    { type: 'generator', id: 'gen_9', count: 8 }
                ],
                bonus: 'All production x6',
                unlocked: false,
                apply: (game) => {
                    game.synergyRealityDimension = 6;
                }
            },
            
            // Crit Synergies
            {
                id: 'lucky_overcharge',
                name: 'Lucky Overcharge',
                icon: '',
                description: 'Lucky Strike + Overcharge = Crit damage x3',
                requirements: [
                    { type: 'upgrade', id: 'crit_chance', level: 5 },
                    { type: 'upgrade', id: 'crit_power', level: 3 }
                ],
                bonus: 'Crit damage x3',
                unlocked: false,
                apply: (game) => {
                    game.critMultiplier *= 3;
                }
            },
            {
                id: 'precision_strikes',
                name: 'Precision Strikes',
                icon: '',
                description: 'High combo + High crit chance = Guaranteed crits during combos >50',
                requirements: [
                    { type: 'upgrade', id: 'combo_power', level: 10 },
                    { type: 'upgrade', id: 'crit_chance', level: 8 }
                ],
                bonus: 'Guaranteed crits at combo >50',
                unlocked: false,
                apply: (game) => {
                    game.synergyPrecisionStrikes = true;
                }
            },
            
            // Combo Synergies
            {
                id: 'eternal_combo',
                name: 'Eternal Combo',
                icon: '',
                description: 'Time Dilation + Synergy Matrix = Combo never expires',
                requirements: [
                    { type: 'upgrade', id: 'combo_duration', level: 10 },
                    { type: 'upgrade', id: 'combo_power', level: 15 }
                ],
                bonus: 'Infinite combo duration',
                unlocked: false,
                apply: (game) => {
                    game.comboWindow = 999999999;
                }
            },
            
            // Ultimate Synergies
            {
                id: 'universal_nexus_supreme',
                name: 'Universal Nexus Supreme',
                icon: '',
                description: 'Universal Nexus x10 + All tier 10+ upgrades = EVERYTHING x10',
                requirements: [
                    { type: 'generator', id: 'gen_10', count: 10 },
                    { type: 'upgrade', id: 'click_power_1', level: 50 },
                    { type: 'upgrade', id: 'global_mult_1', level: 15 }
                ],
                bonus: 'EVERYTHING x10',
                unlocked: false,
                apply: (game) => {
                    game.synergyUltimate = 10;
                }
            },
            {
                id: 'ascended_being',
                name: 'Ascended Being',
                icon: '',
                description: '100+ prestiges + All synergies = Transcend reality itself',
                requirements: [
                    { type: 'prestige', count: 100 }
                ],
                bonus: 'All effects x100',
                unlocked: false,
                apply: (game) => {
                    game.synergyAscended = 100;
                }
            }
        ];
    }
    
    checkSynergies(game) {
        let newUnlocks = [];
        
        this.synergies.forEach(synergy => {
            if (synergy.unlocked) return;
            
            let requirementsMet = true;
            
            synergy.requirements.forEach(req => {
                if (req.type === 'upgrade') {
                    const upgrade = upgradesManager.getUpgrade(req.id);
                    if (!upgrade || upgrade.currentLevel < req.level) {
                        requirementsMet = false;
                    }
                } else if (req.type === 'generator') {
                    const generator = generatorsManager.getGenerator(req.id);
                    if (!generator || generator.count < req.count) {
                        requirementsMet = false;
                    }
                } else if (req.type === 'prestige') {
                    if (game.prestigeCount < req.count) {
                        requirementsMet = false;
                    }
                }
            });
            
            if (requirementsMet) {
                synergy.unlocked = true;
                synergy.apply(game);
                newUnlocks.push(synergy);
            }
        });
        
        // Notify new synergies
        newUnlocks.forEach(synergy => {
            notifications.success(
                ' SYNERGY UNLOCKED!',
                `${synergy.icon} ${synergy.name}: ${synergy.bonus}`,
                6000
            );
            
            particleSystem.createCelebration(document.body);
        });
    }
    
    getUnlockedSynergies() {
        return this.synergies.filter(s => s.unlocked);
    }
    
    getLockedSynergies() {
        return this.synergies.filter(s => !s.unlocked);
    }
    
    reset() {
        this.synergies.forEach(s => s.unlocked = false);
    }
    
    getSaveData() {
        const data = {};
        this.synergies.forEach(synergy => {
            data[synergy.id] = synergy.unlocked;
        });
        return data;
    }
    
    loadSaveData(data, game) {
        if (!data) return;
        
        Object.keys(data).forEach(id => {
            const synergy = this.synergies.find(s => s.id === id);
            if (synergy && data[id]) {
                synergy.unlocked = true;
                synergy.apply(game);
            }
        });
    }
}

const synergiesManager = new SynergiesManager();

// ===== PRESTIGE_PATHS =====
// Prestige Paths System - Multiple prestige options with different bonuses

class PrestigePathsManager {
    constructor() {
        this.paths = [
            {
                id: 'production_path',
                name: 'Path of Production',
                icon: '',
                description: 'Focus on passive income and generators',
                color: '#00aaff',
                bonuses: [
                    'Generator production x3',
                    'Auto-buy generators unlocked immediately',
                    '+50% offline production',
                    'Generators cost 20% less'
                ],
                penalties: [
                    'Click power reduced by 30%',
                    'Manual clicking gives 50% less energy'
                ],
                apply: (game) => {
                    game.pathProductionMult = 3;
                    game.autoBuyGenerators = true;
                    game.offlineProductionRate += 0.5;
                    game.generatorCostReduction = 0.2;
                    game.pathClickPowerPenalty = 0.7;
                    game.pathClickEnergyPenalty = 0.5;
                },
                chosen: false
            },
            {
                id: 'combat_path',
                name: 'Path of Destruction',
                icon: '',
                description: 'Focus on click power and active gameplay',
                color: '#ff0044',
                bonuses: [
                    'Click power x5',
                    'Crit chance +30%',
                    'Crit damage x3',
                    'Combo window x2'
                ],
                penalties: [
                    'Generator production reduced by 50%',
                    'Auto-clickers disabled'
                ],
                apply: (game) => {
                    game.pathClickPowerMult = 5;
                    game.critChance += 0.3;
                    game.critMultiplier *= 3;
                    game.comboWindow *= 2;
                    game.pathProductionPenalty = 0.5;
                    game.autoClickersDisabled = true;
                },
                chosen: false
            },
            {
                id: 'automation_path',
                name: 'Path of Automation',
                icon: '',
                description: 'Focus on auto-clickers and idle play',
                color: '#aa00ff',
                bonuses: [
                    'Auto-clicker efficiency x10',
                    'Start with 10 auto-clickers',
                    'Auto-clickers count toward combos',
                    'Unlock advanced automation'
                ],
                penalties: [
                    'Manual clicks 40% weaker',
                    'Generators cost 50% more'
                ],
                apply: (game) => {
                    game.autoClickerMultiplier *= 10;
                    game.autoClickersPerSecond += 10;
                    game.autoClickersCombos = true;
                    game.advancedAutomation = true;
                    game.pathManualClickPenalty = 0.6;
                    game.pathGeneratorCostIncrease = 1.5;
                },
                chosen: false
            },
            {
                id: 'chaos_path',
                name: 'Path of Chaos',
                icon: '',
                description: 'Embrace randomness for massive rewards',
                color: '#ffaa00',
                bonuses: [
                    'All values randomized between 50-500%',
                    '+200% prestige points',
                    'Random legendary drops',
                    'Unlock chaos-exclusive upgrades'
                ],
                penalties: [
                    'Everything is unpredictable',
                    'No guaranteed progression'
                ],
                apply: (game) => {
                    game.chaosMode = true;
                    game.prestigePointsBonus += 2.0;
                    game.chaosLegendaryChance = 0.1;
                    game.chaosUpgradesUnlocked = true;
                },
                chosen: false
            },
            {
                id: 'balance_path',
                name: 'Path of Balance',
                icon: '',
                description: 'No bonuses or penalties, but unlock special features',
                color: '#00ff88',
                bonuses: [
                    'No penalties applied',
                    'Can switch paths every 5 prestiges',
                    '+50% prestige points',
                    'Unlock hybrid builds'
                ],
                penalties: [
                    'No specialized bonuses'
                ],
                apply: (game) => {
                    game.pathSwitchingUnlocked = true;
                    game.prestigePointsBonus += 0.5;
                    game.hybridBuildsUnlocked = true;
                },
                chosen: false
            },
            {
                id: 'speed_path',
                name: 'Path of Velocity',
                icon: '',
                description: 'Everything happens faster',
                color: '#ffff00',
                bonuses: [
                    'Game speed x3',
                    'Events spawn 5x faster',
                    'Combos build 2x faster',
                    'Power-ups recharge 3x faster'
                ],
                penalties: [
                    'All costs increased by 100%',
                    'Combo window reduced by 30%'
                ],
                apply: (game) => {
                    game.gameSpeed = (game.gameSpeed || 1) * 3;
                    game.eventSpawnBonus += 4.0;
                    game.comboSpeedMult = 2;
                    game.powerupCooldownReduction = 0.67;
                    game.pathCostIncrease = 2;
                    game.comboWindow *= 0.7;
                },
                chosen: false
            },
            {
                id: 'ascension_path',
                name: 'Path of Ascension',
                icon: '',
                description: 'Transcend normal limits',
                color: '#ffffff',
                bonuses: [
                    'Everything x2',
                    '+100% prestige points',
                    'Unlock transcendence mechanic',
                    'Break the level cap'
                ],
                penalties: [
                    'Everything costs x3',
                    'Must reach level 100 to prestige'
                ],
                apply: (game) => {
                    game.pathUniversalMult = 2;
                    game.prestigePointsBonus += 1.0;
                    game.transcendenceUnlocked = true;
                    game.levelCapRemoved = true;
                    game.pathCostIncrease = 3;
                    game.pathPrestigeLevel = 100;
                },
                chosen: false
            }
        ];
        
        this.currentPath = null;
        this.pathHistory = [];
    }
    
    choosePath(pathId, game) {
        // Reset old path
        if (this.currentPath) {
            this.paths.forEach(p => p.chosen = false);
        }
        
        // Set new path
        const path = this.paths.find(p => p.id === pathId);
        if (!path) return false;
        
        path.chosen = true;
        this.currentPath = path;
        this.pathHistory.push({
            pathId: pathId,
            timestamp: Date.now(),
            prestigeCount: game.prestigeCount
        });
        
        // Apply path bonuses
        path.apply(game);
        
        notifications.success(
            ' Path Chosen!',
            `${path.icon} ${path.name}`,
            8000
        );
        
        return true;
    }
    
    canSwitchPath(game) {
        if (game.hybridBuildsUnlocked) return true;
        if (game.pathSwitchingUnlocked && game.prestigeCount % 5 === 0) return true;
        return false;
    }
    
    getCurrentPath() {
        return this.currentPath;
    }
    
    getAvailablePaths() {
        return this.paths;
    }
    
    reset() {
        this.paths.forEach(p => p.chosen = false);
        this.currentPath = null;
    }
    
    getSaveData() {
        return {
            currentPath: this.currentPath ? this.currentPath.id : null,
            pathHistory: this.pathHistory
        };
    }
    
    loadSaveData(data, game) {
        if (!data) return;
        
        if (data.pathHistory) {
            this.pathHistory = data.pathHistory;
        }
        
        if (data.currentPath) {
            this.choosePath(data.currentPath, game);
        }
    }
}

const prestigePathsManager = new PrestigePathsManager();

// ===== ARTIFACTS =====
// Legendary Artifacts System - Random artifacts with unique effects

class ArtifactsManager {
    constructor() {
        this.allArtifacts = [
            // Common Artifacts (60% chance)
            {
                id: 'bronze_coin',
                name: 'Bronze Coin',
                icon: '',
                rarity: 'common',
                description: 'An ancient coin of modest value',
                effect: 'Energy gain +25%',
                dropChance: 0.15,
                apply: (game) => {
                    game.energyGainMultiplier *= 1.25;
                }
            },
            {
                id: 'rusty_cog',
                name: 'Rusty Cog',
                icon: '',
                rarity: 'common',
                description: 'A weathered mechanical component',
                effect: 'Generator efficiency +15%',
                dropChance: 0.15,
                apply: (game) => {
                    game.artifactGeneratorBonus = (game.artifactGeneratorBonus || 0) + 0.15;
                }
            },
            {
                id: 'lucky_charm',
                name: 'Lucky Charm',
                icon: '',
                rarity: 'common',
                description: 'A simple charm that brings fortune',
                effect: 'Crit chance +5%',
                dropChance: 0.15,
                apply: (game) => {
                    game.critChance += 0.05;
                }
            },
            {
                id: 'worn_glove',
                name: 'Worn Glove',
                icon: '',
                rarity: 'common',
                description: 'A glove from countless battles',
                effect: 'Click power +50%',
                dropChance: 0.15,
                apply: (game) => {
                    game.clickPower *= 1.5;
                }
            },
            
            // Uncommon Artifacts (25% chance)
            {
                id: 'silver_ring',
                name: 'Silver Ring',
                icon: '',
                rarity: 'uncommon',
                description: 'A ring infused with magical energy',
                effect: 'Global multiplier +50%',
                dropChance: 0.08,
                apply: (game) => {
                    game.globalMultiplier += 0.5;
                }
            },
            {
                id: 'pocket_watch',
                name: 'Pocket Watch',
                icon: '',
                rarity: 'uncommon',
                description: 'Time moves differently around it',
                effect: 'Combo window +50%',
                dropChance: 0.08,
                apply: (game) => {
                    game.comboWindow *= 1.5;
                }
            },
            {
                id: 'crystal_shard',
                name: 'Crystal Shard',
                icon: '',
                rarity: 'uncommon',
                description: 'A fragment of pure crystallized energy',
                effect: 'All production x2',
                dropChance: 0.09,
                apply: (game) => {
                    game.artifactProductionMult = (game.artifactProductionMult || 1) * 2;
                }
            },
            
            // Rare Artifacts (10% chance)
            {
                id: 'golden_crown',
                name: 'Golden Crown',
                icon: '',
                rarity: 'rare',
                description: 'A crown worn by ancient rulers',
                effect: 'Click power x3, Prestige points +25%',
                dropChance: 0.04,
                apply: (game) => {
                    game.clickPower *= 3;
                    game.prestigePointsBonus += 0.25;
                }
            },
            {
                id: 'phoenix_feather',
                name: 'Phoenix Feather',
                icon: '',
                rarity: 'rare',
                description: 'A feather that never stops burning',
                effect: 'All energy gains x3',
                dropChance: 0.03,
                apply: (game) => {
                    game.energyGainMultiplier *= 3;
                }
            },
            {
                id: 'enchanted_dice',
                name: 'Enchanted Dice',
                icon: '',
                rarity: 'rare',
                description: 'Always lands on a lucky number',
                effect: 'Crit chance +20%, Crit damage x2',
                dropChance: 0.03,
                apply: (game) => {
                    game.critChance += 0.2;
                    game.critMultiplier *= 2;
                }
            },
            
            // Epic Artifacts (4% chance)
            {
                id: 'infinity_gauntlet',
                name: 'Infinity Gauntlet',
                icon: '',
                rarity: 'epic',
                description: 'The ultimate weapon of power',
                effect: 'Everything x5',
                dropChance: 0.015,
                apply: (game) => {
                    game.artifactUniversalMult = (game.artifactUniversalMult || 1) * 5;
                }
            },
            {
                id: 'time_crystal',
                name: 'Time Crystal',
                icon: '',
                rarity: 'epic',
                description: 'A crystal that exists in all moments simultaneously',
                effect: 'Combo never expires, Combo bonus x2',
                dropChance: 0.01,
                apply: (game) => {
                    game.comboWindow = 999999999;
                    game.comboBonus += 0.05;
                }
            },
            {
                id: 'star_core',
                name: 'Star Core',
                icon: '',
                rarity: 'epic',
                description: 'The burning heart of a collapsed star',
                effect: 'Generator production x10',
                dropChance: 0.015,
                apply: (game) => {
                    game.artifactGeneratorMult = (game.artifactGeneratorMult || 1) * 10;
                }
            },
            
            // Legendary Artifacts (1% chance)
            {
                id: 'reality_stone',
                name: 'Reality Stone',
                icon: '',
                rarity: 'legendary',
                description: 'Rewrite the laws of reality',
                effect: 'EVERYTHING x10, +100% prestige points',
                dropChance: 0.003,
                apply: (game) => {
                    game.artifactUniversalMult = (game.artifactUniversalMult || 1) * 10;
                    game.prestigePointsBonus += 1.0;
                }
            },
            {
                id: 'philosophers_stone',
                name: 'Philosopher\'s Stone',
                icon: '',
                rarity: 'legendary',
                description: 'The legendary stone of alchemy',
                effect: 'Turn clicks into gold (x100), costs reduced by 50%',
                dropChance: 0.002,
                apply: (game) => {
                    game.clickPower *= 100;
                    game.costReduction += 0.5;
                }
            },
            {
                id: 'eternal_hourglass',
                name: 'Eternal Hourglass',
                icon: '',
                rarity: 'legendary',
                description: 'Time itself flows through this hourglass',
                effect: 'Game speed x5, offline production x10',
                dropChance: 0.002,
                apply: (game) => {
                    game.gameSpeed = (game.gameSpeed || 1) * 5;
                    game.offlineProductionRate += 9.0;
                }
            },
            {
                id: 'void_heart',
                name: 'Void Heart',
                icon: '',
                rarity: 'legendary',
                description: 'The heart of the void itself',
                effect: 'Production x50, click power x50',
                dropChance: 0.002,
                apply: (game) => {
                    game.artifactProductionMult = (game.artifactProductionMult || 1) * 50;
                    game.clickPower *= 50;
                }
            },
            {
                id: 'origin_spark',
                name: 'Origin Spark',
                icon: '',
                rarity: 'legendary',
                description: 'The first spark that created everything',
                effect: 'EVERYTHING x100, transcend all limits',
                dropChance: 0.001,
                apply: (game) => {
                    game.artifactUniversalMult = (game.artifactUniversalMult || 1) * 100;
                    game.transcendenceUnlocked = true;
                    game.levelCapRemoved = true;
                }
            }
        ];
        
        this.discoveredArtifacts = [];
        this.equippedArtifacts = [];
        this.maxEquipped = 3;
    }
    
    rollForArtifact(game) {
        // Calculate drop chance based on various factors
        let dropChance = 0.05; // Base 5% chance per prestige
        
        if (game.chaosLegendaryChance) {
            dropChance += game.chaosLegendaryChance;
        }
        
        if (game.artifactDropBonus) {
            dropChance += game.artifactDropBonus;
        }
        
        if (Math.random() > dropChance) return null;
        
        // Roll for artifact rarity
        const roll = Math.random();
        let selectedArtifact = null;
        
        // Calculate cumulative drop chances
        let cumulativeChance = 0;
        for (const artifact of this.allArtifacts) {
            cumulativeChance += artifact.dropChance;
            if (roll <= cumulativeChance) {
                selectedArtifact = artifact;
                break;
            }
        }
        
        if (!selectedArtifact) {
            selectedArtifact = this.allArtifacts[0]; // Fallback to first artifact
        }
        
        // Check if already discovered
        const alreadyDiscovered = this.discoveredArtifacts.find(a => a.id === selectedArtifact.id);
        if (!alreadyDiscovered) {
            this.discoveredArtifacts.push({...selectedArtifact});
            
            notifications.success(
                `${this.getRarityIcon(selectedArtifact.rarity)} ARTIFACT DISCOVERED!`,
                `${selectedArtifact.icon} ${selectedArtifact.name}`,
                10000
            );
            
            particleSystem.createCelebration(document.body);
        }
        
        return selectedArtifact;
    }
    
    equipArtifact(artifactId, game) {
        if (this.equippedArtifacts.length >= this.maxEquipped) {
            notifications.warning('Max Artifacts', 'Unequip an artifact first');
            return false;
        }
        
        const artifact = this.discoveredArtifacts.find(a => a.id === artifactId);
        if (!artifact) return false;
        
        if (this.equippedArtifacts.find(a => a.id === artifactId)) {
            notifications.warning('Already Equipped', 'This artifact is already equipped');
            return false;
        }
        
        this.equippedArtifacts.push(artifact);
        artifact.apply(game);
        
        notifications.success(
            ' Artifact Equipped!',
            `${artifact.icon} ${artifact.name}`
        );
        
        return true;
    }
    
    unequipArtifact(artifactId) {
        const index = this.equippedArtifacts.findIndex(a => a.id === artifactId);
        if (index === -1) return false;
        
        this.equippedArtifacts.splice(index, 1);
        
        notifications.info(
            'Artifact Unequipped',
            'Reload game to remove effects'
        );
        
        return true;
    }
    
    getRarityIcon(rarity) {
        const icons = {
            common: '',
            uncommon: '',
            rare: '',
            epic: '',
            legendary: ''
        };
        return icons[rarity] || '';
    }
    
    getRarityColor(rarity) {
        const colors = {
            common: '#888888',
            uncommon: '#00ff00',
            rare: '#0088ff',
            epic: '#aa00ff',
            legendary: '#ffaa00'
        };
        return colors[rarity] || '#888888';
    }
    
    getSaveData() {
        return {
            discovered: this.discoveredArtifacts.map(a => a.id),
            equipped: this.equippedArtifacts.map(a => a.id)
        };
    }
    
    loadSaveData(data, game) {
        if (!data) return;
        
        if (data.discovered) {
            data.discovered.forEach(id => {
                const artifact = this.allArtifacts.find(a => a.id === id);
                if (artifact && !this.discoveredArtifacts.find(a => a.id === id)) {
                    this.discoveredArtifacts.push({...artifact});
                }
            });
        }
        
        if (data.equipped) {
            data.equipped.forEach(id => {
                const artifact = this.discoveredArtifacts.find(a => a.id === id);
                if (artifact && !this.equippedArtifacts.find(a => a.id === id)) {
                    this.equippedArtifacts.push(artifact);
                    artifact.apply(game);
                }
            });
        }
    }
}

const artifactsManager = new ArtifactsManager();

// ===== UPGRADES =====
// Massively Expanded Upgrades System - 50+ Upgrades with 10-100x costs

class UpgradesManager {
    constructor() {
        this.upgrades = [
            // CLICK POWER UPGRADES (15 tiers) - Early game 10x, scaling up
            {
                id: 'click_power_1',
                name: 'Neural Amplifier',
                icon: '',
                description: 'Enhance your neural pathways for more powerful clicks',
                effect: 'Click power +1',
                baseCost: 100, // Was 10, now 10x
                costMultiplier: 1.20, // Steeper from 1.15
                currentLevel: 0,
                maxLevel: 200,
                category: 'click',
                apply: (game) => {
                    game.clickPower += 1;
                }
            },
            {
                id: 'click_power_2',
                name: 'Quantum Processor',
                icon: '',
                description: 'Quantum computing for exponential click gains',
                effect: 'Click power +5',
                baseCost: 1500, // Was 100, now 15x
                costMultiplier: 1.25,
                currentLevel: 0,
                maxLevel: 150,
                category: 'click',
                unlockCondition: (game) => game.stats.totalClicks >= 100,
                apply: (game) => {
                    game.clickPower += 5;
                }
            },
            {
                id: 'click_power_3',
                name: 'Cyber Implant',
                icon: '',
                description: 'Cybernetic enhancement for superhuman clicking',
                effect: 'Click power +25',
                baseCost: 20000, // Was 1000, now 20x
                costMultiplier: 1.30,
                currentLevel: 0,
                maxLevel: 100,
                category: 'click',
                unlockCondition: (game) => game.stats.totalClicks >= 500,
                apply: (game) => {
                    game.clickPower += 25;
                }
            },
            {
                id: 'click_power_4',
                name: 'Nano-Muscle Fibers',
                icon: '',
                description: 'Microscopic muscle enhancers for incredible power',
                effect: 'Click power +100',
                baseCost: 250000, // NEW
                costMultiplier: 1.35,
                currentLevel: 0,
                maxLevel: 75,
                category: 'click',
                unlockCondition: (game) => game.stats.totalClicks >= 2000,
                apply: (game) => {
                    game.clickPower += 100;
                }
            },
            {
                id: 'click_power_5',
                name: 'Bionic Overdriver',
                icon: '',
                description: 'Push your body beyond human limits',
                effect: 'Click power +500',
                baseCost: 3000000, // NEW
                costMultiplier: 1.40,
                currentLevel: 0,
                maxLevel: 50,
                category: 'click',
                unlockCondition: (game) => game.stats.totalClicks >= 10000,
                apply: (game) => {
                    game.clickPower += 500;
                }
            },
            {
                id: 'click_power_6',
                name: 'Plasma Gauntlets',
                icon: '',
                description: 'Superheated plasma enhances each strike',
                effect: 'Click power +2500',
                baseCost: 50000000, // NEW
                costMultiplier: 1.45,
                currentLevel: 0,
                maxLevel: 40,
                category: 'click',
                unlockCondition: (game) => game.level >= 20,
                apply: (game) => {
                    game.clickPower += 2500;
                }
            },
            {
                id: 'click_power_7',
                name: 'Singularity Fist',
                icon: '',
                description: 'Each click creates a micro black hole',
                effect: 'Click power +15000',
                baseCost: 750000000, // NEW
                costMultiplier: 1.50,
                currentLevel: 0,
                maxLevel: 30,
                category: 'click',
                unlockCondition: (game) => game.prestigeCount >= 5,
                apply: (game) => {
                    game.clickPower += 15000;
                }
            },
            {
                id: 'click_power_8',
                name: 'God Hand',
                icon: '',
                description: 'Divine power flows through your clicks',
                effect: 'Click power x2',
                baseCost: 10000000000, // NEW
                costMultiplier: 1.60,
                currentLevel: 0,
                maxLevel: 20,
                category: 'click',
                unlockCondition: (game) => game.prestigeCount >= 10,
                apply: (game) => {
                    game.clickPower *= 2;
                }
            },
            {
                id: 'click_power_9',
                name: 'Universe Shatter',
                icon: '',
                description: 'Your clicks can shatter reality itself',
                effect: 'Click power x3',
                baseCost: 250000000000, // NEW
                costMultiplier: 1.75,
                currentLevel: 0,
                maxLevel: 15,
                category: 'click',
                unlockCondition: (game) => game.prestigeCount >= 25,
                apply: (game) => {
                    game.clickPower *= 3;
                }
            },
            {
                id: 'click_power_10',
                name: 'Omnipotent Touch',
                icon: '',
                description: 'Transcend all limits of clicking power',
                effect: 'Click power x10',
                baseCost: 10000000000000, // NEW
                costMultiplier: 2.00,
                currentLevel: 0,
                maxLevel: 10,
                category: 'click',
                unlockCondition: (game) => game.prestigeCount >= 50,
                apply: (game) => {
                    game.clickPower *= 10;
                }
            },

            // GLOBAL MULTIPLIER UPGRADES (10 tiers)
            {
                id: 'global_mult_1',
                name: 'Energy Catalyst',
                icon: '',
                description: 'Catalyze all energy production',
                effect: 'Global multiplier +10%',
                baseCost: 10000, // Was 500, now 20x
                costMultiplier: 1.60, // Steeper from 1.5
                currentLevel: 0,
                maxLevel: 30,
                category: 'multiplier',
                unlockCondition: (game) => game.energy >= 200,
                apply: (game) => {
                    game.globalMultiplier += 0.1;
                }
            },
            {
                id: 'global_mult_2',
                name: 'Fusion Reactor',
                icon: '',
                description: 'Nuclear fusion for massive power gains',
                effect: 'Global multiplier +25%',
                baseCost: 150000, // Was 5000, now 30x
                costMultiplier: 1.85, // Steeper from 1.75
                currentLevel: 0,
                maxLevel: 20,
                category: 'multiplier',
                unlockCondition: (game) => game.energy >= 10000,
                apply: (game) => {
                    game.globalMultiplier += 0.25;
                }
            },
            {
                id: 'global_mult_3',
                name: 'Cosmic Amplifier',
                icon: '',
                description: 'Harness the power of the cosmos',
                effect: 'Global multiplier +50%',
                baseCost: 5000000, // NEW
                costMultiplier: 2.00,
                currentLevel: 0,
                maxLevel: 15,
                category: 'multiplier',
                unlockCondition: (game) => game.prestigeCount >= 3,
                apply: (game) => {
                    game.globalMultiplier += 0.5;
                }
            },
            {
                id: 'global_mult_4',
                name: 'Reality Multiplier',
                icon: '',
                description: 'Multiply reality itself',
                effect: 'Global multiplier x2',
                baseCost: 500000000, // NEW
                costMultiplier: 2.50,
                currentLevel: 0,
                maxLevel: 10,
                category: 'multiplier',
                unlockCondition: (game) => game.prestigeCount >= 15,
                apply: (game) => {
                    game.globalMultiplier *= 2;
                }
            },
            {
                id: 'global_mult_5',
                name: 'Infinite Catalyst',
                icon: '',
                description: 'Approach infinite multipliers',
                effect: 'Global multiplier x5',
                baseCost: 100000000000, // NEW
                costMultiplier: 3.00,
                currentLevel: 0,
                maxLevel: 5,
                category: 'multiplier',
                unlockCondition: (game) => game.prestigeCount >= 40,
                apply: (game) => {
                    game.globalMultiplier *= 5;
                }
            },

            // COMBO UPGRADES (10 tiers)
            {
                id: 'combo_duration',
                name: 'Time Dilation',
                icon: '',
                description: 'Slow down time to maintain combos longer',
                effect: 'Combo window +1s',
                baseCost: 5000, // Was 250, now 20x
                costMultiplier: 1.50,
                currentLevel: 0,
                maxLevel: 30,
                category: 'combo',
                unlockCondition: (game) => game.stats.highestCombo >= 5,
                apply: (game) => {
                    game.comboWindow += 1000;
                }
            },
            {
                id: 'combo_power',
                name: 'Synergy Matrix',
                icon: '',
                description: 'Increase the power of combo multipliers',
                effect: 'Combo bonus +5%',
                baseCost: 15000, // Was 750, now 20x
                costMultiplier: 1.70,
                currentLevel: 0,
                maxLevel: 40,
                category: 'combo',
                unlockCondition: (game) => game.stats.highestCombo >= 10,
                apply: (game) => {
                    game.comboBonus += 0.05;
                }
            },
            {
                id: 'combo_starter',
                name: 'Combo Initiator',
                icon: '',
                description: 'Start each click chain with a bonus',
                effect: 'Combo starts at +5',
                baseCost: 100000, // NEW
                costMultiplier: 1.80,
                currentLevel: 0,
                maxLevel: 20,
                category: 'combo',
                unlockCondition: (game) => game.stats.highestCombo >= 25,
                apply: (game) => {
                    game.comboStartBonus = (game.comboStartBonus || 0) + 5;
                }
            },
            {
                id: 'combo_preservation',
                name: 'Combo Shield',
                icon: '',
                description: 'Chance to prevent combo from breaking',
                effect: '+10% combo save chance',
                baseCost: 2500000, // NEW
                costMultiplier: 2.00,
                currentLevel: 0,
                maxLevel: 10,
                category: 'combo',
                unlockCondition: (game) => game.stats.highestCombo >= 50,
                apply: (game) => {
                    game.comboSaveChance = (game.comboSaveChance || 0) + 0.1;
                }
            },

            // AUTO-CLICK UPGRADES (10 tiers)
            {
                id: 'auto_click',
                name: 'Auto-Clicker Module',
                icon: '',
                description: 'Automated clicking system',
                effect: '1 auto-click per second',
                baseCost: 50000, // Was 2000, now 25x
                costMultiplier: 2.20, // Steeper from 2.0
                currentLevel: 0,
                maxLevel: 20,
                category: 'automation',
                unlockCondition: (game) => game.energy >= 10000,
                apply: (game) => {
                    game.autoClickersPerSecond += 1;
                }
            },
            {
                id: 'auto_click_2',
                name: 'Advanced AI Clicker',
                icon: '',
                description: 'Smarter automated clicking',
                effect: '+5 auto-clicks per second',
                baseCost: 1000000, // NEW
                costMultiplier: 2.50,
                currentLevel: 0,
                maxLevel: 15,
                category: 'automation',
                unlockCondition: (game) => game.autoClickersPerSecond >= 5,
                apply: (game) => {
                    game.autoClickersPerSecond += 5;
                }
            },
            {
                id: 'auto_click_3',
                name: 'Quantum Auto-Clicker',
                icon: '',
                description: 'Click in multiple realities at once',
                effect: '+25 auto-clicks per second',
                baseCost: 50000000, // NEW
                costMultiplier: 3.00,
                currentLevel: 0,
                maxLevel: 10,
                category: 'automation',
                unlockCondition: (game) => game.autoClickersPerSecond >= 25,
                apply: (game) => {
                    game.autoClickersPerSecond += 25;
                }
            },
            {
                id: 'auto_click_efficiency',
                name: 'Auto-Click Booster',
                icon: '',
                description: 'Auto-clickers work more efficiently',
                effect: 'Auto-click power x2',
                baseCost: 10000000, // NEW
                costMultiplier: 2.75,
                currentLevel: 0,
                maxLevel: 15,
                category: 'automation',
                unlockCondition: (game) => game.autoClickersPerSecond >= 10,
                apply: (game) => {
                    game.autoClickerMultiplier *= 2;
                }
            },

            // CRIT UPGRADES (15 tiers)
            {
                id: 'crit_chance',
                name: 'Lucky Strike',
                icon: '',
                description: 'Chance to deal critical clicks',
                effect: '+5% crit chance',
                baseCost: 30000, // Was 1500, now 20x
                costMultiplier: 1.90,
                currentLevel: 0,
                maxLevel: 20,
                category: 'crit',
                unlockCondition: (game) => game.stats.totalClicks >= 1000,
                apply: (game) => {
                    game.critChance += 0.05;
                }
            },
            {
                id: 'crit_power',
                name: 'Overcharge',
                icon: '',
                description: 'Increase critical click damage',
                effect: 'Crits deal +50% damage',
                baseCost: 90000, // Was 3000, now 30x
                costMultiplier: 2.80,
                currentLevel: 0,
                maxLevel: 15,
                category: 'crit',
                unlockCondition: (game) => game.critChance >= 0.05,
                apply: (game) => {
                    game.critMultiplier += 0.5;
                }
            },
            {
                id: 'crit_chance_2',
                name: 'Fortune\'s Favor',
                icon: '',
                description: 'Even more critical hit chance',
                effect: '+3% crit chance',
                baseCost: 500000, // NEW
                costMultiplier: 2.00,
                currentLevel: 0,
                maxLevel: 25,
                category: 'crit',
                unlockCondition: (game) => game.critChance >= 0.25,
                apply: (game) => {
                    game.critChance += 0.03;
                }
            },
            {
                id: 'crit_power_2',
                name: 'Mega Crits',
                icon: '',
                description: 'Crits hit even harder',
                effect: 'Crit damage x2',
                baseCost: 5000000, // NEW
                costMultiplier: 3.00,
                currentLevel: 0,
                maxLevel: 10,
                category: 'crit',
                unlockCondition: (game) => game.stats.criticalClicks >= 1000,
                apply: (game) => {
                    game.critMultiplier *= 2;
                }
            },
            {
                id: 'crit_power_3',
                name: 'Hyper Crits',
                icon: '',
                description: 'Devastating critical strikes',
                effect: 'Crit damage x3',
                baseCost: 100000000, // NEW
                costMultiplier: 3.50,
                currentLevel: 0,
                maxLevel: 8,
                category: 'crit',
                unlockCondition: (game) => game.critMultiplier >= 10,
                apply: (game) => {
                    game.critMultiplier *= 3;
                }
            },
            {
                id: 'crit_chain',
                name: 'Chain Crits',
                icon: '',
                description: 'Crits have a chance to trigger another crit',
                effect: '+15% double crit chance',
                baseCost: 75000000, // NEW
                costMultiplier: 2.50,
                currentLevel: 0,
                maxLevel: 10,
                category: 'crit',
                unlockCondition: (game) => game.stats.criticalClicks >= 5000,
                apply: (game) => {
                    game.critChainChance = (game.critChainChance || 0) + 0.15;
                }
            },

            // SPECIAL EFFECT UPGRADES (15+ new)
            {
                id: 'energy_overflow',
                name: 'Energy Overflow',
                icon: '',
                description: 'All energy gains increased',
                effect: 'Energy gain +25%',
                baseCost: 75000,
                costMultiplier: 2.00,
                currentLevel: 0,
                maxLevel: 20,
                category: 'special',
                unlockCondition: (game) => game.stats.totalEnergy >= 100000,
                apply: (game) => {
                    game.energyGainMultiplier *= 1.25;
                }
            },
            {
                id: 'cost_reduction',
                name: 'Efficient Economics',
                icon: '',
                description: 'Everything costs less',
                effect: 'All costs -5%',
                baseCost: 250000,
                costMultiplier: 2.50,
                currentLevel: 0,
                maxLevel: 15,
                category: 'special',
                unlockCondition: (game) => game.prestigeCount >= 5,
                apply: (game) => {
                    game.costReduction += 0.05;
                }
            },
            {
                id: 'golden_touch',
                name: 'Midas Touch',
                icon: '',
                description: 'Chance for golden clicks worth 100x',
                effect: '+2% golden click chance',
                baseCost: 5000000,
                costMultiplier: 3.00,
                currentLevel: 0,
                maxLevel: 10,
                category: 'special',
                unlockCondition: (game) => game.level >= 25,
                apply: (game) => {
                    game.goldenClickChance = (game.goldenClickChance || 0) + 0.02;
                }
            },
            {
                id: 'speed_boost',
                name: 'Temporal Acceleration',
                icon: '',
                description: 'Everything happens faster',
                effect: 'Game speed +10%',
                baseCost: 10000000,
                costMultiplier: 2.75,
                currentLevel: 0,
                maxLevel: 10,
                category: 'special',
                unlockCondition: (game) => game.prestigeCount >= 10,
                apply: (game) => {
                    game.gameSpeed = (game.gameSpeed || 1) * 1.1;
                }
            },
            {
                id: 'mega_boost',
                name: 'Mega Boost',
                icon: '',
                description: 'Occasional massive energy bursts',
                effect: '+1% chance for 1000x energy',
                baseCost: 50000000,
                costMultiplier: 3.50,
                currentLevel: 0,
                maxLevel: 5,
                category: 'special',
                unlockCondition: (game) => game.prestigeCount >= 20,
                apply: (game) => {
                    game.megaBoostChance = (game.megaBoostChance || 0) + 0.01;
                }
            },
            {
                id: 'lucky_events',
                name: 'Event Attractor',
                icon: '',
                description: 'Special events happen more often',
                effect: '+20% event frequency',
                baseCost: 15000000,
                costMultiplier: 2.25,
                currentLevel: 0,
                maxLevel: 15,
                category: 'special',
                unlockCondition: (game) => game.stats.eventsCompleted >= 10,
                apply: (game) => {
                    game.eventSpawnBonus += 0.2;
                }
            },
            {
                id: 'prestige_boost',
                name: 'Prestige Accelerator',
                icon: '',
                description: 'Gain prestige points faster',
                effect: '+10% prestige points',
                baseCost: 25000000,
                costMultiplier: 2.50,
                currentLevel: 0,
                maxLevel: 20,
                category: 'special',
                unlockCondition: (game) => game.prestigeCount >= 5,
                apply: (game) => {
                    game.prestigePointsBonus += 0.1;
                }
            },
            {
                id: 'exp_boost',
                name: 'XP Multiplier',
                icon: '',
                description: 'Level up faster',
                effect: '+50% experience gain',
                baseCost: 8000000,
                costMultiplier: 2.00,
                currentLevel: 0,
                maxLevel: 15,
                category: 'special',
                unlockCondition: (game) => game.level >= 15,
                apply: (game) => {
                    game.expMultiplier = (game.expMultiplier || 1) * 1.5;
                }
            },
            {
                id: 'bulk_buy',
                name: 'Bulk Purchasing',
                icon: '',
                description: 'Buy multiple upgrades at once',
                effect: 'Unlock bulk buy options',
                baseCost: 50000000,
                costMultiplier: 1,
                currentLevel: 0,
                maxLevel: 1,
                category: 'special',
                unlockCondition: (game) => game.prestigeCount >= 3,
                apply: (game) => {
                    game.bulkBuyUnlocked = true;
                }
            },
            {
                id: 'offline_gains',
                name: 'Offline Generator',
                icon: '',
                description: 'Earn energy while offline',
                effect: '+10% offline production',
                baseCost: 20000000,
                costMultiplier: 2.50,
                currentLevel: 0,
                maxLevel: 10,
                category: 'special',
                unlockCondition: (game) => game.prestigeCount >= 5,
                apply: (game) => {
                    game.offlineProductionRate += 0.1;
                }
            }
        ];
        
        this.categories = ['click', 'multiplier', 'combo', 'automation', 'crit', 'special'];
    }

    getUpgrade(id) {
        return this.upgrades.find(u => u.id === id);
    }

    getCost(upgrade) {
        let cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.costMultiplier, upgrade.currentLevel));
        
        // Apply cost modifiers from mutations
        if (window.game) {
            const costReduction = game.costReduction || 0;
            const mutationCostReduction = game.mutationCostReduction || 0;
            const mutationCostIncrease = game.mutationCostIncrease || 1;
            
            cost *= (1 - costReduction);
            cost *= (1 - mutationCostReduction);
            cost *= mutationCostIncrease;
        }
        
        return Math.floor(cost);
    }

    canAfford(upgrade, energy) {
        return energy >= this.getCost(upgrade);
    }

    isUnlocked(upgrade, game) {
        if (!upgrade.unlockCondition) return true;
        return upgrade.unlockCondition(game);
    }

    isMaxed(upgrade) {
        return upgrade.currentLevel >= upgrade.maxLevel;
    }

    purchase(upgrade, game) {
        if (this.isMaxed(upgrade)) return false;
        if (!this.canAfford(upgrade, game.energy)) return false;
        if (!this.isUnlocked(upgrade, game)) return false;

        const cost = this.getCost(upgrade);
        game.energy -= cost;
        upgrade.currentLevel++;
        upgrade.apply(game);

        // Create burst effect
        const upgradeCard = document.querySelector(`[data-upgrade-id="${upgrade.id}"]`);
        if (upgradeCard) {
            const rect = upgradeCard.getBoundingClientRect();
            particleSystem.createBurst(
                rect.left + rect.width / 2,
                rect.top + rect.height / 2,
                15,
                '#00ffff'
            );
        }

        notifications.success(
            ' Upgrade Purchased!',
            `${upgrade.name} Level ${upgrade.currentLevel}`
        );

        return true;
    }

    reset() {
        this.upgrades.forEach(upgrade => {
            upgrade.currentLevel = 0;
        });
    }

    getSaveData() {
        const data = {};
        this.upgrades.forEach(upgrade => {
            data[upgrade.id] = upgrade.currentLevel;
        });
        return data;
    }

    loadSaveData(data) {
        if (!data) return;
        Object.keys(data).forEach(id => {
            const upgrade = this.getUpgrade(id);
            if (upgrade) {
                upgrade.currentLevel = data[id];
            }
        });
    }
    
    getUpgradesByCategory(category) {
        return this.upgrades.filter(u => u.category === category);
    }
}

const upgradesManager = new UpgradesManager();


// ===== GENERATORS =====
// Massively Expanded Generators - 25+ Generators with 10-100x costs

class GeneratorsManager {
    constructor() {
        this.generators = [
            // TIER 1-5: Early game (10x cost increase)
            {
                id: 'gen_1',
                name: 'Nano Bot',
                icon: '',
                description: 'Tiny robots that generate energy automatically',
                baseProduction: 0.1,
                baseCost: 150, // Was 15, now 10x
                costMultiplier: 1.20, // Steeper from 1.15
                count: 0,
                unlockCost: 0,
                tier: 1,
                special: null
            },
            {
                id: 'gen_2',
                name: 'Solar Panel',
                icon: '',
                description: 'Harness the power of stars',
                baseProduction: 1,
                baseCost: 1000, // Was 100, now 10x
                costMultiplier: 1.20,
                count: 0,
                unlockCost: 500,
                tier: 2,
                special: null
            },
            {
                id: 'gen_3',
                name: 'Quantum Core',
                icon: '',
                description: 'Quantum entanglement for infinite energy',
                baseProduction: 8,
                baseCost: 11000, // Was 1100, now 10x
                costMultiplier: 1.20,
                count: 0,
                unlockCost: 5000,
                tier: 3,
                special: null
            },
            {
                id: 'gen_4',
                name: 'Fusion Plant',
                icon: '',
                description: 'Nuclear fusion power station',
                baseProduction: 47,
                baseCost: 120000, // Was 12000, now 10x
                costMultiplier: 1.20,
                count: 0,
                unlockCost: 50000,
                tier: 4,
                special: null
            },
            {
                id: 'gen_5',
                name: 'Antimatter Reactor',
                icon: '',
                description: 'Harness the power of antimatter',
                baseProduction: 260,
                baseCost: 1300000, // Was 130000, now 10x
                costMultiplier: 1.20,
                count: 0,
                unlockCost: 500000,
                tier: 5,
                special: null
            },
            
            // TIER 6-10: Mid game (25x cost increase)
            {
                id: 'gen_6',
                name: 'Dark Energy Collector',
                icon: '',
                description: 'Tap into the mysterious dark energy of the universe',
                baseProduction: 1400,
                baseCost: 35000000, // Was 1400000, now 25x
                costMultiplier: 1.20,
                count: 0,
                unlockCost: 5000000,
                tier: 6,
                special: null
            },
            {
                id: 'gen_7',
                name: 'Time Singularity',
                icon: '',
                description: 'Generate energy from time itself',
                baseProduction: 7800,
                baseCost: 500000000, // Was 20000000, now 25x
                costMultiplier: 1.20,
                count: 0,
                unlockCost: 50000000,
                tier: 7,
                special: null
            },
            {
                id: 'gen_8',
                name: 'Reality Engine',
                icon: '',
                description: 'Rewrite reality to generate infinite power',
                baseProduction: 44000,
                baseCost: 8250000000, // Was 330000000, now 25x
                costMultiplier: 1.20,
                count: 0,
                unlockCost: 500000000,
                tier: 8,
                special: null
            },
            {
                id: 'gen_9',
                name: 'Dimension Gateway',
                icon: '',
                description: 'Draw energy from parallel dimensions',
                baseProduction: 260000,
                baseCost: 127500000000, // Was 5100000000, now 25x
                costMultiplier: 1.20,
                count: 0,
                unlockCost: 5000000000,
                tier: 9,
                special: null
            },
            {
                id: 'gen_10',
                name: 'Universal Nexus',
                icon: '',
                description: 'The ultimate energy source from the fabric of existence',
                baseProduction: 1600000,
                baseCost: 1875000000000, // Was 75000000000, now 25x
                costMultiplier: 1.20,
                count: 0,
                unlockCost: 50000000000,
                tier: 10,
                special: null
            },
            
            // TIER 11-15: Late game NEW generators (50x cost increase)
            {
                id: 'gen_11',
                name: 'Void Harvester',
                icon: '',
                description: 'Extract energy from the void between universes',
                baseProduction: 10000000,
                baseCost: 50000000000000,
                costMultiplier: 1.25,
                count: 0,
                unlockCost: 500000000000,
                tier: 11,
                special: 'Synergizes with Dark Energy Collector'
            },
            {
                id: 'gen_12',
                name: 'Celestial Forge',
                icon: '',
                description: 'Forge energy from the hearts of dying stars',
                baseProduction: 65000000,
                baseCost: 1000000000000000,
                costMultiplier: 1.25,
                count: 0,
                unlockCost: 5000000000000,
                tier: 12,
                special: 'Synergizes with Solar Panel and Fusion Plant'
            },
            {
                id: 'gen_13',
                name: 'Infinity Stone',
                icon: '',
                description: 'Ancient artifact of limitless power',
                baseProduction: 450000000,
                baseCost: 25000000000000000,
                costMultiplier: 1.25,
                count: 0,
                unlockCost: 50000000000000,
                tier: 13,
                special: 'Boosts all production by 1% per stone'
            },
            {
                id: 'gen_14',
                name: 'Cosmic Weaver',
                icon: '',
                description: 'Weave the fabric of spacetime into pure energy',
                baseProduction: 3200000000,
                baseCost: 750000000000000000,
                costMultiplier: 1.25,
                count: 0,
                unlockCost: 500000000000000,
                tier: 14,
                special: 'Synergizes with Reality Engine and Time Singularity'
            },
            {
                id: 'gen_15',
                name: 'Primordial Flame',
                icon: '',
                description: 'The first fire that ignited the Big Bang',
                baseProduction: 24000000000,
                baseCost: 25000000000000000000,
                costMultiplier: 1.25,
                count: 0,
                unlockCost: 5000000000000000,
                tier: 15,
                special: 'Each one doubles click power'
            },
            
            // TIER 16-20: End game NEW generators (100x cost increase)
            {
                id: 'gen_16',
                name: 'Multiversal Conduit',
                icon: '',
                description: 'Channel energy from infinite parallel universes',
                baseProduction: 180000000000,
                baseCost: 1000000000000000000000,
                costMultiplier: 1.30,
                count: 0,
                unlockCost: 50000000000000000,
                tier: 16,
                special: 'Synergizes with Dimension Gateway'
            },
            {
                id: 'gen_17',
                name: 'Omega Point',
                icon: '',
                description: 'The final state of universal evolution',
                baseProduction: 1400000000000,
                baseCost: 50000000000000000000000,
                costMultiplier: 1.30,
                count: 0,
                unlockCost: 500000000000000000,
                tier: 17,
                special: 'Boosts all generators by 5% per Omega Point'
            },
            {
                id: 'gen_18',
                name: 'Dyson Sphere',
                icon: '',
                description: 'Megastructure that encapsulates entire stars',
                baseProduction: 11000000000000,
                baseCost: 3000000000000000000000000,
                costMultiplier: 1.30,
                count: 0,
                unlockCost: 5000000000000000000,
                tier: 18,
                special: 'Each sphere boosts solar generators x2'
            },
            {
                id: 'gen_19',
                name: 'Entropy Reverser',
                icon: '',
                description: 'Reverse entropy to create energy from chaos',
                baseProduction: 90000000000000,
                baseCost: 200000000000000000000000000,
                costMultiplier: 1.30,
                count: 0,
                unlockCost: 50000000000000000000,
                tier: 19,
                special: 'Older generators produce more energy over time'
            },
            {
                id: 'gen_20',
                name: 'God Engine',
                icon: '',
                description: 'The machine that powers creation itself',
                baseProduction: 750000000000000,
                baseCost: 15000000000000000000000000000,
                costMultiplier: 1.30,
                count: 0,
                unlockCost: 500000000000000000000,
                tier: 20,
                special: 'Multiplies ALL production by its count'
            },
            
            // TIER 21-25: Post-game NEW generators (Transcendent)
            {
                id: 'gen_21',
                name: 'Transcendence Core',
                icon: '',
                description: 'Transcend physical reality',
                baseProduction: 6500000000000000,
                baseCost: 1000000000000000000000000000000,
                costMultiplier: 1.35,
                count: 0,
                unlockCost: 5000000000000000000000,
                tier: 21,
                special: 'Unlocks Transcendence mechanic'
            },
            {
                id: 'gen_22',
                name: 'Akashic Records',
                icon: '',
                description: 'Access the infinite knowledge of all existence',
                baseProduction: 55000000000000000,
                baseCost: 75000000000000000000000000000000,
                costMultiplier: 1.35,
                count: 0,
                unlockCost: 50000000000000000000000,
                tier: 22,
                special: 'Grants bonus based on total discoveries'
            },
            {
                id: 'gen_23',
                name: 'Chaos Incarnate',
                icon: '',
                description: 'Pure concentrated chaos energy',
                baseProduction: 500000000000000000,
                baseCost: 6000000000000000000000000000000000,
                costMultiplier: 1.35,
                count: 0,
                unlockCost: 500000000000000000000000,
                tier: 23,
                special: 'Random production between 0-10x base'
            },
            {
                id: 'gen_24',
                name: 'Eternal Construct',
                icon: '',
                description: 'A structure that exists beyond time',
                baseProduction: 4500000000000000000,
                baseCost: 500000000000000000000000000000000000,
                costMultiplier: 1.35,
                count: 0,
                unlockCost: 5000000000000000000000000,
                tier: 24,
                special: 'Production increases exponentially over game time'
            },
            {
                id: 'gen_25',
                name: 'The Origin',
                icon: '',
                description: 'The source of all energy, all matter, all existence',
                baseProduction: 40000000000000000000,
                baseCost: 50000000000000000000000000000000000000,
                costMultiplier: 1.40,
                count: 0,
                unlockCost: 50000000000000000000000000,
                tier: 25,
                special: 'Multiplies EVERYTHING by 10 per Origin'
            }
        ];
    }

    getGenerator(id) {
        return this.generators.find(g => g.id === id);
    }

    getCost(generator) {
        let cost = Math.floor(generator.baseCost * Math.pow(generator.costMultiplier, generator.count));
        
        // Apply cost modifiers
        if (window.game) {
            const costReduction = game.costReduction || 0;
            const mutationCostReduction = game.mutationCostReduction || 0;
            const mutationCostIncrease = game.mutationCostIncrease || 1;
            
            cost *= (1 - costReduction);
            cost *= (1 - mutationCostReduction);
            cost *= mutationCostIncrease;
        }
        
        return Math.floor(cost);
    }

    getProduction(generator, game) {
        if (generator.count === 0) return 0;
        
        let production = generator.baseProduction * generator.count;
        
        // Apply generator-specific synergies
        if (game.synergySolarQuantum && (generator.id === 'gen_2' || generator.id === 'gen_3')) {
            production *= game.synergySolarQuantum;
        }
        if (game.synergyFusionAntimatter && (generator.id === 'gen_4' || generator.id === 'gen_5')) {
            production *= game.synergyFusionAntimatter;
        }
        if (game.synergyDarkTime && (generator.id === 'gen_6' || generator.id === 'gen_7')) {
            production *= game.synergyDarkTime;
        }
        if (game.synergyRealityDimension && (generator.id === 'gen_8' || generator.id === 'gen_9')) {
            production *= game.synergyRealityDimension;
        }
        
        // Infinity Stone bonus
        const infinityStones = this.getGenerator('gen_13');
        if (infinityStones && infinityStones.count > 0) {
            production *= (1 + (infinityStones.count * 0.01));
        }
        
        // Primordial Flame - boosts click power instead
        
        // Omega Point bonus
        const omegaPoints = this.getGenerator('gen_17');
        if (omegaPoints && omegaPoints.count > 0) {
            production *= (1 + (omegaPoints.count * 0.05));
        }
        
        // Dyson Sphere bonus for solar generators
        const dysonSpheres = this.getGenerator('gen_18');
        if (dysonSpheres && dysonSpheres.count > 0 && generator.id === 'gen_2') {
            production *= Math.pow(2, dysonSpheres.count);
        }
        
        // God Engine multiplier
        const godEngines = this.getGenerator('gen_20');
        if (godEngines && godEngines.count > 0) {
            production *= godEngines.count;
        }
        
        // The Origin ultimate multiplier
        const origins = this.getGenerator('gen_25');
        if (origins && origins.count > 0) {
            production *= Math.pow(10, origins.count);
        }
        
        // Apply mutation modifiers
        production *= (game.mutationProductionMult || 1);
        
        // Apply global multiplier
        production *= game.globalMultiplier;
        
        // Apply prestige multiplier
        production *= game.prestigeMultiplier;
        
        // Apply ultimate synergy
        if (game.synergyUltimate) {
            production *= game.synergyUltimate;
        }
        
        // Apply ascended synergy
        if (game.synergyAscended) {
            production *= game.synergyAscended;
        }
        
        return production;
    }

    getTotalProduction(game) {
        return this.generators.reduce((total, gen) => {
            return total + this.getProduction(gen, game);
        }, 0);
    }

    canAfford(generator, energy) {
        return energy >= this.getCost(generator);
    }

    isUnlocked(generator, totalEnergy) {
        return totalEnergy >= generator.unlockCost;
    }

    purchase(generator, game) {
        if (!this.canAfford(generator, game.energy)) return false;
        if (!this.isUnlocked(generator, game.stats.totalEnergy)) return false;

        const cost = this.getCost(generator);
        game.energy -= cost;
        generator.count++;

        // Create burst effect
        const genCard = document.querySelector(`[data-generator-id="${generator.id}"]`);
        if (genCard) {
            const rect = genCard.getBoundingClientRect();
            particleSystem.createBurst(
                rect.left + rect.width / 2,
                rect.top + rect.height / 2,
                15,
                '#0080ff'
            );
        }

        notifications.success(
            ' Generator Purchased!',
            `${generator.name} x${generator.count}`
        );

        return true;
    }

    reset() {
        this.generators.forEach(gen => {
            gen.count = 0;
        });
    }

    getSaveData() {
        const data = {};
        this.generators.forEach(gen => {
            data[gen.id] = gen.count;
        });
        return data;
    }

    loadSaveData(data) {
        if (!data) return;
        Object.keys(data).forEach(id => {
            const gen = this.getGenerator(id);
            if (gen) {
                gen.count = data[id];
            }
        });
    }
}

const generatorsManager = new GeneratorsManager();


// ===== ACHIEVEMENTS =====
// Achievements System

class AchievementsManager {
    constructor() {
        this.achievements = [
            // Click-based achievements
            {
                id: 'first_click',
                name: 'First Contact',
                icon: '',
                description: 'Make your first click',
                tier: 'bronze',
                reward: 'Click power +1',
                condition: (game) => game.stats.totalClicks >= 1,
                unlocked: false,
                apply: (game) => { game.clickPower += 1; }
            },
            {
                id: 'clicks_100',
                name: 'Clicker Novice',
                icon: '',
                description: 'Make 100 clicks',
                tier: 'bronze',
                reward: 'Global mult +5%',
                condition: (game) => game.stats.totalClicks >= 100,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.05; }
            },
            {
                id: 'clicks_1000',
                name: 'Clicker Adept',
                icon: '',
                description: 'Make 1,000 clicks',
                tier: 'silver',
                reward: 'Global mult +10%',
                condition: (game) => game.stats.totalClicks >= 1000,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.1; }
            },
            {
                id: 'clicks_10000',
                name: 'Clicker Master',
                icon: '',
                description: 'Make 10,000 clicks',
                tier: 'gold',
                reward: 'Global mult +20%',
                condition: (game) => game.stats.totalClicks >= 10000,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.2; }
            },
            {
                id: 'clicks_100000',
                name: 'Click God',
                icon: '',
                description: 'Make 100,000 clicks',
                tier: 'platinum',
                reward: 'Global mult +50%',
                condition: (game) => game.stats.totalClicks >= 100000,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.5; }
            },
            
            // Energy-based achievements
            {
                id: 'energy_100',
                name: 'Energy Collector',
                icon: '',
                description: 'Collect 100 total energy',
                tier: 'bronze',
                reward: 'Click power +2',
                condition: (game) => game.stats.totalEnergy >= 100,
                unlocked: false,
                apply: (game) => { game.clickPower += 2; }
            },
            {
                id: 'energy_10000',
                name: 'Power Plant',
                icon: '',
                description: 'Collect 10,000 total energy',
                tier: 'silver',
                reward: 'Global mult +15%',
                condition: (game) => game.stats.totalEnergy >= 10000,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.15; }
            },
            {
                id: 'energy_1000000',
                name: 'Energy Tycoon',
                icon: '',
                description: 'Collect 1,000,000 total energy',
                tier: 'gold',
                reward: 'Global mult +30%',
                condition: (game) => game.stats.totalEnergy >= 1000000,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.3; }
            },
            {
                id: 'energy_billion',
                name: 'Energy Magnate',
                icon: '',
                description: 'Collect 1 billion total energy',
                tier: 'platinum',
                reward: 'Global mult +100%',
                condition: (game) => game.stats.totalEnergy >= 1000000000,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 1; }
            },
            
            // Combo-based achievements
            {
                id: 'combo_10',
                name: 'Combo Starter',
                icon: '',
                description: 'Reach a 10x combo',
                tier: 'bronze',
                reward: 'Combo bonus +10%',
                condition: (game) => game.stats.highestCombo >= 10,
                unlocked: false,
                apply: (game) => { game.comboBonus += 0.1; }
            },
            {
                id: 'combo_50',
                name: 'Combo Expert',
                icon: '',
                description: 'Reach a 50x combo',
                tier: 'silver',
                reward: 'Combo bonus +25%',
                condition: (game) => game.stats.highestCombo >= 50,
                unlocked: false,
                apply: (game) => { game.comboBonus += 0.25; }
            },
            {
                id: 'combo_100',
                name: 'Combo Master',
                icon: '',
                description: 'Reach a 100x combo',
                tier: 'gold',
                reward: 'Combo bonus +50%',
                condition: (game) => game.stats.highestCombo >= 100,
                unlocked: false,
                apply: (game) => { game.comboBonus += 0.5; }
            },
            
            // Generator-based achievements
            {
                id: 'first_generator',
                name: 'Automation Begins',
                icon: '',
                description: 'Purchase your first generator',
                tier: 'bronze',
                reward: 'Generator output +10%',
                condition: (game) => {
                    return generatorsManager.generators.some(g => g.count > 0);
                },
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.1; }
            },
            {
                id: 'ten_generators',
                name: 'Factory Owner',
                icon: '',
                description: 'Own 10 total generators',
                tier: 'silver',
                reward: 'Generator output +25%',
                condition: (game) => {
                    const total = generatorsManager.generators.reduce((sum, g) => sum + g.count, 0);
                    return total >= 10;
                },
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.25; }
            },
            {
                id: 'hundred_generators',
                name: 'Industrial Complex',
                icon: '',
                description: 'Own 100 total generators',
                tier: 'gold',
                reward: 'Generator output +50%',
                condition: (game) => {
                    const total = generatorsManager.generators.reduce((sum, g) => sum + g.count, 0);
                    return total >= 100;
                },
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.5; }
            },
            
            // Prestige-based achievements
            {
                id: 'first_prestige',
                name: 'Ascension',
                icon: '',
                description: 'Prestige for the first time',
                tier: 'gold',
                reward: 'Prestige gain +10%',
                condition: (game) => game.prestigeCount >= 1,
                unlocked: false,
                apply: (game) => { game.prestigePointsBonus += 0.1; }
            },
            {
                id: 'prestige_10',
                name: 'Eternal Cycle',
                icon: '',
                description: 'Prestige 10 times',
                tier: 'platinum',
                reward: 'Prestige gain +25%',
                condition: (game) => game.prestigeCount >= 10,
                unlocked: false,
                apply: (game) => { game.prestigePointsBonus += 0.25; }
            },
            {
                id: 'prestige_50',
                name: 'Transcendent',
                icon: '',
                description: 'Prestige 50 times',
                tier: 'diamond',
                reward: 'Prestige gain +50%',
                condition: (game) => game.prestigeCount >= 50,
                unlocked: false,
                apply: (game) => { game.prestigePointsBonus += 0.5; }
            },
            
            // Time-based achievements
            {
                id: 'play_1hour',
                name: 'Dedicated',
                icon: '',
                description: 'Play for 1 hour',
                tier: 'bronze',
                reward: 'Global mult +10%',
                condition: (game) => game.stats.playTime >= 3600,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.1; }
            },
            {
                id: 'play_10hours',
                name: 'Committed',
                icon: '',
                description: 'Play for 10 hours',
                tier: 'silver',
                reward: 'Global mult +25%',
                condition: (game) => game.stats.playTime >= 36000,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.25; }
            },
            {
                id: 'play_100hours',
                name: 'Obsessed',
                icon: '',
                description: 'Play for 100 hours',
                tier: 'gold',
                reward: 'Global mult +100%',
                condition: (game) => game.stats.playTime >= 360000,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 1; }
            },
            
            // Special achievements
            {
                id: 'crit_master',
                name: 'Critical Thinker',
                icon: '',
                description: 'Land 100 critical clicks',
                tier: 'silver',
                reward: 'Crit chance +5%',
                condition: (game) => game.stats.criticalClicks >= 100,
                unlocked: false,
                apply: (game) => { game.critChance += 0.05; }
            },
            {
                id: 'powerup_user',
                name: 'Power User',
                icon: '',
                description: 'Use 50 power-ups',
                tier: 'silver',
                reward: 'Power-up duration +10%',
                condition: (game) => game.stats.powerupsUsed >= 50,
                unlocked: false,
                apply: (game) => { game.powerupDurationBonus += 0.1; }
            },
            {
                id: 'event_hunter',
                name: 'Event Hunter',
                icon: '',
                description: 'Complete 25 special events',
                tier: 'gold',
                reward: 'Event spawn rate +25%',
                condition: (game) => game.stats.eventsCompleted >= 25,
                unlocked: false,
                apply: (game) => { game.eventSpawnBonus += 0.25; }
            }
        ];
    }

    check(game) {
        let newUnlocks = [];
        
        this.achievements.forEach(achievement => {
            if (!achievement.unlocked && achievement.condition(game)) {
                achievement.unlocked = true;
                achievement.apply(game);
                newUnlocks.push(achievement);
                
                // Show notification and celebration
                notifications.success(
                    ` Achievement Unlocked!`,
                    `${achievement.name} - ${achievement.reward}`,
                    4000
                );
                
                // Create celebration effect
                const achievementCard = document.querySelector(`[data-achievement-id="${achievement.id}"]`);
                if (achievementCard) {
                    particleSystem.createCelebration(achievementCard);
                }
            }
        });
        
        return newUnlocks;
    }

    getUnlockedCount() {
        return this.achievements.filter(a => a.unlocked).length;
    }

    getTotalCount() {
        return this.achievements.length;
    }

    getProgress(achievement, game) {
        // This is a simplified version - you'd need to track individual progress
        return achievement.unlocked ? 100 : 0;
    }

    reset(keepPrestige = false) {
        this.achievements.forEach(achievement => {
            // Keep prestige achievements if specified
            if (keepPrestige && achievement.id.startsWith('prestige_')) {
                return;
            }
            achievement.unlocked = false;
        });
    }

    getSaveData() {
        const data = {};
        this.achievements.forEach(achievement => {
            data[achievement.id] = achievement.unlocked;
        });
        return data;
    }

    loadSaveData(data) {
        if (!data) return;
        Object.keys(data).forEach(id => {
            const achievement = this.achievements.find(a => a.id === id);
            if (achievement) {
                achievement.unlocked = data[id];
            }
        });
    }
}

const achievementsManager = new AchievementsManager();


// ===== PRESTIGE =====
// Prestige System

class PrestigeManager {
    constructor() {
        this.prestigeUpgrades = [
            {
                id: 'prestige_mult_1',
                name: 'Nexus Conduit',
                icon: '',
                description: 'Increase prestige multiplier effectiveness',
                effect: '+10% prestige bonus per level',
                baseCost: 1,
                costMultiplier: 2,
                currentLevel: 0,
                maxLevel: 20,
                apply: (game) => {
                    game.prestigeBonus += 0.1;
                }
            },
            {
                id: 'prestige_gain_1',
                name: 'Ascension Catalyst',
                icon: '',
                description: 'Gain more prestige points per ascension',
                effect: '+25% prestige points gained',
                baseCost: 2,
                costMultiplier: 2.5,
                currentLevel: 0,
                maxLevel: 10,
                apply: (game) => {
                    game.prestigePointsBonus += 0.25;
                }
            },
            {
                id: 'starting_energy',
                name: 'Residual Energy',
                icon: '',
                description: 'Start each run with bonus energy',
                effect: 'Start with +100 energy per level',
                baseCost: 3,
                costMultiplier: 2,
                currentLevel: 0,
                maxLevel: 15,
                apply: (game) => {
                    game.startingEnergy += 100;
                }
            },
            {
                id: 'starting_multiplier',
                name: 'Quantum Resonance',
                icon: '',
                description: 'Start with increased global multiplier',
                effect: '+50% global mult per level',
                baseCost: 5,
                costMultiplier: 3,
                currentLevel: 0,
                maxLevel: 10,
                apply: (game) => {
                    game.startingMultiplier += 0.5;
                }
            },
            {
                id: 'auto_buy_generators',
                name: 'Auto-Purchase Protocol',
                icon: '',
                description: 'Automatically purchase generators',
                effect: 'Unlock auto-buy for generators',
                baseCost: 10,
                costMultiplier: 1,
                currentLevel: 0,
                maxLevel: 1,
                apply: (game) => {
                    game.autoBuyGenerators = true;
                }
            },
            {
                id: 'offline_progress',
                name: 'Temporal Cache',
                icon: '',
                description: 'Earn energy while offline',
                effect: '+10% offline production per level',
                baseCost: 8,
                costMultiplier: 2.5,
                currentLevel: 0,
                maxLevel: 10,
                apply: (game) => {
                    game.offlineProductionRate += 0.1;
                }
            },
            {
                id: 'crit_start',
                name: 'Lucky Charm',
                icon: '',
                description: 'Start with increased crit chance',
                effect: '+5% crit chance per level',
                baseCost: 6,
                costMultiplier: 2.5,
                currentLevel: 0,
                maxLevel: 5,
                apply: (game) => {
                    game.startingCritChance += 0.05;
                }
            },
            {
                id: 'powerup_discount',
                name: 'Power Efficiency',
                icon: '',
                description: 'Reduce power-up costs',
                effect: '-10% power-up cost per level',
                baseCost: 7,
                costMultiplier: 2,
                currentLevel: 0,
                maxLevel: 5,
                apply: (game) => {
                    game.powerupCostReduction += 0.1;
                }
            },
            {
                id: 'event_frequency',
                name: 'Event Magnet',
                icon: '',
                description: 'Increase special event frequency',
                effect: '+25% event spawn rate per level',
                baseCost: 5,
                costMultiplier: 2.5,
                currentLevel: 0,
                maxLevel: 8,
                apply: (game) => {
                    game.eventSpawnBonus += 0.25;
                }
            },
            {
                id: 'combo_keeper',
                name: 'Combo Preservation',
                icon: '',
                description: 'Combo window lasts longer',
                effect: '+1s combo window per level',
                baseCost: 4,
                costMultiplier: 2,
                currentLevel: 0,
                maxLevel: 10,
                apply: (game) => {
                    game.comboWindowBonus += 1000;
                }
            }
        ];
    }

    calculatePrestigePoints(totalEnergy) {
        // Formula: sqrt(totalEnergy / 1000)
        if (totalEnergy < 1000) return 0;
        return Math.floor(Math.sqrt(totalEnergy / 1000));
    }

    calculatePrestigeMultiplier(prestigePoints) {
        // 1% bonus per prestige point
        return 1 + (prestigePoints * 0.01);
    }

    canPrestige(game) {
        return this.calculatePrestigePoints(game.stats.totalEnergy) > 0;
    }

    getPrestigeGain(game) {
        const baseGain = this.calculatePrestigePoints(game.stats.totalEnergy);
        const bonus = game.prestigePointsBonus || 0;
        return Math.floor(baseGain * (1 + bonus));
    }

    performPrestige(game) {
        if (!this.canPrestige(game)) return false;

        const pointsGained = this.getPrestigeGain(game);
        
        // Save prestige stats
        const oldPrestigeCount = game.prestigeCount;
        const oldPrestigePoints = game.prestigePoints;
        
        // Reset game but keep prestige data
        game.prestigePoints += pointsGained;
        
        // Roll for artifact drop
        artifactsManager.rollForArtifact(game);
        
        // Roll new mutations for this run
        mutationsManager.rollNewMutations(game);
        
        // Check if player can choose a new prestige path
        if (prestigePathsManager.canSwitchPath(game)) {
            setTimeout(() => {
                notifications.info(' New Path Available!', 'You can now choose or change your prestige path!', 8000);
                // Switch to prestige tab to show paths
                document.querySelector('[data-tab="prestige"]')?.click();
            }, 2000);
        }
        
        game.prestigeCount++;
        
        // Calculate new prestige multiplier
        game.prestigeMultiplier = this.calculatePrestigeMultiplier(game.prestigePoints);
        
        // Roll for artifact drop
        if (typeof artifactsManager !== 'undefined') {
            artifactsManager.rollForArtifact(game);
        }
        
        // Roll new mutations
        if (typeof mutationsManager !== 'undefined') {
            mutationsManager.rollNewMutations(game);
        }
        
        // Check if can choose/switch prestige path
        if (typeof prestigePathsManager !== 'undefined') {
            if (game.prestigeCount === 1 || prestigePathsManager.canSwitchPath(game)) {
                // Show path selection UI
                if (typeof showPrestigePathSelection === 'function') {
                    showPrestigePathSelection();
                }
            }
        }
        
        // Reset all non-prestige systems
        game.energy = game.startingEnergy || 0;
        game.clickPower = 1;
        game.globalMultiplier = 1 + (game.startingMultiplier || 0);
        game.comboCount = 0;
        game.comboWindow = 2000 + (game.comboWindowBonus || 0);
        game.comboBonus = 0;
        game.comboStartBonus = 0;
        game.comboSaveChance = 0;
        game.critChance = game.startingCritChance || 0;
        game.critMultiplier = 2;
        game.critChainChance = 0;
        game.autoClickersPerSecond = 0;
        game.level = 1;
        game.experience = 0;
        game.goldenClicksRemaining = 0;
        game.goldenClickChance = 0;
        game.megaBoostChance = 0;
        
        // Reset modifiers (keep persistent ones)
        game.clickPowerMultiplier = 1;
        game.productionMultiplier = 1;
        game.eventProductionBonus = 1;
        game.autoClickerMultiplier = 1;
        game.freeUpgrades = false;
        game.guaranteedCrit = false;
        game.comboFrozen = false;
        
        // Reset synergies
        if (typeof synergiesManager !== 'undefined') {
            synergiesManager.reset();
        }
        game.synergyClickPowerMult = 1;
        game.synergySolarQuantum = 0;
        game.synergyFusionAntimatter = 0;
        game.synergyDarkTime = 0;
        game.synergyRealityDimension = 0;
        game.synergyPrecisionStrikes = false;
        game.synergyUltimate = 0;
        game.synergyAscended = 0;
        
        // Reset artifact bonuses (will be reapplied from equipped artifacts)
        game.artifactGeneratorBonus = 0;
        game.artifactProductionMult = 1;
        game.artifactGeneratorMult = 1;
        // Don't reset artifactUniversalMult - it's from equipped artifacts
        
        // Reset stats (keep prestige-related ones)
        game.stats.totalClicks = 0;
        game.stats.totalEnergy = 0;
        game.stats.highestCombo = 0;
        game.stats.criticalClicks = 0;
        
        // Reset managers
        upgradesManager.reset();
        generatorsManager.reset();
        if (typeof achievementsManager !== 'undefined') {
            achievementsManager.reset(true); // Keep prestige achievements
        }
        if (typeof powerupsManager !== 'undefined') {
            powerupsManager.reset();
        }
        if (typeof milestonesManager !== 'undefined') {
            milestonesManager.reset();
        }
        
        // Show notification
        notifications.success(
            ' ASCENSION COMPLETE!',
            `+${pointsGained} Prestige Points! Total: ${game.prestigePoints}`,
            5000
        );
        
        // Create massive celebration
        const prestigeBtn = document.getElementById('prestige-btn');
        if (prestigeBtn) {
            particleSystem.createCelebration(prestigeBtn);
        }
        
        return true;
    }

    getCost(upgrade) {
        return Math.floor(upgrade.baseCost * Math.pow(upgrade.costMultiplier, upgrade.currentLevel));
    }

    canAfford(upgrade, prestigePoints) {
        return prestigePoints >= this.getCost(upgrade);
    }

    isMaxed(upgrade) {
        return upgrade.currentLevel >= upgrade.maxLevel;
    }

    purchase(upgrade, game) {
        if (this.isMaxed(upgrade)) return false;
        if (!this.canAfford(upgrade, game.prestigePoints)) return false;

        const cost = this.getCost(upgrade);
        game.prestigePoints -= cost;
        upgrade.currentLevel++;
        upgrade.apply(game);

        // Create burst effect
        const upgradeCard = document.querySelector(`[data-prestige-upgrade-id="${upgrade.id}"]`);
        if (upgradeCard) {
            const rect = upgradeCard.getBoundingClientRect();
            particleSystem.createBurst(
                rect.left + rect.width / 2,
                rect.top + rect.height / 2,
                20,
                '#ff00ff'
            );
        }

        notifications.success(
            ' Prestige Upgrade!',
            `${upgrade.name} Level ${upgrade.currentLevel}`
        );

        return true;
    }

    getSaveData() {
        const data = {};
        this.prestigeUpgrades.forEach(upgrade => {
            data[upgrade.id] = upgrade.currentLevel;
        });
        return data;
    }

    loadSaveData(data) {
        if (!data) return;
        Object.keys(data).forEach(id => {
            const upgrade = this.prestigeUpgrades.find(u => u.id === id);
            if (upgrade) {
                upgrade.currentLevel = data[id];
            }
        });
    }
}

const prestigeManager = new PrestigeManager();


// ===== POWERUPS =====
// Power-ups System

class PowerupsManager {
    constructor() {
        this.powerups = [
            {
                id: 'double_click',
                name: 'Double Power',
                icon: '2',
                description: 'Double your click power',
                duration: 30,
                cooldown: 60,
                cost: 100,
                active: false,
                remaining: 0,
                cooldownRemaining: 0,
                activate: (game) => {
                    game.clickPowerMultiplier = (game.clickPowerMultiplier || 1) * 2;
                },
                deactivate: (game) => {
                    game.clickPowerMultiplier = (game.clickPowerMultiplier || 2) / 2;
                }
            },
            {
                id: 'triple_production',
                name: 'Production Surge',
                icon: '3',
                description: 'Triple all energy production',
                duration: 45,
                cooldown: 90,
                cost: 250,
                active: false,
                remaining: 0,
                cooldownRemaining: 0,
                activate: (game) => {
                    game.productionMultiplier = (game.productionMultiplier || 1) * 3;
                },
                deactivate: (game) => {
                    game.productionMultiplier = (game.productionMultiplier || 3) / 3;
                }
            },
            {
                id: 'combo_freeze',
                name: 'Frozen Time',
                icon: '',
                description: 'Combo never expires',
                duration: 60,
                cooldown: 120,
                cost: 500,
                active: false,
                remaining: 0,
                cooldownRemaining: 0,
                activate: (game) => {
                    game.comboFrozen = true;
                },
                deactivate: (game) => {
                    game.comboFrozen = false;
                }
            },
            {
                id: 'guaranteed_crit',
                name: 'Critical Strike',
                icon: '',
                description: '100% critical hit chance',
                duration: 20,
                cooldown: 120,
                cost: 300,
                active: false,
                remaining: 0,
                cooldownRemaining: 0,
                activate: (game) => {
                    game.guaranteedCrit = true;
                },
                deactivate: (game) => {
                    game.guaranteedCrit = false;
                }
            },
            {
                id: 'mega_multiplier',
                name: 'Mega Boost',
                icon: '',
                description: '10x global multiplier',
                duration: 15,
                cooldown: 180,
                cost: 1000,
                active: false,
                remaining: 0,
                cooldownRemaining: 0,
                activate: (game) => {
                    game.globalMultiplier *= 10;
                },
                deactivate: (game) => {
                    game.globalMultiplier /= 10;
                }
            },
            {
                id: 'golden_touch',
                name: 'Golden Touch',
                icon: '',
                description: 'Gain 5x energy from all sources',
                duration: 30,
                cooldown: 150,
                cost: 750,
                active: false,
                remaining: 0,
                cooldownRemaining: 0,
                activate: (game) => {
                    game.energyGainMultiplier = (game.energyGainMultiplier || 1) * 5;
                },
                deactivate: (game) => {
                    game.energyGainMultiplier = (game.energyGainMultiplier || 5) / 5;
                }
            },
            {
                id: 'auto_clicker_boost',
                name: 'Turbo Clicker',
                icon: '',
                description: 'Auto-clickers work 10x faster',
                duration: 40,
                cooldown: 100,
                cost: 600,
                active: false,
                remaining: 0,
                cooldownRemaining: 0,
                activate: (game) => {
                    game.autoClickerMultiplier = (game.autoClickerMultiplier || 1) * 10;
                },
                deactivate: (game) => {
                    game.autoClickerMultiplier = (game.autoClickerMultiplier || 10) / 10;
                }
            },
            {
                id: 'discount',
                name: 'Sale Event',
                icon: '',
                description: 'All purchases cost 50% less',
                duration: 60,
                cooldown: 180,
                cost: 500,
                active: false,
                remaining: 0,
                cooldownRemaining: 0,
                activate: (game) => {
                    game.costReduction = 0.5;
                },
                deactivate: (game) => {
                    game.costReduction = 0;
                }
            }
        ];
    }

    getCost(powerup, game) {
        const reduction = game.powerupCostReduction || 0;
        return Math.floor(powerup.cost * (1 - reduction));
    }

    getDuration(powerup, game) {
        const bonus = game.powerupDurationBonus || 0;
        return Math.floor(powerup.duration * (1 + bonus));
    }

    canUse(powerup, game) {
        return !powerup.active && 
               powerup.cooldownRemaining === 0 && 
               game.energy >= this.getCost(powerup, game);
    }

    activate(powerup, game) {
        if (!this.canUse(powerup, game)) return false;

        const cost = this.getCost(powerup, game);
        game.energy -= cost;

        powerup.active = true;
        powerup.remaining = this.getDuration(powerup, game);
        powerup.activate(game);

        game.stats.powerupsUsed = (game.stats.powerupsUsed || 0) + 1;

        // Create burst effect
        const powerupCard = document.querySelector(`[data-powerup-id="${powerup.id}"]`);
        if (powerupCard) {
            const rect = powerupCard.getBoundingClientRect();
            particleSystem.createBurst(
                rect.left + rect.width / 2,
                rect.top + rect.height / 2,
                25,
                '#ffff00'
            );
        }

        notifications.success(
            ' Power-up Activated!',
            `${powerup.name} for ${powerup.remaining}s`
        );

        return true;
    }

    update(deltaTime, game) {
        this.powerups.forEach(powerup => {
            if (powerup.active) {
                powerup.remaining -= deltaTime;
                if (powerup.remaining <= 0) {
                    powerup.active = false;
                    powerup.remaining = 0;
                    powerup.cooldownRemaining = powerup.cooldown;
                    powerup.deactivate(game);
                    
                    notifications.info(
                        ' Power-up Expired',
                        `${powerup.name} has worn off`
                    );
                }
            } else if (powerup.cooldownRemaining > 0) {
                powerup.cooldownRemaining -= deltaTime;
                if (powerup.cooldownRemaining < 0) {
                    powerup.cooldownRemaining = 0;
                }
            }
        });
    }

    getActivePowerups() {
        return this.powerups.filter(p => p.active);
    }

    reset() {
        this.powerups.forEach(powerup => {
            if (powerup.active) {
                powerup.deactivate({ 
                    clickPowerMultiplier: 1,
                    productionMultiplier: 1,
                    globalMultiplier: 1,
                    energyGainMultiplier: 1,
                    autoClickerMultiplier: 1
                });
            }
            powerup.active = false;
            powerup.remaining = 0;
            powerup.cooldownRemaining = 0;
        });
    }

    getSaveData() {
        const data = {};
        this.powerups.forEach(powerup => {
            data[powerup.id] = {
                active: powerup.active,
                remaining: powerup.remaining,
                cooldownRemaining: powerup.cooldownRemaining
            };
        });
        return data;
    }

    loadSaveData(data) {
        if (!data) return;
        Object.keys(data).forEach(id => {
            const powerup = this.powerups.find(p => p.id === id);
            if (powerup && data[id]) {
                powerup.active = data[id].active || false;
                powerup.remaining = data[id].remaining || 0;
                powerup.cooldownRemaining = data[id].cooldownRemaining || 0;
            }
        });
    }
}

const powerupsManager = new PowerupsManager();


// ===== EVENTS =====
// Special Events System

class EventsManager {
    constructor() {
        this.eventTypes = [
            {
                id: 'bonus_energy',
                title: 'ENERGY SURGE',
                icon: '',
                description: 'A surge of energy flows through the nexus!',
                duration: 30,
                reward: (game) => {
                    const bonus = Math.floor(game.energy * 0.5);
                    game.energy += bonus;
                    return `+${this.formatNumber(bonus)} Energy!`;
                }
            },
            {
                id: 'double_production',
                title: 'PRODUCTION BOOST',
                icon: '',
                description: 'All generators are working overtime!',
                duration: 60,
                reward: (game) => {
                    game.eventProductionBonus = 2;
                    setTimeout(() => {
                        game.eventProductionBonus = 1;
                    }, 60000);
                    return 'Double production for 60s!';
                }
            },
            {
                id: 'free_upgrades',
                title: 'TECH BREAKTHROUGH',
                icon: '',
                description: 'Upgrades are temporarily free!',
                duration: 45,
                reward: (game) => {
                    game.freeUpgrades = true;
                    setTimeout(() => {
                        game.freeUpgrades = false;
                    }, 45000);
                    return 'Free upgrades for 45s!';
                }
            },
            {
                id: 'mega_combo',
                title: 'COMBO FRENZY',
                icon: '',
                description: 'Combo power is supercharged!',
                duration: 40,
                reward: (game) => {
                    const oldBonus = game.comboBonus;
                    game.comboBonus *= 3;
                    setTimeout(() => {
                        game.comboBonus = oldBonus;
                    }, 40000);
                    return '3x combo bonus for 40s!';
                }
            },
            {
                id: 'crit_spree',
                title: 'LUCKY MOMENT',
                icon: '',
                description: 'Lady luck smiles upon you!',
                duration: 30,
                reward: (game) => {
                    const oldCrit = game.critChance;
                    game.critChance = Math.min(1, game.critChance + 0.5);
                    setTimeout(() => {
                        game.critChance = oldCrit;
                    }, 30000);
                    return '+50% crit chance for 30s!';
                }
            },
            {
                id: 'prestige_boost',
                title: 'COSMIC ALIGNMENT',
                icon: '',
                description: 'The stars align in your favor!',
                duration: 20,
                reward: (game) => {
                    const points = Math.floor(game.prestigePoints * 0.1) + 1;
                    game.prestigePoints += points;
                    return `+${points} Prestige Points!`;
                }
            },
            {
                id: 'instant_levels',
                title: 'EXPERIENCE RUSH',
                icon: '',
                description: 'Massive experience gain incoming!',
                duration: 15,
                reward: (game) => {
                    const levels = Math.floor(Math.random() * 3) + 1;
                    game.level += levels;
                    return `+${levels} Levels!`;
                }
            },
            {
                id: 'golden_click',
                title: 'GOLDEN OPPORTUNITY',
                icon: '',
                description: 'Next 10 clicks give massive rewards!',
                duration: 20,
                reward: (game) => {
                    game.goldenClicksRemaining = 10;
                    return 'Next 10 clicks = 100x reward!';
                }
            },
            {
                id: 'achievement_hunter',
                title: 'ACHIEVEMENT BONUS',
                icon: '',
                description: 'Achievement rewards doubled temporarily!',
                duration: 120,
                reward: (game) => {
                    // Check and potentially unlock random achievement progress
                    return 'Achievement rewards doubled!';
                }
            },
            {
                id: 'mystery_box',
                title: 'MYSTERY REWARD',
                icon: '',
                description: 'A mystery box appears...',
                duration: 25,
                reward: (game) => {
                    const rewards = [
                        () => { 
                            const bonus = Math.floor(game.energy * 0.75); 
                            game.energy += bonus; 
                            return `+${this.formatNumber(bonus)} Energy!`;
                        },
                        () => { 
                            game.clickPower *= 2; 
                            setTimeout(() => game.clickPower /= 2, 60000); 
                            return 'Double click power for 60s!';
                        },
                        () => { 
                            const pp = Math.floor(Math.random() * 5) + 1; 
                            game.prestigePoints += pp; 
                            return `+${pp} Prestige Points!`;
                        },
                        () => { 
                            game.level += 2; 
                            return '+2 Levels!';
                        },
                        () => { 
                            game.globalMultiplier *= 1.5; 
                            return '+50% global multiplier (permanent)!';
                        }
                    ];
                    const reward = rewards[Math.floor(Math.random() * rewards.length)];
                    return reward();
                }
            }
        ];
        
        this.currentEvent = null;
        this.eventTimer = 0;
        this.nextEventTime = this.getNextEventTime();
    }

    getNextEventTime() {
        // Random time between 2-5 minutes
        return (120 + Math.random() * 180) * 1000;
    }

    update(deltaTime, game) {
        if (this.currentEvent) {
            this.eventTimer -= deltaTime * 1000;
            if (this.eventTimer <= 0) {
                this.expireEvent();
            }
        } else {
            this.nextEventTime -= deltaTime * 1000;
            if (this.nextEventTime <= 0) {
                this.spawnEvent(game);
            }
        }
    }

    spawnEvent(game) {
        const eventType = this.eventTypes[Math.floor(Math.random() * this.eventTypes.length)];
        
        // Apply event spawn bonus
        const spawnBonus = game.eventSpawnBonus || 0;
        const duration = eventType.duration * (1 + spawnBonus);
        
        this.currentEvent = {
            ...eventType,
            duration: duration,
            game: game
        };
        this.eventTimer = duration * 1000;
        
        notifications.warning(
            ' Special Event!',
            eventType.title,
            4000
        );
    }

    claimEvent() {
        if (!this.currentEvent) return;
        
        const result = this.currentEvent.reward(this.currentEvent.game);
        
        notifications.success(
            ' Event Claimed!',
            result,
            4000
        );
        
        this.currentEvent.game.stats.eventsCompleted = (this.currentEvent.game.stats.eventsCompleted || 0) + 1;
        
        this.currentEvent = null;
        this.nextEventTime = this.getNextEventTime();
    }

    expireEvent() {
        if (!this.currentEvent) return;
        
        notifications.warning(
            ' Event Expired',
            `${this.currentEvent.title} has ended`
        );
        
        this.currentEvent = null;
        this.nextEventTime = this.getNextEventTime();
    }

    formatNumber(num) {
        if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
        if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
        if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
        return Math.floor(num).toString();
    }

    reset() {
        this.currentEvent = null;
        this.eventTimer = 0;
        this.nextEventTime = this.getNextEventTime();
    }

    getSaveData() {
        return {
            currentEvent: this.currentEvent ? {
                id: this.currentEvent.id,
                timer: this.eventTimer
            } : null,
            nextEventTime: this.nextEventTime
        };
    }

    loadSaveData(data, game) {
        if (!data) return;
        
        if (data.currentEvent) {
            const eventType = this.eventTypes.find(e => e.id === data.currentEvent.id);
            if (eventType) {
                this.currentEvent = { ...eventType, game: game };
                this.eventTimer = data.currentEvent.timer || 0;
            }
        }
        
        this.nextEventTime = data.nextEventTime || this.getNextEventTime();
    }
}

const eventsManager = new EventsManager();


// ===== MILESTONES =====
// Milestones System

class MilestonesManager {
    constructor() {
        this.milestones = [
            {
                id: 'energy_1000',
                name: 'Energy Milestone I',
                icon: '',
                goal: 1000,
                type: 'totalEnergy',
                reward: 'Global mult +10%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 0.1;
                }
            },
            {
                id: 'energy_10000',
                name: 'Energy Milestone II',
                icon: '',
                goal: 10000,
                type: 'totalEnergy',
                reward: 'Global mult +25%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 0.25;
                }
            },
            {
                id: 'energy_100000',
                name: 'Energy Milestone III',
                icon: '',
                goal: 100000,
                type: 'totalEnergy',
                reward: 'Global mult +50%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 0.5;
                }
            },
            {
                id: 'energy_1000000',
                name: 'Energy Milestone IV',
                icon: '',
                goal: 1000000,
                type: 'totalEnergy',
                reward: 'Global mult +100%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 1;
                }
            },
            {
                id: 'clicks_500',
                name: 'Click Milestone I',
                icon: '',
                goal: 500,
                type: 'totalClicks',
                reward: 'Click power +10',
                unlocked: false,
                apply: (game) => {
                    game.clickPower += 10;
                }
            },
            {
                id: 'clicks_5000',
                name: 'Click Milestone II',
                icon: '',
                goal: 5000,
                type: 'totalClicks',
                reward: 'Click power +50',
                unlocked: false,
                apply: (game) => {
                    game.clickPower += 50;
                }
            },
            {
                id: 'clicks_50000',
                name: 'Click Milestone III',
                icon: '',
                goal: 50000,
                type: 'totalClicks',
                reward: 'Click power +250',
                unlocked: false,
                apply: (game) => {
                    game.clickPower += 250;
                }
            },
            {
                id: 'level_10',
                name: 'Level Up!',
                icon: '',
                goal: 10,
                type: 'level',
                reward: 'Unlock special feature',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 0.2;
                }
            },
            {
                id: 'level_25',
                name: 'Quarter Century',
                icon: '',
                goal: 25,
                type: 'level',
                reward: 'Global mult +50%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 0.5;
                }
            },
            {
                id: 'level_50',
                name: 'Half Century',
                icon: '',
                goal: 50,
                type: 'level',
                reward: 'Global mult +100%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 1;
                }
            },
            {
                id: 'level_100',
                name: 'Centurion',
                icon: '',
                goal: 100,
                type: 'level',
                reward: 'Global mult +200%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 2;
                }
            },
            {
                id: 'generators_50',
                name: 'Generator Array',
                icon: '',
                goal: 50,
                type: 'totalGenerators',
                reward: 'Generator output +50%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 0.5;
                }
            },
            {
                id: 'generators_200',
                name: 'Generator Complex',
                icon: '',
                goal: 200,
                type: 'totalGenerators',
                reward: 'Generator output +100%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 1;
                }
            },
            {
                id: 'combo_75',
                name: 'Combo Champion',
                icon: '',
                goal: 75,
                type: 'highestCombo',
                reward: 'Combo bonus +50%',
                unlocked: false,
                apply: (game) => {
                    game.comboBonus += 0.5;
                }
            },
            {
                id: 'combo_150',
                name: 'Combo Legend',
                icon: '',
                goal: 150,
                type: 'highestCombo',
                reward: 'Combo bonus +100%',
                unlocked: false,
                apply: (game) => {
                    game.comboBonus += 1;
                }
            }
        ];
    }

    check(game) {
        let newUnlocks = [];
        
        this.milestones.forEach(milestone => {
            if (!milestone.unlocked) {
                let current = 0;
                
                switch(milestone.type) {
                    case 'totalEnergy':
                        current = game.stats.totalEnergy;
                        break;
                    case 'totalClicks':
                        current = game.stats.totalClicks;
                        break;
                    case 'level':
                        current = game.level;
                        break;
                    case 'totalGenerators':
                        current = generatorsManager.generators.reduce((sum, g) => sum + g.count, 0);
                        break;
                    case 'highestCombo':
                        current = game.stats.highestCombo;
                        break;
                }
                
                if (current >= milestone.goal) {
                    milestone.unlocked = true;
                    milestone.apply(game);
                    newUnlocks.push(milestone);
                    
                    notifications.success(
                        ' Milestone Reached!',
                        `${milestone.name} - ${milestone.reward}`,
                        4000
                    );
                    
                    // Create celebration
                    const milestoneCard = document.querySelector(`[data-milestone-id="${milestone.id}"]`);
                    if (milestoneCard) {
                        particleSystem.createCelebration(milestoneCard);
                    }
                }
            }
        });
        
        return newUnlocks;
    }

    getProgress(milestone, game) {
        let current = 0;
        
        switch(milestone.type) {
            case 'totalEnergy':
                current = game.stats.totalEnergy;
                break;
            case 'totalClicks':
                current = game.stats.totalClicks;
                break;
            case 'level':
                current = game.level;
                break;
            case 'totalGenerators':
                current = generatorsManager.generators.reduce((sum, g) => sum + g.count, 0);
                break;
            case 'highestCombo':
                current = game.stats.highestCombo;
                break;
        }
        
        return Math.min(100, (current / milestone.goal) * 100);
    }

    reset() {
        this.milestones.forEach(milestone => {
            milestone.unlocked = false;
        });
    }

    getSaveData() {
        const data = {};
        this.milestones.forEach(milestone => {
            data[milestone.id] = milestone.unlocked;
        });
        return data;
    }

    loadSaveData(data) {
        if (!data) return;
        Object.keys(data).forEach(id => {
            const milestone = this.milestones.find(m => m.id === id);
            if (milestone) {
                milestone.unlocked = data[id];
            }
        });
    }
}

const milestonesManager = new MilestonesManager();


// ===== GAME =====
// Core Game Engine

class Game {
    constructor() {
        // Core resources
        this.energy = 0;
        this.clickPower = 1;
        this.globalMultiplier = 1;
        
        // Combo system
        this.comboCount = 0;
        this.comboWindow = 2000; // milliseconds
        this.comboTimeout = null;
        this.comboBonus = 0; // Additional combo bonus from upgrades
        this.comboFrozen = false; // From power-up
        this.comboWindowBonus = 0; // From prestige
        this.comboStartBonus = 0; // From upgrades
        this.comboSaveChance = 0; // From upgrades
        this.comboSpeedMult = 1; // From paths
        
        // Click modifiers
        this.clickPowerMultiplier = 1; // From power-ups
        this.critChance = 0;
        this.critMultiplier = 2;
        this.startingCritChance = 0;
        this.guaranteedCrit = false; // From power-up
        this.critChainChance = 0; // From upgrades
        
        // Production modifiers
        this.productionMultiplier = 1; // From power-ups
        this.energyGainMultiplier = 1; // From power-ups
        this.eventProductionBonus = 1; // From events
        
        // Auto-clickers
        this.autoClickersPerSecond = 0;
        this.autoClickerMultiplier = 1; // From power-ups
        this.autoClickersDisabled = false; // From paths
        this.autoClickersCombos = false; // From paths
        
        // Cost modifiers
        this.costReduction = 0; // From upgrades/power-ups
        this.powerupCostReduction = 0; // From prestige
        this.freeUpgrades = false; // From events
        this.generatorCostReduction = 0; // From paths
        
        // Prestige system
        this.prestigeCount = 0;
        this.prestigePoints = 0;
        this.prestigeMultiplier = 1;
        this.prestigeBonus = 0;
        this.prestigePointsBonus = 0;
        this.startingEnergy = 0;
        this.startingMultiplier = 0;
        
        // Level system
        this.level = 1;
        this.experience = 0;
        this.experienceToNextLevel = 100;
        this.expMultiplier = 1;
        this.levelCapRemoved = false;
        
        // Special mechanics
        this.goldenClicksRemaining = 0; // From events
        this.goldenClickChance = 0; // From upgrades
        this.autoBuyGenerators = false; // From prestige
        this.offlineProductionRate = 0; // From prestige
        this.powerupDurationBonus = 0; // From achievements
        this.eventSpawnBonus = 0; // From achievements/prestige
        this.powerupCooldownReduction = 0; // From paths
        
        // NEW SYSTEMS - Mutations
        this.mutationClickPowerMult = 1;
        this.mutationProductionMult = 1;
        this.mutationCostReduction = 0;
        this.mutationCostIncrease = 1;
        this.mutationChaosMode = false;
        
        // NEW SYSTEMS - Synergies
        this.synergyClickPowerMult = 1;
        this.synergySolarQuantum = 0;
        this.synergyFusionAntimatter = 0;
        this.synergyDarkTime = 0;
        this.synergyRealityDimension = 0;
        this.synergyPrecisionStrikes = false;
        this.synergyUltimate = 0;
        this.synergyAscended = 0;
        
        // NEW SYSTEMS - Prestige Paths
        this.pathProductionMult = 1;
        this.pathClickPowerMult = 1;
        this.pathClickPowerPenalty = 1;
        this.pathClickEnergyPenalty = 1;
        this.pathProductionPenalty = 1;
        this.pathManualClickPenalty = 1;
        this.pathGeneratorCostIncrease = 1;
        this.pathCostIncrease = 1;
        this.pathUniversalMult = 1;
        this.pathPrestigeLevel = 0;
        this.pathSwitchingUnlocked = false;
        this.hybridBuildsUnlocked = false;
        this.chaosMode = false;
        this.chaosLegendaryChance = 0;
        this.chaosUpgradesUnlocked = false;
        this.advancedAutomation = false;
        this.transcendenceUnlocked = false;
        
        // NEW SYSTEMS - Artifacts
        this.artifactGeneratorBonus = 0;
        this.artifactProductionMult = 1;
        this.artifactGeneratorMult = 1;
        this.artifactUniversalMult = 1;
        this.artifactDropBonus = 0;
        
        // Game speed
        this.gameSpeed = 1;
        
        // Special upgrades
        this.bulkBuyUnlocked = false;
        this.megaBoostChance = 0;
        
        // Statistics
        this.stats = {
            totalClicks: 0,
            totalEnergy: 0,
            playTime: 0,
            highestCombo: 0,
            criticalClicks: 0,
            powerupsUsed: 0,
            eventsCompleted: 0
        };
        
        // Game state
        this.lastUpdate = Date.now();
        this.lastSave = Date.now();
        this.autoSaveInterval = 30000; // 30 seconds
        
        // Initialize
        this.init();
    }
    
    init() {
        // Load saved game if exists
        this.loadGame();
        
        // Start game loop
        this.gameLoop();
        
        // Auto-save
        setInterval(() => this.saveGame(), this.autoSaveInterval);
    }
    
    gameLoop() {
        const now = Date.now();
        const deltaTime = (now - this.lastUpdate) / 1000; // seconds
        this.lastUpdate = now;
        
        // Update game logic
        this.update(deltaTime);
        
        // Continue loop
        requestAnimationFrame(() => this.gameLoop());
    }
    
    update(deltaTime) {
        // Apply game speed modifier
        deltaTime *= this.gameSpeed;
        
        // Update play time
        this.stats.playTime += deltaTime;
        
        // Generate passive income
        this.generatePassiveIncome(deltaTime);
        
        // Auto-clickers
        this.processAutoClickers(deltaTime);
        
        // Update power-ups
        if (typeof powerupsManager !== 'undefined') {
            powerupsManager.update(deltaTime, this);
        
        
        // Load new expansion managers
        if (saved.mutations) {
            mutationsManager.loadSaveData(saved.mutations, this);
        }
        if (saved.synergies) {
            synergiesManager.loadSaveData(saved.synergies, this);
        }
        if (saved.prestigePaths) {
            prestigePathsManager.loadSaveData(saved.prestigePaths, this);
        }
        if (saved.artifacts) {
            artifactsManager.loadSaveData(saved.artifacts, this);
        }
        
        }
        
        // Update events
        if (typeof eventsManager !== 'undefined') {
            eventsManager.update(deltaTime, this);
        }
        
        // Check achievements
        if (typeof achievementsManager !== 'undefined') {
            achievementsManager.check(this);
        }
        
        // Check milestones
        if (typeof milestonesManager !== 'undefined') {
            milestonesManager.check(this);
        }
        
        // Check synergies
        if (typeof synergiesManager !== 'undefined') {
            synergiesManager.checkSynergies(this);
        }
        
        // Update level
        this.updateLevel();
        
        // Update UI
        if (typeof updateUI === 'function') {
            updateUI(this);
        }
    }
    
    generatePassiveIncome(deltaTime) {
        const production = generatorsManager.getTotalProduction(this);
        const modifiedProduction = production * 
            this.productionMultiplier * 
            this.eventProductionBonus *
            this.energyGainMultiplier;
        
        const energyGained = modifiedProduction * deltaTime;
        this.addEnergy(energyGained);
    }
    
    processAutoClickers(deltaTime) {
        if (this.autoClickersDisabled) return;
        
        if (this.autoClickersPerSecond > 0) {
            const clicks = this.autoClickersPerSecond * this.autoClickerMultiplier * deltaTime;
            const wholeClicks = Math.floor(clicks);
            
            for (let i = 0; i < wholeClicks; i++) {
                this.click(null, null, true); // Silent auto-clicks
            }
        }
    }
    
    click(x = null, y = null, isAuto = false) {
        // Calculate click value
        let clickValue = this.clickPower * this.clickPowerMultiplier;
        
        // Apply mutation modifiers
        clickValue *= this.mutationClickPowerMult;
        
        // Apply synergy modifiers
        clickValue *= this.synergyClickPowerMult;
        
        // Apply path modifiers
        clickValue *= this.pathClickPowerMult;
        if (!isAuto) {
            clickValue *= this.pathManualClickPenalty;
        }
        clickValue *= this.pathClickPowerPenalty;
        
        // Apply artifact modifiers
        clickValue *= this.artifactUniversalMult;
        clickValue *= this.pathUniversalMult;
        
        // Check for golden click
        if (this.goldenClickChance > 0 && Math.random() < this.goldenClickChance) {
            this.goldenClicksRemaining++;
        }
        
        // Check for critical hit
        let critChance = this.critChance;
        
        // Precision Strikes synergy - guaranteed crits at high combos
        if (this.synergyPrecisionStrikes && this.comboCount > 50) {
            critChance = 1.0;
        }
        
        const isCrit = this.guaranteedCrit || Math.random() < critChance;
        if (isCrit) {
            clickValue *= this.critMultiplier;
            this.stats.criticalClicks++;
            
            // Check for crit chain
            if (this.critChainChance > 0 && Math.random() < this.critChainChance) {
                clickValue *= this.critMultiplier; // Double crit!
                if (!isAuto && x && y) {
                    particleSystem.createTextParticle(x, y, 'DOUBLE CRIT!', '#ff00ff');
                }
            }
            
            if (!isAuto && x && y) {
                // Visual feedback for crit
                particleSystem.createTextParticle(x, y, 'CRIT!', '#ff00ff');
            }
        }
        
        // Golden click bonus
        if (this.goldenClicksRemaining > 0) {
            clickValue *= 100;
            this.goldenClicksRemaining--;
            
            if (!isAuto && x && y) {
                particleSystem.createTextParticle(x, y, 'GOLDEN!', '#ffd700');
            }
        }
        
        // Check for mega boost
        if (this.megaBoostChance > 0 && Math.random() < this.megaBoostChance) {
            clickValue *= 1000;
            if (!isAuto && x && y) {
                particleSystem.createTextParticle(x, y, 'MEGA BOOST!', '#ffaa00');
            }
        }
        
        // Apply combo
        if (!this.comboFrozen) {
            // Check for combo save
            if (this.comboCount > 0 && this.comboSaveChance > 0 && Math.random() < this.comboSaveChance) {
                // Combo saved!
            } else {
                this.comboCount++;
                if (this.comboStartBonus > 0 && this.comboCount === 1) {
                    this.comboCount += this.comboStartBonus;
                }
            }
            this.resetComboTimer();
        } else {
            this.comboCount++;
        }
        
        if (this.comboCount > this.stats.highestCombo) {
            this.stats.highestCombo = this.comboCount;
        }
        
        const comboMultiplier = 1 + (this.comboCount * 0.01 * this.comboSpeedMult) + this.comboBonus;
        clickValue *= comboMultiplier;
        
        // Apply global multiplier
        clickValue *= this.globalMultiplier;
        
        // Apply prestige multiplier
        clickValue *= this.prestigeMultiplier;
        
        // Apply energy gain multiplier
        clickValue *= this.energyGainMultiplier;
        
        // Apply path click energy penalty
        if (!isAuto) {
            clickValue *= this.pathClickEnergyPenalty;
        }
        
        // Apply synergy ultimate
        if (this.synergyUltimate > 0) {
            clickValue *= this.synergyUltimate;
        }
        
        // Apply synergy ascended
        if (this.synergyAscended > 0) {
            clickValue *= this.synergyAscended;
        }
        
        // Add energy
        this.addEnergy(clickValue);
        
        // Update stats
        this.stats.totalClicks++;
        
        // Add experience
        const expGain = 1 * this.expMultiplier;
        this.addExperience(expGain);
        
        // Visual feedback
        if (!isAuto && x && y) {
            particleSystem.createTextParticle(
                x, 
                y, 
                '+' + this.formatNumber(clickValue),
                isCrit ? '#ff00ff' : '#00ffff'
            );
            particleSystem.createRipple(x, y);
        }
    }
    
    resetComboTimer() {
        if (this.comboTimeout) {
            clearTimeout(this.comboTimeout);
        }
        
        if (!this.comboFrozen) {
            const window = this.comboWindow + this.comboWindowBonus;
            this.comboTimeout = setTimeout(() => {
                this.comboCount = 0;
            }, window);
        }
    }
    
    addEnergy(amount) {
        this.energy += amount;
        this.stats.totalEnergy += amount;
        
        // Auto-buy generators if unlocked
        if (this.autoBuyGenerators) {
            this.autoBuyGeneratorsFunction();
        }
    }
    
    autoBuyGeneratorsFunction() {
        generatorsManager.generators.forEach(generator => {
            if (generatorsManager.canAfford(generator, this.energy) &&
                generatorsManager.isUnlocked(generator, this.stats.totalEnergy)) {
                generatorsManager.purchase(generator, this);
            }
        });
    }
    
    addExperience(amount) {
        this.experience += amount;
        
        while (this.experience >= this.experienceToNextLevel) {
            this.levelUp();
        }
    }
    
    levelUp() {
        this.experience -= this.experienceToNextLevel;
        this.level++;
        this.experienceToNextLevel = Math.floor(100 * Math.pow(1.1, this.level - 1));
        
        // Level up rewards
        this.clickPower += this.level;
        this.globalMultiplier += 0.01;
        
        notifications.success(
            '\u2b50 LEVEL UP!',
            `Level ${this.level} - Click power +${this.level}!`
        );
        
        // Celebration effect
        const levelDisplay = document.getElementById('player-level');
        if (levelDisplay) {
            particleSystem.createCelebration(levelDisplay);
        }
    }
    
    updateLevel() {
        // Levels are updated through experience gain
    }
    
    formatNumber(num) {
        if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
        if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
        if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
        if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
        return Math.floor(num).toString();
    }
    
    formatTime(seconds) {
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = Math.floor(seconds % 60);
        
        if (hours > 0) {
            return `${hours}h ${minutes}m`;
        } else if (minutes > 0) {
            return `${minutes}m ${secs}s`;
        } else {
            return `${secs}s`;
        }
    }
    
    saveGame() {
        const saveData = {
            version: '1.0',
            timestamp: Date.now(),
            game: {
                energy: this.energy,
                clickPower: this.clickPower,
                globalMultiplier: this.globalMultiplier,
                comboCount: this.comboCount,
                comboBonus: this.comboBonus,
                comboWindowBonus: this.comboWindowBonus,
                critChance: this.critChance,
                critMultiplier: this.critMultiplier,
                startingCritChance: this.startingCritChance,
                autoClickersPerSecond: this.autoClickersPerSecond,
                prestigeCount: this.prestigeCount,
                prestigePoints: this.prestigePoints,
                prestigeMultiplier: this.prestigeMultiplier,
                prestigeBonus: this.prestigeBonus,
                prestigePointsBonus: this.prestigePointsBonus,
                startingEnergy: this.startingEnergy,
                startingMultiplier: this.startingMultiplier,
                level: this.level,
                experience: this.experience,
                experienceToNextLevel: this.experienceToNextLevel,
                autoBuyGenerators: this.autoBuyGenerators,
                offlineProductionRate: this.offlineProductionRate,
                powerupDurationBonus: this.powerupDurationBonus,
                eventSpawnBonus: this.eventSpawnBonus,
                powerupCostReduction: this.powerupCostReduction,
                stats: this.stats
            },
            upgrades: upgradesManager.getSaveData(),
            generators: generatorsManager.getSaveData(),
            achievements: achievementsManager.getSaveData(),
            prestige: prestigeManager.getSaveData(),
            powerups: powerupsManager.getSaveData(),
            events: eventsManager.getSaveData(),
            milestones: milestonesManager.getSaveData(),
            mutations: typeof mutationsManager !== 'undefined' ? mutationsManager.getSaveData() : null,
            synergies: typeof synergiesManager !== 'undefined' ? synergiesManager.getSaveData() : null,
            prestigePaths: typeof prestigePathsManager !== 'undefined' ? prestigePathsManager.getSaveData() : null,
            artifacts: typeof artifactsManager !== 'undefined' ? artifactsManager.getSaveData() : null
        };
        
        localStorage.setItem('neonNexusSave', JSON.stringify(saveData));
        this.lastSave = Date.now();
        
        return saveData;
    }
    
    loadGame() {
        const saveDataStr = localStorage.getItem('neonNexusSave');
        if (!saveDataStr) return false;
        
        try {
            const saveData = JSON.parse(saveDataStr);
            
            // Load game state
            const game = saveData.game;
            this.energy = game.energy || 0;
            this.clickPower = game.clickPower || 1;
            this.globalMultiplier = game.globalMultiplier || 1;
            this.comboCount = game.comboCount || 0;
            this.comboBonus = game.comboBonus || 0;
            this.comboWindowBonus = game.comboWindowBonus || 0;
            this.critChance = game.critChance || 0;
            this.critMultiplier = game.critMultiplier || 2;
            this.startingCritChance = game.startingCritChance || 0;
            this.autoClickersPerSecond = game.autoClickersPerSecond || 0;
            this.prestigeCount = game.prestigeCount || 0;
            this.prestigePoints = game.prestigePoints || 0;
            this.prestigeMultiplier = game.prestigeMultiplier || 1;
            this.prestigeBonus = game.prestigeBonus || 0;
            this.prestigePointsBonus = game.prestigePointsBonus || 0;
            this.startingEnergy = game.startingEnergy || 0;
            this.startingMultiplier = game.startingMultiplier || 0;
            this.level = game.level || 1;
            this.experience = game.experience || 0;
            this.experienceToNextLevel = game.experienceToNextLevel || 100;
            this.autoBuyGenerators = game.autoBuyGenerators || false;
            this.offlineProductionRate = game.offlineProductionRate || 0;
            this.powerupDurationBonus = game.powerupDurationBonus || 0;
            this.eventSpawnBonus = game.eventSpawnBonus || 0;
            this.powerupCostReduction = game.powerupCostReduction || 0;
            this.stats = game.stats || {
                totalClicks: 0,
                totalEnergy: 0,
                playTime: 0,
                highestCombo: 0,
                criticalClicks: 0,
                powerupsUsed: 0,
                eventsCompleted: 0
            };
            
            // Load managers
            upgradesManager.loadSaveData(saveData.upgrades);
            generatorsManager.loadSaveData(saveData.generators);
            achievementsManager.loadSaveData(saveData.achievements);
            prestigeManager.loadSaveData(saveData.prestige);
            powerupsManager.loadSaveData(saveData.powerups);
            eventsManager.loadSaveData(saveData.events, this);
            milestonesManager.loadSaveData(saveData.milestones);
            
            // Load new systems
            if (typeof mutationsManager !== 'undefined' && saveData.mutations) {
                mutationsManager.loadSaveData(saveData.mutations, this);
            }
            if (typeof synergiesManager !== 'undefined' && saveData.synergies) {
                synergiesManager.loadSaveData(saveData.synergies, this);
            }
            if (typeof prestigePathsManager !== 'undefined' && saveData.prestigePaths) {
                prestigePathsManager.loadSaveData(saveData.prestigePaths, this);
            }
            if (typeof artifactsManager !== 'undefined' && saveData.artifacts) {
                artifactsManager.loadSaveData(saveData.artifacts, this);
            }
            
            // Re-apply all upgrades
            upgradesManager.upgrades.forEach(upgrade => {
                for (let i = 0; i < upgrade.currentLevel; i++) {
                    upgrade.apply(this);
                }
            });
            
            // Re-apply all prestige upgrades
            prestigeManager.prestigeUpgrades.forEach(upgrade => {
                for (let i = 0; i < upgrade.currentLevel; i++) {
                    upgrade.apply(this);
                }
            });
            
            // Re-apply all achievements
            achievementsManager.achievements.forEach(achievement => {
                if (achievement.unlocked) {
                    achievement.apply(this);
                }
            });
            
            // Re-apply all milestones
            milestonesManager.milestones.forEach(milestone => {
                if (milestone.unlocked) {
                    milestone.apply(this);
                }
            });
            
            // Calculate offline progress
            if (saveData.timestamp && this.offlineProductionRate > 0) {
                const offlineTime = (Date.now() - saveData.timestamp) / 1000;
                const production = generatorsManager.getTotalProduction(this);
                const offlineEnergy = production * offlineTime * this.offlineProductionRate;
                
                if (offlineEnergy > 0) {
                    this.energy += offlineEnergy;
                    this.stats.totalEnergy += offlineEnergy;
                    
                    notifications.success(
                        ' Welcome Back!',
                        `You earned ${this.formatNumber(offlineEnergy)} energy while away (${this.formatTime(offlineTime)})`,
                        6000
                    );
                }
            }
            
            notifications.success('Game Loaded', 'Progress restored successfully!');
            return true;
        } catch (error) {
            console.error('Failed to load save:', error);
            notifications.error('Load Failed', 'Could not restore save data');
            return false;
        }
    }
    
    exportSave() {
        const saveData = this.saveGame();
        const encoded = btoa(JSON.stringify(saveData));
        
        // Copy to clipboard
        navigator.clipboard.writeText(encoded).then(() => {
            notifications.success('Exported!', 'Save data copied to clipboard');
        }).catch(() => {
            // Fallback: show in alert
            prompt('Copy this save data:', encoded);
        });
    }
    
    importSave(encoded) {
        try {
            const decoded = atob(encoded);
            const saveData = JSON.parse(decoded);
            
            localStorage.setItem('neonNexusSave', JSON.stringify(saveData));
            location.reload();
            
            return true;
        } catch (error) {
            console.error('Failed to import save:', error);
            notifications.error('Import Failed', 'Invalid save data');
            return false;
        }
    }
    
    hardReset() {
        if (confirm('Are you sure? This will delete ALL progress!')) {
            if (confirm('Really? This cannot be undone!')) {
                localStorage.removeItem('neonNexusSave');
                location.reload();
            }
        }
    }
}

// Create global game instance
const game = new Game();


// ===== UI =====
// UI System

function updateUI(game) {
    // Update energy display
    document.getElementById('energy-amount').textContent = game.formatNumber(game.energy);
    
    // Update energy per second
    const energyPerSec = generatorsManager.getTotalProduction(game);
    document.getElementById('energy-per-sec').textContent = game.formatNumber(energyPerSec);
    
    // Update level
    document.getElementById('player-level').textContent = game.level;
    
    // Update prestige count
    document.getElementById('prestige-count').textContent = game.prestigeCount;
    
    // Update multipliers
    document.getElementById('click-power').textContent = game.formatNumber(game.clickPower * game.clickPowerMultiplier);
    document.getElementById('global-mult').textContent = game.globalMultiplier.toFixed(2);
    
    if (game.prestigeMultiplier > 1) {
        document.getElementById('prestige-mult-display').style.display = 'flex';
        document.getElementById('prestige-mult').textContent = game.prestigeMultiplier.toFixed(2);
    }
    
    // Update combo
    if (game.comboCount > 1) {
        document.getElementById('combo-counter').style.display = 'block';
        document.getElementById('combo-value').textContent = game.comboCount;
    } else {
        document.getElementById('combo-counter').style.display = 'none';
    }
    
    // Update statistics
    document.getElementById('total-clicks').textContent = game.formatNumber(game.stats.totalClicks);
    document.getElementById('total-energy').textContent = game.formatNumber(game.stats.totalEnergy);
    document.getElementById('play-time').textContent = game.formatTime(game.stats.playTime);
    document.getElementById('highest-combo').textContent = game.stats.highestCombo;
    document.getElementById('unlocked-achievements').textContent = achievementsManager.getUnlockedCount();
    document.getElementById('total-achievements').textContent = achievementsManager.getTotalCount();
    
    // Update level progress
    const levelProgress = (game.experience / game.experienceToNextLevel) * 100;
    document.getElementById('level-progress').style.width = levelProgress + '%';
    document.getElementById('level-progress-text').textContent = Math.floor(levelProgress) + '%';
}

function renderUpgrades() {
    const grid = document.getElementById('upgrades-grid');
    grid.innerHTML = '';
    
    upgradesManager.upgrades.forEach(upgrade => {
        const isUnlocked = upgradesManager.isUnlocked(upgrade, game);
        const isMaxed = upgradesManager.isMaxed(upgrade);
        const cost = upgradesManager.getCost(upgrade);
        const canAfford = upgradesManager.canAfford(upgrade, game.energy);
        
        if (!isUnlocked) return; // Don't show locked upgrades
        
        const card = document.createElement('div');
        card.className = 'upgrade-card';
        card.dataset.upgradeId = upgrade.id;
        
        if (isMaxed) card.classList.add('maxed');
        
        card.innerHTML = `
            <div class=\"upgrade-header\">
                <span class=\"upgrade-icon\">${upgrade.icon}</span>
                <span class=\"upgrade-level\">Lv. ${upgrade.currentLevel}</span>
            </div>
            <div class=\"upgrade-name\">${upgrade.name}</div>
            <div class=\"upgrade-description\">${upgrade.description}</div>
            <div class=\"upgrade-effect\">${upgrade.effect}</div>
            <div class=\"upgrade-cost\">
                <span class=\"cost-label\">Cost:</span>
                <span class=\"cost-value ${canAfford ? 'affordable' : 'expensive'}\">${game.formatNumber(cost)}</span>
            </div>
        `;
        
        if (!isMaxed) {
            card.addEventListener('click', () => {
                if (upgradesManager.purchase(upgrade, game)) {
                    renderUpgrades();
                }
            });
        }
        
        grid.appendChild(card);
    });
}

function renderGenerators() {
    const list = document.getElementById('generators-list');
    list.innerHTML = '';
    
    generatorsManager.generators.forEach(generator => {
        const isUnlocked = generatorsManager.isUnlocked(generator, game.stats.totalEnergy);
        const cost = generatorsManager.getCost(generator);
        const canAfford = generatorsManager.canAfford(generator, game.energy);
        const production = generatorsManager.getProduction(generator, game);
        
        if (!isUnlocked && generator.unlockCost > 0) {
            // Show locked generator with requirements
            const card = document.createElement('div');
            card.className = 'generator-card locked';
            card.innerHTML = `
                <div class=\"generator-header\">
                    <span class=\"generator-icon\">\ud83d\udd12</span>
                    <div class=\"generator-info\">
                        <div class=\"generator-name\">???</div>
                        <div class=\"generator-production\">Unlock at ${game.formatNumber(generator.unlockCost)} total energy</div>
                    </div>
                </div>
            `;
            list.appendChild(card);
            return;
        }
        
        const card = document.createElement('div');
        card.className = 'generator-card';
        card.dataset.generatorId = generator.id;
        
        card.innerHTML = `
            <div class=\"generator-header\">
                <span class=\"generator-icon\">${generator.icon}</span>
                <div class=\"generator-info\">
                    <div class=\"generator-name\">${generator.name}</div>
                    <div class=\"generator-count\">Owned: <span class=\"generator-count-value\">${generator.count}</span></div>
                </div>
            </div>
            <div class=\"generator-production\">${game.formatNumber(production)}/sec</div>
            <div class=\"generator-footer\">
                <span class=\"generator-cost ${canAfford ? 'affordable' : 'expensive'}\">${game.formatNumber(cost)}</span>
            </div>
        `;
        
        card.addEventListener('click', () => {
            if (generatorsManager.purchase(generator, game)) {
                renderGenerators();
            }
        });
        
        list.appendChild(card);
    });
}

function renderPowerups() {
    const grid = document.getElementById('powerups-grid');
    grid.innerHTML = '';
    
    powerupsManager.powerups.forEach(powerup => {
        const cost = powerupsManager.getCost(powerup, game);
        const canUse = powerupsManager.canUse(powerup, game);
        
        const card = document.createElement('div');
        card.className = 'powerup-card';
        card.dataset.powerupId = powerup.id;
        
        if (powerup.active) card.classList.add('active');
        if (powerup.cooldownRemaining > 0) card.classList.add('cooldown');
        
        let statusHtml = '';
        if (powerup.cooldownRemaining > 0) {
            statusHtml = `<div class=\"powerup-cooldown\">${Math.ceil(powerup.cooldownRemaining)}s</div>`;
        }
        
        card.innerHTML = `
            ${statusHtml}
            <div class=\"powerup-icon\">${powerup.icon}</div>
            <div class=\"powerup-name\">${powerup.name}</div>
            <div class=\"powerup-description\">${powerup.description}</div>
            <div class=\"powerup-duration\">Duration: ${powerup.duration}s</div>
            <div class=\"powerup-cost\">${game.formatNumber(cost)} Energy</div>
        `;
        
        if (canUse) {
            card.addEventListener('click', () => {
                if (powerupsManager.activate(powerup, game)) {
                    renderPowerups();
                }
            });
        }
        
        grid.appendChild(card);
    });
    
    // Update active power-ups display
    renderActivePowerups();
}

function renderActivePowerups() {
    const container = document.getElementById('active-powerups');
    container.innerHTML = '';
    
    const activePowerups = powerupsManager.getActivePowerups();
    
    activePowerups.forEach(powerup => {
        const item = document.createElement('div');
        item.className = 'powerup-active-item';
        
        const progress = (powerup.remaining / powerupsManager.getDuration(powerup, game)) * 100;
        
        item.innerHTML = `
            <div class=\"powerup-active-header\">
                <span class=\"powerup-active-name\">${powerup.icon} ${powerup.name}</span>
                <span class=\"powerup-active-timer\">${Math.ceil(powerup.remaining)}s</span>
            </div>
            <div class=\"powerup-progress\">
                <div class=\"powerup-progress-fill\" style=\"width: ${progress}%\"></div>
            </div>
        `;
        
        container.appendChild(item);
    });
}

function renderAchievements(filter = 'all') {
    const grid = document.getElementById('achievements-grid');
    grid.innerHTML = '';
    
    let achievements = achievementsManager.achievements;
    
    if (filter === 'unlocked') {
        achievements = achievements.filter(a => a.unlocked);
    } else if (filter === 'locked') {
        achievements = achievements.filter(a => !a.unlocked);
    }
    
    achievements.forEach(achievement => {
        const card = document.createElement('div');
        card.className = 'achievement-card';
        card.dataset.achievementId = achievement.id;
        
        if (achievement.unlocked) {
            card.classList.add('unlocked');
        } else {
            card.classList.add('locked');
        }
        
        card.innerHTML = `
            <div class=\"achievement-tier ${achievement.tier}\">${achievement.tier.toUpperCase()}</div>
            <div class=\"achievement-icon\">${achievement.icon}</div>
            <div class=\"achievement-name\">${achievement.name}</div>
            <div class=\"achievement-description\">${achievement.description}</div>
            <div class=\"achievement-reward\">\u2728 ${achievement.reward}</div>
        `;
        
        grid.appendChild(card);
    });
}

function renderPrestige() {
    // Update prestige stats
    document.getElementById('prestige-current-energy').textContent = game.formatNumber(game.stats.totalEnergy);
    document.getElementById('prestige-points-gain').textContent = prestigeManager.getPrestigeGain(game);
    document.getElementById('prestige-points-total').textContent = game.prestigePoints;
    
    const bonus = (game.prestigeMultiplier - 1) * 100;
    document.getElementById('prestige-bonus-display').textContent = '+' + bonus.toFixed(0) + '%';
    
    // Update prestige button
    const prestigeBtn = document.getElementById('prestige-btn');
    const canPrestige = prestigeManager.canPrestige(game);
    prestigeBtn.disabled = !canPrestige;
    
    // Render prestige upgrades
    const grid = document.getElementById('prestige-upgrades-grid');
    grid.innerHTML = '';
    
    prestigeManager.prestigeUpgrades.forEach(upgrade => {
        const cost = prestigeManager.getCost(upgrade);
        const canAfford = prestigeManager.canAfford(upgrade, game.prestigePoints);
        const isMaxed = prestigeManager.isMaxed(upgrade);
        
        const card = document.createElement('div');
        card.className = 'prestige-upgrade-card upgrade-card';
        card.dataset.prestigeUpgradeId = upgrade.id;
        
        if (isMaxed) card.classList.add('maxed');
        
        card.innerHTML = `
            <div class=\"upgrade-header\">
                <span class=\"upgrade-icon\">${upgrade.icon}</span>
                <span class=\"upgrade-level\">Lv. ${upgrade.currentLevel}</span>
            </div>
            <div class=\"upgrade-name\">${upgrade.name}</div>
            <div class=\"upgrade-description\">${upgrade.description}</div>
            <div class=\"upgrade-effect\">${upgrade.effect}</div>
            <div class=\"upgrade-cost\">
                <span class=\"cost-label\">Cost:</span>
                <span class=\"cost-value prestige-points ${canAfford ? 'affordable' : 'expensive'}\">${cost} PP</span>
            </div>
        `;
        
        if (!isMaxed) {
            card.addEventListener('click', () => {
                if (prestigeManager.purchase(upgrade, game)) {
                    renderPrestige();
                }
            });
        }
        
        grid.appendChild(card);
    });
}

function renderMilestones() {
    const list = document.getElementById('milestones-list');
    list.innerHTML = '';
    
    milestonesManager.milestones.forEach(milestone => {
        const progress = milestonesManager.getProgress(milestone, game);
        
        const card = document.createElement('div');
        card.className = 'milestone-item';
        card.dataset.milestoneId = milestone.id;
        
        if (milestone.unlocked) {
            card.classList.add('unlocked');
        }
        
        card.innerHTML = `
            <div class=\"milestone-header\">
                <span class=\"milestone-name\">${milestone.icon} ${milestone.name}</span>
                <span class=\"milestone-reward\">${milestone.reward}</span>
            </div>
            <div class=\"milestone-progress-bar\">
                <div class=\"milestone-progress-fill\" style=\"width: ${progress}%\"></div>
            </div>
            <div class=\"milestone-progress-text\">${game.formatNumber(progress)}%</div>
        `;
        
        list.appendChild(card);
    });
}

function renderEvent() {
    const eventContainer = document.getElementById('special-event');
    const event = eventsManager.currentEvent;
    
    if (event) {
        eventContainer.style.display = 'block';
        document.getElementById('event-title').textContent = event.title;
        document.getElementById('event-description').textContent = event.description;
        
        const timeLeft = Math.ceil(eventsManager.eventTimer / 1000);
        document.getElementById('event-timer').textContent = `${timeLeft}s remaining`;
    } else {
        eventContainer.style.display = 'none';
    }
}

function initializeUI() {
    // Render all tabs
    renderUpgrades();
    renderGenerators();
    renderPowerups();
    renderAchievements();
    renderPrestige();
    renderMilestones();
    renderEvent();
    
    // Tab navigation
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const tab = btn.dataset.tab;
            
            // Update active tab button
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Update active tab pane
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            document.getElementById(tab + '-tab').classList.add('active');
            
            // Re-render content
            switch(tab) {
                case 'upgrades':
                    renderUpgrades();
                    break;
                case 'generators':
                    renderGenerators();
                    break;
                case 'powerups':
                    renderPowerups();
                    break;
                case 'achievements':
                    renderAchievements();
                    break;
                case 'prestige':
                    renderPrestige();
                    break;
            }
        });
    });
    
    // Achievement filters
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const filter = btn.dataset.filter;
            
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            renderAchievements(filter);
        });
    });
    
    // Main click button
    document.getElementById('main-click-btn').addEventListener('click', (e) => {
        const rect = e.currentTarget.getBoundingClientRect();
        const x = e.clientX;
        const y = e.clientY;
        
        game.click(x, y);
    });
    
    // Prestige button
    document.getElementById('prestige-btn').addEventListener('click', () => {
        if (prestigeManager.performPrestige(game)) {
            // Refresh all displays
            renderUpgrades();
            renderGenerators();
            renderPowerups();
            renderAchievements();
            renderPrestige();
            renderMilestones();
        }
    });
    
    // Event claim button
    document.getElementById('event-claim-btn').addEventListener('click', () => {
        eventsManager.claimEvent();
        renderEvent();
    });
    
    // Settings buttons
    document.getElementById('save-btn').addEventListener('click', () => {
        game.saveGame();
        notifications.success('Saved!', 'Game saved successfully');
    });
    
    document.getElementById('load-btn').addEventListener('click', () => {
        location.reload();
    });
    
    document.getElementById('export-btn').addEventListener('click', () => {
        game.exportSave();
    });
    
    document.getElementById('import-btn').addEventListener('click', () => {
        document.getElementById('import-modal').style.display = 'flex';
    });
    
    document.getElementById('import-confirm-btn').addEventListener('click', () => {
        const data = document.getElementById('import-textarea').value.trim();
        if (data) {
            game.importSave(data);
        }
    });
    
    document.getElementById('import-cancel-btn').addEventListener('click', () => {
        document.getElementById('import-modal').style.display = 'none';
        document.getElementById('import-textarea').value = '';
    });
    
    document.getElementById('reset-btn').addEventListener('click', () => {
        game.hardReset();
    });
    
    // Update UI periodically
    setInterval(() => {
        renderEvent();
        renderActivePowerups();
        
        // Update visible tab content
        const activeTab = document.querySelector('.tab-btn.active').dataset.tab;
        switch(activeTab) {
            case 'upgrades':
                renderUpgrades();
                break;
            case 'generators':
                renderGenerators();
                break;
            case 'powerups':
                renderPowerups();
                break;
            case 'prestige':
                renderPrestige();
                break;
        }
    }, 1000);
}




// ===== NEW EXPANSION UI FUNCTIONS =====

// Render Active Mutations
function renderActiveMutations() {
    const container = document.getElementById('mutations-list');
    if (!container) return;
    
    const mutations = mutationsManager.getActiveMutations();
    if (mutations.length === 0) {
        container.innerHTML = '<div style="color: var(--text-secondary); text-align: center; padding: 10px; font-size: 0.9em;">No mutations active</div>';
        return;
    }
    
    container.innerHTML = mutations.map(m => `
        <div class="mutation-item" style="padding: 8px 12px; background: var(--bg-card); border: 2px solid ${m.type === 'positive' ? 'var(--neon-green)' : m.type === 'challenge' ? 'var(--neon-magenta)' : 'var(--neon-orange)'}; border-radius: 8px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="font-size: 1.5em;">${m.icon}</span>
                <div style="flex: 1; margin-left: 10px;">
                    <div style="font-weight: 700; color: var(--neon-cyan);">${m.name}</div>
                    <div style="font-size: 0.85em; color: var(--text-secondary);">${m.description}</div>
                </div>
            </div>
        </div>
    `).join('');
}

// Render Synergies Grid
function renderSynergies() {
    const container = document.getElementById('synergies-grid');
    if (!container) return;
    
    const filter = document.querySelector('.synergies-filter .filter-btn.active')?.dataset.filter || 'all';
    let synergies = synergiesManager.synergies;
    
    if (filter === 'unlocked') {
        synergies = synergies.filter(s => s.unlocked);
    } else if (filter === 'locked') {
        synergies = synergies.filter(s => !s.unlocked);
    }
    
    container.innerHTML = synergies.map(s => `
        <div class="synergy-card" style="padding: 15px; background: var(--bg-card); border: 2px solid ${s.unlocked ? 'var(--neon-green)' : 'var(--border-color)'}; border-radius: 10px; ${s.unlocked ? '' : 'opacity: 0.6; filter: grayscale(1);'}">
            <div style="font-size: 2em; text-align: center; margin-bottom: 10px;">${s.icon}</div>
            <div style="font-weight: 700; font-size: 1.1em; color: var(--neon-cyan); margin-bottom: 5px; text-align: center;">${s.name}</div>
            <div style="font-size: 0.9em; color: var(--text-secondary); margin-bottom: 10px; line-height: 1.4;">${s.description}</div>
            <div style="padding: 8px; background: var(--bg-dark); border-radius: 5px; text-align: center;">
                <div style="color: var(--neon-green); font-weight: 700; font-size: 0.95em;">${s.bonus}</div>
            </div>
            ${s.unlocked ? '<div style="margin-top: 8px; text-align: center; color: var(--neon-green); font-weight: 700;"> UNLOCKED</div>' : ''}
        </div>
    `).join('');
}

// Render Prestige Paths
function renderPrestigePaths() {
    const container = document.querySelector('.prestige-paths-grid');
    const currentPathDisplay = document.getElementById('current-path-display');
    if (!container) return;
    
    const paths = prestigePathsManager.getAvailablePaths();
    const currentPath = prestigePathsManager.getCurrentPath();
    
    container.innerHTML = paths.map(p => `
        <div class="prestige-path-card" onclick="selectPrestigePath('${p.id}')" style="padding: 15px; background: var(--bg-card); border: 3px solid ${p.chosen ? p.color : 'var(--border-color)'}; border-radius: 10px; cursor: pointer; transition: all 0.3s ease; ${p.chosen ? 'box-shadow: 0 0 30px ' + p.color + '80;' : ''}">
            <div style="font-size: 2.5em; text-align: center; margin-bottom: 10px;">${p.icon}</div>
            <div style="font-weight: 700; font-size: 1.2em; color: ${p.color}; margin-bottom: 8px; text-align: center;">${p.name}</div>
            <div style="font-size: 0.9em; color: var(--text-secondary); margin-bottom: 15px; line-height: 1.4; text-align: center;">${p.description}</div>
            <div style="margin-bottom: 10px;">
                <div style="font-weight: 700; color: var(--neon-green); margin-bottom: 5px;"> Bonuses:</div>
                ${p.bonuses.map(b => `<div style="font-size: 0.85em; color: var(--text-secondary); margin-left: 10px;"> ${b}</div>`).join('')}
            </div>
            <div>
                <div style="font-weight: 700; color: var(--neon-magenta); margin-bottom: 5px;"> Penalties:</div>
                ${p.penalties.map(pen => `<div style="font-size: 0.85em; color: var(--text-secondary); margin-left: 10px;"> ${pen}</div>`).join('')}
            </div>
            ${p.chosen ? '<div style="margin-top: 10px; text-align: center; padding: 8px; background: ' + p.color + '40; border-radius: 5px; color: white; font-weight: 700;">ACTIVE</div>' : ''}
        </div>
    `).join('');
    
    if (currentPath && currentPathDisplay) {
        currentPathDisplay.innerHTML = `
            <div style="text-align: center;">
                <div style="font-size: 2em; margin-bottom: 10px;">${currentPath.icon}</div>
                <div style="font-size: 1.3em; font-weight: 700; color: ${currentPath.color};">Current Path: ${currentPath.name}</div>
                <div style="margin-top: 10px; color: var(--text-secondary);">${currentPath.description}</div>
            </div>
        `;
    } else if (currentPathDisplay) {
        currentPathDisplay.innerHTML = `
            <div style="text-align: center; color: var(--text-secondary);">
                No path selected. Choose a path after your first prestige!
            </div>
        `;
    }
}

// Render Artifacts
function renderArtifacts() {
    const equippedContainer = document.getElementById('equipped-artifacts-display');
    const gridContainer = document.getElementById('artifacts-grid');
    if (!gridContainer) return;
    
    const discovered = artifactsManager.discoveredArtifacts;
    const equipped = artifactsManager.equippedArtifacts;
    
    // Update collection count
    const collectedSpan = document.getElementById('artifacts-collected');
    const totalSpan = document.getElementById('artifacts-total');
    if (collectedSpan) collectedSpan.textContent = discovered.length;
    if (totalSpan) totalSpan.textContent = artifactsManager.allArtifacts.length;
    
    // Render equipped artifacts
    if (equippedContainer) {
        if (equipped.length === 0) {
            equippedContainer.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; color: var(--text-secondary); padding: 20px;">No artifacts equipped</div>';
        } else {
            equippedContainer.innerHTML = equipped.map(a => `
                <div class="artifact-card equipped" style="padding: 12px; background: var(--bg-dark); border: 3px solid ${artifactsManager.getRarityColor(a.rarity)}; border-radius: 10px; text-align: center;">
                    <div style="font-size: 2.5em; margin-bottom: 8px;">${a.icon}</div>
                    <div style="font-weight: 700; color: ${artifactsManager.getRarityColor(a.rarity)}; margin-bottom: 5px;">${a.name}</div>
                    <div style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 8px;">${a.effect}</div>
                    <button onclick="unequipArtifact('${a.id}')" style="width: 100%; padding: 6px; background: var(--neon-magenta); border: none; border-radius: 5px; color: white; font-weight: 700; cursor: pointer;">Unequip</button>
                </div>
            `).join('');
        }
    }
    
    // Render artifact grid
    if (discovered.length === 0) {
        gridContainer.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; color: var(--text-secondary); padding: 40px;">No artifacts discovered yet. Prestige to find artifacts!</div>';
    } else {
        gridContainer.innerHTML = discovered.map(a => {
            const isEquipped = equipped.find(e => e.id === a.id);
            return `
                <div class="artifact-card" style="padding: 15px; background: var(--bg-card); border: 2px solid ${artifactsManager.getRarityColor(a.rarity)}; border-radius: 10px; text-align: center; ${isEquipped ? 'opacity: 0.5;' : ''}">
                    <div style="position: absolute; top: 8px; right: 8px; font-size: 1.2em;">${artifactsManager.getRarityIcon(a.rarity)}</div>
                    <div style="font-size: 3em; margin-bottom: 10px;">${a.icon}</div>
                    <div style="font-weight: 700; font-size: 1.1em; color: ${artifactsManager.getRarityColor(a.rarity)}; margin-bottom: 5px;">${a.name}</div>
                    <div style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 5px; font-style: italic;">${a.rarity.toUpperCase()}</div>
                    <div style="font-size: 0.9em; color: var(--text-secondary); margin-bottom: 10px; line-height: 1.4;">${a.description}</div>
                    <div style="padding: 8px; background: var(--bg-dark); border-radius: 5px; margin-bottom: 10px;">
                        <div style="color: var(--neon-green); font-weight: 700; font-size: 0.9em;">${a.effect}</div>
                    </div>
                    ${isEquipped ? 
                        '<div style="color: var(--neon-green); font-weight: 700;"> EQUIPPED</div>' : 
                        '<button onclick="equipArtifact('' + a.id + '')" style="width: 100%; padding: 8px; background: var(--gradient-main); border: none; border-radius: 5px; color: white; font-weight: 700; cursor: pointer;">Equip</button>'
                    }
                </div>
            `;
        }).join('');
    }
}

// Global functions for artifact management
window.equipArtifact = function(artifactId) {
    if (artifactsManager.equipArtifact(artifactId, game)) {
        renderArtifacts();
        updateUI(game);
    }
};

window.unequipArtifact = function(artifactId) {
    if (artifactsManager.unequipArtifact(artifactId)) {
        renderArtifacts();
        // Note: Need to reload game to remove effects
        notifications.warning('Artifact Unequipped', 'Save and reload the game to remove artifact effects');
    }
};

// Global function for prestige path selection
window.selectPrestigePath = function(pathId) {
    if (!game || game.prestigeCount === 0) {
        notifications.warning('Not Available', 'Complete at least one prestige first!');
        return;
    }
    
    if (!prestigePathsManager.canSwitchPath(game)) {
        notifications.warning('Cannot Switch', 'You cannot switch paths at this time');
        return;
    }
    
    if (prestigePathsManager.choosePath(pathId, game)) {
        renderPrestigePaths();
        updateUI(game);
        game.saveGame();
    }
};

// Add these render calls to the main updateUI function
const originalUpdateUI = updateUI;
updateUI = function(game) {
    originalUpdateUI(game);
    renderActiveMutations();
    renderArtifacts();
};





// ===== INITIALIZATION =====
(function() {
    'use strict';
    
    console.log(' Neon Nexus: Ultimate Expansion Loading...');
    
    // Wait for DOM to be ready
    function initGame() {
        if (typeof game === 'undefined') {
            console.error('Game not initialized!');
            return;
        }
        
        console.log(' Game initialized');
        console.log(' Mutations Manager ready');
        console.log(' Synergies Manager ready');
        console.log(' Prestige Paths Manager ready');
        console.log(' Artifacts Manager ready');
        
        // Render initial UI for expansion features
        setTimeout(() => {
            try {
                renderPrestigePaths();
                renderSynergies();
                renderActiveMutations();
                renderArtifacts();
                
                // Add event listeners for synergy filters
                const synergyFilters = document.querySelectorAll('.synergies-filter .filter-btn');
                synergyFilters.forEach(btn => {
                    btn.addEventListener('click', function() {
                        synergyFilters.forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        renderSynergies();
                    });
                });
                
                console.log(' All expansion features initialized!');
            } catch (error) {
                console.error('Error initializing expansion UI:', error);
            }
        }, 1000);
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initGame);
    } else {
        initGame();
    }
})();

</script>
</body>
</html>