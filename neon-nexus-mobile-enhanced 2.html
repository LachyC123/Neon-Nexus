<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0a0a0f">
    <title>Neon Nexus - The Ultimate Idle Experience</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    
    <style>
/* ===== NEON NEXUS - DARK/NEON THEME ===== */

/* Reset & Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    /* Neon Colors */
    --neon-cyan: #00ffff;
    --neon-magenta: #ff00ff;
    --neon-blue: #0080ff;
    --neon-green: #00ff00;
    --neon-pink: #ff1493;
    --neon-yellow: #ffff00;
    --neon-purple: #9d00ff;
    --neon-orange: #ff6600;
    
    /* Dark Theme */
    --bg-dark: #0a0a0f;
    --bg-panel: #12121a;
    --bg-card: #1a1a28;
    --bg-hover: #22223a;
    --text-primary: #ffffff;
    --text-secondary: #a0a0c0;
    --border-color: #2a2a40;
    
    /* Gradients */
    --gradient-main: linear-gradient(135deg, #00ffff 0%, #ff00ff 100%);
    --gradient-alt: linear-gradient(135deg, #0080ff 0%, #9d00ff 100%);
    --gradient-success: linear-gradient(135deg, #00ff00 0%, #00ffff 100%);
    --gradient-warning: linear-gradient(135deg, #ffff00 0%, #ff6600 100%);
    --gradient-danger: linear-gradient(135deg, #ff00ff 0%, #ff0000 100%);
}

body {
    font-family: 'Rajdhani', sans-serif;
    background: var(--bg-dark);
    color: var(--text-primary);
    overflow-x: hidden;
    min-height: 100vh;
}

/* Animated Star Background */
.stars {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0;
    background: 
        radial-gradient(2px 2px at 20% 30%, white, transparent),
        radial-gradient(2px 2px at 60% 70%, white, transparent),
        radial-gradient(1px 1px at 50% 50%, white, transparent),
        radial-gradient(1px 1px at 80% 10%, white, transparent),
        radial-gradient(2px 2px at 90% 60%, white, transparent),
        radial-gradient(1px 1px at 33% 80%, white, transparent),
        radial-gradient(2px 2px at 70% 40%, white, transparent);
    background-size: 200% 200%;
    animation: starMove 200s linear infinite;
    opacity: 0.3;
}

@keyframes starMove {
    from { background-position: 0 0; }
    to { background-position: 200% 200%; }
}

/* Main Container */
.game-container {
    position: relative;
    z-index: 1;
    max-width: 1920px;
    margin: 0 auto;
    padding: 20px;
}

/* Header */
.game-header {
    background: var(--bg-panel);
    border: 2px solid var(--border-color);
    border-radius: 15px;
    padding: 20px 30px;
    margin-bottom: 20px;
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.2);
    position: relative;
    overflow: hidden;
}

.game-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);
    animation: shimmer 3s infinite;
}

@keyframes shimmer {
    to { left: 100%; }
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.game-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 3em;
    font-weight: 900;
    letter-spacing: 0.1em;
    margin: 0;
}

.neon-text {
    color: var(--neon-cyan);
    text-shadow: 
        0 0 10px var(--neon-cyan),
        0 0 20px var(--neon-cyan),
        0 0 30px var(--neon-cyan),
        0 0 40px var(--neon-cyan);
    animation: neonPulse 2s ease-in-out infinite;
}

.nexus-text {
    color: var(--neon-magenta);
    text-shadow: 
        0 0 10px var(--neon-magenta),
        0 0 20px var(--neon-magenta),
        0 0 30px var(--neon-magenta),
        0 0 40px var(--neon-magenta);
    animation: neonPulse 2s ease-in-out infinite 0.5s;
}

@keyframes neonPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; }
}

.header-stats {
    display: flex;
    gap: 30px;
}

.stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px 20px;
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    min-width: 100px;
}

.stat-label {
    font-size: 0.9em;
    color: var(--text-secondary);
    margin-bottom: 5px;
}

.stat-value {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.8em;
    font-weight: 700;
    color: var(--neon-cyan);
    text-shadow: 0 0 10px var(--neon-cyan);
}

.prestige-value {
    color: var(--neon-magenta);
    text-shadow: 0 0 10px var(--neon-magenta);
}

/* Game Content Layout */
.game-content {
    display: grid;
    grid-template-columns: 1fr 2fr 1fr;
    gap: 20px;
    min-height: 70vh;
}

/* Panel Styling */
.left-panel, .center-panel, .right-panel {
    background: var(--bg-panel);
    border: 2px solid var(--border-color);
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.1);
}

/* Energy Display */
.energy-display {
    text-align: center;
    padding: 30px 20px;
    background: var(--bg-card);
    border: 2px solid var(--neon-cyan);
    border-radius: 15px;
    margin-bottom: 30px;
    box-shadow: 
        0 0 20px rgba(0, 255, 255, 0.3),
        inset 0 0 20px rgba(0, 255, 255, 0.1);
}

.energy-label {
    font-size: 1.2em;
    color: var(--text-secondary);
    margin-bottom: 10px;
    letter-spacing: 0.1em;
}

.energy-amount {
    font-family: 'Orbitron', sans-serif;
    font-size: 3em;
    font-weight: 900;
    color: var(--neon-cyan);
    text-shadow: 
        0 0 10px var(--neon-cyan),
        0 0 20px var(--neon-cyan),
        0 0 30px var(--neon-cyan);
    margin: 10px 0;
    animation: energyGlow 2s ease-in-out infinite;
}

@keyframes energyGlow {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.energy-per-sec {
    font-size: 1.3em;
    color: var(--neon-green);
    text-shadow: 0 0 10px var(--neon-green);
}

/* Main Click Button */
.click-area {
    text-align: center;
    margin: 30px 0;
    position: relative;
}

.main-click-btn {
    width: 250px;
    height: 250px;
    border: none;
    border-radius: 50%;
    background: var(--gradient-main);
    cursor: pointer;
    position: relative;
    transition: all 0.2s ease;
    box-shadow: 
        0 0 40px rgba(0, 255, 255, 0.5),
        0 0 60px rgba(255, 0, 255, 0.3),
        inset 0 0 30px rgba(255, 255, 255, 0.2);
}

.main-click-btn:hover {
    transform: scale(1.05);
    box-shadow: 
        0 0 60px rgba(0, 255, 255, 0.8),
        0 0 80px rgba(255, 0, 255, 0.5),
        inset 0 0 40px rgba(255, 255, 255, 0.3);
}

.main-click-btn:active {
    transform: scale(0.95);
}

.click-btn-inner {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
}

.click-icon {
    font-size: 5em;
    margin-bottom: 10px;
    animation: iconFloat 2s ease-in-out infinite;
}

@keyframes iconFloat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.click-text {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.5em;
    font-weight: 700;
    color: white;
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
}

/* Combo Counter */
.combo-counter {
    margin-top: 20px;
    padding: 10px 20px;
    background: var(--bg-card);
    border: 2px solid var(--neon-orange);
    border-radius: 10px;
    display: inline-block;
    box-shadow: 0 0 20px rgba(255, 102, 0, 0.5);
    animation: comboPulse 0.5s ease-in-out infinite;
}

@keyframes comboPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.combo-text {
    color: var(--text-secondary);
    margin-right: 10px;
}

.combo-value {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.5em;
    font-weight: 700;
    color: var(--neon-orange);
    text-shadow: 0 0 10px var(--neon-orange);
}

/* Multipliers Display */
.multipliers-display {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    margin: 20px 0;
}

.multiplier-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid var(--border-color);
}

.multiplier-item:last-child {
    border-bottom: none;
}

.mult-label {
    color: var(--text-secondary);
}

.mult-value {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    color: var(--neon-cyan);
    text-shadow: 0 0 10px var(--neon-cyan);
}

.prestige-mult .mult-value {
    color: var(--neon-magenta);
    text-shadow: 0 0 10px var(--neon-magenta);
}

/* Active Power-ups */
.active-powerups {
    margin: 20px 0;
}

.powerup-active-item {
    background: var(--bg-card);
    border: 2px solid var(--neon-yellow);
    border-radius: 10px;
    padding: 10px;
    margin-bottom: 10px;
    box-shadow: 0 0 15px rgba(255, 255, 0, 0.3);
    animation: powerupGlow 1s ease-in-out infinite;
}

@keyframes powerupGlow {
    0%, 100% { box-shadow: 0 0 15px rgba(255, 255, 0, 0.3); }
    50% { box-shadow: 0 0 25px rgba(255, 255, 0, 0.6); }
}

.powerup-active-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.powerup-active-name {
    font-weight: 700;
    color: var(--neon-yellow);
}

.powerup-active-timer {
    color: var(--text-secondary);
    font-size: 0.9em;
}

.powerup-progress {
    width: 100%;
    height: 4px;
    background: var(--bg-dark);
    border-radius: 2px;
    margin-top: 5px;
    overflow: hidden;
}

.powerup-progress-fill {
    height: 100%;
    background: var(--neon-yellow);
    transition: width 0.1s linear;
    box-shadow: 0 0 10px var(--neon-yellow);
}

/* Section Title */
.section-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.3em;
    font-weight: 700;
    color: var(--neon-cyan);
    text-shadow: 0 0 10px var(--neon-cyan);
    margin-bottom: 15px;
    text-align: center;
    letter-spacing: 0.1em;
}

/* Milestones */
.milestones-section {
    margin-top: 30px;
}

.milestones-list {
    max-height: 300px;
    overflow-y: auto;
}

.milestone-item {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 10px;
    transition: all 0.3s ease;
}

.milestone-item.unlocked {
    border-color: var(--neon-green);
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
}

.milestone-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.milestone-name {
    font-weight: 700;
    color: var(--neon-cyan);
}

.milestone-reward {
    color: var(--neon-green);
    font-size: 0.9em;
}

.milestone-progress-bar {
    width: 100%;
    height: 8px;
    background: var(--bg-dark);
    border-radius: 4px;
    overflow: hidden;
    position: relative;
}

.milestone-progress-fill {
    height: 100%;
    background: var(--gradient-success);
    transition: width 0.3s ease;
    box-shadow: 0 0 10px var(--neon-green);
}

.milestone-progress-text {
    text-align: center;
    font-size: 0.85em;
    color: var(--text-secondary);
    margin-top: 5px;
}

/* Tab Navigation */
.tab-navigation {
    display: flex;
    gap: 5px;
    margin-bottom: 20px;
    border-bottom: 2px solid var(--border-color);
}

.tab-btn {
    flex: 1;
    padding: 15px 10px;
    background: var(--bg-card);
    border: none;
    border-bottom: 3px solid transparent;
    color: var(--text-secondary);
    font-family: 'Rajdhani', sans-serif;
    font-size: 1.1em;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.tab-btn:hover {
    background: var(--bg-hover);
    color: var(--neon-cyan);
}

.tab-btn.active {
    color: var(--neon-cyan);
    border-bottom-color: var(--neon-cyan);
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
}

/* Tab Content */
.tab-content {
    min-height: 600px;
}

.tab-pane {
    display: none;
    animation: fadeIn 0.3s ease;
}

.tab-pane.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Upgrades Grid */
.upgrades-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 15px;
    max-height: 650px;
    overflow-y: auto;
    padding-right: 10px;
}

.upgrade-card {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.upgrade-card:hover {
    border-color: var(--neon-cyan);
    transform: translateY(-5px);
    box-shadow: 0 5px 30px rgba(0, 255, 255, 0.4);
}

.upgrade-card.maxed {
    opacity: 0.6;
    cursor: not-allowed;
    border-color: var(--neon-green);
}

.upgrade-card.maxed::after {
    content: 'MAX';
    position: absolute;
    top: 10px;
    right: 10px;
    background: var(--neon-green);
    color: var(--bg-dark);
    padding: 3px 8px;
    border-radius: 5px;
    font-weight: 700;
    font-size: 0.8em;
}

.upgrade-card.locked {
    opacity: 0.4;
    cursor: not-allowed;
    filter: grayscale(1);
}

.upgrade-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.upgrade-icon {
    font-size: 2em;
}

.upgrade-level {
    background: var(--bg-dark);
    padding: 3px 10px;
    border-radius: 5px;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.9em;
    color: var(--neon-cyan);
}

.upgrade-name {
    font-weight: 700;
    font-size: 1.1em;
    color: var(--neon-cyan);
    margin-bottom: 5px;
}

.upgrade-description {
    color: var(--text-secondary);
    font-size: 0.9em;
    margin-bottom: 10px;
    line-height: 1.4;
}

.upgrade-effect {
    color: var(--neon-green);
    font-size: 0.9em;
    margin-bottom: 10px;
}

.upgrade-cost {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 10px;
    border-top: 1px solid var(--border-color);
}

.cost-label {
    color: var(--text-secondary);
    font-size: 0.9em;
}

.cost-value {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    color: var(--neon-cyan);
}

.cost-value.affordable {
    color: var(--neon-green);
}

.cost-value.expensive {
    color: var(--neon-magenta);
}

/* Generators List */
.generators-list {
    max-height: 650px;
    overflow-y: auto;
    padding-right: 10px;
}

.generator-card {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.generator-card:hover {
    border-color: var(--neon-blue);
    box-shadow: 0 0 30px rgba(0, 128, 255, 0.4);
    transform: translateX(5px);
}

.generator-card.locked {
    opacity: 0.4;
    cursor: not-allowed;
    filter: grayscale(1);
}

.generator-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.generator-info {
    flex: 1;
}

.generator-icon {
    font-size: 2.5em;
    margin-right: 15px;
}

.generator-name {
    font-weight: 700;
    font-size: 1.3em;
    color: var(--neon-blue);
    margin-bottom: 5px;
}

.generator-count {
    font-family: 'Orbitron', sans-serif;
    color: var(--text-secondary);
}

.generator-count-value {
    color: var(--neon-cyan);
    font-weight: 700;
}

.generator-production {
    color: var(--neon-green);
    font-size: 0.95em;
    margin-bottom: 10px;
}

.generator-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.generator-cost {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    font-size: 1.1em;
}

.generator-multiplier {
    background: var(--bg-dark);
    padding: 5px 10px;
    border-radius: 5px;
    color: var(--neon-yellow);
    font-size: 0.9em;
}

/* Power-ups Grid */
.powerups-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    max-height: 650px;
    overflow-y: auto;
}

.powerup-card {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.powerup-card:hover {
    border-color: var(--neon-yellow);
    transform: translateY(-5px);
    box-shadow: 0 5px 30px rgba(255, 255, 0, 0.4);
}

.powerup-card.active {
    border-color: var(--neon-green);
    background: rgba(0, 255, 0, 0.1);
    animation: powerupActive 2s ease-in-out infinite;
}

@keyframes powerupActive {
    0%, 100% { box-shadow: 0 0 20px rgba(0, 255, 0, 0.5); }
    50% { box-shadow: 0 0 40px rgba(0, 255, 0, 0.8); }
}

.powerup-card.cooldown {
    opacity: 0.5;
    cursor: not-allowed;
}

.powerup-icon {
    font-size: 3em;
    margin-bottom: 10px;
}

.powerup-name {
    font-weight: 700;
    font-size: 1.1em;
    color: var(--neon-yellow);
    margin-bottom: 10px;
}

.powerup-description {
    color: var(--text-secondary);
    font-size: 0.9em;
    margin-bottom: 10px;
    line-height: 1.4;
}

.powerup-duration {
    color: var(--neon-cyan);
    font-size: 0.85em;
    margin-bottom: 10px;
}

.powerup-cost {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    color: var(--neon-green);
}

.powerup-cooldown {
    position: absolute;
    top: 10px;
    right: 10px;
    background: var(--bg-dark);
    padding: 3px 8px;
    border-radius: 5px;
    font-size: 0.8em;
    color: var(--neon-magenta);
}

/* Achievements */
.achievements-filter {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    justify-content: center;
}

.filter-btn {
    padding: 10px 20px;
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 8px;
    color: var(--text-secondary);
    font-family: 'Rajdhani', sans-serif;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
}

.filter-btn:hover {
    border-color: var(--neon-cyan);
    color: var(--neon-cyan);
}

.filter-btn.active {
    background: var(--neon-cyan);
    color: var(--bg-dark);
    border-color: var(--neon-cyan);
}

.achievements-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 15px;
    max-height: 600px;
    overflow-y: auto;
}

.achievement-card {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    transition: all 0.3s ease;
    position: relative;
}

.achievement-card.unlocked {
    border-color: var(--neon-green);
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
}

.achievement-card.locked {
    opacity: 0.5;
    filter: grayscale(1);
}

.achievement-tier {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 3px 8px;
    border-radius: 5px;
    font-size: 0.8em;
    font-weight: 700;
}

.achievement-tier.bronze {
    background: #cd7f32;
    color: white;
}

.achievement-tier.silver {
    background: #c0c0c0;
    color: var(--bg-dark);
}

.achievement-tier.gold {
    background: #ffd700;
    color: var(--bg-dark);
}

.achievement-tier.platinum {
    background: linear-gradient(135deg, #e5e4e2, #ffffff);
    color: var(--bg-dark);
}

.achievement-tier.diamond {
    background: linear-gradient(135deg, #b9f2ff, #00ffff);
    color: var(--bg-dark);
}

.achievement-icon {
    font-size: 3em;
    margin-bottom: 10px;
}

.achievement-name {
    font-weight: 700;
    font-size: 1.1em;
    color: var(--neon-cyan);
    margin-bottom: 5px;
}

.achievement-description {
    color: var(--text-secondary);
    font-size: 0.9em;
    margin-bottom: 10px;
}

.achievement-reward {
    color: var(--neon-green);
    font-size: 0.9em;
    font-weight: 700;
}

.achievement-progress {
    margin-top: 10px;
}

.achievement-progress-bar {
    width: 100%;
    height: 6px;
    background: var(--bg-dark);
    border-radius: 3px;
    overflow: hidden;
    margin-top: 5px;
}

.achievement-progress-fill {
    height: 100%;
    background: var(--gradient-success);
    transition: width 0.3s ease;
}

.achievement-progress-text {
    font-size: 0.85em;
    color: var(--text-secondary);
    margin-top: 3px;
}

/* Prestige */
.prestige-info {
    text-align: center;
}

.prestige-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 2.5em;
    color: var(--neon-magenta);
    text-shadow: 
        0 0 10px var(--neon-magenta),
        0 0 20px var(--neon-magenta),
        0 0 30px var(--neon-magenta);
    margin-bottom: 20px;
    animation: neonPulse 2s ease-in-out infinite;
}

.prestige-description {
    color: var(--text-secondary);
    font-size: 1.2em;
    margin-bottom: 30px;
    line-height: 1.6;
}

.prestige-stats {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 30px;
}

.prestige-stat {
    display: flex;
    justify-content: space-between;
    padding: 15px;
    border-bottom: 1px solid var(--border-color);
}

.prestige-stat:last-child {
    border-bottom: none;
}

.pstat-label {
    color: var(--text-secondary);
    font-size: 1.1em;
}

.pstat-value {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    font-size: 1.2em;
    color: var(--neon-cyan);
}

.prestige-points {
    color: var(--neon-magenta) !important;
    text-shadow: 0 0 10px var(--neon-magenta);
}

.prestige-btn {
    padding: 20px 60px;
    font-family: 'Orbitron', sans-serif;
    font-size: 1.5em;
    font-weight: 700;
    background: var(--gradient-danger);
    border: none;
    border-radius: 15px;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.prestige-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 50px rgba(255, 0, 255, 0.8);
}

.prestige-btn:active {
    transform: scale(0.95);
}

.prestige-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.prestige-upgrades {
    margin-top: 40px;
    text-align: left;
}

.prestige-upgrades-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.prestige-upgrade-card {
    background: var(--bg-card);
    border: 2px solid var(--neon-magenta);
    border-radius: 10px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.prestige-upgrade-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 30px rgba(255, 0, 255, 0.4);
}

.prestige-upgrade-card.maxed {
    opacity: 0.6;
    cursor: not-allowed;
    border-color: var(--neon-green);
}

.prestige-upgrade-card.locked {
    opacity: 0.4;
    cursor: not-allowed;
    filter: grayscale(1);
}

/* Special Event */
.special-event {
    background: var(--bg-card);
    border: 3px solid var(--neon-yellow);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 0 30px rgba(255, 255, 0, 0.5);
    animation: eventPulse 1.5s ease-in-out infinite;
}

@keyframes eventPulse {
    0%, 100% { transform: scale(1); box-shadow: 0 0 30px rgba(255, 255, 0, 0.5); }
    50% { transform: scale(1.02); box-shadow: 0 0 50px rgba(255, 255, 0, 0.8); }
}

.event-header {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 10px;
}

.event-icon {
    font-size: 2em;
    margin-right: 10px;
}

.event-title {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    font-size: 1.2em;
    color: var(--neon-yellow);
    text-shadow: 0 0 10px var(--neon-yellow);
}

.event-description {
    color: var(--text-secondary);
    margin-bottom: 10px;
    text-align: center;
    line-height: 1.4;
}

.event-timer {
    text-align: center;
    font-family: 'Orbitron', sans-serif;
    font-size: 1.3em;
    color: var(--neon-orange);
    margin-bottom: 15px;
}

.event-claim-btn {
    width: 100%;
    padding: 12px;
    background: var(--gradient-warning);
    border: none;
    border-radius: 10px;
    font-family: 'Rajdhani', sans-serif;
    font-weight: 700;
    font-size: 1.1em;
    color: var(--bg-dark);
    cursor: pointer;
    transition: all 0.3s ease;
}

.event-claim-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 20px rgba(255, 255, 0, 0.6);
}

/* Statistics */
.statistics-section {
    margin-bottom: 30px;
}

.stats-list {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
}

.stat-row {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid var(--border-color);
}

.stat-row:last-child {
    border-bottom: none;
}

.stat-name {
    color: var(--text-secondary);
}

.stat-number {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    color: var(--neon-cyan);
}

/* Progress Section */
.progress-section {
    margin-bottom: 30px;
}

.progress-bar {
    width: 100%;
    height: 30px;
    background: var(--bg-dark);
    border: 2px solid var(--border-color);
    border-radius: 15px;
    overflow: hidden;
    position: relative;
    margin-top: 15px;
}

.progress-fill {
    height: 100%;
    background: var(--gradient-main);
    transition: width 0.3s ease;
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
}

.progress-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    color: white;
    text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
}

/* Settings */
.settings-section {
}

.settings-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.setting-btn {
    padding: 12px;
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    color: var(--text-primary);
    font-family: 'Rajdhani', sans-serif;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
}

.setting-btn:hover {
    border-color: var(--neon-cyan);
    background: var(--bg-hover);
    transform: translateX(5px);
}

.setting-btn.danger {
    border-color: var(--neon-magenta);
    color: var(--neon-magenta);
}

.setting-btn.danger:hover {
    background: rgba(255, 0, 255, 0.1);
}

/* Notifications */
.notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.notification {
    background: var(--bg-panel);
    border: 2px solid var(--neon-cyan);
    border-radius: 10px;
    padding: 15px 20px;
    min-width: 300px;
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
    animation: notificationSlide 0.3s ease;
}

@keyframes notificationSlide {
    from {
        transform: translateX(400px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.notification.success {
    border-color: var(--neon-green);
    box-shadow: 0 0 30px rgba(0, 255, 0, 0.5);
}

.notification.warning {
    border-color: var(--neon-yellow);
    box-shadow: 0 0 30px rgba(255, 255, 0, 0.5);
}

.notification.error {
    border-color: var(--neon-magenta);
    box-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
}

.notification-title {
    font-weight: 700;
    font-size: 1.1em;
    margin-bottom: 5px;
    color: var(--neon-cyan);
}

.notification.success .notification-title {
    color: var(--neon-green);
}

.notification.warning .notification-title {
    color: var(--neon-yellow);
}

.notification.error .notification-title {
    color: var(--neon-magenta);
}

.notification-message {
    color: var(--text-secondary);
    font-size: 0.95em;
}

/* Particles */
.particle-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 999;
}

.particle {
    position: absolute;
    font-size: 1.5em;
    font-weight: 700;
    font-family: 'Orbitron', sans-serif;
    color: var(--neon-cyan);
    text-shadow: 0 0 10px var(--neon-cyan);
    animation: particleFloat 1.5s ease-out forwards;
    pointer-events: none;
}

@keyframes particleFloat {
    0% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
    100% {
        opacity: 0;
        transform: translateY(-100px) scale(1.5);
    }
}

.particle-effect {
    position: absolute;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--neon-cyan);
    box-shadow: 0 0 10px var(--neon-cyan);
    animation: particleBurst 0.8s ease-out forwards;
}

@keyframes particleBurst {
    0% {
        opacity: 1;
        transform: translate(0, 0) scale(1);
    }
    100% {
        opacity: 0;
        transform: translate(var(--tx), var(--ty)) scale(0);
    }
}

/* Modal */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}

.modal-content {
    background: var(--bg-panel);
    border: 3px solid var(--neon-cyan);
    border-radius: 15px;
    padding: 30px;
    max-width: 500px;
    width: 90%;
    box-shadow: 0 0 50px rgba(0, 255, 255, 0.5);
}

.modal-content h2 {
    font-family: 'Orbitron', sans-serif;
    color: var(--neon-cyan);
    margin-bottom: 20px;
    text-align: center;
}

#import-textarea {
    width: 100%;
    height: 200px;
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    color: var(--text-primary);
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
    resize: vertical;
}

.modal-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.modal-btn {
    flex: 1;
    padding: 12px;
    background: var(--neon-cyan);
    border: none;
    border-radius: 10px;
    color: var(--bg-dark);
    font-family: 'Rajdhani', sans-serif;
    font-weight: 700;
    font-size: 1.1em;
    cursor: pointer;
    transition: all 0.3s ease;
}

.modal-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 20px var(--neon-cyan);
}

.modal-btn.cancel {
    background: var(--bg-card);
    color: var(--text-primary);
    border: 2px solid var(--border-color);
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

::-webkit-scrollbar-track {
    background: var(--bg-dark);
    border-radius: 5px;
}

::-webkit-scrollbar-thumb {
    background: var(--neon-cyan);
    border-radius: 5px;
    box-shadow: 0 0 10px var(--neon-cyan);
}

::-webkit-scrollbar-thumb:hover {
    background: var(--neon-magenta);
    box-shadow: 0 0 15px var(--neon-magenta);
}

/* ===== MOBILE OPTIMIZATION ===== */

/* Prevent zoom and text selection on mobile */
* {
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    touch-action: manipulation;
}

/* Prevent text selection on game elements */
.main-click-btn, .tab-btn, .upgrade-card, .generator-card, 
.powerup-card, .achievement-card, .setting-btn, .prestige-btn,
.event-claim-btn, .filter-btn {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

/* Touch feedback for all buttons */
.main-click-btn:active,
.tab-btn:active,
.upgrade-card:active,
.generator-card:active,
.powerup-card:active,
.setting-btn:active,
.prestige-btn:active,
.event-claim-btn:active,
.filter-btn:active,
.modal-btn:active {
    opacity: 0.8;
}

/* Responsive Design */
@media (max-width: 1400px) {
    .game-content {
        grid-template-columns: 1fr 2fr;
    }
    
    .right-panel {
        grid-column: 1 / -1;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
    }
}

@media (max-width: 900px) {
    .game-content {
        grid-template-columns: 1fr;
    }
    
    .game-title {
        font-size: 2em;
    }
    
    .header-stats {
        gap: 15px;
    }
    
    .tab-btn {
        font-size: 0.9em;
        padding: 12px 5px;
    }
}

/* ===== IPHONE OPTIMIZATION ===== */

/* iPhone Pro Max (430px), 14/13/12 (390px), SE (375px) */
@media (max-width: 768px) {
    /* Reduce container padding */
    .game-container {
        padding: 10px;
    }
    
    /* Header optimizations */
    .game-header {
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .header-content {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
    
    .game-title {
        font-size: 2em;
    }
    
    .header-stats {
        width: 100%;
        justify-content: center;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .stat-item {
        min-width: 80px;
        padding: 8px 15px;
    }
    
    .stat-value {
        font-size: 1.4em;
    }
    
    /* Stack all panels vertically */
    .game-content {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    /* Panel padding */
    .left-panel, .center-panel, .right-panel {
        padding: 15px;
    }
    
    /* Energy display */
    .energy-display {
        padding: 20px 15px;
        margin-bottom: 20px;
    }
    
    .energy-label {
        font-size: 1em;
    }
    
    .energy-amount {
        font-size: 2.2em;
    }
    
    .energy-per-sec {
        font-size: 1.1em;
    }
    
    /* Main click button - larger for mobile */
    .main-click-btn {
        width: 200px;
        height: 200px;
        min-width: 200px;
        min-height: 200px;
    }
    
    .click-icon {
        font-size: 4em;
    }
    
    .click-text {
        font-size: 1.2em;
    }
    
    /* Combo counter */
    .combo-counter {
        margin-top: 15px;
        padding: 8px 15px;
    }
    
    .combo-value {
        font-size: 1.3em;
    }
    
    /* Multipliers display */
    .multipliers-display {
        padding: 12px;
        margin: 15px 0;
    }
    
    .multiplier-item {
        padding: 10px 0;
        font-size: 1em;
    }
    
    /* Milestones */
    .milestones-section {
        margin-top: 20px;
    }
    
    .section-title {
        font-size: 1.1em;
        margin-bottom: 12px;
    }
    
    .milestones-list {
        max-height: 250px;
    }
    
    .milestone-item {
        padding: 12px;
    }
    
    /* Tab navigation - minimum 44px height for touch */
    .tab-navigation {
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 15px;
    }
    
    .tab-btn {
        flex: 1 1 calc(50% - 4px);
        min-width: 140px;
        padding: 14px 8px;
        font-size: 0.95em;
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    /* Tab content */
    .tab-content {
        min-height: 400px;
    }
    
    /* Upgrades grid - single column on mobile */
    .upgrades-grid {
        grid-template-columns: 1fr;
        gap: 12px;
        max-height: 500px;
        padding-right: 5px;
    }
    
    .upgrade-card {
        padding: 12px;
        min-height: 44px;
    }
    
    .upgrade-header {
        margin-bottom: 8px;
    }
    
    .upgrade-icon {
        font-size: 1.8em;
    }
    
    .upgrade-name {
        font-size: 1em;
    }
    
    .upgrade-description {
        font-size: 0.85em;
        margin-bottom: 8px;
    }
    
    /* Generators list */
    .generators-list {
        max-height: 500px;
        padding-right: 5px;
    }
    
    .generator-card {
        padding: 15px;
        margin-bottom: 12px;
        min-height: 44px;
    }
    
    .generator-header {
        margin-bottom: 12px;
        flex-wrap: wrap;
    }
    
    .generator-icon {
        font-size: 2em;
        margin-right: 12px;
    }
    
    .generator-name {
        font-size: 1.1em;
    }
    
    /* Power-ups grid - single column */
    .powerups-grid {
        grid-template-columns: 1fr;
        gap: 12px;
        max-height: 500px;
    }
    
    .powerup-card {
        padding: 12px;
        min-height: 44px;
    }
    
    .powerup-icon {
        font-size: 2.5em;
    }
    
    .powerup-name {
        font-size: 1em;
    }
    
    /* Achievements - 2 columns on mobile */
    .achievements-filter {
        gap: 8px;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }
    
    .filter-btn {
        padding: 10px 15px;
        min-height: 44px;
        font-size: 0.9em;
    }
    
    .achievements-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        max-height: 500px;
    }
    
    .achievement-card {
        padding: 10px;
    }
    
    .achievement-icon {
        font-size: 2.5em;
    }
    
    .achievement-name {
        font-size: 0.95em;
    }
    
    .achievement-description {
        font-size: 0.8em;
    }
    
    /* Prestige section */
    .prestige-title {
        font-size: 2em;
        margin-bottom: 15px;
    }
    
    .prestige-description {
        font-size: 1em;
        margin-bottom: 20px;
    }
    
    .prestige-stats {
        padding: 15px;
        margin-bottom: 20px;
    }
    
    .prestige-stat {
        padding: 12px;
        flex-direction: column;
        gap: 5px;
        text-align: center;
    }
    
    .pstat-label {
        font-size: 0.95em;
    }
    
    .pstat-value {
        font-size: 1.1em;
    }
    
    .prestige-btn {
        padding: 16px 40px;
        font-size: 1.2em;
        min-height: 54px;
    }
    
    .prestige-upgrades-grid {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    /* Right panel stacked */
    .right-panel {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    /* Special event */
    .special-event {
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .event-claim-btn {
        min-height: 44px;
        padding: 12px;
        font-size: 1em;
    }
    
    /* Statistics */
    .statistics-section {
        margin-bottom: 20px;
    }
    
    .stats-list {
        padding: 12px;
    }
    
    .stat-row {
        padding: 8px 0;
        font-size: 0.95em;
    }
    
    /* Settings */
    .settings-list {
        gap: 8px;
    }
    
    .setting-btn {
        padding: 14px;
        min-height: 44px;
        font-size: 0.95em;
    }
    
    /* Notifications - adjust position for mobile */
    .notification-container {
        top: 10px;
        right: 10px;
        left: 10px;
        max-width: calc(100% - 20px);
    }
    
    .notification {
        min-width: auto;
        width: 100%;
        padding: 12px 15px;
    }
    
    .notification-title {
        font-size: 1em;
    }
    
    .notification-message {
        font-size: 0.9em;
    }
    
    /* Modal */
    .modal-content {
        width: 95%;
        padding: 20px;
        max-width: none;
    }
    
    .modal-content h2 {
        font-size: 1.3em;
    }
    
    #import-textarea {
        height: 150px;
        font-size: 0.85em;
    }
    
    .modal-buttons {
        flex-direction: column;
        gap: 8px;
    }
    
    .modal-btn {
        width: 100%;
        min-height: 44px;
    }
    
    /* Active power-ups */
    .powerup-active-item {
        padding: 8px;
        margin-bottom: 8px;
    }
    
    /* Progress bar */
    .progress-bar {
        height: 25px;
    }
    
    /* Reduce particle size on mobile */
    .particle {
        font-size: 1.2em;
    }
    
    .particle-effect {
        width: 8px;
        height: 8px;
    }
}

/* iPhone SE (375px) and smaller */
@media (max-width: 375px) {
    .game-title {
        font-size: 1.6em;
    }
    
    .main-click-btn {
        width: 180px;
        height: 180px;
        min-width: 180px;
        min-height: 180px;
    }
    
    .click-icon {
        font-size: 3.5em;
    }
    
    .click-text {
        font-size: 1em;
    }
    
    .energy-amount {
        font-size: 2em;
    }
    
    .tab-btn {
        font-size: 0.85em;
        padding: 12px 5px;
        min-width: 120px;
    }
    
    .achievements-grid {
        grid-template-columns: 1fr;
    }
    
    .section-title {
        font-size: 1em;
    }
    
    .prestige-title {
        font-size: 1.6em;
    }
}

/* Portrait orientation optimizations */
@media (orientation: portrait) and (max-width: 768px) {
    /* Optimize spacing for portrait mode */
    .game-container {
        padding: 8px;
    }
    
    .game-header {
        padding: 12px;
    }
    
    /* Taller click button area for easier thumb reach */
    .click-area {
        margin: 20px 0;
    }
    
    /* Reduce animation intensity on mobile */
    .main-click-btn {
        animation: none;
    }
    
    .main-click-btn:hover {
        transform: none;
    }
    
    .main-click-btn:active {
        transform: scale(0.95);
    }
    
    /* Disable hover effects on touch devices */
    .upgrade-card:hover,
    .generator-card:hover,
    .powerup-card:hover {
        transform: none;
    }
    
    .upgrade-card:active,
    .generator-card:active,
    .powerup-card:active {
        transform: scale(0.98);
    }
}

/* Landscape orientation on mobile */
@media (orientation: landscape) and (max-height: 500px) {
    .game-header {
        padding: 10px 15px;
        margin-bottom: 10px;
    }
    
    .game-title {
        font-size: 1.5em;
    }
    
    .header-stats {
        gap: 10px;
    }
    
    .stat-item {
        padding: 5px 10px;
        min-width: 70px;
    }
    
    .stat-value {
        font-size: 1.2em;
    }
    
    .game-content {
        grid-template-columns: 1fr 2fr;
        gap: 10px;
    }
    
    .left-panel {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    
    .main-click-btn {
        width: 150px;
        height: 150px;
    }
    
    .click-icon {
        font-size: 3em;
    }
    
    .energy-display {
        padding: 15px 10px;
        margin-bottom: 15px;
    }
    
    .energy-amount {
        font-size: 2em;
    }
    
    .milestones-section {
        display: none;
    }
    
    .tab-content {
        min-height: 300px;
    }
}

/* Celebration Effects */
@keyframes celebration {
    0%, 100% {
        transform: scale(1) rotate(0deg);
    }
    25% {
        transform: scale(1.2) rotate(-5deg);
    }
    50% {
        transform: scale(1.3) rotate(5deg);
    }
    75% {
        transform: scale(1.2) rotate(-5deg);
    }
}

.celebrate {
    animation: celebration 0.6s ease-in-out;
}

/* Loading Animation */
@keyframes loading {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid var(--border-color);
    border-top-color: var(--neon-cyan);
    border-radius: 50%;
    animation: loading 1s linear infinite;
}
    
/* ===== NEW FEATURES CSS ===== */

/* Bulk Buy Options */
.bulk-buy-controls {
    display: flex;
    gap: 8px;
    justify-content: center;
    margin: 15px 0;
    flex-wrap: wrap;
}

.bulk-buy-btn {
    padding: 8px 16px;
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 8px;
    color: var(--text-primary);
    font-family: 'Orbitron', sans-serif;
    font-size: 0.9em;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 60px;
}

.bulk-buy-btn:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
    transform: translateY(-2px);
}

.bulk-buy-btn.active {
    background: var(--gradient-main);
    border-color: var(--neon-cyan);
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
}

/* Daily Rewards */
.daily-rewards-panel {
    background: var(--bg-card);
    border: 2px solid var(--neon-magenta);
    border-radius: 15px;
    padding: 20px;
    margin: 20px 0;
    text-align: center;
    box-shadow: 0 0 30px rgba(255, 0, 255, 0.3);
}

.daily-reward-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.8em;
    color: var(--neon-magenta);
    text-shadow: 0 0 10px var(--neon-magenta);
    margin-bottom: 15px;
}

.daily-streak {
    font-size: 1.3em;
    color: var(--neon-cyan);
    margin: 10px 0;
}

.daily-reward-btn {
    padding: 15px 40px;
    font-family: 'Orbitron', sans-serif;
    font-size: 1.2em;
    background: var(--gradient-main);
    border: none;
    border-radius: 10px;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
    margin-top: 15px;
}

.daily-reward-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 30px rgba(255, 0, 255, 0.8);
}

.daily-reward-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.daily-timer {
    color: var(--text-secondary);
    font-size: 1em;
    margin-top: 10px;
}

/* Challenges/Quests */
.challenges-panel {
    background: var(--bg-card);
    border: 2px solid var(--neon-blue);
    border-radius: 15px;
    padding: 20px;
    margin: 20px 0;
}

.challenge-card {
    background: var(--bg-panel);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
    transition: all 0.3s ease;
}

.challenge-card:hover {
    border-color: var(--neon-blue);
    box-shadow: 0 0 15px rgba(0, 128, 255, 0.3);
}

.challenge-card.completed {
    border-color: var(--neon-green);
    opacity: 0.7;
}

.challenge-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.challenge-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.1em;
    color: var(--neon-blue);
}

.challenge-reward {
    color: var(--neon-yellow);
    font-weight: bold;
}

.challenge-progress {
    margin: 10px 0;
}

.progress-bar-container {
    background: var(--bg-dark);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    height: 20px;
    overflow: hidden;
    position: relative;
}

.progress-bar {
    background: var(--gradient-main);
    height: 100%;
    transition: width 0.3s ease;
    border-radius: 10px;
}

.progress-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 0.85em;
    font-weight: bold;
    color: white;
    text-shadow: 0 0 5px black;
}

.challenge-claim-btn {
    padding: 8px 20px;
    background: var(--gradient-success);
    border: none;
    border-radius: 8px;
    color: white;
    font-family: 'Orbitron', sans-serif;
    cursor: pointer;
    transition: all 0.3s ease;
}

.challenge-claim-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
}

.challenge-claim-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

/* Skill Tree */
.skill-tree-container {
    padding: 20px;
}

.skill-branches {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
}

.skill-branch {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 15px;
    padding: 20px;
}

.branch-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.5em;
    text-align: center;
    margin-bottom: 20px;
    text-shadow: 0 0 10px currentColor;
}

.branch-title.production { color: var(--neon-green); }
.branch-title.clicking { color: var(--neon-cyan); }
.branch-title.automation { color: var(--neon-magenta); }
.branch-title.special { color: var(--neon-yellow); }

.skill-node {
    background: var(--bg-panel);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 12px;
    margin: 10px 0;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.skill-node:hover:not(.locked) {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
    transform: translateX(5px);
}

.skill-node.unlocked {
    border-color: var(--neon-green);
    background: linear-gradient(135deg, var(--bg-panel) 0%, rgba(0, 255, 0, 0.1) 100%);
}

.skill-node.locked {
    opacity: 0.5;
    cursor: not-allowed;
}

.skill-name {
    font-family: 'Orbitron', sans-serif;
    font-size: 1em;
    color: var(--neon-cyan);
    margin-bottom: 5px;
}

.skill-description {
    font-size: 0.9em;
    color: var(--text-secondary);
    margin: 5px 0;
}

.skill-cost {
    color: var(--neon-yellow);
    font-weight: bold;
    margin-top: 5px;
}

.skill-points-display {
    text-align: center;
    font-size: 1.3em;
    color: var(--neon-magenta);
    margin-bottom: 20px;
    padding: 15px;
    background: var(--bg-card);
    border: 2px solid var(--neon-magenta);
    border-radius: 10px;
}

/* Collection System */
.collection-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    padding: 20px;
}

.artifact-card {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
}

.artifact-card.common { border-color: #808080; }
.artifact-card.rare { border-color: var(--neon-blue); }
.artifact-card.epic { border-color: var(--neon-magenta); }
.artifact-card.legendary { border-color: var(--neon-yellow); }

.artifact-card.unlocked {
    box-shadow: 0 0 20px currentColor;
}

.artifact-card.locked {
    opacity: 0.4;
    filter: grayscale(1);
}

.artifact-icon {
    font-size: 3em;
    margin: 10px 0;
}

.artifact-name {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.1em;
    margin: 10px 0;
}

.artifact-rarity {
    font-size: 0.9em;
    font-weight: bold;
    text-transform: uppercase;
    margin: 5px 0;
}

.artifact-bonus {
    color: var(--neon-green);
    font-size: 0.95em;
    margin-top: 10px;
}

.collection-stats {
    text-align: center;
    padding: 20px;
    background: var(--bg-card);
    border: 2px solid var(--neon-cyan);
    border-radius: 10px;
    margin: 20px 0;
}

/* Settings Panel */
.settings-grid {
    display: grid;
    gap: 15px;
    padding: 20px;
}

.setting-row {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.setting-label {
    font-size: 1.1em;
    color: var(--text-primary);
}

.setting-description {
    font-size: 0.9em;
    color: var(--text-secondary);
    margin-top: 5px;
}

.toggle-switch {
    position: relative;
    width: 60px;
    height: 30px;
    background: var(--bg-dark);
    border: 2px solid var(--border-color);
    border-radius: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.toggle-switch.active {
    background: var(--gradient-main);
    border-color: var(--neon-cyan);
}

.toggle-slider {
    position: absolute;
    top: 2px;
    left: 2px;
    width: 22px;
    height: 22px;
    background: white;
    border-radius: 50%;
    transition: all 0.3s ease;
}

.toggle-switch.active .toggle-slider {
    left: 32px;
}

/* Enhanced Stats */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    padding: 20px;
}

.stat-card {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 20px;
    text-align: center;
}

.stat-card-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.95em;
    color: var(--text-secondary);
    margin-bottom: 10px;
}

.stat-card-value {
    font-size: 2em;
    font-weight: bold;
    color: var(--neon-cyan);
    text-shadow: 0 0 10px var(--neon-cyan);
}

/* Tooltip System */
.tooltip {
    position: fixed;
    background: rgba(10, 10, 15, 0.95);
    border: 2px solid var(--neon-cyan);
    border-radius: 10px;
    padding: 15px;
    max-width: 300px;
    z-index: 10000;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease;
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
}

.tooltip.show {
    opacity: 1;
}

.tooltip-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.2em;
    color: var(--neon-cyan);
    margin-bottom: 10px;
}

.tooltip-content {
    color: var(--text-primary);
    font-size: 0.95em;
    line-height: 1.4;
}

.tooltip-stat {
    margin: 5px 0;
    display: flex;
    justify-content: space-between;
}

.tooltip-label {
    color: var(--text-secondary);
}

.tooltip-value {
    color: var(--neon-green);
    font-weight: bold;
}

/* Floating Damage Numbers */
.damage-number {
    position: fixed;
    font-family: 'Orbitron', sans-serif;
    font-weight: bold;
    font-size: 1.5em;
    pointer-events: none;
    z-index: 9999;
    animation: floatUp 1.5s ease-out forwards;
    text-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
}

@keyframes floatUp {
    0% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
    100% {
        opacity: 0;
        transform: translateY(-100px) scale(1.5);
    }
}

.damage-number.crit {
    color: var(--neon-magenta);
    font-size: 2em;
}

.damage-number.golden {
    color: #ffd700;
    font-size: 2.2em;
}

/* Automation Panel */
.automation-panel {
    background: var(--bg-card);
    border: 2px solid var(--neon-purple);
    border-radius: 15px;
    padding: 20px;
    margin: 20px 0;
}

.automation-option {
    background: var(--bg-panel);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.automation-info h4 {
    color: var(--neon-purple);
    font-family: 'Orbitron', sans-serif;
    margin-bottom: 5px;
}

.automation-info p {
    color: var(--text-secondary);
    font-size: 0.9em;
}

/* Progression Tracker */
.progression-panel {
    background: var(--bg-card);
    border: 2px solid var(--neon-green);
    border-radius: 15px;
    padding: 20px;
    margin: 20px 0;
}

.next-milestone {
    background: var(--bg-panel);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    margin: 15px 0;
}

.milestone-icon {
    font-size: 2em;
    text-align: center;
    margin-bottom: 10px;
}

.milestone-name {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.2em;
    color: var(--neon-green);
    text-align: center;
    margin-bottom: 10px;
}

.recommendations-list {
    list-style: none;
    padding: 0;
}

.recommendation-item {
    background: var(--bg-panel);
    border-left: 4px solid var(--neon-cyan);
    padding: 12px;
    margin: 10px 0;
    border-radius: 5px;
}

.recommendation-item.priority {
    border-left-color: var(--neon-yellow);
}

/* Save Slot Management */
.save-slots {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    padding: 20px;
}

.save-slot {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.save-slot:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
}

.save-slot.active {
    border-color: var(--neon-green);
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
}

.save-slot.empty {
    opacity: 0.5;
    font-style: italic;
}

.save-slot-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.save-slot-name {
    font-family: 'Orbitron', sans-serif;
    color: var(--neon-cyan);
}

.save-slot-info {
    font-size: 0.9em;
    color: var(--text-secondary);
    margin: 5px 0;
}

/* Collapsible Sections */
.collapsible-header {
    background: var(--bg-panel);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
    margin: 10px 0;
}

.collapsible-header:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
}

.collapsible-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.2em;
    color: var(--neon-cyan);
}

.collapsible-arrow {
    font-size: 1.5em;
    transition: transform 0.3s ease;
}

.collapsible-header.collapsed .collapsible-arrow {
    transform: rotate(-90deg);
}

.collapsible-content {
    max-height: 1000px;
    overflow: hidden;
    transition: max-height 0.3s ease, opacity 0.3s ease;
    opacity: 1;
}

.collapsible-content.collapsed {
    max-height: 0;
    opacity: 0;
}

/* Streak Indicators */
.streak-indicator {
    display: inline-block;
    padding: 5px 15px;
    background: var(--gradient-warning);
    border-radius: 20px;
    font-family: 'Orbitron', sans-serif;
    font-weight: bold;
    box-shadow: 0 0 15px rgba(255, 165, 0, 0.5);
    animation: streakPulse 1.5s ease-in-out infinite;
}

@keyframes streakPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

/* Level Up Animation */
@keyframes levelUp {
    0% {
        transform: scale(1) rotate(0deg);
        opacity: 1;
    }
    50% {
        transform: scale(1.5) rotate(180deg);
        opacity: 0.8;
    }
    100% {
        transform: scale(2) rotate(360deg);
        opacity: 0;
    }
}

.level-up-effect {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 5em;
    pointer-events: none;
    z-index: 10000;
    animation: levelUp 2s ease-out forwards;
}

/* Achievement Popup Enhanced */
.achievement-popup {
    position: fixed;
    top: 20px;
    right: -400px;
    width: 350px;
    background: linear-gradient(135deg, var(--bg-card) 0%, rgba(255, 0, 255, 0.2) 100%);
    border: 3px solid var(--neon-magenta);
    border-radius: 15px;
    padding: 20px;
    z-index: 10000;
    transition: right 0.5s ease;
    box-shadow: 0 0 40px rgba(255, 0, 255, 0.6);
}

.achievement-popup.show {
    right: 20px;
}

.achievement-popup-icon {
    font-size: 3em;
    text-align: center;
    margin-bottom: 10px;
    animation: bounceIn 0.5s ease;
}

@keyframes bounceIn {
    0% { transform: scale(0); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

/* Time to Afford Display */
.time-to-afford {
    font-size: 0.85em;
    color: var(--neon-yellow);
    margin-top: 5px;
    font-style: italic;
}

/* DPS Display */
.dps-display {
    text-align: center;
    padding: 15px;
    background: var(--bg-card);
    border: 2px solid var(--neon-green);
    border-radius: 10px;
    margin: 15px 0;
}

.dps-value {
    font-size: 2em;
    color: var(--neon-green);
    font-family: 'Orbitron', sans-serif;
    text-shadow: 0 0 10px var(--neon-green);
}

.dps-label {
    color: var(--text-secondary);
    font-size: 1em;
    margin-top: 5px;
}

/* Mobile Optimizations */
@media (max-width: 768px) {
    .bulk-buy-controls {
        gap: 5px;
    }
    
    .bulk-buy-btn {
        padding: 6px 12px;
        font-size: 0.8em;
        min-width: 50px;
    }
    
    .skill-branches {
        grid-template-columns: 1fr;
    }
    
    .collection-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .save-slots {
        grid-template-columns: 1fr;
    }
    
    .tooltip {
        max-width: 250px;
        font-size: 0.9em;
    }
    
    .damage-number {
        font-size: 1.2em;
    }
}

/* Touch Feedback for New Elements */
@media (hover: none) {
    .bulk-buy-btn:active,
    .skill-node:active,
    .artifact-card:active,
    .save-slot:active,
    .challenge-claim-btn:active {
        opacity: 0.8;
        transform: scale(0.98);
    }
}

</style>
</head>
<body>
    <div class="stars"></div>
    <div class="game-container">
        <!-- Header -->
        <header class="game-header">
            <div class="header-content">
                <h1 class="game-title">
                    <span class="neon-text">NEON</span> <span class="nexus-text">NEXUS</span>
                </h1>
                <div class="header-stats">
                    <div class="stat-item">
                        <span class="stat-label">LEVEL</span>
                        <span class="stat-value" id="player-level">1</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">PRESTIGE</span>
                        <span class="stat-value prestige-value" id="prestige-count">0</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Game Area -->
        <div class="game-content">
            <!-- Left Panel: Main Clicker -->
            <div class="left-panel">
                <!-- Energy Display -->
                <div class="energy-display">
                    <div class="energy-label">ENERGY CORES</div>
                    <div class="energy-amount" id="energy-amount">0</div>
                    <div class="energy-per-sec">
                        <span id="energy-per-sec">0</span> /sec
                    </div>
                </div>

                <!-- Main Click Button -->
                <div class="click-area">
                    <button class="main-click-btn" id="main-click-btn">
                        <div class="click-btn-inner">
                            <div class="click-icon"></div>
                            <div class="click-text">GENERATE</div>
                        </div>
                    </button>
                    <div class="combo-counter" id="combo-counter" style="display: none;">
                        <span class="combo-text">COMBO</span>
                        <span class="combo-value" id="combo-value">0</span>x
                    </div>
                </div>

                <!-- Multipliers Display -->
                <div class="multipliers-display">
                    <div class="multiplier-item">
                        <span class="mult-label">Click Power:</span>
                        <span class="mult-value" id="click-power">1</span>
                    </div>

                <!-- DPS Display -->
                <div class="dps-display">
                    <div class="dps-value" id="dps-value">0</div>
                    <div class="dps-label">Total DPS</div>
                </div>

                <!-- Progression Tracker -->
                <div class="progression-panel" style="margin-top: 20px;">
                    <h3 class="section-title"> NEXT GOALS</h3>
                    <div id="next-goals"></div>
                    <h4 style="margin-top: 15px; color: var(--neon-cyan);"> Recommendations</h4>
                    <ul class="recommendations-list" id="recommendations"></ul>
                </div>
                    <div class="multiplier-item">
                        <span class="mult-label">Global Mult:</span>
                        <span class="mult-value" id="global-mult">1</span>x
                    </div>
                    <div class="multiplier-item prestige-mult" id="prestige-mult-display" style="display: none;">
                        <span class="mult-label">Prestige Bonus:</span>
                        <span class="mult-value" id="prestige-mult">1</span>x
                    </div>
                </div>

                <!-- Active Power-ups -->
                <div class="active-powerups" id="active-powerups"></div>

                <!-- Milestones -->
                <div class="milestones-section">
                    <h3 class="section-title"> MILESTONES</h3>
                    <div class="milestones-list" id="milestones-list"></div>
                </div>
            </div>

            <!-- Center Panel: Tabs -->
            <div class="center-panel">
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button class="tab-btn active" data-tab="upgrades"> UPGRADES</button>
                    <button class="tab-btn" data-tab="generators"> GENERATORS</button>
                    <button class="tab-btn" data-tab="powerups"> POWER-UPS</button>
                    <button class="tab-btn" data-tab="achievements"> ACHIEVEMENTS</button>
                    <button class="tab-btn" data-tab="prestige"> PRESTIGE</button>
                
                    <button class="tab-btn" data-tab="rewards"> REWARDS</button>
                    <button class="tab-btn" data-tab="challenges"> CHALLENGES</button>
                    <button class="tab-btn" data-tab="skills"> SKILLS</button>
                    <button class="tab-btn" data-tab="collection"> COLLECTION</button>
                    <button class="tab-btn" data-tab="automation"> AUTO</button>
                    <button class="tab-btn" data-tab="settings"> SETTINGS</button></div>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Upgrades Tab -->
                    <div class="tab-pane active" id="upgrades-tab">
                        <div class="bulk-buy-controls">
                            <button class="bulk-buy-btn active" data-amount="1">x1</button>
                            <button class="bulk-buy-btn" data-amount="10">x10</button>
                            <button class="bulk-buy-btn" data-amount="25">x25</button>
                            <button class="bulk-buy-btn" data-amount="100">x100</button>
                            <button class="bulk-buy-btn" data-amount="max">MAX</button>
                        </div>
                        <div class="upgrades-grid" id="upgrades-grid"></div>
                    </div>

                    <!-- Generators Tab -->
                    <div class="tab-pane" id="generators-tab">
                        <div class="bulk-buy-controls" id="bulk-buy-generators">
                            <button class="bulk-buy-btn active" data-amount="1">x1</button>
                            <button class="bulk-buy-btn" data-amount="10">x10</button>
                            <button class="bulk-buy-btn" data-amount="25">x25</button>
                            <button class="bulk-buy-btn" data-amount="100">x100</button>
                            <button class="bulk-buy-btn" data-amount="max">MAX</button>
                        </div>
                        <div class="generators-list" id="generators-list"></div>
                    </div>

                    <!-- Power-ups Tab -->
                    <div class="tab-pane" id="powerups-tab">
                        <div class="powerups-grid" id="powerups-grid"></div>
                    </div>

                    <!-- Achievements Tab -->
                    <div class="tab-pane" id="achievements-tab">
                        <div class="achievements-filter">
                            <button class="filter-btn active" data-filter="all">All</button>
                            <button class="filter-btn" data-filter="unlocked">Unlocked</button>
                            <button class="filter-btn" data-filter="locked">Locked</button>
                        </div>
                        <div class="achievements-grid" id="achievements-grid"></div>
                    </div>

                    <!-- Prestige Tab -->
                    <div class="tab-pane" id="prestige-tab">
                        <div class="prestige-info">
                            <h2 class="prestige-title"> ASCENSION PROTOCOL</h2>
                            <p class="prestige-description">
                                Reset your progress to gain permanent bonuses and unlock new features!
                            </p>
                            <div class="prestige-stats">
                                <div class="prestige-stat">
                                    <span class="pstat-label">Current Run Energy:</span>
                                    <span class="pstat-value" id="prestige-current-energy">0</span>
                                </div>

                    <!-- Daily Rewards Tab -->
                    <div class="tab-pane" id="rewards-tab">
                        <div class="daily-rewards-panel">
                            <h2 class="daily-reward-title"> DAILY REWARDS</h2>
                            <div class="daily-streak" id="daily-streak">Current Streak: 0 days</div>
                            <div class="daily-timer" id="daily-timer"></div>
                            <button class="daily-reward-btn" id="claim-daily-btn">Claim Reward</button>
                            <div class="streak-milestones" id="streak-milestones" style="margin-top: 20px;"></div>
                        </div>
                    </div>

                    <!-- Challenges Tab -->
                    <div class="tab-pane" id="challenges-tab">
                        <div class="challenges-panel">
                            <h2 class="section-title"> ACTIVE CHALLENGES</h2>
                            <div class="challenges-filter" style="text-align: center; margin-bottom: 20px;">
                                <button class="filter-btn active" data-filter="daily">Daily</button>
                                <button class="filter-btn" data-filter="weekly">Weekly</button>
                                <button class="filter-btn" data-filter="completed">Completed</button>
                            </div>
                            <div id="challenges-list"></div>
                        </div>
                    </div>

                    <!-- Skills Tab -->
                    <div class="tab-pane" id="skills-tab">
                        <div class="skill-tree-container">
                            <div class="skill-points-display" id="skill-points">
                                Available Skill Points: <span id="skill-points-value">0</span>
                            </div>
                            <div class="skill-branches" id="skill-branches"></div>
                        </div>
                    </div>

                    <!-- Collection Tab -->
                    <div class="tab-pane" id="collection-tab">
                        <div class="collection-stats" id="collection-stats">
                            <h2 class="section-title"> ARTIFACT COLLECTION</h2>
                            <div>Collected: <span id="artifacts-collected">0</span> / <span id="artifacts-total">0</span></div>
                            <div style="margin-top: 10px;">Drop Chance: <span id="drop-chance">1%</span></div>
                        </div>
                        <div class="collection-grid" id="artifacts-grid"></div>
                    </div>

                    <!-- Automation Tab -->
                    <div class="tab-pane" id="automation-tab">
                        <div class="automation-panel">
                            <h2 class="section-title"> AUTOMATION SETTINGS</h2>
                            <div id="automation-options"></div>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div class="tab-pane" id="settings-tab">
                        <div class="settings-panel">
                            <h2 class="section-title"> GAME SETTINGS</h2>
                            <div class="settings-grid" id="settings-grid"></div>
                            
                            <h3 class="section-title" style="margin-top: 30px;"> SAVE MANAGEMENT</h3>
                            <div class="save-slots" id="save-slots"></div>
                        </div>
                    </div>
                                <div class="prestige-stat">
                                    <span class="pstat-label">Prestige Points Earned:</span>
                                    <span class="pstat-value prestige-points" id="prestige-points-gain">0</span>
                                </div>
                                <div class="prestige-stat">
                                    <span class="pstat-label">Total Prestige Points:</span>
                                    <span class="pstat-value prestige-points" id="prestige-points-total">0</span>
                                </div>
                                <div class="prestige-stat">
                                    <span class="pstat-label">Prestige Bonus:</span>
                                    <span class="pstat-value" id="prestige-bonus-display">+0%</span>
                                </div>
                            </div>
                            <button class="prestige-btn" id="prestige-btn"> ASCEND</button>
                            <div class="prestige-upgrades">
                                <h3 class="section-title">Prestige Upgrades</h3>
                                <div class="prestige-upgrades-grid" id="prestige-upgrades-grid"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Stats & Events -->
            <div class="right-panel">
                <!-- Special Event -->
                <div class="special-event" id="special-event" style="display: none;">
                    <div class="event-header">
                        <span class="event-icon"></span>
                        <span class="event-title" id="event-title">SPECIAL EVENT</span>
                    </div>
                    <div class="event-description" id="event-description"></div>
                    <div class="event-timer" id="event-timer"></div>
                    <button class="event-claim-btn" id="event-claim-btn">CLAIM</button>
                </div>

                <!-- Statistics -->
                <div class="statistics-section">
                    <h3 class="section-title"> STATISTICS</h3>
                    <div class="stats-list">
                        <div class="stat-row">
                            <span class="stat-name">Total Clicks:</span>
                            <span class="stat-number" id="total-clicks">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-name">Total Energy:</span>
                            <span class="stat-number" id="total-energy">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-name">Play Time:</span>
                            <span class="stat-number" id="play-time">0s</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-name">Highest Combo:</span>
                            <span class="stat-number" id="highest-combo">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-name">Achievements:</span>
                            <span class="stat-number"><span id="unlocked-achievements">0</span>/<span id="total-achievements">0</span></span>
                        </div>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="progress-section">
                    <h3 class="section-title"> NEXT LEVEL</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="level-progress"></div>
                        <span class="progress-text" id="level-progress-text">0%</span>
                    </div>
                </div>

                <!-- Settings -->
                <div class="settings-section">
                    <h3 class="section-title"> SETTINGS</h3>
                    <div class="settings-list">
                        <button class="setting-btn" id="save-btn"> Save Game</button>
                        <button class="setting-btn" id="load-btn"> Load Game</button>
                        <button class="setting-btn" id="export-btn"> Export</button>
                        <button class="setting-btn" id="import-btn"> Import</button>
                        <button class="setting-btn danger" id="reset-btn"> Hard Reset</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notification-container"></div>

    <!-- Particle Container -->
    <div class="particle-container" id="particle-container"></div>

    <!-- Modal for Import -->
    <div class="modal" id="import-modal" style="display: none;">
        <div class="modal-content">
            <h2>Import Save Data</h2>
            <textarea id="import-textarea" placeholder="Paste your save data here..."></textarea>
            <div class="modal-buttons">
                <button class="modal-btn" id="import-confirm-btn">Import</button>
                <button class="modal-btn cancel" id="import-cancel-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- All JavaScript embedded below -->
    
    <!-- ===== JAVASCRIPT CODE ===== -->
    
    <!-- Ripple animation style -->
    <script>
// Add ripple animation to CSS dynamically
if (!document.getElementById('ripple-style')) {
    const style = document.createElement('style');
    style.id = 'ripple-style';
    style.textContent = `
        @keyframes rippleExpand {
            from {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            to {
                transform: translate(-50%, -50%) scale(10);
                opacity: 0;
            }
        }
    `;
    document.head.appendChild(style);
}
    </script>
    
    <!-- Particle System -->
    <script>
// Particle Effects System

// Detect mobile device for performance optimization
const isMobileDevice = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent) || 
                       (navigator.maxTouchPoints && navigator.maxTouchPoints > 1);

class ParticleSystem {
    constructor() {
        this.container = document.getElementById('particle-container');
        // Reduce particle count on mobile for better performance
        this.isMobile = isMobileDevice;
        this.particleMultiplier = this.isMobile ? 0.4 : 1; // 40% particles on mobile
        
        if (this.isMobile) {
            console.log(' Particle system optimized for mobile');
        }
    }

    // Create floating text particle (for click rewards)
    createTextParticle(x, y, text, color = '#00ffff') {
        // Throttle text particles on mobile
        if (this.isMobile && Math.random() > 0.5) {
            return; // Skip 50% of text particles on mobile
        }
        
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.textContent = text;
        particle.style.left = x + 'px';
        particle.style.top = y + 'px';
        particle.style.color = color;
        particle.style.textShadow = `0 0 10px ${color}`;
        
        this.container.appendChild(particle);
        
        setTimeout(() => {
            particle.remove();
        }, 1500);
    }

    // Create burst effect (for achievements, upgrades)
    createBurst(x, y, count = 20, color = '#00ffff') {
        // Reduce burst particles on mobile
        const adjustedCount = Math.floor(count * this.particleMultiplier);
        
        for (let i = 0; i < adjustedCount; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle-effect';
            
            const angle = (Math.PI * 2 * i) / adjustedCount;
            const distance = 50 + Math.random() * 50;
            const tx = Math.cos(angle) * distance;
            const ty = Math.sin(angle) * distance;
            
            particle.style.left = x + 'px';
            particle.style.top = y + 'px';
            particle.style.background = color;
            particle.style.boxShadow = `0 0 10px ${color}`;
            particle.style.setProperty('--tx', tx + 'px');
            particle.style.setProperty('--ty', ty + 'px');
            
            this.container.appendChild(particle);
            
            setTimeout(() => {
                particle.remove();
            }, 800);
        }
    }

    // Create celebration effect (for milestones, prestige)
    createCelebration(element) {
        element.classList.add('celebrate');
        
        const rect = element.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        
        // Create multiple bursts with different colors
        const colors = ['#00ffff', '#ff00ff', '#00ff00', '#ffff00', '#0080ff'];
        // Reduce number of color bursts on mobile
        const colorsToUse = this.isMobile ? colors.slice(0, 3) : colors;
        
        colorsToUse.forEach((color, index) => {
            setTimeout(() => {
                this.createBurst(centerX, centerY, this.isMobile ? 15 : 30, color);
            }, index * 100);
        });
        
        setTimeout(() => {
            element.classList.remove('celebrate');
        }, 600);
    }

    // Create click ripple effect
    createRipple(x, y) {
        // Simplified ripple effect on mobile
        if (this.isMobile && Math.random() > 0.6) {
            return; // Skip 40% of ripples on mobile
        }
        
        const ripple = document.createElement('div');
        ripple.style.position = 'absolute';
        ripple.style.left = x + 'px';
        ripple.style.top = y + 'px';
        ripple.style.width = '10px';
        ripple.style.height = '10px';
        ripple.style.borderRadius = '50%';
        ripple.style.border = '2px solid #00ffff';
        ripple.style.pointerEvents = 'none';
        ripple.style.animation = 'rippleExpand 0.6s ease-out';
        
        this.container.appendChild(ripple);
        
        setTimeout(() => {
            ripple.remove();
        }, 600);
    }
    
    // Clean up old particles for mobile performance
    cleanup() {
        if (this.isMobile && this.container.children.length > 20) {
            // Remove oldest particles if too many exist
            while (this.container.children.length > 20) {
                this.container.firstChild.remove();
            }
        }
    }
}

const particleSystem = new ParticleSystem();
    </script>
    
    <!-- Notification System -->
    <script>
// Notification System

class NotificationSystem {
    constructor() {
        this.container = document.getElementById('notification-container');
        this.queue = [];
        this.isShowing = false;
    }

    show(title, message, type = 'info', duration = 3000) {
        this.queue.push({ title, message, type, duration });
        if (!this.isShowing) {
            this.processQueue();
        }
    }

    processQueue() {
        if (this.queue.length === 0) {
            this.isShowing = false;
            return;
        }

        this.isShowing = true;
        const { title, message, type, duration } = this.queue.shift();

        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <div class="notification-title">${title}</div>
            <div class="notification-message">${message}</div>
        `;

        this.container.appendChild(notification);

        setTimeout(() => {
            notification.style.animation = 'notificationSlide 0.3s ease reverse';
            setTimeout(() => {
                notification.remove();
                this.processQueue();
            }, 300);
        }, duration);
    }

    success(title, message, duration) {
        this.show(title, message, 'success', duration);
    }

    warning(title, message, duration) {
        this.show(title, message, 'warning', duration);
    }

    error(title, message, duration) {
        this.show(title, message, 'error', duration);
    }

    info(title, message, duration) {
        this.show(title, message, 'info', duration);
    }
}

const notifications = new NotificationSystem();
    </script>
    
    <!-- Upgrades System -->
    <script>
// Upgrades System

class UpgradesManager {
    constructor() {
        this.upgrades = [
            {
                id: 'click_power_1',
                name: 'Neural Amplifier',
                icon: '',
                description: 'Enhance your neural pathways for more powerful clicks',
                effect: 'Click power +1',
                baseCost: 10,
                costMultiplier: 1.15,
                currentLevel: 0,
                maxLevel: 100,
                apply: (game) => {
                    game.clickPower += 1;
                }
            },
            {
                id: 'click_power_2',
                name: 'Quantum Processor',
                icon: '',
                description: 'Quantum computing for exponential click gains',
                effect: 'Click power +5',
                baseCost: 100,
                costMultiplier: 1.2,
                currentLevel: 0,
                maxLevel: 50,
                unlockCondition: (game) => game.stats.totalClicks >= 100,
                apply: (game) => {
                    game.clickPower += 5;
                }
            },
            {
                id: 'click_power_3',
                name: 'Cyber Implant',
                icon: '',
                description: 'Cybernetic enhancement for superhuman clicking',
                effect: 'Click power +25',
                baseCost: 1000,
                costMultiplier: 1.25,
                currentLevel: 0,
                maxLevel: 25,
                unlockCondition: (game) => game.stats.totalClicks >= 500,
                apply: (game) => {
                    game.clickPower += 25;
                }
            },
            {
                id: 'global_mult_1',
                name: 'Energy Catalyst',
                icon: '',
                description: 'Catalyze all energy production',
                effect: 'Global multiplier +10%',
                baseCost: 500,
                costMultiplier: 1.5,
                currentLevel: 0,
                maxLevel: 20,
                unlockCondition: (game) => game.energy >= 200,
                apply: (game) => {
                    game.globalMultiplier += 0.1;
                }
            },
            {
                id: 'global_mult_2',
                name: 'Fusion Reactor',
                icon: '',
                description: 'Nuclear fusion for massive power gains',
                effect: 'Global multiplier +25%',
                baseCost: 5000,
                costMultiplier: 1.75,
                currentLevel: 0,
                maxLevel: 10,
                unlockCondition: (game) => game.energy >= 2000,
                apply: (game) => {
                    game.globalMultiplier += 0.25;
                }
            },
            {
                id: 'combo_duration',
                name: 'Time Dilation',
                icon: '',
                description: 'Slow down time to maintain combos longer',
                effect: 'Combo window +1s',
                baseCost: 250,
                costMultiplier: 1.4,
                currentLevel: 0,
                maxLevel: 15,
                unlockCondition: (game) => game.stats.highestCombo >= 5,
                apply: (game) => {
                    game.comboWindow += 1000;
                }
            },
            {
                id: 'combo_power',
                name: 'Synergy Matrix',
                icon: '',
                description: 'Increase the power of combo multipliers',
                effect: 'Combo bonus +5%',
                baseCost: 750,
                costMultiplier: 1.6,
                currentLevel: 0,
                maxLevel: 20,
                unlockCondition: (game) => game.stats.highestCombo >= 10,
                apply: (game) => {
                    game.comboBonus += 0.05;
                }
            },
            {
                id: 'auto_click',
                name: 'Auto-Clicker Module',
                icon: '',
                description: 'Automated clicking system',
                effect: '1 auto-click per second',
                baseCost: 2000,
                costMultiplier: 2,
                currentLevel: 0,
                maxLevel: 10,
                unlockCondition: (game) => game.energy >= 1000,
                apply: (game) => {
                    game.autoClickersPerSecond += 1;
                }
            },
            {
                id: 'crit_chance',
                name: 'Lucky Strike',
                icon: '',
                description: 'Chance to deal critical clicks',
                effect: '+5% crit chance',
                baseCost: 1500,
                costMultiplier: 1.8,
                currentLevel: 0,
                maxLevel: 10,
                unlockCondition: (game) => game.stats.totalClicks >= 1000,
                apply: (game) => {
                    game.critChance += 0.05;
                }
            },
            {
                id: 'crit_power',
                name: 'Overcharge',
                icon: '',
                description: 'Increase critical click damage',
                effect: 'Crits deal +50% damage',
                baseCost: 3000,
                costMultiplier: 2.5,
                currentLevel: 0,
                maxLevel: 5,
                unlockCondition: (game) => game.critChance >= 0.05,
                apply: (game) => {
                    game.critMultiplier += 0.5;
                }
            }
        ];
    }

    getUpgrade(id) {
        return this.upgrades.find(u => u.id === id);
    }

    getCost(upgrade) {
        return Math.floor(upgrade.baseCost * Math.pow(upgrade.costMultiplier, upgrade.currentLevel));
    }

    canAfford(upgrade, energy) {
        return energy >= this.getCost(upgrade);
    }

    isUnlocked(upgrade, game) {
        if (!upgrade.unlockCondition) return true;
        return upgrade.unlockCondition(game);
    }

    isMaxed(upgrade) {
        return upgrade.currentLevel >= upgrade.maxLevel;
    }

    purchase(upgrade, game) {
        if (this.isMaxed(upgrade)) return false;
        if (!this.canAfford(upgrade, game.energy)) return false;
        if (!this.isUnlocked(upgrade, game)) return false;

        const cost = this.getCost(upgrade);
        game.energy -= cost;
        upgrade.currentLevel++;
        upgrade.apply(game);

        // Create burst effect
        const upgradeCard = document.querySelector(`[data-upgrade-id="${upgrade.id}"]`);
        if (upgradeCard) {
            const rect = upgradeCard.getBoundingClientRect();
            particleSystem.createBurst(
                rect.left + rect.width / 2,
                rect.top + rect.height / 2,
                15,
                '#00ffff'
            );
        }

        notifications.success(
            ' Upgrade Purchased!',
            `${upgrade.name} Level ${upgrade.currentLevel}`
        );

        return true;
    }

    reset() {
        this.upgrades.forEach(upgrade => {
            upgrade.currentLevel = 0;
        });
    }

    getSaveData() {
        const data = {};
        this.upgrades.forEach(upgrade => {
            data[upgrade.id] = upgrade.currentLevel;
        });
        return data;
    }

    loadSaveData(data) {
        if (!data) return;
        Object.keys(data).forEach(id => {
            const upgrade = this.getUpgrade(id);
            if (upgrade) {
                upgrade.currentLevel = data[id];
            }
        });
    }
}

const upgradesManager = new UpgradesManager();
    </script>
    
    <!-- Generators System -->
    <script>
// Generators (Passive Income) System

class GeneratorsManager {
    constructor() {
        this.generators = [
            {
                id: 'gen_1',
                name: 'Nano Bot',
                icon: '',
                description: 'Tiny robots that generate energy automatically',
                baseProduction: 0.1,
                baseCost: 15,
                costMultiplier: 1.15,
                count: 0,
                unlockCost: 0
            },
            {
                id: 'gen_2',
                name: 'Solar Panel',
                icon: '',
                description: 'Harness the power of stars',
                baseProduction: 1,
                baseCost: 100,
                costMultiplier: 1.15,
                count: 0,
                unlockCost: 50
            },
            {
                id: 'gen_3',
                name: 'Quantum Core',
                icon: '',
                description: 'Quantum entanglement for infinite energy',
                baseProduction: 8,
                baseCost: 1100,
                costMultiplier: 1.15,
                count: 0,
                unlockCost: 500
            },
            {
                id: 'gen_4',
                name: 'Fusion Plant',
                icon: '',
                description: 'Nuclear fusion power station',
                baseProduction: 47,
                baseCost: 12000,
                costMultiplier: 1.15,
                count: 0,
                unlockCost: 5000
            },
            {
                id: 'gen_5',
                name: 'Antimatter Reactor',
                icon: '',
                description: 'Harness the power of antimatter',
                baseProduction: 260,
                baseCost: 130000,
                costMultiplier: 1.15,
                count: 0,
                unlockCost: 50000
            },
            {
                id: 'gen_6',
                name: 'Dark Energy Collector',
                icon: '',
                description: 'Tap into the mysterious dark energy of the universe',
                baseProduction: 1400,
                baseCost: 1400000,
                costMultiplier: 1.15,
                count: 0,
                unlockCost: 500000
            },
            {
                id: 'gen_7',
                name: 'Time Singularity',
                icon: '',
                description: 'Generate energy from time itself',
                baseProduction: 7800,
                baseCost: 20000000,
                costMultiplier: 1.15,
                count: 0,
                unlockCost: 5000000
            },
            {
                id: 'gen_8',
                name: 'Reality Engine',
                icon: '',
                description: 'Rewrite reality to generate infinite power',
                baseProduction: 44000,
                baseCost: 330000000,
                costMultiplier: 1.15,
                count: 0,
                unlockCost: 50000000
            },
            {
                id: 'gen_9',
                name: 'Dimension Gateway',
                icon: '',
                description: 'Draw energy from parallel dimensions',
                baseProduction: 260000,
                baseCost: 5100000000,
                costMultiplier: 1.15,
                count: 0,
                unlockCost: 500000000
            },
            {
                id: 'gen_10',
                name: 'Universal Nexus',
                icon: '',
                description: 'The ultimate energy source from the fabric of existence',
                baseProduction: 1600000,
                baseCost: 75000000000,
                costMultiplier: 1.15,
                count: 0,
                unlockCost: 5000000000
            }
        ];
    }

    getGenerator(id) {
        return this.generators.find(g => g.id === id);
    }

    getCost(generator) {
        return Math.floor(generator.baseCost * Math.pow(generator.costMultiplier, generator.count));
    }

    getProduction(generator, game) {
        if (generator.count === 0) return 0;
        
        let production = generator.baseProduction * generator.count;
        
        // Apply generator-specific multipliers from achievements
        // Apply global multiplier
        production *= game.globalMultiplier;
        
        // Apply prestige multiplier
        production *= game.prestigeMultiplier;
        
        return production;
    }

    getTotalProduction(game) {
        return this.generators.reduce((total, gen) => {
            return total + this.getProduction(gen, game);
        }, 0);
    }

    canAfford(generator, energy) {
        return energy >= this.getCost(generator);
    }

    isUnlocked(generator, totalEnergy) {
        return totalEnergy >= generator.unlockCost;
    }

    purchase(generator, game) {
        if (!this.canAfford(generator, game.energy)) return false;
        if (!this.isUnlocked(generator, game.stats.totalEnergy)) return false;

        const cost = this.getCost(generator);
        game.energy -= cost;
        generator.count++;

        // Create burst effect
        const genCard = document.querySelector(`[data-generator-id="${generator.id}"]`);
        if (genCard) {
            const rect = genCard.getBoundingClientRect();
            particleSystem.createBurst(
                rect.left + rect.width / 2,
                rect.top + rect.height / 2,
                15,
                '#0080ff'
            );
        }

        notifications.success(
            ' Generator Purchased!',
            `${generator.name} x${generator.count}`
        );

        return true;
    }

    reset() {
        this.generators.forEach(gen => {
            gen.count = 0;
        });
    }

    getSaveData() {
        const data = {};
        this.generators.forEach(gen => {
            data[gen.id] = gen.count;
        });
        return data;
    }

    loadSaveData(data) {
        if (!data) return;
        Object.keys(data).forEach(id => {
            const gen = this.getGenerator(id);
            if (gen) {
                gen.count = data[id];
            }
        });
    }
}

const generatorsManager = new GeneratorsManager();
    </script>
    
    <!-- Achievements System -->
    <script>
// Achievements System

class AchievementsManager {
    constructor() {
        this.achievements = [
            // Click-based achievements
            {
                id: 'first_click',
                name: 'First Contact',
                icon: '',
                description: 'Make your first click',
                tier: 'bronze',
                reward: 'Click power +1',
                condition: (game) => game.stats.totalClicks >= 1,
                unlocked: false,
                apply: (game) => { game.clickPower += 1; }
            },
            {
                id: 'clicks_100',
                name: 'Clicker Novice',
                icon: '',
                description: 'Make 100 clicks',
                tier: 'bronze',
                reward: 'Global mult +5%',
                condition: (game) => game.stats.totalClicks >= 100,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.05; }
            },
            {
                id: 'clicks_1000',
                name: 'Clicker Adept',
                icon: '',
                description: 'Make 1,000 clicks',
                tier: 'silver',
                reward: 'Global mult +10%',
                condition: (game) => game.stats.totalClicks >= 1000,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.1; }
            },
            {
                id: 'clicks_10000',
                name: 'Clicker Master',
                icon: '',
                description: 'Make 10,000 clicks',
                tier: 'gold',
                reward: 'Global mult +20%',
                condition: (game) => game.stats.totalClicks >= 10000,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.2; }
            },
            {
                id: 'clicks_100000',
                name: 'Click God',
                icon: '',
                description: 'Make 100,000 clicks',
                tier: 'platinum',
                reward: 'Global mult +50%',
                condition: (game) => game.stats.totalClicks >= 100000,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.5; }
            },
            
            // Energy-based achievements
            {
                id: 'energy_100',
                name: 'Energy Collector',
                icon: '',
                description: 'Collect 100 total energy',
                tier: 'bronze',
                reward: 'Click power +2',
                condition: (game) => game.stats.totalEnergy >= 100,
                unlocked: false,
                apply: (game) => { game.clickPower += 2; }
            },
            {
                id: 'energy_10000',
                name: 'Power Plant',
                icon: '',
                description: 'Collect 10,000 total energy',
                tier: 'silver',
                reward: 'Global mult +15%',
                condition: (game) => game.stats.totalEnergy >= 10000,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.15; }
            },
            {
                id: 'energy_1000000',
                name: 'Energy Tycoon',
                icon: '',
                description: 'Collect 1,000,000 total energy',
                tier: 'gold',
                reward: 'Global mult +30%',
                condition: (game) => game.stats.totalEnergy >= 1000000,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.3; }
            },
            {
                id: 'energy_billion',
                name: 'Energy Magnate',
                icon: '',
                description: 'Collect 1 billion total energy',
                tier: 'platinum',
                reward: 'Global mult +100%',
                condition: (game) => game.stats.totalEnergy >= 1000000000,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 1; }
            },
            
            // Combo-based achievements
            {
                id: 'combo_10',
                name: 'Combo Starter',
                icon: '',
                description: 'Reach a 10x combo',
                tier: 'bronze',
                reward: 'Combo bonus +10%',
                condition: (game) => game.stats.highestCombo >= 10,
                unlocked: false,
                apply: (game) => { game.comboBonus += 0.1; }
            },
            {
                id: 'combo_50',
                name: 'Combo Expert',
                icon: '',
                description: 'Reach a 50x combo',
                tier: 'silver',
                reward: 'Combo bonus +25%',
                condition: (game) => game.stats.highestCombo >= 50,
                unlocked: false,
                apply: (game) => { game.comboBonus += 0.25; }
            },
            {
                id: 'combo_100',
                name: 'Combo Master',
                icon: '',
                description: 'Reach a 100x combo',
                tier: 'gold',
                reward: 'Combo bonus +50%',
                condition: (game) => game.stats.highestCombo >= 100,
                unlocked: false,
                apply: (game) => { game.comboBonus += 0.5; }
            },
            
            // Generator-based achievements
            {
                id: 'first_generator',
                name: 'Automation Begins',
                icon: '',
                description: 'Purchase your first generator',
                tier: 'bronze',
                reward: 'Generator output +10%',
                condition: (game) => {
                    return generatorsManager.generators.some(g => g.count > 0);
                },
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.1; }
            },
            {
                id: 'ten_generators',
                name: 'Factory Owner',
                icon: '',
                description: 'Own 10 total generators',
                tier: 'silver',
                reward: 'Generator output +25%',
                condition: (game) => {
                    const total = generatorsManager.generators.reduce((sum, g) => sum + g.count, 0);
                    return total >= 10;
                },
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.25; }
            },
            {
                id: 'hundred_generators',
                name: 'Industrial Complex',
                icon: '',
                description: 'Own 100 total generators',
                tier: 'gold',
                reward: 'Generator output +50%',
                condition: (game) => {
                    const total = generatorsManager.generators.reduce((sum, g) => sum + g.count, 0);
                    return total >= 100;
                },
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.5; }
            },
            
            // Prestige-based achievements
            {
                id: 'first_prestige',
                name: 'Ascension',
                icon: '',
                description: 'Prestige for the first time',
                tier: 'gold',
                reward: 'Prestige gain +10%',
                condition: (game) => game.prestigeCount >= 1,
                unlocked: false,
                apply: (game) => { game.prestigePointsBonus += 0.1; }
            },
            {
                id: 'prestige_10',
                name: 'Eternal Cycle',
                icon: '',
                description: 'Prestige 10 times',
                tier: 'platinum',
                reward: 'Prestige gain +25%',
                condition: (game) => game.prestigeCount >= 10,
                unlocked: false,
                apply: (game) => { game.prestigePointsBonus += 0.25; }
            },
            {
                id: 'prestige_50',
                name: 'Transcendent',
                icon: '',
                description: 'Prestige 50 times',
                tier: 'diamond',
                reward: 'Prestige gain +50%',
                condition: (game) => game.prestigeCount >= 50,
                unlocked: false,
                apply: (game) => { game.prestigePointsBonus += 0.5; }
            },
            
            // Time-based achievements
            {
                id: 'play_1hour',
                name: 'Dedicated',
                icon: '',
                description: 'Play for 1 hour',
                tier: 'bronze',
                reward: 'Global mult +10%',
                condition: (game) => game.stats.playTime >= 3600,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.1; }
            },
            {
                id: 'play_10hours',
                name: 'Committed',
                icon: '',
                description: 'Play for 10 hours',
                tier: 'silver',
                reward: 'Global mult +25%',
                condition: (game) => game.stats.playTime >= 36000,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 0.25; }
            },
            {
                id: 'play_100hours',
                name: 'Obsessed',
                icon: '',
                description: 'Play for 100 hours',
                tier: 'gold',
                reward: 'Global mult +100%',
                condition: (game) => game.stats.playTime >= 360000,
                unlocked: false,
                apply: (game) => { game.globalMultiplier += 1; }
            },
            
            // Special achievements
            {
                id: 'crit_master',
                name: 'Critical Thinker',
                icon: '',
                description: 'Land 100 critical clicks',
                tier: 'silver',
                reward: 'Crit chance +5%',
                condition: (game) => game.stats.criticalClicks >= 100,
                unlocked: false,
                apply: (game) => { game.critChance += 0.05; }
            },
            {
                id: 'powerup_user',
                name: 'Power User',
                icon: '',
                description: 'Use 50 power-ups',
                tier: 'silver',
                reward: 'Power-up duration +10%',
                condition: (game) => game.stats.powerupsUsed >= 50,
                unlocked: false,
                apply: (game) => { game.powerupDurationBonus += 0.1; }
            },
            {
                id: 'event_hunter',
                name: 'Event Hunter',
                icon: '',
                description: 'Complete 25 special events',
                tier: 'gold',
                reward: 'Event spawn rate +25%',
                condition: (game) => game.stats.eventsCompleted >= 25,
                unlocked: false,
                apply: (game) => { game.eventSpawnBonus += 0.25; }
            }
        ];
    }

    check(game) {
        let newUnlocks = [];
        
        this.achievements.forEach(achievement => {
            if (!achievement.unlocked && achievement.condition(game)) {
                achievement.unlocked = true;
                achievement.apply(game);
                newUnlocks.push(achievement);
                
                // Show notification and celebration
                notifications.success(
                    ` Achievement Unlocked!`,
                    `${achievement.name} - ${achievement.reward}`,
                    4000
                );
                
                // Create celebration effect
                const achievementCard = document.querySelector(`[data-achievement-id="${achievement.id}"]`);
                if (achievementCard) {
                    particleSystem.createCelebration(achievementCard);
                }
            }
        });
        
        return newUnlocks;
    }

    getUnlockedCount() {
        return this.achievements.filter(a => a.unlocked).length;
    }

    getTotalCount() {
        return this.achievements.length;
    }

    getProgress(achievement, game) {
        // This is a simplified version - you'd need to track individual progress
        return achievement.unlocked ? 100 : 0;
    }

    reset(keepPrestige = false) {
        this.achievements.forEach(achievement => {
            // Keep prestige achievements if specified
            if (keepPrestige && achievement.id.startsWith('prestige_')) {
                return;
            }
            achievement.unlocked = false;
        });
    }

    getSaveData() {
        const data = {};
        this.achievements.forEach(achievement => {
            data[achievement.id] = achievement.unlocked;
        });
        return data;
    }

    loadSaveData(data) {
        if (!data) return;
        Object.keys(data).forEach(id => {
            const achievement = this.achievements.find(a => a.id === id);
            if (achievement) {
                achievement.unlocked = data[id];
            }
        });
    }
}

const achievementsManager = new AchievementsManager();
    </script>
    
    <!-- Prestige System -->
    <script>
// Prestige System

class PrestigeManager {
    constructor() {
        this.prestigeUpgrades = [
            {
                id: 'prestige_mult_1',
                name: 'Nexus Conduit',
                icon: '',
                description: 'Increase prestige multiplier effectiveness',
                effect: '+10% prestige bonus per level',
                baseCost: 1,
                costMultiplier: 2,
                currentLevel: 0,
                maxLevel: 20,
                apply: (game) => {
                    game.prestigeBonus += 0.1;
                }
            },
            {
                id: 'prestige_gain_1',
                name: 'Ascension Catalyst',
                icon: '',
                description: 'Gain more prestige points per ascension',
                effect: '+25% prestige points gained',
                baseCost: 2,
                costMultiplier: 2.5,
                currentLevel: 0,
                maxLevel: 10,
                apply: (game) => {
                    game.prestigePointsBonus += 0.25;
                }
            },
            {
                id: 'starting_energy',
                name: 'Residual Energy',
                icon: '',
                description: 'Start each run with bonus energy',
                effect: 'Start with +100 energy per level',
                baseCost: 3,
                costMultiplier: 2,
                currentLevel: 0,
                maxLevel: 15,
                apply: (game) => {
                    game.startingEnergy += 100;
                }
            },
            {
                id: 'starting_multiplier',
                name: 'Quantum Resonance',
                icon: '',
                description: 'Start with increased global multiplier',
                effect: '+50% global mult per level',
                baseCost: 5,
                costMultiplier: 3,
                currentLevel: 0,
                maxLevel: 10,
                apply: (game) => {
                    game.startingMultiplier += 0.5;
                }
            },
            {
                id: 'auto_buy_generators',
                name: 'Auto-Purchase Protocol',
                icon: '',
                description: 'Automatically purchase generators',
                effect: 'Unlock auto-buy for generators',
                baseCost: 10,
                costMultiplier: 1,
                currentLevel: 0,
                maxLevel: 1,
                apply: (game) => {
                    game.autoBuyGenerators = true;
                }
            },
            {
                id: 'offline_progress',
                name: 'Temporal Cache',
                icon: '',
                description: 'Earn energy while offline',
                effect: '+10% offline production per level',
                baseCost: 8,
                costMultiplier: 2.5,
                currentLevel: 0,
                maxLevel: 10,
                apply: (game) => {
                    game.offlineProductionRate += 0.1;
                }
            },
            {
                id: 'crit_start',
                name: 'Lucky Charm',
                icon: '',
                description: 'Start with increased crit chance',
                effect: '+5% crit chance per level',
                baseCost: 6,
                costMultiplier: 2.5,
                currentLevel: 0,
                maxLevel: 5,
                apply: (game) => {
                    game.startingCritChance += 0.05;
                }
            },
            {
                id: 'powerup_discount',
                name: 'Power Efficiency',
                icon: '',
                description: 'Reduce power-up costs',
                effect: '-10% power-up cost per level',
                baseCost: 7,
                costMultiplier: 2,
                currentLevel: 0,
                maxLevel: 5,
                apply: (game) => {
                    game.powerupCostReduction += 0.1;
                }
            },
            {
                id: 'event_frequency',
                name: 'Event Magnet',
                icon: '',
                description: 'Increase special event frequency',
                effect: '+25% event spawn rate per level',
                baseCost: 5,
                costMultiplier: 2.5,
                currentLevel: 0,
                maxLevel: 8,
                apply: (game) => {
                    game.eventSpawnBonus += 0.25;
                }
            },
            {
                id: 'combo_keeper',
                name: 'Combo Preservation',
                icon: '',
                description: 'Combo window lasts longer',
                effect: '+1s combo window per level',
                baseCost: 4,
                costMultiplier: 2,
                currentLevel: 0,
                maxLevel: 10,
                apply: (game) => {
                    game.comboWindowBonus += 1000;
                }
            }
        ];
    }

    calculatePrestigePoints(totalEnergy) {
        // Formula: sqrt(totalEnergy / 1000)
        if (totalEnergy < 1000) return 0;
        return Math.floor(Math.sqrt(totalEnergy / 1000));
    }

    calculatePrestigeMultiplier(prestigePoints) {
        // 1% bonus per prestige point
        return 1 + (prestigePoints * 0.01);
    }

    canPrestige(game) {
        return this.calculatePrestigePoints(game.stats.totalEnergy) > 0;
    }

    getPrestigeGain(game) {
        const baseGain = this.calculatePrestigePoints(game.stats.totalEnergy);
        const bonus = game.prestigePointsBonus || 0;
        return Math.floor(baseGain * (1 + bonus));
    }

    performPrestige(game) {
        if (!this.canPrestige(game)) return false;

        const pointsGained = this.getPrestigeGain(game);
        
        // Save prestige stats
        const oldPrestigeCount = game.prestigeCount;
        const oldPrestigePoints = game.prestigePoints;
        
        // Reset game but keep prestige data
        game.prestigePoints += pointsGained;
        game.prestigeCount++;
        
        // Calculate new prestige multiplier
        game.prestigeMultiplier = this.calculatePrestigeMultiplier(game.prestigePoints);
        
        // Reset all non-prestige systems
        game.energy = game.startingEnergy || 0;
        game.clickPower = 1;
        game.globalMultiplier = 1 + (game.startingMultiplier || 0);
        game.comboCount = 0;
        game.comboWindow = 2000 + (game.comboWindowBonus || 0);
        game.comboBonus = 0;
        game.critChance = game.startingCritChance || 0;
        game.critMultiplier = 2;
        game.autoClickersPerSecond = 0;
        game.level = 1;
        
        // Reset stats (keep prestige-related ones)
        game.stats.totalClicks = 0;
        game.stats.totalEnergy = 0;
        game.stats.highestCombo = 0;
        game.stats.criticalClicks = 0;
        
        // Reset managers
        upgradesManager.reset();
        generatorsManager.reset();
        achievementsManager.reset(true); // Keep prestige achievements
        powerupsManager.reset();
        milestonesManager.reset();
        
        // Show notification
        notifications.success(
            ' ASCENSION COMPLETE!',
            `+${pointsGained} Prestige Points! Total: ${game.prestigePoints}`,
            5000
        );
        
        // Create massive celebration
        const prestigeBtn = document.getElementById('prestige-btn');
        if (prestigeBtn) {
            particleSystem.createCelebration(prestigeBtn);
        }
        
        return true;
    }

    getCost(upgrade) {
        return Math.floor(upgrade.baseCost * Math.pow(upgrade.costMultiplier, upgrade.currentLevel));
    }

    canAfford(upgrade, prestigePoints) {
        return prestigePoints >= this.getCost(upgrade);
    }

    isMaxed(upgrade) {
        return upgrade.currentLevel >= upgrade.maxLevel;
    }

    purchase(upgrade, game) {
        if (this.isMaxed(upgrade)) return false;
        if (!this.canAfford(upgrade, game.prestigePoints)) return false;

        const cost = this.getCost(upgrade);
        game.prestigePoints -= cost;
        upgrade.currentLevel++;
        upgrade.apply(game);

        // Create burst effect
        const upgradeCard = document.querySelector(`[data-prestige-upgrade-id="${upgrade.id}"]`);
        if (upgradeCard) {
            const rect = upgradeCard.getBoundingClientRect();
            particleSystem.createBurst(
                rect.left + rect.width / 2,
                rect.top + rect.height / 2,
                20,
                '#ff00ff'
            );
        }

        notifications.success(
            ' Prestige Upgrade!',
            `${upgrade.name} Level ${upgrade.currentLevel}`
        );

        return true;
    }

    getSaveData() {
        const data = {};
        this.prestigeUpgrades.forEach(upgrade => {
            data[upgrade.id] = upgrade.currentLevel;
        });
        return data;
    }

    loadSaveData(data) {
        if (!data) return;
        Object.keys(data).forEach(id => {
            const upgrade = this.prestigeUpgrades.find(u => u.id === id);
            if (upgrade) {
                upgrade.currentLevel = data[id];
            }
        });
    }
}

const prestigeManager = new PrestigeManager();
    </script>
    
    <!-- Powerups System -->
    <script>
// Power-ups System

class PowerupsManager {
    constructor() {
        this.powerups = [
            {
                id: 'double_click',
                name: 'Double Power',
                icon: '2',
                description: 'Double your click power',
                duration: 30,
                cooldown: 60,
                cost: 100,
                active: false,
                remaining: 0,
                cooldownRemaining: 0,
                activate: (game) => {
                    game.clickPowerMultiplier = (game.clickPowerMultiplier || 1) * 2;
                },
                deactivate: (game) => {
                    game.clickPowerMultiplier = (game.clickPowerMultiplier || 2) / 2;
                }
            },
            {
                id: 'triple_production',
                name: 'Production Surge',
                icon: '3',
                description: 'Triple all energy production',
                duration: 45,
                cooldown: 90,
                cost: 250,
                active: false,
                remaining: 0,
                cooldownRemaining: 0,
                activate: (game) => {
                    game.productionMultiplier = (game.productionMultiplier || 1) * 3;
                },
                deactivate: (game) => {
                    game.productionMultiplier = (game.productionMultiplier || 3) / 3;
                }
            },
            {
                id: 'combo_freeze',
                name: 'Frozen Time',
                icon: '',
                description: 'Combo never expires',
                duration: 60,
                cooldown: 120,
                cost: 500,
                active: false,
                remaining: 0,
                cooldownRemaining: 0,
                activate: (game) => {
                    game.comboFrozen = true;
                },
                deactivate: (game) => {
                    game.comboFrozen = false;
                }
            },
            {
                id: 'guaranteed_crit',
                name: 'Critical Strike',
                icon: '',
                description: '100% critical hit chance',
                duration: 20,
                cooldown: 120,
                cost: 300,
                active: false,
                remaining: 0,
                cooldownRemaining: 0,
                activate: (game) => {
                    game.guaranteedCrit = true;
                },
                deactivate: (game) => {
                    game.guaranteedCrit = false;
                }
            },
            {
                id: 'mega_multiplier',
                name: 'Mega Boost',
                icon: '',
                description: '10x global multiplier',
                duration: 15,
                cooldown: 180,
                cost: 1000,
                active: false,
                remaining: 0,
                cooldownRemaining: 0,
                activate: (game) => {
                    game.globalMultiplier *= 10;
                },
                deactivate: (game) => {
                    game.globalMultiplier /= 10;
                }
            },
            {
                id: 'golden_touch',
                name: 'Golden Touch',
                icon: '',
                description: 'Gain 5x energy from all sources',
                duration: 30,
                cooldown: 150,
                cost: 750,
                active: false,
                remaining: 0,
                cooldownRemaining: 0,
                activate: (game) => {
                    game.energyGainMultiplier = (game.energyGainMultiplier || 1) * 5;
                },
                deactivate: (game) => {
                    game.energyGainMultiplier = (game.energyGainMultiplier || 5) / 5;
                }
            },
            {
                id: 'auto_clicker_boost',
                name: 'Turbo Clicker',
                icon: '',
                description: 'Auto-clickers work 10x faster',
                duration: 40,
                cooldown: 100,
                cost: 600,
                active: false,
                remaining: 0,
                cooldownRemaining: 0,
                activate: (game) => {
                    game.autoClickerMultiplier = (game.autoClickerMultiplier || 1) * 10;
                },
                deactivate: (game) => {
                    game.autoClickerMultiplier = (game.autoClickerMultiplier || 10) / 10;
                }
            },
            {
                id: 'discount',
                name: 'Sale Event',
                icon: '',
                description: 'All purchases cost 50% less',
                duration: 60,
                cooldown: 180,
                cost: 500,
                active: false,
                remaining: 0,
                cooldownRemaining: 0,
                activate: (game) => {
                    game.costReduction = 0.5;
                },
                deactivate: (game) => {
                    game.costReduction = 0;
                }
            }
        ];
    }

    getCost(powerup, game) {
        const reduction = game.powerupCostReduction || 0;
        return Math.floor(powerup.cost * (1 - reduction));
    }

    getDuration(powerup, game) {
        const bonus = game.powerupDurationBonus || 0;
        return Math.floor(powerup.duration * (1 + bonus));
    }

    canUse(powerup, game) {
        return !powerup.active && 
               powerup.cooldownRemaining === 0 && 
               game.energy >= this.getCost(powerup, game);
    }

    activate(powerup, game) {
        if (!this.canUse(powerup, game)) return false;

        const cost = this.getCost(powerup, game);
        game.energy -= cost;

        powerup.active = true;
        powerup.remaining = this.getDuration(powerup, game);
        powerup.activate(game);

        game.stats.powerupsUsed = (game.stats.powerupsUsed || 0) + 1;

        // Create burst effect
        const powerupCard = document.querySelector(`[data-powerup-id="${powerup.id}"]`);
        if (powerupCard) {
            const rect = powerupCard.getBoundingClientRect();
            particleSystem.createBurst(
                rect.left + rect.width / 2,
                rect.top + rect.height / 2,
                25,
                '#ffff00'
            );
        }

        notifications.success(
            ' Power-up Activated!',
            `${powerup.name} for ${powerup.remaining}s`
        );

        return true;
    }

    update(deltaTime, game) {
        this.powerups.forEach(powerup => {
            if (powerup.active) {
                powerup.remaining -= deltaTime;
                if (powerup.remaining <= 0) {
                    powerup.active = false;
                    powerup.remaining = 0;
                    powerup.cooldownRemaining = powerup.cooldown;
                    powerup.deactivate(game);
                    
                    notifications.info(
                        ' Power-up Expired',
                        `${powerup.name} has worn off`
                    );
                }
            } else if (powerup.cooldownRemaining > 0) {
                powerup.cooldownRemaining -= deltaTime;
                if (powerup.cooldownRemaining < 0) {
                    powerup.cooldownRemaining = 0;
                }
            }
        });
    }

    getActivePowerups() {
        return this.powerups.filter(p => p.active);
    }

    reset() {
        this.powerups.forEach(powerup => {
            if (powerup.active) {
                powerup.deactivate({ 
                    clickPowerMultiplier: 1,
                    productionMultiplier: 1,
                    globalMultiplier: 1,
                    energyGainMultiplier: 1,
                    autoClickerMultiplier: 1
                });
            }
            powerup.active = false;
            powerup.remaining = 0;
            powerup.cooldownRemaining = 0;
        });
    }

    getSaveData() {
        const data = {};
        this.powerups.forEach(powerup => {
            data[powerup.id] = {
                active: powerup.active,
                remaining: powerup.remaining,
                cooldownRemaining: powerup.cooldownRemaining
            };
        });
        return data;
    }

    loadSaveData(data) {
        if (!data) return;
        Object.keys(data).forEach(id => {
            const powerup = this.powerups.find(p => p.id === id);
            if (powerup && data[id]) {
                powerup.active = data[id].active || false;
                powerup.remaining = data[id].remaining || 0;
                powerup.cooldownRemaining = data[id].cooldownRemaining || 0;
            }
        });
    }
}

const powerupsManager = new PowerupsManager();
    </script>
    
    <!-- Events System -->
    <script>
// Special Events System

class EventsManager {
    constructor() {
        this.eventTypes = [
            {
                id: 'bonus_energy',
                title: 'ENERGY SURGE',
                icon: '',
                description: 'A surge of energy flows through the nexus!',
                duration: 30,
                reward: (game) => {
                    const bonus = Math.floor(game.energy * 0.5);
                    game.energy += bonus;
                    return `+${this.formatNumber(bonus)} Energy!`;
                }
            },
            {
                id: 'double_production',
                title: 'PRODUCTION BOOST',
                icon: '',
                description: 'All generators are working overtime!',
                duration: 60,
                reward: (game) => {
                    game.eventProductionBonus = 2;
                    setTimeout(() => {
                        game.eventProductionBonus = 1;
                    }, 60000);
                    return 'Double production for 60s!';
                }
            },
            {
                id: 'free_upgrades',
                title: 'TECH BREAKTHROUGH',
                icon: '',
                description: 'Upgrades are temporarily free!',
                duration: 45,
                reward: (game) => {
                    game.freeUpgrades = true;
                    setTimeout(() => {
                        game.freeUpgrades = false;
                    }, 45000);
                    return 'Free upgrades for 45s!';
                }
            },
            {
                id: 'mega_combo',
                title: 'COMBO FRENZY',
                icon: '',
                description: 'Combo power is supercharged!',
                duration: 40,
                reward: (game) => {
                    const oldBonus = game.comboBonus;
                    game.comboBonus *= 3;
                    setTimeout(() => {
                        game.comboBonus = oldBonus;
                    }, 40000);
                    return '3x combo bonus for 40s!';
                }
            },
            {
                id: 'crit_spree',
                title: 'LUCKY MOMENT',
                icon: '',
                description: 'Lady luck smiles upon you!',
                duration: 30,
                reward: (game) => {
                    const oldCrit = game.critChance;
                    game.critChance = Math.min(1, game.critChance + 0.5);
                    setTimeout(() => {
                        game.critChance = oldCrit;
                    }, 30000);
                    return '+50% crit chance for 30s!';
                }
            },
            {
                id: 'prestige_boost',
                title: 'COSMIC ALIGNMENT',
                icon: '',
                description: 'The stars align in your favor!',
                duration: 20,
                reward: (game) => {
                    const points = Math.floor(game.prestigePoints * 0.1) + 1;
                    game.prestigePoints += points;
                    return `+${points} Prestige Points!`;
                }
            },
            {
                id: 'instant_levels',
                title: 'EXPERIENCE RUSH',
                icon: '',
                description: 'Massive experience gain incoming!',
                duration: 15,
                reward: (game) => {
                    const levels = Math.floor(Math.random() * 3) + 1;
                    game.level += levels;
                    return `+${levels} Levels!`;
                }
            },
            {
                id: 'golden_click',
                title: 'GOLDEN OPPORTUNITY',
                icon: '',
                description: 'Next 10 clicks give massive rewards!',
                duration: 20,
                reward: (game) => {
                    game.goldenClicksRemaining = 10;
                    return 'Next 10 clicks = 100x reward!';
                }
            },
            {
                id: 'achievement_hunter',
                title: 'ACHIEVEMENT BONUS',
                icon: '',
                description: 'Achievement rewards doubled temporarily!',
                duration: 120,
                reward: (game) => {
                    // Check and potentially unlock random achievement progress
                    return 'Achievement rewards doubled!';
                }
            },
            {
                id: 'mystery_box',
                title: 'MYSTERY REWARD',
                icon: '',
                description: 'A mystery box appears...',
                duration: 25,
                reward: (game) => {
                    const rewards = [
                        () => { 
                            const bonus = Math.floor(game.energy * 0.75); 
                            game.energy += bonus; 
                            return `+${this.formatNumber(bonus)} Energy!`;
                        },
                        () => { 
                            game.clickPower *= 2; 
                            setTimeout(() => game.clickPower /= 2, 60000); 
                            return 'Double click power for 60s!';
                        },
                        () => { 
                            const pp = Math.floor(Math.random() * 5) + 1; 
                            game.prestigePoints += pp; 
                            return `+${pp} Prestige Points!`;
                        },
                        () => { 
                            game.level += 2; 
                            return '+2 Levels!';
                        },
                        () => { 
                            game.globalMultiplier *= 1.5; 
                            return '+50% global multiplier (permanent)!';
                        }
                    ];
                    const reward = rewards[Math.floor(Math.random() * rewards.length)];
                    return reward();
                }
            }
        ];
        
        this.currentEvent = null;
        this.eventTimer = 0;
        this.nextEventTime = this.getNextEventTime();
    }

    getNextEventTime() {
        // Random time between 2-5 minutes
        return (120 + Math.random() * 180) * 1000;
    }

    update(deltaTime, game) {
        if (this.currentEvent) {
            this.eventTimer -= deltaTime * 1000;
            if (this.eventTimer <= 0) {
                this.expireEvent();
            }
        } else {
            this.nextEventTime -= deltaTime * 1000;
            if (this.nextEventTime <= 0) {
                this.spawnEvent(game);
            }
        }
    }

    spawnEvent(game) {
        const eventType = this.eventTypes[Math.floor(Math.random() * this.eventTypes.length)];
        
        // Apply event spawn bonus
        const spawnBonus = game.eventSpawnBonus || 0;
        const duration = eventType.duration * (1 + spawnBonus);
        
        this.currentEvent = {
            ...eventType,
            duration: duration,
            game: game
        };
        this.eventTimer = duration * 1000;
        
        notifications.warning(
            ' Special Event!',
            eventType.title,
            4000
        );
    }

    claimEvent() {
        if (!this.currentEvent) return;
        
        const result = this.currentEvent.reward(this.currentEvent.game);
        
        notifications.success(
            ' Event Claimed!',
            result,
            4000
        );
        
        this.currentEvent.game.stats.eventsCompleted = (this.currentEvent.game.stats.eventsCompleted || 0) + 1;
        
        this.currentEvent = null;
        this.nextEventTime = this.getNextEventTime();
    }

    expireEvent() {
        if (!this.currentEvent) return;
        
        notifications.warning(
            ' Event Expired',
            `${this.currentEvent.title} has ended`
        );
        
        this.currentEvent = null;
        this.nextEventTime = this.getNextEventTime();
    }

    formatNumber(num) {
        if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
        if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
        if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
        return Math.floor(num).toString();
    }

    reset() {
        this.currentEvent = null;
        this.eventTimer = 0;
        this.nextEventTime = this.getNextEventTime();
    }

    getSaveData() {
        return {
            currentEvent: this.currentEvent ? {
                id: this.currentEvent.id,
                timer: this.eventTimer
            } : null,
            nextEventTime: this.nextEventTime
        };
    }

    loadSaveData(data, game) {
        if (!data) return;
        
        if (data.currentEvent) {
            const eventType = this.eventTypes.find(e => e.id === data.currentEvent.id);
            if (eventType) {
                this.currentEvent = { ...eventType, game: game };
                this.eventTimer = data.currentEvent.timer || 0;
            }
        }
        
        this.nextEventTime = data.nextEventTime || this.getNextEventTime();
    }
}

const eventsManager = new EventsManager();
    </script>
    
    <!-- Milestones System -->
    <script>
// Milestones System

class MilestonesManager {
    constructor() {
        this.milestones = [
            {
                id: 'energy_1000',
                name: 'Energy Milestone I',
                icon: '',
                goal: 1000,
                type: 'totalEnergy',
                reward: 'Global mult +10%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 0.1;
                }
            },
            {
                id: 'energy_10000',
                name: 'Energy Milestone II',
                icon: '',
                goal: 10000,
                type: 'totalEnergy',
                reward: 'Global mult +25%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 0.25;
                }
            },
            {
                id: 'energy_100000',
                name: 'Energy Milestone III',
                icon: '',
                goal: 100000,
                type: 'totalEnergy',
                reward: 'Global mult +50%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 0.5;
                }
            },
            {
                id: 'energy_1000000',
                name: 'Energy Milestone IV',
                icon: '',
                goal: 1000000,
                type: 'totalEnergy',
                reward: 'Global mult +100%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 1;
                }
            },
            {
                id: 'clicks_500',
                name: 'Click Milestone I',
                icon: '',
                goal: 500,
                type: 'totalClicks',
                reward: 'Click power +10',
                unlocked: false,
                apply: (game) => {
                    game.clickPower += 10;
                }
            },
            {
                id: 'clicks_5000',
                name: 'Click Milestone II',
                icon: '',
                goal: 5000,
                type: 'totalClicks',
                reward: 'Click power +50',
                unlocked: false,
                apply: (game) => {
                    game.clickPower += 50;
                }
            },
            {
                id: 'clicks_50000',
                name: 'Click Milestone III',
                icon: '',
                goal: 50000,
                type: 'totalClicks',
                reward: 'Click power +250',
                unlocked: false,
                apply: (game) => {
                    game.clickPower += 250;
                }
            },
            {
                id: 'level_10',
                name: 'Level Up!',
                icon: '',
                goal: 10,
                type: 'level',
                reward: 'Unlock special feature',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 0.2;
                }
            },
            {
                id: 'level_25',
                name: 'Quarter Century',
                icon: '',
                goal: 25,
                type: 'level',
                reward: 'Global mult +50%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 0.5;
                }
            },
            {
                id: 'level_50',
                name: 'Half Century',
                icon: '',
                goal: 50,
                type: 'level',
                reward: 'Global mult +100%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 1;
                }
            },
            {
                id: 'level_100',
                name: 'Centurion',
                icon: '',
                goal: 100,
                type: 'level',
                reward: 'Global mult +200%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 2;
                }
            },
            {
                id: 'generators_50',
                name: 'Generator Array',
                icon: '',
                goal: 50,
                type: 'totalGenerators',
                reward: 'Generator output +50%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 0.5;
                }
            },
            {
                id: 'generators_200',
                name: 'Generator Complex',
                icon: '',
                goal: 200,
                type: 'totalGenerators',
                reward: 'Generator output +100%',
                unlocked: false,
                apply: (game) => {
                    game.globalMultiplier += 1;
                }
            },
            {
                id: 'combo_75',
                name: 'Combo Champion',
                icon: '',
                goal: 75,
                type: 'highestCombo',
                reward: 'Combo bonus +50%',
                unlocked: false,
                apply: (game) => {
                    game.comboBonus += 0.5;
                }
            },
            {
                id: 'combo_150',
                name: 'Combo Legend',
                icon: '',
                goal: 150,
                type: 'highestCombo',
                reward: 'Combo bonus +100%',
                unlocked: false,
                apply: (game) => {
                    game.comboBonus += 1;
                }
            }
        ];
    }

    check(game) {
        let newUnlocks = [];
        
        this.milestones.forEach(milestone => {
            if (!milestone.unlocked) {
                let current = 0;
                
                switch(milestone.type) {
                    case 'totalEnergy':
                        current = game.stats.totalEnergy;
                        break;
                    case 'totalClicks':
                        current = game.stats.totalClicks;
                        break;
                    case 'level':
                        current = game.level;
                        break;
                    case 'totalGenerators':
                        current = generatorsManager.generators.reduce((sum, g) => sum + g.count, 0);
                        break;
                    case 'highestCombo':
                        current = game.stats.highestCombo;
                        break;
                }
                
                if (current >= milestone.goal) {
                    milestone.unlocked = true;
                    milestone.apply(game);
                    newUnlocks.push(milestone);
                    
                    notifications.success(
                        ' Milestone Reached!',
                        `${milestone.name} - ${milestone.reward}`,
                        4000
                    );
                    
                    // Create celebration
                    const milestoneCard = document.querySelector(`[data-milestone-id="${milestone.id}"]`);
                    if (milestoneCard) {
                        particleSystem.createCelebration(milestoneCard);
                    }
                }
            }
        });
        
        return newUnlocks;
    }

    getProgress(milestone, game) {
        let current = 0;
        
        switch(milestone.type) {
            case 'totalEnergy':
                current = game.stats.totalEnergy;
                break;
            case 'totalClicks':
                current = game.stats.totalClicks;
                break;
            case 'level':
                current = game.level;
                break;
            case 'totalGenerators':
                current = generatorsManager.generators.reduce((sum, g) => sum + g.count, 0);
                break;
            case 'highestCombo':
                current = game.stats.highestCombo;
                break;
        }
        
        return Math.min(100, (current / milestone.goal) * 100);
    }

    reset() {
        this.milestones.forEach(milestone => {
            milestone.unlocked = false;
        });
    }

    getSaveData() {
        const data = {};
        this.milestones.forEach(milestone => {
            data[milestone.id] = milestone.unlocked;
        });
        return data;
    }

    loadSaveData(data) {
        if (!data) return;
        Object.keys(data).forEach(id => {
            const milestone = this.milestones.find(m => m.id === id);
            if (milestone) {
                milestone.unlocked = data[id];
            }
        });
    }
}

const milestonesManager = new MilestonesManager();
    </script>
    
    <!-- Game Engine -->
    <script>
// ===== BULK BUY MANAGER =====
const bulkBuyManager = {
    currentAmount: 1,
    
    init() {
        // Upgrades bulk buy
        document.querySelectorAll('.bulk-buy-controls .bulk-buy-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.bulk-buy-controls .bulk-buy-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                this.currentAmount = btn.dataset.amount;
            });
        });
        
        // Generators bulk buy
        document.querySelectorAll('#bulk-buy-generators .bulk-buy-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('#bulk-buy-generators .bulk-buy-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                this.currentAmount = btn.dataset.amount;
            });
        });
    },
    
    calculateBulkCost(baseCost, currentLevel, amount, costMultiplier = 1.15) {
        if (amount === 'max') return null;
        
        let totalCost = 0;
        for (let i = 0; i < amount; i++) {
            totalCost += baseCost * Math.pow(costMultiplier, currentLevel + i);
        }
        return totalCost;
    },
    
    calculateMaxAffordable(baseCost, currentLevel, availableEnergy, costMultiplier = 1.15) {
        let amount = 0;
        let totalCost = 0;
        
        while (true) {
            const nextCost = baseCost * Math.pow(costMultiplier, currentLevel + amount);
            if (totalCost + nextCost > availableEnergy) break;
            totalCost += nextCost;
            amount++;
            if (amount > 1000) break;
        }
        
        return { amount, totalCost };
    }
};
    </script>

    <script>
// ===== CHALLENGES MANAGER =====
const challengesManager = {
    challenges: [],
    completedChallenges: [],
    
    dailyChallenges: [
        { id: 'daily_click_1000', name: 'Click Master', description: 'Click 1,000 times', target: 1000, type: 'clicks', reward: { energy: 50000 }, icon: '' },
        { id: 'daily_energy_100k', name: 'Energy Collector', description: 'Earn 100K energy', target: 100000, type: 'energy', reward: { energy: 200000, multiplier: 1.05 }, icon: '' },
        { id: 'daily_combo_50', name: 'Combo King', description: 'Reach 50x combo', target: 50, type: 'combo', reward: { energy: 150000 }, icon: '' },
        { id: 'daily_crit_100', name: 'Critical Mass', description: 'Get 100 critical hits', target: 100, type: 'crits', reward: { energy: 100000 }, icon: '' },
        { id: 'daily_generator_10', name: 'Automation Starter', description: 'Buy 10 generators', target: 10, type: 'generators', reward: { energy: 80000 }, icon: '' }
    ],
    
    weeklyChallenges: [
        { id: 'weekly_energy_10m', name: 'Million Dollar Baby', description: 'Earn 10M energy', target: 10000000, type: 'energy', reward: { energy: 5000000, multiplier: 1.2, skillPoints: 5 }, icon: '' },
        { id: 'weekly_level_10', name: 'Level Up!', description: 'Reach level 10', target: 10, type: 'level', reward: { energy: 1000000, skillPoints: 3 }, icon: '' },
        { id: 'weekly_upgrades_20', name: 'Upgrade Addict', description: 'Purchase 20 upgrades', target: 20, type: 'upgrades', reward: { energy: 2000000 }, icon: '' },
        { id: 'weekly_powerups_10', name: 'Power Player', description: 'Activate 10 power-ups', target: 10, type: 'powerups', reward: { energy: 1500000 }, icon: '' }
    ],
    
    init() {
        this.resetDailyChallenges();
        this.updateUI();
        
        // Setup filter buttons
        document.querySelectorAll('.challenges-filter .filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.challenges-filter .filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                this.filterChallenges(btn.dataset.filter);
            });
        });
    },
    
    resetDailyChallenges() {
        const lastReset = localStorage.getItem('lastChallengeReset');
        const now = new Date();
        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        
        if (!lastReset || new Date(parseInt(lastReset)) < today) {
            // Reset daily challenges
            this.challenges = [...this.dailyChallenges, ...this.weeklyChallenges].map(c => ({
                ...c,
                progress: 0,
                completed: false,
                claimedAt: null
            }));
            localStorage.setItem('lastChallengeReset', today.getTime().toString());
        }
    },
    
    updateProgress(type, value) {
        this.challenges.forEach(challenge => {
            if (challenge.type === type && !challenge.completed) {
                challenge.progress += value;
                if (challenge.progress >= challenge.target) {
                    challenge.progress = challenge.target;
                    challenge.completed = true;
                    notifications.success('Challenge Completed!', challenge.name, 5000);
                    particleSystem.createBurst(window.innerWidth / 2, 200, 30, '#00ff00');
                }
            }
        });
        this.updateUI();
    },
    
    claimReward(challengeId) {
        const challenge = this.challenges.find(c => c.id === challengeId);
        if (!challenge || !challenge.completed || challenge.claimedAt) return;
        
        challenge.claimedAt = Date.now();
        this.completedChallenges.push(challengeId);
        
        // Apply rewards
        if (challenge.reward.energy) {
            game.addEnergy(challenge.reward.energy);
        }
        if (challenge.reward.multiplier) {
            game.globalMultiplier *= challenge.reward.multiplier;
        }
        if (challenge.reward.skillPoints) {
            skillTreeManager.addSkillPoints(challenge.reward.skillPoints);
        }
        
        let rewardText = '';
        if (challenge.reward.energy) rewardText += `+${game.formatNumber(challenge.reward.energy)} Energy`;
        if (challenge.reward.multiplier) rewardText += ` +${((challenge.reward.multiplier - 1) * 100).toFixed(0)}% Mult`;
        if (challenge.reward.skillPoints) rewardText += ` +${challenge.reward.skillPoints} SP`;
        
        notifications.success('Reward Claimed!', rewardText, 5000);
        particleSystem.createCelebration();
        this.updateUI();
        game.saveGame();
    },
    
    filterChallenges(filter) {
        const list = document.getElementById('challenges-list');
        if (!list) return;
        
        list.querySelectorAll('.challenge-card').forEach(card => {
            const completed = card.classList.contains('completed');
            const isDaily = card.dataset.type === 'daily';
            
            let show = false;
            if (filter === 'daily') show = isDaily;
            else if (filter === 'weekly') show = !isDaily;
            else if (filter === 'completed') show = completed;
            
            card.style.display = show ? 'block' : 'none';
        });
    },
    
    updateUI() {
        const list = document.getElementById('challenges-list');
        if (!list) return;
        
        let html = '';
        this.challenges.forEach(challenge => {
            const progress = Math.min(100, (challenge.progress / challenge.target) * 100);
            const completedClass = challenge.completed ? 'completed' : '';
            const claimedClass = challenge.claimedAt ? 'claimed' : '';
            
            html += `
                <div class="challenge-card ${completedClass} ${claimedClass}" data-type="${this.dailyChallenges.find(c => c.id === challenge.id) ? 'daily' : 'weekly'}">
                    <div class="challenge-header">
                        <div class="challenge-title">${challenge.icon} ${challenge.name}</div>
                        <div class="challenge-reward"> ${game.formatNumber(challenge.reward.energy || 0)}</div>
                    </div>
                    <div class="challenge-description">${challenge.description}</div>
                    <div class="challenge-progress">
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: ${progress}%"></div>
                            <div class="progress-text">${game.formatNumber(challenge.progress)} / ${game.formatNumber(challenge.target)}</div>
                        </div>
                    </div>
                    ${challenge.completed && !challenge.claimedAt ? `<button class="challenge-claim-btn" onclick="challengesManager.claimReward('${challenge.id}')">Claim Reward</button>` : ''}
                    ${challenge.claimedAt ? '<div style="text-align: center; color: var(--neon-green); margin-top: 10px;"> Claimed</div>' : ''}
                </div>
            `;
        });
        
        list.innerHTML = html;
    },
    
    getSaveData() {
        return {
            challenges: this.challenges,
            completedChallenges: this.completedChallenges
        };
    },
    
    loadSaveData(data) {
        if (data) {
            this.challenges = data.challenges || [];
            this.completedChallenges = data.completedChallenges || [];
            this.resetDailyChallenges(); // Ensure we have current challenges
        }
    }
};

// ===== SKILL TREE MANAGER =====
const skillTreeManager = {
    availablePoints: 0,
    skills: {},
    
    branches: {
        production: {
            name: 'Production',
            color: '#00ff00',
            skills: [
                { id: 'prod1', name: 'Energy Boost I', description: '+10% production', cost: 1, bonus: { production: 1.1 } },
                { id: 'prod2', name: 'Energy Boost II', description: '+20% production', cost: 2, bonus: { production: 1.2 }, requires: ['prod1'] },
                { id: 'prod3', name: 'Energy Boost III', description: '+30% production', cost: 3, bonus: { production: 1.3 }, requires: ['prod2'] },
                { id: 'prod4', name: 'Generator Master', description: 'Generators 50% cheaper', cost: 2, bonus: { generatorCost: 0.5 } },
                { id: 'prod5', name: 'Mega Production', description: '+100% production', cost: 5, bonus: { production: 2 }, requires: ['prod3'] }
            ]
        },
        clicking: {
            name: 'Clicking',
            color: '#00ffff',
            skills: [
                { id: 'click1', name: 'Click Power I', description: '+25% click power', cost: 1, bonus: { clickPower: 1.25 } },
                { id: 'click2', name: 'Click Power II', description: '+50% click power', cost: 2, bonus: { clickPower: 1.5 }, requires: ['click1'] },
                { id: 'click3', name: 'Critical Strike', description: '+5% crit chance', cost: 2, bonus: { critChance: 0.05 } },
                { id: 'click4', name: 'Combo Master', description: '+10% combo bonus', cost: 3, bonus: { comboBonus: 0.1 }, requires: ['click2'] },
                { id: 'click5', name: 'Ultimate Clicker', description: '+200% click power', cost: 5, bonus: { clickPower: 3 }, requires: ['click4'] }
            ]
        },
        automation: {
            name: 'Automation',
            color: '#ff00ff',
            skills: [
                { id: 'auto1', name: 'Auto-Clicker I', description: '1 auto-click/sec', cost: 2, bonus: { autoClicks: 1 } },
                { id: 'auto2', name: 'Auto-Clicker II', description: '+2 auto-clicks/sec', cost: 3, bonus: { autoClicks: 2 }, requires: ['auto1'] },
                { id: 'auto3', name: 'Smart Buy', description: 'Auto-buy unlocked', cost: 3, bonus: { autoBuy: true } },
                { id: 'auto4', name: 'Offline Progress', description: '+50% offline production', cost: 4, bonus: { offline: 0.5 } },
                { id: 'auto5', name: 'Full Automation', description: '+10 auto-clicks/sec', cost: 5, bonus: { autoClicks: 10 }, requires: ['auto2'] }
            ]
        },
        special: {
            name: 'Special',
            color: '#ffff00',
            skills: [
                { id: 'spec1', name: 'Lucky Drop', description: '+50% artifact drop rate', cost: 2, bonus: { dropRate: 1.5 } },
                { id: 'spec2', name: 'Experience Boost', description: '+25% XP gain', cost: 2, bonus: { xpBonus: 1.25 } },
                { id: 'spec3', name: 'Prestige Power', description: '+10% prestige points', cost: 3, bonus: { prestigeBonus: 1.1 } },
                { id: 'spec4', name: 'Power Duration', description: '+25% power-up duration', cost: 3, bonus: { powerupDuration: 1.25 } },
                { id: 'spec5', name: 'Legendary', description: '+50% to all bonuses', cost: 10, bonus: { allBonuses: 1.5 }, requires: ['spec1', 'spec2', 'spec3', 'spec4'] }
            ]
        }
    },
    
    init() {
        this.renderSkillTree();
    },
    
    addSkillPoints(amount) {
        this.availablePoints += amount;
        this.updateUI();
        notifications.success('Skill Points!', `+${amount} Skill Points earned!`, 3000);
    },
    
    canUnlock(skill) {
        // Check if we have enough points
        if (this.availablePoints < skill.cost) return false;
        
        // Check if already unlocked
        if (this.skills[skill.id]) return false;
        
        // Check requirements
        if (skill.requires) {
            for (const reqId of skill.requires) {
                if (!this.skills[reqId]) return false;
            }
        }
        
        return true;
    },
    
    unlockSkill(skillId, branchId) {
        const branch = this.branches[branchId];
        const skill = branch.skills.find(s => s.id === skillId);
        
        if (!skill || !this.canUnlock(skill)) return;
        
        this.availablePoints -= skill.cost;
        this.skills[skillId] = true;
        
        // Apply bonuses
        this.applySkillBonus(skill);
        
        notifications.success('Skill Unlocked!', skill.name, 3000);
        particleSystem.createBurst(window.innerWidth / 2, window.innerHeight / 2, 20, branch.color);
        this.updateUI();
        game.saveGame();
    },
    
    applySkillBonus(skill) {
        const bonus = skill.bonus;
        
        if (bonus.production) game.globalMultiplier *= bonus.production;
        if (bonus.clickPower) game.clickPower *= bonus.clickPower;
        if (bonus.critChance) game.critChance += bonus.critChance;
        if (bonus.comboBonus) game.comboBonus += bonus.comboBonus;
        if (bonus.autoClicks) game.autoClickersPerSecond += bonus.autoClicks;
        if (bonus.autoBuy) game.autoBuyGenerators = true;
        if (bonus.offline) game.offlineProductionRate += bonus.offline;
        if (bonus.generatorCost) game.generatorCostReduction = bonus.generatorCost;
        if (bonus.dropRate) collectionManager.dropRateMultiplier = (collectionManager.dropRateMultiplier || 1) * bonus.dropRate;
        if (bonus.xpBonus) game.xpMultiplier = (game.xpMultiplier || 1) * bonus.xpBonus;
        if (bonus.prestigeBonus) game.prestigePointsBonus += (bonus.prestigeBonus - 1);
        if (bonus.powerupDuration) game.powerupDurationBonus += (bonus.powerupDuration - 1);
        if (bonus.allBonuses) {
            // Apply to all current bonuses
            game.globalMultiplier *= bonus.allBonuses;
            game.clickPower *= bonus.allBonuses;
        }
    },
    
    renderSkillTree() {
        const container = document.getElementById('skill-branches');
        if (!container) return;
        
        let html = '';
        for (const [branchId, branch] of Object.entries(this.branches)) {
            html += `
                <div class="skill-branch">
                    <h3 class="branch-title ${branchId}" style="color: ${branch.color}">${branch.name}</h3>
                    ${branch.skills.map(skill => this.renderSkillNode(skill, branchId)).join('')}
                </div>
            `;
        }
        
        container.innerHTML = html;
    },
    
    renderSkillNode(skill, branchId) {
        const unlocked = this.skills[skill.id];
        const canUnlock = this.canUnlock(skill);
        const lockedClass = !unlocked && !canUnlock ? 'locked' : '';
        const unlockedClass = unlocked ? 'unlocked' : '';
        
        return `
            <div class="skill-node ${lockedClass} ${unlockedClass}" 
                 onclick="skillTreeManager.unlockSkill('${skill.id}', '${branchId}')"
                 data-skill="${skill.id}">
                <div class="skill-name">${skill.name} ${unlocked ? '' : ''}</div>
                <div class="skill-description">${skill.description}</div>
                <div class="skill-cost">Cost: ${skill.cost} SP</div>
                ${skill.requires ? `<div style="font-size: 0.8em; color: var(--text-secondary); margin-top: 5px;">Requires: ${skill.requires.join(', ')}</div>` : ''}
            </div>
        `;
    },
    
    updateUI() {
        const pointsEl = document.getElementById('skill-points-value');
        if (pointsEl) {
            pointsEl.textContent = this.availablePoints;
        }
        
        // Re-render tree to update states
        this.renderSkillTree();
    },
    
    getSaveData() {
        return {
            availablePoints: this.availablePoints,
            skills: this.skills
        };
    },
    
    loadSaveData(data) {
        if (data) {
            this.availablePoints = data.availablePoints || 0;
            this.skills = data.skills || {};
            
            // Reapply all unlocked skills
            for (const [branchId, branch] of Object.entries(this.branches)) {
                branch.skills.forEach(skill => {
                    if (this.skills[skill.id]) {
                        this.applySkillBonus(skill);
                    }
                });
            }
        }
    }
};

// ===== COLLECTION MANAGER =====
const collectionManager = {
    artifacts: {},
    dropRateMultiplier: 1,
    baseDropChance: 0.01, // 1% base drop chance
    
    artifactList: [
        // Common
        { id: 'lucky_coin', name: 'Lucky Coin', rarity: 'common', icon: '', bonus: { clickPower: 1.1 }, dropChance: 0.4 },
        { id: 'energy_crystal', name: 'Energy Crystal', rarity: 'common', icon: '', bonus: { production: 1.15 }, dropChance: 0.4 },
        { id: 'speed_boots', name: 'Speed Boots', rarity: 'common', icon: '', bonus: { comboWindow: 1.2 }, dropChance: 0.4 },
        
        // Rare
        { id: 'golden_orb', name: 'Golden Orb', rarity: 'rare', icon: '', bonus: { globalMult: 1.25 }, dropChance: 0.15 },
        { id: 'power_gauntlet', name: 'Power Gauntlet', rarity: 'rare', icon: '', bonus: { clickPower: 1.5, critChance: 0.05 }, dropChance: 0.15 },
        { id: 'time_watch', name: 'Time Watch', rarity: 'rare', icon: '', bonus: { powerupDuration: 1.3 }, dropChance: 0.15 },
        
        // Epic
        { id: 'phoenix_feather', name: 'Phoenix Feather', rarity: 'epic', icon: '', bonus: { prestigePoints: 1.5 }, dropChance: 0.05 },
        { id: 'infinity_stone', name: 'Infinity Stone', rarity: 'epic', icon: '', bonus: { globalMult: 1.5, production: 1.5 }, dropChance: 0.05 },
        { id: 'dragon_scale', name: 'Dragon Scale', rarity: 'epic', icon: '', bonus: { clickPower: 2, critMult: 1.5 }, dropChance: 0.05 },
        
        // Legendary
        { id: 'crown_of_power', name: 'Crown of Power', rarity: 'legendary', icon: '', bonus: { allStats: 2 }, dropChance: 0.01 },
        { id: 'cosmic_artifact', name: 'Cosmic Artifact', rarity: 'legendary', icon: '', bonus: { globalMult: 3, skillPoints: 10 }, dropChance: 0.01 },
        { id: 'time_remnant', name: 'Time Remnant', rarity: 'legendary', icon: '', bonus: { offline: 1, autoBuy: true }, dropChance: 0.01 }
    ],
    
    init() {
        this.updateUI();
    },
    
    checkDrop(game) {
        // Only check on clicks
        const dropChance = this.baseDropChance * this.dropRateMultiplier;
        
        if (Math.random() < dropChance) {
            // Determine which artifact
            const unlockedArtifacts = this.artifactList.filter(a => !this.artifacts[a.id]);
            if (unlockedArtifacts.length === 0) return; // All collected
            
            // Weighted random selection based on individual drop chances
            const totalWeight = unlockedArtifacts.reduce((sum, a) => sum + a.dropChance, 0);
            let random = Math.random() * totalWeight;
            
            for (const artifact of unlockedArtifacts) {
                random -= artifact.dropChance;
                if (random <= 0) {
                    this.unlockArtifact(artifact, game);
                    break;
                }
            }
        }
    },
    
    unlockArtifact(artifact, game) {
        this.artifacts[artifact.id] = {
            unlockedAt: Date.now(),
            rarity: artifact.rarity
        };
        
        // Apply bonuses
        this.applyArtifactBonus(artifact, game);
        
        const rarityColor = {
            common: '#808080',
            rare: '#0080ff',
            epic: '#ff00ff',
            legendary: '#ffff00'
        };
        
        notifications.success(
            `${artifact.icon} Artifact Found!`,
            `${artifact.name} (${artifact.rarity.toUpperCase()})`,
            8000
        );
        
        particleSystem.createCelebration();
        particleSystem.createBurst(window.innerWidth / 2, window.innerHeight / 2, 50, rarityColor[artifact.rarity]);
        
        this.updateUI();
        game.saveGame();
    },
    
    applyArtifactBonus(artifact, game) {
        const bonus = artifact.bonus;
        
        if (bonus.clickPower) game.clickPower *= bonus.clickPower;
        if (bonus.production) game.globalMultiplier *= bonus.production;
        if (bonus.globalMult) game.globalMultiplier *= bonus.globalMult;
        if (bonus.critChance) game.critChance += bonus.critChance;
        if (bonus.critMult) game.critMultiplier *= bonus.critMult;
        if (bonus.comboWindow) game.comboWindow *= bonus.comboWindow;
        if (bonus.powerupDuration) game.powerupDurationBonus += (bonus.powerupDuration - 1);
        if (bonus.prestigePoints) game.prestigePointsBonus += (bonus.prestigePoints - 1);
        if (bonus.offline) game.offlineProductionRate = bonus.offline;
        if (bonus.autoBuy) game.autoBuyGenerators = true;
        if (bonus.skillPoints) skillTreeManager.addSkillPoints(bonus.skillPoints);
        if (bonus.allStats) {
            game.clickPower *= bonus.allStats;
            game.globalMultiplier *= bonus.allStats;
            game.critMultiplier *= bonus.allStats;
        }
    },
    
    updateUI() {
        const collectedEl = document.getElementById('artifacts-collected');
        const totalEl = document.getElementById('artifacts-total');
        const dropChanceEl = document.getElementById('drop-chance');
        const gridEl = document.getElementById('artifacts-grid');
        
        const collected = Object.keys(this.artifacts).length;
        const total = this.artifactList.length;
        
        if (collectedEl) collectedEl.textContent = collected;
        if (totalEl) totalEl.textContent = total;
        if (dropChanceEl) {
            const finalChance = (this.baseDropChance * this.dropRateMultiplier * 100).toFixed(2);
            dropChanceEl.textContent = `${finalChance}%`;
        }
        
        if (gridEl) {
            let html = '';
            this.artifactList.forEach(artifact => {
                const unlocked = this.artifacts[artifact.id];
                const lockedClass = unlocked ? 'unlocked' : 'locked';
                
                html += `
                    <div class="artifact-card ${artifact.rarity} ${lockedClass}">
                        <div class="artifact-icon">${unlocked ? artifact.icon : ''}</div>
                        <div class="artifact-name">${unlocked ? artifact.name : '???'}</div>
                        <div class="artifact-rarity" style="color: var(--neon-${artifact.rarity === 'common' ? 'cyan' : artifact.rarity === 'rare' ? 'blue' : artifact.rarity === 'epic' ? 'magenta' : 'yellow'})">${artifact.rarity.toUpperCase()}</div>
                        ${unlocked ? `<div class="artifact-bonus">${this.getBonusText(artifact.bonus)}</div>` : ''}
                    </div>
                `;
            });
            gridEl.innerHTML = html;
        }
    },
    
    getBonusText(bonus) {
        const parts = [];
        if (bonus.clickPower) parts.push(`+${((bonus.clickPower - 1) * 100).toFixed(0)}% Click Power`);
        if (bonus.production) parts.push(`+${((bonus.production - 1) * 100).toFixed(0)}% Production`);
        if (bonus.globalMult) parts.push(`+${((bonus.globalMult - 1) * 100).toFixed(0)}% Global Mult`);
        if (bonus.critChance) parts.push(`+${(bonus.critChance * 100).toFixed(0)}% Crit Chance`);
        if (bonus.critMult) parts.push(`${bonus.critMult}x Crit Mult`);
        if (bonus.allStats) parts.push(`${bonus.allStats}x ALL STATS`);
        if (bonus.prestigePoints) parts.push(`+${((bonus.prestigePoints - 1) * 100).toFixed(0)}% Prestige`);
        if (bonus.offline) parts.push('Offline Production');
        if (bonus.autoBuy) parts.push('Auto-Buy');
        if (bonus.skillPoints) parts.push(`+${bonus.skillPoints} Skill Points`);
        return parts.join(', ');
    },
    
    getSaveData() {
        return {
            artifacts: this.artifacts,
            dropRateMultiplier: this.dropRateMultiplier
        };
    },
    
    loadSaveData(data, game) {
        if (data) {
            this.artifacts = data.artifacts || {};
            this.dropRateMultiplier = data.dropRateMultiplier || 1;
            
            // Reapply all artifact bonuses
            this.artifactList.forEach(artifact => {
                if (this.artifacts[artifact.id]) {
                    this.applyArtifactBonus(artifact, game);
                }
            });
        }
    }
};

// ===== DAILY REWARDS MANAGER =====
const dailyRewardsManager = {
    lastClaimTime: 0,
    claimCooldown: 24 * 60 * 60 * 1000, // 24 hours in milliseconds
    
    init() {
        this.loadSaveData();
        this.updateUI();
    },
    
    canClaim() {
        const now = Date.now();
        return (now - this.lastClaimTime) >= this.claimCooldown;
    },
    
    claim(game) {
        if (!this.canClaim()) return false;
        
        // Grant daily reward
        const reward = game.stats.totalEnergy * 0.1; // 10% of total energy earned
        game.addEnergy(reward);
        
        this.lastClaimTime = Date.now();
        notifications.success(' Daily Reward!', `+${game.formatNumber(reward)} Energy!`);
        
        this.updateUI();
        return true;
    },
    
    updateUI() {
        const btn = document.getElementById('claim-daily-btn');
        if (!btn) return;
        
        if (this.canClaim()) {
            btn.disabled = false;
            btn.textContent = 'Claim Reward';
        } else {
            btn.disabled = true;
            const timeLeft = this.claimCooldown - (Date.now() - this.lastClaimTime);
            const hoursLeft = Math.ceil(timeLeft / (60 * 60 * 1000));
            btn.textContent = `Next reward in ${hoursLeft}h`;
        }
    },
    
    getSaveData() {
        return {
            lastClaimTime: this.lastClaimTime
        };
    },
    
    loadSaveData(data) {
        if (data) {
            this.lastClaimTime = data.lastClaimTime || 0;
        }
    }
};

// ===== AUTOMATION MANAGER =====
const automationManager = {
    settings: {
        autoBuyUpgrades: false,
        autoBuyGenerators: false,
        autoClaimEvents: false,
        autoPrestige: false,
        autoPrestigeThreshold: 1000 // Prestige when we can get 1000+ points
    },
    
    init() {
        this.updateUI();
    },
    
    update(game) {
        if (this.settings.autoBuyUpgrades) {
            this.autoBuyUpgrades(game);
        }
        
        if (this.settings.autoBuyGenerators) {
            this.autoBuyGenerators(game);
        }
        
        if (this.settings.autoClaimEvents) {
            this.autoClaimEvents();
        }
        
        if (this.settings.autoPrestige) {
            this.autoPrestige(game);
        }
    },
    
    autoBuyUpgrades(game) {
        // Try to buy the cheapest affordable upgrade
        upgradesManager.upgrades.forEach(upgrade => {
            const cost = upgradesManager.getCost(upgrade);
            if (game.energy >= cost) {
                upgradesManager.purchase(upgrade, game, true); // Silent purchase
            }
        });
    },
    
    autoBuyGenerators(game) {
        // Buy generators if affordable
        generatorsManager.generators.forEach(generator => {
            const cost = generatorsManager.getCost(generator);
            if (game.energy >= cost * 1.5) { // Only buy if we have 1.5x the cost
                generatorsManager.purchase(generator, game, true); // Silent purchase
            }
        });
    },
    
    autoClaimEvents() {
        if (eventsManager.currentEvent && eventsManager.currentEvent.active) {
            eventsManager.claimEvent();
        }
    },
    
    autoPrestige(game) {
        const pointsGained = prestigeManager.calculatePrestigePoints(game.stats.totalEnergy);
        if (pointsGained >= this.settings.autoPrestigeThreshold) {
            prestigeManager.performPrestige(game);
        }
    },
    
    toggleSetting(settingName) {
        this.settings[settingName] = !this.settings[settingName];
        this.updateUI();
        game.saveGame();
        
        const status = this.settings[settingName] ? 'enabled' : 'disabled';
        notifications.info('Automation Updated', `${settingName} ${status}`, 3000);
    },
    
    updateUI() {
        const container = document.getElementById('automation-options');
        if (!container) return;
        
        const options = [
            { id: 'autoBuyUpgrades', name: 'Auto-Buy Upgrades', description: 'Automatically purchase affordable upgrades' },
            { id: 'autoBuyGenerators', name: 'Auto-Buy Generators', description: 'Automatically purchase generators when affordable' },
            { id: 'autoClaimEvents', name: 'Auto-Claim Events', description: 'Automatically claim event rewards' },
            { id: 'autoPrestige', name: 'Auto-Prestige', description: 'Automatically prestige when threshold is met' }
        ];
        
        let html = '';
        options.forEach(option => {
            const active = this.settings[option.id];
            html += `
                <div class="automation-option">
                    <div class="automation-info">
                        <h4>${option.name}</h4>
                        <p>${option.description}</p>
                    </div>
                    <div class="toggle-switch ${active ? 'active' : ''}" onclick="automationManager.toggleSetting('${option.id}')">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            `;
        });
        
        if (this.settings.autoPrestige) {
            html += `
                <div style="margin-top: 20px; padding: 15px; background: var(--bg-panel); border-radius: 10px;">
                    <label style="color: var(--text-primary);">Auto-Prestige Threshold:</label>
                    <input type="number" 
                           value="${this.settings.autoPrestigeThreshold}" 
                           onchange="automationManager.settings.autoPrestigeThreshold = parseInt(this.value); game.saveGame();"
                           style="width: 100%; padding: 10px; margin-top: 10px; background: var(--bg-dark); border: 2px solid var(--border-color); border-radius: 5px; color: var(--text-primary); font-family: 'Orbitron', sans-serif;">
                </div>
            `;
        }
        
        container.innerHTML = html;
    },
    
    getSaveData() {
        return this.settings;
    },
    
    loadSaveData(data) {
        if (data) {
            this.settings = { ...this.settings, ...data };
        }
    }
};

    </script>

    <script>
// ===== SETTINGS MANAGER =====
const settingsManager = {
    settings: {
        showNotifications: true,
        showParticles: true,
        autoSave: true,
        showDamageNumbers: true,
        showProgressBars: true,
        animationSpeed: 1,
        compactMode: false
    },
    
    saveSlots: {
        slot1: null,
        slot2: null,
        slot3: null,
        currentSlot: 'slot1'
    },
    
    init() {
        this.updateUI();
    },
    
    toggleSetting(settingName) {
        this.settings[settingName] = !this.settings[settingName];
        this.applySetting(settingName);
        this.updateUI();
        game.saveGame();
        
        notifications.info('Setting Updated', `${settingName} ${this.settings[settingName] ? 'enabled' : 'disabled'}`, 2000);
    },
    
    applySetting(settingName) {
        switch(settingName) {
            case 'showParticles':
                particleSystem.enabled = this.settings.showParticles;
                break;
            case 'animationSpeed':
                document.documentElement.style.setProperty('--animation-speed', this.settings.animationSpeed);
                break;
            case 'compactMode':
                document.body.classList.toggle('compact-mode', this.settings.compactMode);
                break;
        }
    },
    
    updateUI() {
        const container = document.getElementById('settings-grid');
        if (!container) return;
        
        const settingsList = [
            { id: 'showNotifications', name: 'Show Notifications', description: 'Display popup notifications for events' },
            { id: 'showParticles', name: 'Show Particles', description: 'Enable particle effects (may affect performance)' },
            { id: 'autoSave', name: 'Auto-Save', description: 'Automatically save game every 30 seconds' },
            { id: 'showDamageNumbers', name: 'Damage Numbers', description: 'Show floating damage numbers on clicks' },
            { id: 'showProgressBars', name: 'Progress Bars', description: 'Show progress bars everywhere' },
            { id: 'compactMode', name: 'Compact Mode', description: 'Reduce spacing for smaller screens' }
        ];
        
        let html = '';
        settingsList.forEach(setting => {
            const active = this.settings[setting.id];
            html += `
                <div class="setting-row">
                    <div>
                        <div class="setting-label">${setting.name}</div>
                        <div class="setting-description">${setting.description}</div>
                    </div>
                    <div class="toggle-switch ${active ? 'active' : ''}" onclick="settingsManager.toggleSetting('${setting.id}')">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            `;
        });
        
        // Animation speed slider
        html += `
            <div class="setting-row" style="flex-direction: column; align-items: flex-start;">
                <div class="setting-label">Animation Speed</div>
                <input type="range" min="0.5" max="2" step="0.1" value="${this.settings.animationSpeed}" 
                       onchange="settingsManager.settings.animationSpeed = parseFloat(this.value); settingsManager.applySetting('animationSpeed'); game.saveGame();"
                       style="width: 100%; margin-top: 10px;">
                <div style="text-align: center; width: 100%; color: var(--neon-cyan); margin-top: 5px;">${this.settings.animationSpeed}x</div>
            </div>
        `;
        
        container.innerHTML = html;
        
        // Render save slots
        this.renderSaveSlots();
    },
    
    renderSaveSlots() {
        const container = document.getElementById('save-slots');
        if (!container) return;
        
        let html = '';
        ['slot1', 'slot2', 'slot3'].forEach(slotId => {
            const slotData = this.saveSlots[slotId];
            const isActive = this.saveSlots.currentSlot === slotId;
            const isEmpty = !slotData;
            
            html += `
                <div class="save-slot ${isActive ? 'active' : ''} ${isEmpty ? 'empty' : ''}" onclick="settingsManager.loadSlot('${slotId}')">
                    <div class="save-slot-header">
                        <div class="save-slot-name">${slotId.toUpperCase()}</div>
                        ${!isEmpty ? `<button onclick="event.stopPropagation(); settingsManager.deleteSlot('${slotId}')" style="background: var(--neon-pink); border: none; border-radius: 5px; padding: 5px 10px; cursor: pointer;">Delete</button>` : ''}
                    </div>
                    ${isEmpty ? '<div style="text-align: center; color: var(--text-secondary); margin-top: 10px;">Empty Slot</div>' : `
                        <div class="save-slot-info">Level: ${slotData.level}</div>
                        <div class="save-slot-info">Energy: ${game.formatNumber(slotData.energy)}</div>
                        <div class="save-slot-info">Prestige: ${slotData.prestigeCount}</div>
                        <div class="save-slot-info" style="font-size: 0.8em; color: var(--text-secondary);">Saved: ${new Date(slotData.savedAt).toLocaleString()}</div>
                    `}
                </div>
            `;
        });
        
        html += `
            <div style="grid-column: 1 / -1; display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button onclick="settingsManager.saveToCurrentSlot()" 
                        style="padding: 12px 24px; background: var(--gradient-success); border: none; border-radius: 8px; color: white; font-family: 'Orbitron', sans-serif; cursor: pointer; font-size: 1em;">
                     Save to Current Slot
                </button>
                <button onclick="settingsManager.createBackup()" 
                        style="padding: 12px 24px; background: var(--gradient-alt); border: none; border-radius: 8px; color: white; font-family: 'Orbitron', sans-serif; cursor: pointer; font-size: 1em;">
                     Create Backup
                </button>
            </div>
        `;
        
        container.innerHTML = html;
    },
    
    saveToCurrentSlot() {
        const currentSlot = this.saveSlots.currentSlot;
        this.saveSlots[currentSlot] = {
            level: game.level,
            energy: game.energy,
            prestigeCount: game.prestigeCount,
            savedAt: Date.now(),
            fullData: game.getSaveData()
        };
        
        localStorage.setItem('neonNexusSaveSlots', JSON.stringify(this.saveSlots));
        notifications.success('Game Saved!', `Saved to ${currentSlot.toUpperCase()}`, 3000);
        this.renderSaveSlots();
    },
    
    loadSlot(slotId) {
        const slotData = this.saveSlots[slotId];
        if (!slotData) {
            this.saveSlots.currentSlot = slotId;
            this.renderSaveSlots();
            return;
        }
        
        if (confirm(`Load save from ${slotId.toUpperCase()}? Current progress will be saved to the current slot first.`)) {
            // Save current game to current slot first
            this.saveToCurrentSlot();
            
            // Load the selected slot
            game.loadSaveData(slotData.fullData);
            this.saveSlots.currentSlot = slotId;
            
            notifications.success('Game Loaded!', `Loaded from ${slotId.toUpperCase()}`, 3000);
            this.renderSaveSlots();
        }
    },
    
    deleteSlot(slotId) {
        if (confirm(`Delete save slot ${slotId.toUpperCase()}? This cannot be undone.`)) {
            this.saveSlots[slotId] = null;
            localStorage.setItem('neonNexusSaveSlots', JSON.stringify(this.saveSlots));
            notifications.info('Slot Deleted', `${slotId.toUpperCase()} has been deleted`, 3000);
            this.renderSaveSlots();
        }
    },
    
    createBackup() {
        const backup = game.getSaveData();
        const backupString = JSON.stringify(backup);
        const backupBlob = new Blob([backupString], { type: 'application/json' });
        const backupURL = URL.createObjectURL(backupBlob);
        
        const link = document.createElement('a');
        link.href = backupURL;
        link.download = `neon-nexus-backup-${Date.now()}.json`;
        link.click();
        
        notifications.success('Backup Created!', 'Backup file downloaded', 3000);
    },
    
    getSaveData() {
        return {
            settings: this.settings,
            saveSlots: this.saveSlots
        };
    },
    
    loadSaveData(data) {
        if (data) {
            this.settings = { ...this.settings, ...(data.settings || {}) };
            this.saveSlots = { ...this.saveSlots, ...(data.saveSlots || {}) };
            
            // Apply all settings
            Object.keys(this.settings).forEach(key => this.applySetting(key));
        }
    }
};

// ===== TOOLTIP MANAGER =====
const tooltipManager = {
    tooltip: null,
    
    init() {
        this.tooltip = document.getElementById('game-tooltip');
        
        // Add hover listeners to all interactive elements
        this.attachTooltips();
    },
    
    attachTooltips() {
        // Will be called after UI renders to attach tooltips dynamically
        setTimeout(() => {
            // Attach to upgrade cards
            document.querySelectorAll('.upgrade-card, .generator-card, .powerup-card').forEach(card => {
                card.addEventListener('mouseenter', (e) => this.show(e, card));
                card.addEventListener('mouseleave', () => this.hide());
                card.addEventListener('mousemove', (e) => this.updatePosition(e));
            });
        }, 1000);
    },
    
    show(event, element) {
        if (!this.tooltip || !settingsManager.settings.showProgressBars) return;
        
        const title = element.querySelector('.card-title, .generator-name, .powerup-name')?.textContent || '';
        const description = element.querySelector('.card-description, .generator-description, .powerup-description')?.textContent || '';
        const cost = element.querySelector('.cost-value')?.textContent || '';
        
        let content = `<div style="margin: 5px 0;">${description}</div>`;
        
        if (cost) {
            const affordable = game.energy >= parseFloat(cost.replace(/[^0-9.]/g, ''));
            content += `<div class="tooltip-stat">
                <span class="tooltip-label">Cost:</span>
                <span class="tooltip-value" style="color: ${affordable ? 'var(--neon-green)' : 'var(--neon-pink)'}">${cost}</span>
            </div>`;
            
            // Calculate time to afford
            if (!affordable) {
                const costValue = parseFloat(cost.replace(/[^0-9.]/g, ''));
                const production = generatorsManager.getTotalProduction(game);
                if (production > 0) {
                    const timeSeconds = (costValue - game.energy) / production;
                    const timeString = this.formatTime(timeSeconds);
                    content += `<div class="tooltip-stat">
                        <span class="tooltip-label">Time to Afford:</span>
                        <span class="tooltip-value">${timeString}</span>
                    </div>`;
                }
            }
        }
        
        document.getElementById('tooltip-title').textContent = title;
        document.getElementById('tooltip-content').innerHTML = content;
        
        this.updatePosition(event);
        this.tooltip.classList.add('show');
    },
    
    hide() {
        if (this.tooltip) {
            this.tooltip.classList.remove('show');
        }
    },
    
    updatePosition(event) {
        if (!this.tooltip) return;
        
        const x = event.clientX + 15;
        const y = event.clientY + 15;
        
        // Keep tooltip on screen
        const rect = this.tooltip.getBoundingClientRect();
        const maxX = window.innerWidth - rect.width - 20;
        const maxY = window.innerHeight - rect.height - 20;
        
        this.tooltip.style.left = Math.min(x, maxX) + 'px';
        this.tooltip.style.top = Math.min(y, maxY) + 'px';
    },
    
    formatTime(seconds) {
        if (seconds < 60) return `${Math.ceil(seconds)}s`;
        if (seconds < 3600) return `${Math.ceil(seconds / 60)}m`;
        if (seconds < 86400) return `${Math.ceil(seconds / 3600)}h`;
        return `${Math.ceil(seconds / 86400)}d`;
    }
};

// ===== DAMAGE NUMBERS MANAGER =====
const damageNumbersManager = {
    createDamageNumber(x, y, value, isCrit, isGolden) {
        if (!settingsManager.settings.showDamageNumbers) return;
        
        const damageEl = document.createElement('div');
        damageEl.className = 'damage-number';
        if (isCrit) damageEl.classList.add('crit');
        if (isGolden) damageEl.classList.add('golden');
        
        damageEl.textContent = `+${game.formatNumber(value)}`;
        damageEl.style.left = x + 'px';
        damageEl.style.top = y + 'px';
        
        // Random horizontal offset
        const offsetX = (Math.random() - 0.5) * 100;
        damageEl.style.transform = `translateX(${offsetX}px)`;
        
        document.body.appendChild(damageEl);
        
        // Remove after animation
        setTimeout(() => {
            damageEl.remove();
        }, 1500);
    }
};

// ===== PROGRESSION TRACKER =====
const progressionTracker = {
    update(game) {
        this.updateNextGoals(game);
        this.updateRecommendations(game);
        this.updateDPS(game);
    },
    
    updateDPS(game) {
        const dpsEl = document.getElementById('dps-value');
        if (!dpsEl) return;
        
        // Calculate total DPS (production + auto-clickers)
        const production = generatorsManager.getTotalProduction(game);
        const autoClickDPS = game.autoClickersPerSecond * game.clickPower * game.globalMultiplier * game.prestigeMultiplier;
        const totalDPS = production + autoClickDPS;
        
        dpsEl.textContent = game.formatNumber(totalDPS);
    },
    
    updateNextGoals(game) {
        const goalsEl = document.getElementById('next-goals');
        if (!goalsEl) return;
        
        let html = '';
        
        // Next level
        const xpNeeded = game.experienceToNextLevel - game.experience;
        const xpProgress = (game.experience / game.experienceToNextLevel) * 100;
        html += `
            <div class="next-milestone">
                <div class="milestone-icon"></div>
                <div class="milestone-name">Next Level: ${game.level + 1}</div>
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: ${xpProgress}%"></div>
                    <div class="progress-text">${game.formatNumber(game.experience)} / ${game.formatNumber(game.experienceToNextLevel)}</div>
                </div>
            </div>
        `;
        
        // Next achievement
        const nextAchievement = achievementsManager.achievements.find(a => !a.unlocked);
        if (nextAchievement) {
            const progress = achievementsManager.getProgress(nextAchievement, game);
            html += `
                <div class="next-milestone">
                    <div class="milestone-icon">${nextAchievement.icon}</div>
                    <div class="milestone-name">${nextAchievement.name}</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: ${progress}%"></div>
                        <div class="progress-text">${progress.toFixed(1)}%</div>
                    </div>
                </div>
            `;
        }
        
        // Next milestone
        const nextMilestone = milestonesManager.milestones.find(m => !m.unlocked);
        if (nextMilestone) {
            const progress = milestonesManager.getProgress(nextMilestone, game);
            html += `
                <div class="next-milestone">
                    <div class="milestone-icon">${nextMilestone.icon}</div>
                    <div class="milestone-name">${nextMilestone.name}</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: ${progress}%"></div>
                        <div class="progress-text">${progress.toFixed(1)}%</div>
                    </div>
                </div>
            `;
        }
        
        goalsEl.innerHTML = html;
    },
    
    updateRecommendations(game) {
        const recsEl = document.getElementById('recommendations');
        if (!recsEl) return;
        
        const recommendations = this.calculateRecommendations(game);
        
        let html = '';
        recommendations.forEach(rec => {
            html += `<li class="recommendation-item ${rec.priority ? 'priority' : ''}">${rec.icon} ${rec.text}</li>`;
        });
        
        recsEl.innerHTML = html;
    },
    
    calculateRecommendations(game) {
        const recommendations = [];
        
        // Check if should prestige
        const prestigePoints = prestigeManager.calculatePrestigePoints(game.stats.totalEnergy);
        if (prestigePoints > game.prestigePoints * 0.5) {
            recommendations.push({
                icon: '',
                text: `Consider prestiging for ${game.formatNumber(prestigePoints)} points`,
                priority: true
            });
        }
        
        // Check for affordable upgrades
        const affordableUpgrades = upgradesManager.upgrades.filter(u => {
            const cost = upgradesManager.getCost(u);
            return game.energy >= cost && u.level < u.maxLevel;
        });
        if (affordableUpgrades.length > 0) {
            recommendations.push({
                icon: '',
                text: `${affordableUpgrades.length} affordable upgrade(s) available`,
                priority: false
            });
        }
        
        // Check for affordable generators
        const affordableGenerators = generatorsManager.generators.filter(g => {
            const cost = generatorsManager.getCost(g);
            return game.energy >= cost;
        });
        if (affordableGenerators.length > 0) {
            recommendations.push({
                icon: '',
                text: `${affordableGenerators.length} generator(s) available`,
                priority: false
            });
        }
        
        // Check for available power-ups
        const readyPowerups = powerupsManager.powerups.filter(p => !p.active && p.cooldown <= 0);
        if (readyPowerups.length > 0 && game.energy >= readyPowerups[0].cost) {
            recommendations.push({
                icon: '',
                text: `${readyPowerups.length} power-up(s) ready to activate`,
                priority: false
            });
        }
        
        // Check for skill points
        if (skillTreeManager.availablePoints > 0) {
            recommendations.push({
                icon: '',
                text: `${skillTreeManager.availablePoints} skill point(s) available`,
                priority: true
            });
        }
        
        // Check for daily reward
        if (dailyRewardsManager.canClaim()) {
            recommendations.push({
                icon: '',
                text: 'Daily reward ready to claim!',
                priority: true
            });
        }
        
        // Check for completed challenges
        const completedChallenges = challengesManager.challenges.filter(c => c.completed && !c.claimedAt);
        if (completedChallenges.length > 0) {
            recommendations.push({
                icon: '',
                text: `${completedChallenges.length} challenge(s) ready to claim`,
                priority: true
            });
        }
        
        if (recommendations.length === 0) {
            recommendations.push({
                icon: '',
                text: 'Everything is optimized! Keep clicking!',
                priority: false
            });
        }
        
        return recommendations;
    }
};

// ===== HOTKEYS MANAGER =====
const hotkeysManager = {
    keys: {
        '1-9': 'Switch tabs',
        'Space': 'Click main button',
        'Ctrl+S': 'Save game',
        'Ctrl+E': 'Export save',
        'B': 'Toggle bulk buy amount',
        'A': 'Activate first available power-up',
        'U': 'Buy best affordable upgrade',
        'G': 'Buy best affordable generator'
    },
    
    init() {
        document.addEventListener('keydown', (e) => {
            // Ignore if typing in input
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            this.handleKey(e);
        });
    },
    
    handleKey(e) {
        // B - cycle bulk buy amount
        if (e.key.toLowerCase() === 'b') {
            e.preventDefault();
            this.cycleBulkBuy();
        }
        
        // A - activate power-up
        if (e.key.toLowerCase() === 'a') {
            e.preventDefault();
            const readyPowerup = powerupsManager.powerups.find(p => !p.active && p.cooldown <= 0 && game.energy >= p.cost);
            if (readyPowerup) {
                powerupsManager.activate(readyPowerup, game);
            }
        }
        
        // U - buy upgrade
        if (e.key.toLowerCase() === 'u') {
            e.preventDefault();
            const affordable = upgradesManager.upgrades
                .filter(u => game.energy >= upgradesManager.getCost(u) && u.level < u.maxLevel)
                .sort((a, b) => upgradesManager.getCost(a) - upgradesManager.getCost(b))[0];
            if (affordable) {
                upgradesManager.purchase(affordable, game);
            }
        }
        
        // G - buy generator
        if (e.key.toLowerCase() === 'g') {
            e.preventDefault();
            const affordable = generatorsManager.generators
                .filter(g => game.energy >= generatorsManager.getCost(g))
                .sort((a, b) => generatorsManager.getCost(a) - generatorsManager.getCost(b))[0];
            if (affordable) {
                generatorsManager.purchase(affordable, game);
            }
        }
    },
    
    cycleBulkBuy() {
        const amounts = ['1', '10', '25', '100', 'max'];
        const currentBtn = document.querySelector('.bulk-buy-controls .bulk-buy-btn.active');
        if (!currentBtn) return;
        
        const currentIndex = amounts.indexOf(currentBtn.dataset.amount);
        const nextIndex = (currentIndex + 1) % amounts.length;
        
        const nextBtn = document.querySelector(`.bulk-buy-controls .bulk-buy-btn[data-amount="${amounts[nextIndex]}"]`);
        if (nextBtn) {
            nextBtn.click();
            notifications.info('Bulk Buy', `Amount set to ${amounts[nextIndex]}`, 1000);
        }
    }
};

// ===== ENHANCED STATISTICS =====
const enhancedStatsManager = {
    history: {
        energyHistory: [],
        clickHistory: [],
        maxHistoryLength: 100
    },
    
    records: {
        highestEnergyEver: 0,
        highestCombo: 0,
        mostCritsInRow: 0,
        fastestPrestige: Infinity,
        longestSession: 0
    },
    
    currentSession: {
        startTime: Date.now(),
        energyGained: 0,
        clicksMade: 0
    },
    
    update(game) {
        // Update history
        this.addToHistory('energy', game.energy);
        
        // Update records
        if (game.energy > this.records.highestEnergyEver) {
            this.records.highestEnergyEver = game.energy;
        }
        if (game.stats.highestCombo > this.records.highestCombo) {
            this.records.highestCombo = game.stats.highestCombo;
        }
        
        // Update session
        const sessionLength = Date.now() - this.currentSession.startTime;
        if (sessionLength > this.records.longestSession) {
            this.records.longestSession = sessionLength;
        }
    },
    
    addToHistory(type, value) {
        const history = this.history[type + 'History'];
        if (history) {
            history.push({ time: Date.now(), value });
            if (history.length > this.maxHistoryLength) {
                history.shift();
            }
        }
    },
    
    getSaveData() {
        return {
            records: this.records,
            currentSession: this.currentSession
        };
    },
    
    loadSaveData(data) {
        if (data) {
            this.records = { ...this.records, ...(data.records || {}) };
            this.currentSession = { ...this.currentSession, ...(data.currentSession || {}) };
            this.currentSession.startTime = Date.now(); // Reset session start
        }
    }
};

    </script>

    <script>
// Core Game Engine

class Game {
    constructor() {
        // Core resources
        this.energy = 0;
        this.clickPower = 1;
        this.globalMultiplier = 1;
        
        // Combo system
        this.comboCount = 0;
        this.comboWindow = 2000; // milliseconds
        this.comboTimeout = null;
        this.comboBonus = 0; // Additional combo bonus from upgrades
        this.comboFrozen = false; // From power-up
        this.comboWindowBonus = 0; // From prestige
        
        // Click modifiers
        this.clickPowerMultiplier = 1; // From power-ups
        this.critChance = 0;
        this.critMultiplier = 2;
        this.startingCritChance = 0;
        this.guaranteedCrit = false; // From power-up
        
        // Production modifiers
        this.productionMultiplier = 1; // From power-ups
        this.energyGainMultiplier = 1; // From power-ups
        this.eventProductionBonus = 1; // From events
        
        // Auto-clickers
        this.autoClickersPerSecond = 0;
        this.autoClickerMultiplier = 1; // From power-ups
        
        // Cost modifiers
        this.costReduction = 0; // From power-ups
        this.powerupCostReduction = 0; // From prestige
        this.freeUpgrades = false; // From events
        
        // Prestige system
        this.prestigeCount = 0;
        this.prestigePoints = 0;
        this.prestigeMultiplier = 1;
        this.prestigeBonus = 0;
        this.prestigePointsBonus = 0;
        this.startingEnergy = 0;
        this.startingMultiplier = 0;
        
        // Level system
        this.level = 1;
        this.experience = 0;
        this.experienceToNextLevel = 100;
        
        // Special mechanics
        this.goldenClicksRemaining = 0; // From events
        this.autoBuyGenerators = false; // From prestige
        this.offlineProductionRate = 0; // From prestige
        this.powerupDurationBonus = 0; // From achievements
        this.eventSpawnBonus = 0; // From achievements/prestige
        
        // Statistics
        this.stats = {
            totalClicks: 0,
            totalEnergy: 0,
            playTime: 0,
            highestCombo: 0,
            criticalClicks: 0,
            powerupsUsed: 0,
            eventsCompleted: 0
        };
        
        // Game state
        this.lastUpdate = Date.now();
        this.lastSave = Date.now();
        this.autoSaveInterval = 30000; // 30 seconds
        
        // Initialize
        this.init();
    }
    
    init() {
        // Load saved game if exists
        this.loadGame();
        
        // Start game loop
        this.gameLoop();
        
        // Auto-save
        setInterval(() => this.saveGame(), this.autoSaveInterval);
    }
    
    gameLoop() {
        const now = Date.now();
        const deltaTime = (now - this.lastUpdate) / 1000; // seconds
        this.lastUpdate = now;
        
        // Update game logic
        this.update(deltaTime);
        
        // Continue loop
        requestAnimationFrame(() => this.gameLoop());
    }
    
    update(deltaTime) {
        // Update play time
        this.stats.playTime += deltaTime;
        
        // Generate passive income
        this.generatePassiveIncome(deltaTime);
        
        // Auto-clickers
        this.processAutoClickers(deltaTime);
        
        // Update power-ups
        powerupsManager.update(deltaTime, this);
        
        // Update events
        eventsManager.update(deltaTime, this);
        
        // Check achievements
        achievementsManager.check(this);
        
        // Check milestones
        milestonesManager.check(this);
        
        // Update level
        this.updateLevel();
        
        // Update new systems
        automationManager.update(this);
        progressionTracker.update(this);
        enhancedStatsManager.update(this);
        
        // Update daily rewards timer
        if (Math.floor(deltaTime) % 60 === 0) { // Every minute
            dailyRewardsManager.updateUI();
        }
        
        // Update UI
        if (typeof updateUI === 'function') {
            updateUI(this);
        }
    }
    
    generatePassiveIncome(deltaTime) {
        const production = generatorsManager.getTotalProduction(this);
        const modifiedProduction = production * 
            this.productionMultiplier * 
            this.eventProductionBonus *
            this.energyGainMultiplier;
        
        const energyGained = modifiedProduction * deltaTime;
        this.addEnergy(energyGained);
    }
    
    processAutoClickers(deltaTime) {
        if (this.autoClickersPerSecond > 0) {
            const clicks = this.autoClickersPerSecond * this.autoClickerMultiplier * deltaTime;
            const wholeClicks = Math.floor(clicks);
            
            for (let i = 0; i < wholeClicks; i++) {
                this.click(false, true); // Silent auto-clicks
            }
        }
    }
    
    click(x = null, y = null, isAuto = false) {
        // Calculate click value
        let clickValue = this.clickPower * this.clickPowerMultiplier;
        
        // Check for critical hit
        const isCrit = this.guaranteedCrit || Math.random() < this.critChance;
        if (isCrit) {
            clickValue *= this.critMultiplier;
            this.stats.criticalClicks++;
            
            if (!isAuto && x && y) {
                // Visual feedback for crit
                particleSystem.createTextParticle(x, y, 'CRIT!', '#ff00ff');
            }
        }
        
        // Golden click bonus
        if (this.goldenClicksRemaining > 0) {
            clickValue *= 100;
            this.goldenClicksRemaining--;
            
            if (!isAuto && x && y) {
                particleSystem.createTextParticle(x, y, 'GOLDEN!', '#ffd700');
            }
        }
        
        // Apply combo
        if (!this.comboFrozen) {
            this.comboCount++;
            this.resetComboTimer();
        } else {
            this.comboCount++;
        }
        
        if (this.comboCount > this.stats.highestCombo) {
            this.stats.highestCombo = this.comboCount;
        }
        
        const comboMultiplier = 1 + (this.comboCount * 0.01) + this.comboBonus;
        clickValue *= comboMultiplier;
        
        // Apply global multiplier
        clickValue *= this.globalMultiplier;
        
        // Apply prestige multiplier
        clickValue *= this.prestigeMultiplier;
        
        // Apply energy gain multiplier
        clickValue *= this.energyGainMultiplier;
        
        // Add energy
        this.addEnergy(clickValue);
        
        // Update stats
        this.stats.totalClicks++;
        
        // Enhanced features
        if (!isAuto && x && y) {
            damageNumbersManager.createDamageNumber(x, y, clickValue, isCrit, this.goldenClicksRemaining > 0);
        }
        
        // Check for artifact drops
        if (!isAuto) {
            collectionManager.checkDrop(this);
        }
        
        // Update challenge progress
        challengesManager.updateProgress('clicks', 1);
        if (isCrit) {
            challengesManager.updateProgress('crits', 1);
        }
        if (this.comboCount > 50) {
            challengesManager.updateProgress('combo', this.comboCount);
        }

        
        // Add experience
        this.addExperience(1);
        
        // Visual feedback
        if (!isAuto && x && y) {
            particleSystem.createTextParticle(
                x, 
                y, 
                '+' + this.formatNumber(clickValue),
                isCrit ? '#ff00ff' : '#00ffff'
            );
            particleSystem.createRipple(x, y);
        }
    }
    
    resetComboTimer() {
        if (this.comboTimeout) {
            clearTimeout(this.comboTimeout);
        }
        
        if (!this.comboFrozen) {
            const window = this.comboWindow + this.comboWindowBonus;
            this.comboTimeout = setTimeout(() => {
                this.comboCount = 0;
            }, window);
        }
    }
    
    addEnergy(amount) {
        this.energy += amount;
        
        challengesManager.updateProgress('energy', amount);

        this.stats.totalEnergy += amount;
        
        // Auto-buy generators if unlocked
        if (this.autoBuyGenerators) {
            this.autoBuyGeneratorsFunction();
        }
    }
    
    autoBuyGeneratorsFunction() {
        generatorsManager.generators.forEach(generator => {
            if (generatorsManager.canAfford(generator, this.energy) &&
                generatorsManager.isUnlocked(generator, this.stats.totalEnergy)) {
                generatorsManager.purchase(generator, this);
            }
        });
    }
    
    addExperience(amount) {
        this.experience += amount;
        
        while (this.experience >= this.experienceToNextLevel) {
            this.levelUp();
        }
    }
    
    levelUp() {
        this.experience -= this.experienceToNextLevel;
        this.level++;
        this.experienceToNextLevel = Math.floor(100 * Math.pow(1.1, this.level - 1));
        
        // Level up rewards
        this.clickPower += this.level;
        this.globalMultiplier += 0.01;
        
        notifications.success(
            '\u2b50 LEVEL UP!',
            `Level ${this.level} - Click power +${this.level}!`
        );
        
        // Celebration effect
        const levelDisplay = document.getElementById('player-level');
        if (levelDisplay) {
            particleSystem.createCelebration(levelDisplay);
        }
    }
    
    updateLevel() {
        // Levels are updated through experience gain
    }
    
    formatNumber(num) {
        if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
        if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
        if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
        if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
        return Math.floor(num).toString();
    }
    
    formatTime(seconds) {
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = Math.floor(seconds % 60);
        
        if (hours > 0) {
            return `${hours}h ${minutes}m`;
        } else if (minutes > 0) {
            return `${minutes}m ${secs}s`;
        } else {
            return `${secs}s`;
        }
    }
    
    saveGame() {
        const saveData = {
            version: '1.0',
            timestamp: Date.now(),
            game: {
                energy: this.energy,
                clickPower: this.clickPower,
                globalMultiplier: this.globalMultiplier,
                comboCount: this.comboCount,
                comboBonus: this.comboBonus,
                comboWindowBonus: this.comboWindowBonus,
                critChance: this.critChance,
                critMultiplier: this.critMultiplier,
                startingCritChance: this.startingCritChance,
                autoClickersPerSecond: this.autoClickersPerSecond,
                prestigeCount: this.prestigeCount,
                prestigePoints: this.prestigePoints,
                prestigeMultiplier: this.prestigeMultiplier,
                prestigeBonus: this.prestigeBonus,
                prestigePointsBonus: this.prestigePointsBonus,
                startingEnergy: this.startingEnergy,
                startingMultiplier: this.startingMultiplier,
                level: this.level,
                experience: this.experience,
                experienceToNextLevel: this.experienceToNextLevel,
                autoBuyGenerators: this.autoBuyGenerators,
                offlineProductionRate: this.offlineProductionRate,
                powerupDurationBonus: this.powerupDurationBonus,
                eventSpawnBonus: this.eventSpawnBonus,
                powerupCostReduction: this.powerupCostReduction,
                stats: this.stats
            },
            upgrades: upgradesManager.getSaveData(),
            generators: generatorsManager.getSaveData(),
            achievements: achievementsManager.getSaveData(),
            prestige: prestigeManager.getSaveData(),
            powerups: powerupsManager.getSaveData(),
            events: eventsManager.getSaveData(),
            milestones: milestonesManager.getSaveData()
        };
        
        localStorage.setItem('neonNexusSave', JSON.stringify(saveData));
        this.lastSave = Date.now();
        
        return saveData;
    }
    
    loadGame() {
        const saveDataStr = localStorage.getItem('neonNexusSave');
        if (!saveDataStr) return false;
        
        try {
            const saveData = JSON.parse(saveDataStr);
            
            // Load game state
            const game = saveData.game;
            this.energy = game.energy || 0;
            this.clickPower = game.clickPower || 1;
            this.globalMultiplier = game.globalMultiplier || 1;
            this.comboCount = game.comboCount || 0;
            this.comboBonus = game.comboBonus || 0;
            this.comboWindowBonus = game.comboWindowBonus || 0;
            this.critChance = game.critChance || 0;
            this.critMultiplier = game.critMultiplier || 2;
            this.startingCritChance = game.startingCritChance || 0;
            this.autoClickersPerSecond = game.autoClickersPerSecond || 0;
            this.prestigeCount = game.prestigeCount || 0;
            this.prestigePoints = game.prestigePoints || 0;
            this.prestigeMultiplier = game.prestigeMultiplier || 1;
            this.prestigeBonus = game.prestigeBonus || 0;
            this.prestigePointsBonus = game.prestigePointsBonus || 0;
            this.startingEnergy = game.startingEnergy || 0;
            this.startingMultiplier = game.startingMultiplier || 0;
            this.level = game.level || 1;
            this.experience = game.experience || 0;
            this.experienceToNextLevel = game.experienceToNextLevel || 100;
            this.autoBuyGenerators = game.autoBuyGenerators || false;
            this.offlineProductionRate = game.offlineProductionRate || 0;
            this.powerupDurationBonus = game.powerupDurationBonus || 0;
            this.eventSpawnBonus = game.eventSpawnBonus || 0;
            this.powerupCostReduction = game.powerupCostReduction || 0;
            this.stats = game.stats || {
                totalClicks: 0,
                totalEnergy: 0,
                playTime: 0,
                highestCombo: 0,
                criticalClicks: 0,
                powerupsUsed: 0,
                eventsCompleted: 0
            };
            
            // Load managers
            upgradesManager.loadSaveData(saveData.upgrades);
            generatorsManager.loadSaveData(saveData.generators);
            achievementsManager.loadSaveData(saveData.achievements);
            prestigeManager.loadSaveData(saveData.prestige);
            powerupsManager.loadSaveData(saveData.powerups);
            eventsManager.loadSaveData(saveData.events, this);
            milestonesManager.loadSaveData(saveData.milestones);
            
            // Re-apply all upgrades
            upgradesManager.upgrades.forEach(upgrade => {
                for (let i = 0; i < upgrade.currentLevel; i++) {
                    upgrade.apply(this);
                }
            });
            
            // Re-apply all prestige upgrades
            prestigeManager.prestigeUpgrades.forEach(upgrade => {
                for (let i = 0; i < upgrade.currentLevel; i++) {
                    upgrade.apply(this);
                }
            });
            
            // Re-apply all achievements
            achievementsManager.achievements.forEach(achievement => {
                if (achievement.unlocked) {
                    achievement.apply(this);
                }
            });
            
            // Re-apply all milestones
            milestonesManager.milestones.forEach(milestone => {
                if (milestone.unlocked) {
                    milestone.apply(this);
                }
            });
            
            // Calculate offline progress
            if (saveData.timestamp && this.offlineProductionRate > 0) {
                const offlineTime = (Date.now() - saveData.timestamp) / 1000;
                const production = generatorsManager.getTotalProduction(this);
                const offlineEnergy = production * offlineTime * this.offlineProductionRate;
                
                if (offlineEnergy > 0) {
                    this.energy += offlineEnergy;
                    this.stats.totalEnergy += offlineEnergy;
                    
                    notifications.success(
                        ' Welcome Back!',
                        `You earned ${this.formatNumber(offlineEnergy)} energy while away (${this.formatTime(offlineTime)})`,
                        6000
                    );
                }
            }
            
            notifications.success('Game Loaded', 'Progress restored successfully!');
            return true;
        } catch (error) {
            console.error('Failed to load save:', error);
            notifications.error('Load Failed', 'Could not restore save data');
            return false;
        }
    }
    
    exportSave() {
        const saveData = this.saveGame();
        const encoded = btoa(JSON.stringify(saveData));
        
        // Copy to clipboard
        navigator.clipboard.writeText(encoded).then(() => {
            notifications.success('Exported!', 'Save data copied to clipboard');
        }).catch(() => {
            // Fallback: show in alert
            prompt('Copy this save data:', encoded);
        });
    }
    
    importSave(encoded) {
        try {
            const decoded = atob(encoded);
            const saveData = JSON.parse(decoded);
            
            localStorage.setItem('neonNexusSave', JSON.stringify(saveData));
            location.reload();
            
            return true;
        } catch (error) {
            console.error('Failed to import save:', error);
            notifications.error('Import Failed', 'Invalid save data');
            return false;
        }
    }
    
    hardReset() {
        if (confirm('Are you sure? This will delete ALL progress!')) {
            if (confirm('Really? This cannot be undone!')) {
                localStorage.removeItem('neonNexusSave');
                location.reload();
            }
        }
    }
}

// Create global game instance
const game = new Game();
    </script>
    
    <!-- UI System -->
    <script>
// UI System

function updateUI(game) {
    // Update energy display
    document.getElementById('energy-amount').textContent = game.formatNumber(game.energy);
    
    // Update energy per second
    const energyPerSec = generatorsManager.getTotalProduction(game);
    document.getElementById('energy-per-sec').textContent = game.formatNumber(energyPerSec);
    
    // Update level
    document.getElementById('player-level').textContent = game.level;
    
    // Update prestige count
    document.getElementById('prestige-count').textContent = game.prestigeCount;
    
    // Update multipliers
    document.getElementById('click-power').textContent = game.formatNumber(game.clickPower * game.clickPowerMultiplier);
    document.getElementById('global-mult').textContent = game.globalMultiplier.toFixed(2);
    
    if (game.prestigeMultiplier > 1) {
        document.getElementById('prestige-mult-display').style.display = 'flex';
        document.getElementById('prestige-mult').textContent = game.prestigeMultiplier.toFixed(2);
    }
    
    // Update combo
    if (game.comboCount > 1) {
        document.getElementById('combo-counter').style.display = 'block';
        document.getElementById('combo-value').textContent = game.comboCount;
    } else {
        document.getElementById('combo-counter').style.display = 'none';
    }
    
    // Update statistics
    document.getElementById('total-clicks').textContent = game.formatNumber(game.stats.totalClicks);
    document.getElementById('total-energy').textContent = game.formatNumber(game.stats.totalEnergy);
    document.getElementById('play-time').textContent = game.formatTime(game.stats.playTime);
    document.getElementById('highest-combo').textContent = game.stats.highestCombo;
    document.getElementById('unlocked-achievements').textContent = achievementsManager.getUnlockedCount();
    document.getElementById('total-achievements').textContent = achievementsManager.getTotalCount();
    
    // Update level progress
    const levelProgress = (game.experience / game.experienceToNextLevel) * 100;
    document.getElementById('level-progress').style.width = levelProgress + '%';
    document.getElementById('level-progress-text').textContent = Math.floor(levelProgress) + '%';
}

function renderUpgrades() {
    const grid = document.getElementById('upgrades-grid');
    grid.innerHTML = '';
    
    upgradesManager.upgrades.forEach(upgrade => {
        const isUnlocked = upgradesManager.isUnlocked(upgrade, game);
        const isMaxed = upgradesManager.isMaxed(upgrade);
        const cost = upgradesManager.getCost(upgrade);
        const canAfford = upgradesManager.canAfford(upgrade, game.energy);
        
        if (!isUnlocked) return; // Don't show locked upgrades
        
        const card = document.createElement('div');
        card.className = 'upgrade-card';
        card.dataset.upgradeId = upgrade.id;
        
        if (isMaxed) card.classList.add('maxed');
        
        card.innerHTML = `
            <div class=\"upgrade-header\">
                <span class=\"upgrade-icon\">${upgrade.icon}</span>
                <span class=\"upgrade-level\">Lv. ${upgrade.currentLevel}</span>
            </div>
            <div class=\"upgrade-name\">${upgrade.name}</div>
            <div class=\"upgrade-description\">${upgrade.description}</div>
            <div class=\"upgrade-effect\">${upgrade.effect}</div>
            <div class=\"upgrade-cost\">
                <span class=\"cost-label\">Cost:</span>
                <span class=\"cost-value ${canAfford ? 'affordable' : 'expensive'}\">${game.formatNumber(cost)}</span>
            </div>
        `;
        
        if (!isMaxed) {
            card.addEventListener('click', () => {
                if (upgradesManager.purchase(upgrade, game)) {
                    renderUpgrades();
                }
            });
        }
        
        grid.appendChild(card);
    });
}

function renderGenerators() {
    const list = document.getElementById('generators-list');
    list.innerHTML = '';
    
    generatorsManager.generators.forEach(generator => {
        const isUnlocked = generatorsManager.isUnlocked(generator, game.stats.totalEnergy);
        const cost = generatorsManager.getCost(generator);
        const canAfford = generatorsManager.canAfford(generator, game.energy);
        const production = generatorsManager.getProduction(generator, game);
        
        if (!isUnlocked && generator.unlockCost > 0) {
            // Show locked generator with requirements
            const card = document.createElement('div');
            card.className = 'generator-card locked';
            card.innerHTML = `
                <div class=\"generator-header\">
                    <span class=\"generator-icon\">\ud83d\udd12</span>
                    <div class=\"generator-info\">
                        <div class=\"generator-name\">???</div>
                        <div class=\"generator-production\">Unlock at ${game.formatNumber(generator.unlockCost)} total energy</div>
                    </div>
                </div>
            `;
            list.appendChild(card);
            return;
        }
        
        const card = document.createElement('div');
        card.className = 'generator-card';
        card.dataset.generatorId = generator.id;
        
        card.innerHTML = `
            <div class=\"generator-header\">
                <span class=\"generator-icon\">${generator.icon}</span>
                <div class=\"generator-info\">
                    <div class=\"generator-name\">${generator.name}</div>
                    <div class=\"generator-count\">Owned: <span class=\"generator-count-value\">${generator.count}</span></div>
                </div>
            </div>
            <div class=\"generator-production\">${game.formatNumber(production)}/sec</div>
            <div class=\"generator-footer\">
                <span class=\"generator-cost ${canAfford ? 'affordable' : 'expensive'}\">${game.formatNumber(cost)}</span>
            </div>
        `;
        
        card.addEventListener('click', () => {
            if (generatorsManager.purchase(generator, game)) {
                renderGenerators();
            }
        });
        
        list.appendChild(card);
    });
}

function renderPowerups() {
    const grid = document.getElementById('powerups-grid');
    grid.innerHTML = '';
    
    powerupsManager.powerups.forEach(powerup => {
        const cost = powerupsManager.getCost(powerup, game);
        const canUse = powerupsManager.canUse(powerup, game);
        
        const card = document.createElement('div');
        card.className = 'powerup-card';
        card.dataset.powerupId = powerup.id;
        
        if (powerup.active) card.classList.add('active');
        if (powerup.cooldownRemaining > 0) card.classList.add('cooldown');
        
        let statusHtml = '';
        if (powerup.cooldownRemaining > 0) {
            statusHtml = `<div class=\"powerup-cooldown\">${Math.ceil(powerup.cooldownRemaining)}s</div>`;
        }
        
        card.innerHTML = `
            ${statusHtml}
            <div class=\"powerup-icon\">${powerup.icon}</div>
            <div class=\"powerup-name\">${powerup.name}</div>
            <div class=\"powerup-description\">${powerup.description}</div>
            <div class=\"powerup-duration\">Duration: ${powerup.duration}s</div>
            <div class=\"powerup-cost\">${game.formatNumber(cost)} Energy</div>
        `;
        
        if (canUse) {
            card.addEventListener('click', () => {
                if (powerupsManager.activate(powerup, game)) {
                    renderPowerups();
                }
            });
        }
        
        grid.appendChild(card);
    });
    
    // Update active power-ups display
    renderActivePowerups();
}

function renderActivePowerups() {
    const container = document.getElementById('active-powerups');
    container.innerHTML = '';
    
    const activePowerups = powerupsManager.getActivePowerups();
    
    activePowerups.forEach(powerup => {
        const item = document.createElement('div');
        item.className = 'powerup-active-item';
        
        const progress = (powerup.remaining / powerupsManager.getDuration(powerup, game)) * 100;
        
        item.innerHTML = `
            <div class=\"powerup-active-header\">
                <span class=\"powerup-active-name\">${powerup.icon} ${powerup.name}</span>
                <span class=\"powerup-active-timer\">${Math.ceil(powerup.remaining)}s</span>
            </div>
            <div class=\"powerup-progress\">
                <div class=\"powerup-progress-fill\" style=\"width: ${progress}%\"></div>
            </div>
        `;
        
        container.appendChild(item);
    });
}

function renderAchievements(filter = 'all') {
    const grid = document.getElementById('achievements-grid');
    grid.innerHTML = '';
    
    let achievements = achievementsManager.achievements;
    
    if (filter === 'unlocked') {
        achievements = achievements.filter(a => a.unlocked);
    } else if (filter === 'locked') {
        achievements = achievements.filter(a => !a.unlocked);
    }
    
    achievements.forEach(achievement => {
        const card = document.createElement('div');
        card.className = 'achievement-card';
        card.dataset.achievementId = achievement.id;
        
        if (achievement.unlocked) {
            card.classList.add('unlocked');
        } else {
            card.classList.add('locked');
        }
        
        card.innerHTML = `
            <div class=\"achievement-tier ${achievement.tier}\">${achievement.tier.toUpperCase()}</div>
            <div class=\"achievement-icon\">${achievement.icon}</div>
            <div class=\"achievement-name\">${achievement.name}</div>
            <div class=\"achievement-description\">${achievement.description}</div>
            <div class=\"achievement-reward\">\u2728 ${achievement.reward}</div>
        `;
        
        grid.appendChild(card);
    });
}

function renderPrestige() {
    // Update prestige stats
    document.getElementById('prestige-current-energy').textContent = game.formatNumber(game.stats.totalEnergy);
    document.getElementById('prestige-points-gain').textContent = prestigeManager.getPrestigeGain(game);
    document.getElementById('prestige-points-total').textContent = game.prestigePoints;
    
    const bonus = (game.prestigeMultiplier - 1) * 100;
    document.getElementById('prestige-bonus-display').textContent = '+' + bonus.toFixed(0) + '%';
    
    // Update prestige button
    const prestigeBtn = document.getElementById('prestige-btn');
    const canPrestige = prestigeManager.canPrestige(game);
    prestigeBtn.disabled = !canPrestige;
    
    // Render prestige upgrades
    const grid = document.getElementById('prestige-upgrades-grid');
    grid.innerHTML = '';
    
    prestigeManager.prestigeUpgrades.forEach(upgrade => {
        const cost = prestigeManager.getCost(upgrade);
        const canAfford = prestigeManager.canAfford(upgrade, game.prestigePoints);
        const isMaxed = prestigeManager.isMaxed(upgrade);
        
        const card = document.createElement('div');
        card.className = 'prestige-upgrade-card upgrade-card';
        card.dataset.prestigeUpgradeId = upgrade.id;
        
        if (isMaxed) card.classList.add('maxed');
        
        card.innerHTML = `
            <div class=\"upgrade-header\">
                <span class=\"upgrade-icon\">${upgrade.icon}</span>
                <span class=\"upgrade-level\">Lv. ${upgrade.currentLevel}</span>
            </div>
            <div class=\"upgrade-name\">${upgrade.name}</div>
            <div class=\"upgrade-description\">${upgrade.description}</div>
            <div class=\"upgrade-effect\">${upgrade.effect}</div>
            <div class=\"upgrade-cost\">
                <span class=\"cost-label\">Cost:</span>
                <span class=\"cost-value prestige-points ${canAfford ? 'affordable' : 'expensive'}\">${cost} PP</span>
            </div>
        `;
        
        if (!isMaxed) {
            card.addEventListener('click', () => {
                if (prestigeManager.purchase(upgrade, game)) {
                    renderPrestige();
                }
            });
        }
        
        grid.appendChild(card);
    });
}

function renderMilestones() {
    const list = document.getElementById('milestones-list');
    list.innerHTML = '';
    
    milestonesManager.milestones.forEach(milestone => {
        const progress = milestonesManager.getProgress(milestone, game);
        
        const card = document.createElement('div');
        card.className = 'milestone-item';
        card.dataset.milestoneId = milestone.id;
        
        if (milestone.unlocked) {
            card.classList.add('unlocked');
        }
        
        card.innerHTML = `
            <div class=\"milestone-header\">
                <span class=\"milestone-name\">${milestone.icon} ${milestone.name}</span>
                <span class=\"milestone-reward\">${milestone.reward}</span>
            </div>
            <div class=\"milestone-progress-bar\">
                <div class=\"milestone-progress-fill\" style=\"width: ${progress}%\"></div>
            </div>
            <div class=\"milestone-progress-text\">${game.formatNumber(progress)}%</div>
        `;
        
        list.appendChild(card);
    });
}

function renderEvent() {
    const eventContainer = document.getElementById('special-event');
    const event = eventsManager.currentEvent;
    
    if (event) {
        eventContainer.style.display = 'block';
        document.getElementById('event-title').textContent = event.title;
        document.getElementById('event-description').textContent = event.description;
        
        const timeLeft = Math.ceil(eventsManager.eventTimer / 1000);
        document.getElementById('event-timer').textContent = `${timeLeft}s remaining`;
    } else {
        eventContainer.style.display = 'none';
    }
}

function initializeUI() {
    // Render all tabs
    renderUpgrades();
    renderGenerators();
    renderPowerups();
    renderAchievements();
    renderPrestige();
    renderMilestones();
    renderEvent();
    
    // Tab navigation
    console.log('%c[DEBUG] Attaching tab button listeners', 'color: #ff00ff; font-weight: bold');
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const tab = btn.dataset.tab;
            console.log('%c[TAB] Tab clicked:', 'color: #00ffff; font-weight: bold', tab);
            
            // Update active tab button
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Update active tab pane
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            document.getElementById(tab + '-tab').classList.add('active');
            
            // Re-render content
            switch(tab) {
                case 'upgrades':
                    renderUpgrades();
                    break;
                case 'generators':
                    renderGenerators();
                    break;
                case 'powerups':
                    renderPowerups();
                    break;
                case 'achievements':
                    renderAchievements();
                    break;
                case 'prestige':
                    renderPrestige();
                    break;
            }
        });
        
        // Add touchstart listener for mobile debugging
        btn.addEventListener('touchstart', (e) => {
            console.log('%c[TAB TOUCH] Tab touched:', 'color: #00ffff; font-weight: bold', btn.dataset.tab);
        }, { passive: true });
    });
    console.log('%c[DEBUG] Tab button listeners attached:', 'color: #00ff00; font-weight: bold', document.querySelectorAll('.tab-btn').length, 'buttons');
    
    // Achievement filters
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const filter = btn.dataset.filter;
            
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            renderAchievements(filter);
        });
    });
    
    // Main click button - support both mouse and touch events
    console.log('%c[DEBUG] Attaching event listeners to main click button', 'color: #ff00ff; font-weight: bold');
    const mainClickBtn = document.getElementById('main-click-btn');
    if (mainClickBtn) {
        // UNIFIED CLICK HANDLER - Works for both mouse and touch
        const handleClick = (e) => {
            console.log('%c[CLICK] Button activated!', 'color: #00ff00; font-weight: bold', e.type);
            
            // Visual feedback
            const target = e.currentTarget;
            target.style.transform = 'scale(0.95)';
            setTimeout(() => {
                target.style.transform = '';
            }, 100);
            
            const rect = e.currentTarget.getBoundingClientRect();
            let x, y;
            
            // Get coordinates from touch or mouse event
            if (e.type === 'touchstart') {
                const touch = e.touches[0];
                x = touch.clientX;
                y = touch.clientY;
            } else if (e.type === 'click') {
                x = e.clientX;
                y = e.clientY;
            }
            
            console.log('%c[CLICK] Calling game.click() at', 'color: #ffff00; font-weight: bold', x, y);
            game.click(x, y);
            console.log('%c[CLICK] game.click() completed', 'color: #00ff00; font-weight: bold');
        };
        
        // Add event listeners
        // For desktop: click event
        mainClickBtn.addEventListener('click', handleClick);
        // For mobile: touchstart event (fires immediately on touch)
        mainClickBtn.addEventListener('touchstart', (e) => {
            console.log('%c[TOUCH] touchstart detected', 'color: #00ffff; font-weight: bold');
            handleClick(e);
            // Prevent click event from firing after touchstart to avoid double-trigger
            e.preventDefault();
        }, { passive: false });
        
        console.log('%c[DEBUG] Event listeners attached successfully (click + touchstart)', 'color: #00ff00; font-weight: bold');
    } else {
        console.error('[ERROR] Main click button not found!');
    }
    
    // Prestige button
    document.getElementById('prestige-btn').addEventListener('click', () => {
        if (prestigeManager.performPrestige(game)) {
            // Refresh all displays
            renderUpgrades();
            renderGenerators();
            renderPowerups();
            renderAchievements();
            renderPrestige();
            renderMilestones();
        }
    });
    
    // Event claim button
    document.getElementById('event-claim-btn').addEventListener('click', () => {
        eventsManager.claimEvent();
        renderEvent();
    });
    
    // Daily rewards button
    document.getElementById('claim-daily-btn').addEventListener('click', () => {
        dailyRewardsManager.claim(game);
    });
    
    // Settings buttons
    document.getElementById('save-btn').addEventListener('click', () => {
        game.saveGame();
        notifications.success('Saved!', 'Game saved successfully');
    });
    
    document.getElementById('load-btn').addEventListener('click', () => {
        location.reload();
    });
    
    document.getElementById('export-btn').addEventListener('click', () => {
        game.exportSave();
    });
    
    document.getElementById('import-btn').addEventListener('click', () => {
        document.getElementById('import-modal').style.display = 'flex';
    });
    
    document.getElementById('import-confirm-btn').addEventListener('click', () => {
        const data = document.getElementById('import-textarea').value.trim();
        if (data) {
            game.importSave(data);
        }
    });
    
    document.getElementById('import-cancel-btn').addEventListener('click', () => {
        document.getElementById('import-modal').style.display = 'none';
        document.getElementById('import-textarea').value = '';
    });
    
    document.getElementById('reset-btn').addEventListener('click', () => {
        game.hardReset();
    });
    
    // Update UI periodically
    setInterval(() => {
        renderEvent();
        renderActivePowerups();
        
        // Update visible tab content
        const activeTab = document.querySelector('.tab-btn.active').dataset.tab;
        switch(activeTab) {
            case 'upgrades':
                renderUpgrades();
                break;
            case 'generators':
                renderGenerators();
                break;
            case 'powerups':
                renderPowerups();
                break;
            case 'prestige':
                renderPrestige();
                break;
        }
    }, 1000);

    
    // Initialize new managers
    bulkBuyManager.init();
    dailyRewardsManager.init();
    challengesManager.init();
    skillTreeManager.init();
    collectionManager.init();
    automationManager.init();
    settingsManager.init();
    tooltipManager.init();
    hotkeysManager.init();
    
    console.log(' Enhanced features initialized!');
}
    </script>
    
    <!-- Main Initialization -->
    <script>
// Main Initialization

// Detect if user is on a mobile device
const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent) || 
                 (navigator.maxTouchPoints && navigator.maxTouchPoints > 1);

// Initialize the game
function initGame() {
    console.log('%c NEON NEXUS ', 'font-size: 24px; color: #00ffff; font-weight: bold; text-shadow: 0 0 10px #00ffff');
    console.log('%cThe Ultimate Idle Experience', 'font-size: 14px; color: #ff00ff; text-shadow: 0 0 10px #ff00ff');
    
    if (isMobile) {
        console.log('%c Mobile mode enabled', 'color: #00ff00; font-weight: bold');
    }
    
    // Show welcome notification
    setTimeout(() => {
        if (game.stats.playTime === 0) {
            notifications.success(
                ' Welcome to Neon Nexus!',
                'Click the glowing orb to generate energy and begin your journey!',
                5000
            );
        } else {
            notifications.success(
                ' Welcome Back!',
                `Level ${game.level} | ${game.formatNumber(game.energy)} Energy`,
                3000
            );
        }
    }, 500);
    
    // Initialize UI
    initializeUI();
    
    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        // Space bar to click
        if (e.code === 'Space' && !e.repeat) {
            e.preventDefault();
            const btn = document.getElementById('main-click-btn');
            const rect = btn.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;
            game.click(x, y);
            
            // Visual feedback
            btn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                btn.style.transform = '';
            }, 100);
        }
        
        // Tab shortcuts
        if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
                case 's':
                    e.preventDefault();
                    game.saveGame();
                    notifications.success('Saved!', 'Game saved');
                    break;
                case 'e':
                    e.preventDefault();
                    game.exportSave();
                    break;
            }
        }
        
        // Number keys for tabs
        if (e.key >= '1' && e.key <= '5' && !e.ctrlKey && !e.metaKey) {
            const tabButtons = document.querySelectorAll('.tab-btn');
            const index = parseInt(e.key) - 1;
            if (tabButtons[index]) {
                tabButtons[index].click();
            }
        }
    });
    
    // Prevent accidental navigation
    window.addEventListener('beforeunload', (e) => {
        game.saveGame();
    });
    
    // ===== MOBILE TOUCH SUPPORT =====
    
    // Prevent default touch behaviors to avoid zoom and scrolling issues
    if (isMobile) {
        document.body.style.overflow = 'auto';
        document.body.style.position = 'relative';
        
        // Prevent pull-to-refresh on mobile
        document.body.addEventListener('touchmove', (e) => {
            if (e.target === document.body) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // Prevent double-tap zoom on specific elements
        const preventZoomElements = document.querySelectorAll('.main-click-btn, .tab-btn, .upgrade-card, .generator-card, .powerup-card, .setting-btn');
        preventZoomElements.forEach(element => {
            element.addEventListener('touchend', (e) => {
                e.preventDefault();
                element.click();
            }, { passive: false });
        });
    }
    
    // Visual feedback and click handling is now consolidated in initializeUI()
    // No duplicate event listeners needed here
    
    // Animate numbers on hover
    const animateNumber = (element, start, end, duration = 1000) => {
        const startTime = performance.now();
        
        const update = (currentTime) => {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            const current = start + (end - start) * progress;
            element.textContent = game.formatNumber(current);
            
            if (progress < 1) {
                requestAnimationFrame(update);
            }
        };
        
        requestAnimationFrame(update);
    };
    
    // Easter eggs and fun messages
    const easterEggs = [
        { clicks: 100, message: ' Century Club!' },
        { clicks: 500, message: ' You are on fire!' },
        { clicks: 1000, message: ' Thousand clicks! Legend!' },
        { clicks: 5000, message: ' To the moon!' },
        { clicks: 10000, message: ' UNSTOPPABLE!' },
        { energy: 1000000, message: ' Million Energy Club!' },
        { energy: 1000000000, message: ' Billion Energy Royalty!' },
        { level: 20, message: ' Rising Star!' },
        { level: 50, message: ' Superstar Status!' },
        { level: 100, message: ' LEGENDARY!' }
    ];
    
    let triggeredEasterEggs = new Set();
    
    setInterval(() => {
        easterEggs.forEach((egg, index) => {
            if (triggeredEasterEggs.has(index)) return;
            
            let triggered = false;
            
            if (egg.clicks && game.stats.totalClicks >= egg.clicks) {
                triggered = true;
            } else if (egg.energy && game.stats.totalEnergy >= egg.energy) {
                triggered = true;
            } else if (egg.level && game.level >= egg.level) {
                triggered = true;
            }
            
            if (triggered) {
                triggeredEasterEggs.add(index);
                notifications.info(' Achievement!', egg.message, 3000);
                
                // Celebration effect on main button
                const btn = document.getElementById('main-click-btn');
                particleSystem.createCelebration(btn);
            }
        });
    }, 2000);
    
    // Tips system
    const tips = [
        'Tip: Press SPACE to click!',
        'Tip: Use number keys 1-5 to switch tabs quickly!',
        'Tip: Combos increase your click power - keep clicking!',
        'Tip: Generators provide passive income even when you are away!',
        'Tip: Prestige gives permanent bonuses - do not be afraid to reset!',
        'Tip: Power-ups can dramatically boost your progress!',
        'Tip: Watch for special events - they give huge rewards!',
        'Tip: Achievements grant permanent bonuses!',
        'Tip: Level up to unlock new features!',
        'Tip: Critical hits deal massive damage - upgrade your crit chance!',
        'Tip: Auto-clickers work even when you are not clicking!',
        'Tip: Higher combos = higher rewards!',
        'Tip: Save your game regularly with Ctrl+S!',
        'Tip: Export your save to backup your progress!',
        'Tip: Milestones give permanent bonuses automatically!'
    ];
    
    let tipIndex = 0;
    setInterval(() => {
        if (Math.random() < 0.3) { // 30% chance every interval
            notifications.info('', tips[tipIndex], 4000);
            tipIndex = (tipIndex + 1) % tips.length;
        }
    }, 60000); // Every minute
    
    // Performance monitoring
    let fps = 0;
    let lastFrameTime = performance.now();
    
    const monitorPerformance = () => {
        const currentTime = performance.now();
        fps = 1000 / (currentTime - lastFrameTime);
        lastFrameTime = currentTime;
        
        // Log warnings for low FPS
        if (fps < 30 && fps > 0) {
            console.warn('Low FPS detected:', Math.floor(fps));
        }
        
        requestAnimationFrame(monitorPerformance);
    };
    
    monitorPerformance();
    
    // Mobile particle cleanup for performance
    if (isMobile) {
        setInterval(() => {
            if (particleSystem && particleSystem.cleanup) {
                particleSystem.cleanup();
            }
        }, 2000); // Clean up every 2 seconds on mobile
    }
    
    // Debug mode (toggle with Ctrl+Shift+D)
    let debugMode = false;
    document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.shiftKey && e.key === 'D') {
            debugMode = !debugMode;
            console.log('Debug mode:', debugMode ? 'ON' : 'OFF');
            
            if (debugMode) {
                // Add debug overlay
                const debugOverlay = document.createElement('div');
                debugOverlay.id = 'debug-overlay';
                debugOverlay.style.cssText = `
                    position: fixed;
                    top: 10px;
                    left: 10px;
                    background: rgba(0, 0, 0, 0.8);
                    color: #00ff00;
                    padding: 10px;
                    font-family: monospace;
                    font-size: 12px;
                    z-index: 10000;
                    border: 2px solid #00ff00;
                    border-radius: 5px;
                `;
                document.body.appendChild(debugOverlay);
                
                setInterval(() => {
                    if (debugMode) {
                        const overlay = document.getElementById('debug-overlay');
                        if (overlay) {
                            overlay.innerHTML = `
                                FPS: ${Math.floor(fps)}<br>
                                Energy: ${game.formatNumber(game.energy)}<br>
                                Energy/sec: ${game.formatNumber(generatorsManager.getTotalProduction(game))}<br>
                                Clicks: ${game.stats.totalClicks}<br>
                                Combo: ${game.comboCount}<br>
                                Level: ${game.level}<br>
                                Prestige: ${game.prestigeCount}<br>
                            `;
                        }
                    }
                }, 100);
            } else {
                const overlay = document.getElementById('debug-overlay');
                if (overlay) overlay.remove();
            }
        }
    });
    
    // Console commands for testing
    window.cheat = {
        addEnergy: (amount) => {
            game.energy += amount;
            game.stats.totalEnergy += amount;
            console.log(`Added ${amount} energy`);
        },
        addPrestigePoints: (amount) => {
            game.prestigePoints += amount;
            console.log(`Added ${amount} prestige points`);
        },
        setLevel: (level) => {
            game.level = level;
            console.log(`Set level to ${level}`);
        },
        unlockAll: () => {
            achievementsManager.achievements.forEach(a => {
                if (!a.unlocked) {
                    a.unlocked = true;
                    a.apply(game);
                }
            });
            console.log('Unlocked all achievements');
        },
        maxAll: () => {
            upgradesManager.upgrades.forEach(u => {
                while (!upgradesManager.isMaxed(u)) {
                    u.currentLevel++;
                    u.apply(game);
                }
            });
            console.log('Maxed all upgrades');
        }
    };
    
    console.log('%cDebug commands available:', 'color: #00ffff; font-weight: bold');
    console.log('%ccheat.addEnergy(amount)', 'color: #00ff00');
    console.log('%ccheat.addPrestigePoints(amount)', 'color: #00ff00');
    console.log('%ccheat.setLevel(level)', 'color: #00ff00');
    console.log('%ccheat.unlockAll()', 'color: #00ff00');
    console.log('%ccheat.maxAll()', 'color: #00ff00');
    console.log('%cPress Ctrl+Shift+D for debug overlay', 'color: #ffff00');
    
    // Celebrate milestones
    let lastLevel = game.level;
    setInterval(() => {
        if (game.level > lastLevel) {
            const mainBtn = document.getElementById('main-click-btn');
            particleSystem.createCelebration(mainBtn);
            lastLevel = game.level;
        }
    }, 1000);
    
    // Auto-save indicator
    setInterval(() => {
        const timeSinceLastSave = Date.now() - game.lastSave;
        if (timeSinceLastSave < 1000) {
            // Flash a save indicator
            const saveBtn = document.getElementById('save-btn');
            saveBtn.style.borderColor = '#00ff00';
            setTimeout(() => {
                saveBtn.style.borderColor = '';
            }, 500);
        }
    }, 500);
    
    console.log('%c Game initialized successfully!', 'color: #00ff00; font-weight: bold; font-size: 14px');
    console.log('%c Have fun playing Neon Nexus!', 'color: #ff00ff; font-weight: bold; font-size: 14px');
}

// Call initGame immediately if DOM is already loaded, or wait for it
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initGame);
} else {
    // DOM is already loaded, call initGame immediately
    initGame();
}
    </script>
    

    <!-- Tooltip -->
    <div class="tooltip" id="game-tooltip">
        <div class="tooltip-title" id="tooltip-title"></div>
        <div class="tooltip-content" id="tooltip-content"></div>
    </div>
</body>
</html>
